[{"content":" # ç®€ä»‹ go-iniæ˜¯ Go è¯­è¨€ä¸­ç”¨äºæ“ä½œ ini æ–‡ä»¶çš„ç¬¬ä¸‰æ–¹åº“ã€‚\næœ¬æ–‡ä»‹ç»go-iniåº“çš„ä½¿ç”¨ã€‚\n# inié…ç½®æ–‡ä»¶ä»‹ç» ini æ˜¯ Windows ä¸Šå¸¸ç”¨çš„é…ç½®æ–‡ä»¶æ ¼å¼ã€‚MySQL çš„ Windows ç‰ˆå°±æ˜¯ä½¿ç”¨ ini æ ¼å¼å­˜å‚¨é…ç½®çš„ã€‚\n.iniæ–‡ä»¶æ˜¯Initialization Fileçš„ç¼©å†™ï¼Œå³åˆå§‹åŒ–æ–‡ä»¶ï¼Œiniæ–‡ä»¶æ ¼å¼ï¼š[èŠ‚/section/åˆ†åŒº/è¡¨/æ®µ]+é”®=å€¼ã€‚\nèŠ‚å¯ä»¥ä¸ºç©ºï¼Œä½†å‚æ•°ï¼ˆkey=valueï¼‰å°±éœ€è¦å†™åœ¨å¼€å¤´ã€‚å› ä¸ºä¸€ä¸ªsectionæ²¡æœ‰æ˜æ˜¾çš„ç»“æŸæ ‡è¯†ç¬¦ï¼Œä¸€ä¸ªsectionçš„å¼€å§‹å°±æ˜¯ä¸Šä¸€ä¸ªsectionçš„ç»“æŸï¼Œæˆ–è€…æ˜¯æ–‡ä»¶ç»“æŸã€‚ æ‰€æœ‰çš„sectionåç§°éƒ½æ˜¯ç‹¬å ä¸€è¡Œï¼Œå¹¶ä¸”sectionåå­—éƒ½è¢«æ–¹æ‹¬å·åŒ…å›´ç€ï¼ˆ[å’Œ]ï¼‰ã€‚ iniæ–‡ä»¶ä¸æ”¯æŒå¤šä¸ªæ–¹æ‹¬å·åµŒå¥—ã€‚æœ‰çš„å°±ä¸ä»¥inié…ç½®æ–‡ä»¶æ ¼å¼è¯»å–ã€‚ inié…ç½®æ–‡ä»¶åç¼€ä¸ä¸€å®šæ˜¯.iniï¼Œä¹Ÿå¯ä»¥æ˜¯.cfgã€.confæˆ–è€…æ˜¯.txtã€‚ èŠ‚ååŒºåˆ†å¤§å°å†™ï¼Œå»ºè®®ç”¨_è¿æ¥ã€‚ æ‰€æœ‰çš„å‚æ•°éƒ½æ˜¯ä»¥sectionä¸ºå•ä½ç»“åˆåœ¨ä¸€èµ·çš„ã€‚å¯ä»¥æœ‰å¤šä¸ªå‚æ•°ï¼Œä½†ä¸€ä¸ªå‚æ•°ç‹¬å ä¸€è¡Œã€‚ åœ¨sectionå£°æ˜åçš„æ‰€æœ‰parameterséƒ½å±äºè¯¥sectionã€‚ åŒºåˆ†å¤§å°å†™ï¼Œå»ºè®®ç”¨_è¿æ¥ã€‚ æ³¨é‡Šï¼ˆcommentsï¼‰ä½¿ç”¨åˆ†å·è¡¨ç¤ºï¼ˆ;ï¼‰æˆ–è€…#å·ï¼Œåœ¨åˆ†å·ã€#å·åé¢çš„æ–‡å­—ï¼Œç›´åˆ°è¯¥è¡Œç»“å°¾éƒ½å…¨éƒ¨ä¸ºæ³¨é‡Šã€‚\n1 2 3 4 5 # app=name app_name = awesome web [mysql] ip = 127.0.0.1 ; database=mysql .iniæ–‡ä»¶æ˜¯windowsçš„ç³»ç»Ÿé…ç½®æ–‡ä»¶ï¼Œç»Ÿç®¡windowsçš„å„é¡¹é…ç½®ï¼Œæœ€é‡è¦çš„å°±æ˜¯â€œSystem.iniâ€ã€â€œSystem32.iniâ€å’Œâ€œWin.iniâ€ã€‚è¯¥æ–‡ä»¶ä¸»è¦å­˜æ”¾ç”¨æˆ·æ‰€åšçš„é€‰æ‹©ä»¥åŠç³»ç»Ÿçš„å„ç§å‚æ•°ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡ä¿®æ”¹INIæ–‡ä»¶ï¼Œæ¥æ”¹å˜åº”ç”¨ç¨‹åºå’Œç³»ç»Ÿçš„å¾ˆå¤šé…ç½®ã€‚ä¸€èˆ¬ç”¨æˆ·å°±ç”¨windowsæä¾›çš„å„é¡¹å›¾å½¢åŒ–ç®¡ç†ç•Œé¢å°±å¯å®ç°ç›¸åŒçš„é…ç½®äº†ï¼Œä½†åœ¨æŸäº›æƒ…å†µï¼Œè¿˜æ˜¯è¦ç›´æ¥ç¼–è¾‘.iniæ‰æ–¹ä¾¿ï¼Œä¸€èˆ¬åªæœ‰å¾ˆç†Ÿæ‚‰windowsæ‰èƒ½å»ç›´æ¥ç¼–è¾‘ã€‚\nåœ¨Windowsç³»ç»Ÿä¸­ï¼Œæ³¨å†Œè¡¨çš„å‡ºç°ï¼Œè®©INIæ–‡ä»¶åœ¨Windowsç³»ç»Ÿçš„åœ°ä½å°±å¼€å§‹ä¸æ–­ä¸‹æ»‘ï¼Œå› ä¸ºæ³¨å†Œè¡¨ç‹¬ç‰¹ä¼˜ç‚¹ï¼Œä½¿åº”ç”¨ç¨‹åºå’Œç³»ç»Ÿéƒ½æŠŠè®¸å¤šå‚æ•°å’Œåˆå§‹åŒ–ä¿¡æ¯å­˜æ”¾è¿›äº†æ³¨å†Œè¡¨ä¸­ã€‚ä½†åœ¨æŸäº›åœºåˆï¼ŒINIæ–‡ä»¶è¿˜æ‹¥æœ‰ä¸å¯æ›¿ä»£çš„åœ°ä½ã€‚ åœ¨inié…ç½®æ–‡ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å ä½ç¬¦%(name)sè¡¨ç¤ºç”¨ä¹‹å‰å·²å®šä¹‰çš„é”®nameçš„å€¼æ¥æ›¿æ¢ï¼Œè¿™é‡Œçš„sè¡¨ç¤ºå€¼ä¸ºå­—ç¬¦ä¸²ç±»å‹ã€‚4\nåœ¨sectionåç§°ä¸­å¯ä»¥ç”¨.æ¥è¡¨ç¤ºä¸¤ä¸ªæˆ–å¤šä¸ªåˆ†åŒºä¹‹é—´çš„çˆ¶å­å…³ç³»ã€‚ 1 2 3 4 5 6 7 8 NAME = ini VERSION = v1 IMPORT_PATH = gopkg.in/%(NAME)s.%(VERSION)s [package] CLONE_URL = https://%(IMPORT_PATH)s [package.sub] packageçš„æ²¡æœ‰çˆ¶åˆ†åŒºã€‚\nå¦‚æœæŸä¸ªé”®åœ¨å­åˆ†åŒºä¸­ä¸å­˜åœ¨ï¼Œåˆ™ä¼šåœ¨å®ƒçš„çˆ¶åˆ†åŒºä¸­å†æ¬¡æŸ¥æ‰¾ï¼Œç›´åˆ°æ²¡æœ‰çˆ¶åˆ†åŒºä¸ºæ­¢ã€‚ iniæ–‡ä»¶é”®å€¼å¦‚æœå­˜åœ¨å¤šè¡Œç”¨\u0026quot;\u0026quot;\u0026quot;\u0026quot;\u0026quot;åŒ…è£¹ã€‚\nä¸€è¡Œå†™ä¸ä¸‹å¯ä»¥ä½¿ç”¨\\ï¼Œå¦èµ·ä¸€è¡Œã€‚\nIgnoreContinuationå¯ä»¥å¿½ç•¥è¿ç»­è¡Œã€‚ # å¿«é€Ÿä½¿ç”¨ go-ini æ˜¯ç¬¬ä¸‰æ–¹åº“ï¼Œä½¿ç”¨å‰éœ€è¦å®‰è£…[æ¨èã€‘ï¼š\n1 $ go get -u gopkg.in/ini.v1 ä¹Ÿå¯ä»¥ä½¿ç”¨ GitHub ä¸Šçš„ä»“åº“ï¼š\n1 $ go get -u github.com/go-ini/ini ä¸ºä»€ä¹ˆæ¨ègopkg.in,å‚è€ƒæ–‡ç« ï¼šgopkg.inä»‹ç»\né¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªmy.inié…ç½®æ–‡ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 app_name = awesome web ; è¿™æ˜¯æ³¨é‡Š # possible values: DEBUG, INFO, WARNING, ERROR, FATAL log_level = DEBUG # è¿™ä¹Ÿæ˜¯æ³¨é‡Š ; database=mysql [mysql] ip = 127.0.0.1 port = 3306 user = root password = 123456 database = awesome [redis] ip = 127.0.0.1 port = 6381 ä½¿ç”¨ go-ini åº“è¯»å–ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;gopkg.in/ini.v1\u0026#34; ) func main() { cfg, err := ini.Load(\u0026#34;my.ini\u0026#34;) if err != nil { log.Fatal(\u0026#34;Fail to read file: \u0026#34;, err) } fmt.Println(\u0026#34;App Name:\u0026#34;, cfg.Section(\u0026#34;\u0026#34;).Key(\u0026#34;app_name\u0026#34;).String()) fmt.Println(\u0026#34;Log Level:\u0026#34;, cfg.Section(\u0026#34;\u0026#34;).Key(\u0026#34;log_level\u0026#34;).String()) fmt.Println(\u0026#34;MySQL IP:\u0026#34;, cfg.Section(\u0026#34;mysql\u0026#34;).Key(\u0026#34;ip\u0026#34;).String()) mysqlPort, err := cfg.Section(\u0026#34;mysql\u0026#34;).Key(\u0026#34;port\u0026#34;).Int() if err != nil { log.Fatal(err) } fmt.Println(\u0026#34;MySQL Port:\u0026#34;, mysqlPort) fmt.Println(\u0026#34;MySQL User:\u0026#34;, cfg.Section(\u0026#34;mysql\u0026#34;).Key(\u0026#34;user\u0026#34;).String()) fmt.Println(\u0026#34;MySQL Password:\u0026#34;, cfg.Section(\u0026#34;mysql\u0026#34;).Key(\u0026#34;password\u0026#34;).String()) fmt.Println(\u0026#34;MySQL Database:\u0026#34;, cfg.Section(\u0026#34;mysql\u0026#34;).Key(\u0026#34;database\u0026#34;).String()) fmt.Println(\u0026#34;Redis IP:\u0026#34;, cfg.Section(\u0026#34;redis\u0026#34;).Key(\u0026#34;ip\u0026#34;).String()) redisPort, err := cfg.Section(\u0026#34;redis\u0026#34;).Key(\u0026#34;port\u0026#34;).Int() if err != nil { log.Fatal(err) } fmt.Println(\u0026#34;Redis Port:\u0026#34;, redisPort) } åœ¨ ini æ–‡ä»¶ä¸­ï¼Œæ¯ä¸ªé”®å€¼å¯¹å ç”¨ä¸€è¡Œï¼Œä¸­é—´ä½¿ç”¨=éš”å¼€ï¼Œå¯ä»¥æœ‰ç©ºæ ¼ï¼Œä½†ä¸æ˜¯å¿…é¡»å¾—ã€‚ä»¥#å¼€å¤´çš„å†…å®¹ä¸ºæ³¨é‡Šã€‚ini æ–‡ä»¶æ˜¯ä»¥åˆ†åŒºï¼ˆsectionï¼‰ç»„ç»‡çš„ã€‚ åˆ†åŒºä»¥[name]å¼€å§‹ï¼Œåœ¨ä¸‹ä¸€ä¸ªåˆ†åŒºå‰ç»“æŸã€‚æ‰€æœ‰åˆ†åŒºå‰çš„å†…å®¹å±äºé»˜è®¤åˆ†åŒºï¼Œå¦‚my.iniæ–‡ä»¶ä¸­çš„app_nameå’Œlog_levelã€‚\nä½¿ç”¨go-iniè¯»å–é…ç½®æ–‡ä»¶çš„æ­¥éª¤å¦‚ä¸‹ï¼š\né¦–å…ˆè°ƒç”¨ini.LoadåŠ è½½æ–‡ä»¶ï¼Œå¾—åˆ°é…ç½®å¯¹è±¡cfgï¼› ç„¶åä»¥åˆ†åŒºåè°ƒç”¨é…ç½®å¯¹è±¡çš„Sectionæ–¹æ³•å¾—åˆ°å¯¹åº”çš„åˆ†åŒºå¯¹è±¡sectionï¼Œé»˜è®¤åˆ†åŒºçš„åå­—ä¸º\u0026quot;\u0026quot;ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ini.DefaultSectionï¼› ä»¥é”®åè°ƒç”¨åˆ†åŒºå¯¹è±¡çš„Keyæ–¹æ³•å¾—åˆ°å¯¹åº”çš„é…ç½®é¡¹keyå¯¹è±¡ï¼› ç”±äºæ–‡ä»¶ä¸­è¯»å–å‡ºæ¥çš„éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œkeyå¯¹è±¡éœ€æ ¹æ®ç±»å‹è°ƒç”¨å¯¹åº”çš„æ–¹æ³•è¿”å›å…·ä½“ç±»å‹çš„å€¼ä½¿ç”¨ï¼Œå¦‚ä¸Šé¢çš„Stringã€MustIntæ–¹æ³•ã€‚ è¿è¡Œä»¥ä¸‹ç¨‹åºï¼Œå¾—åˆ°è¾“å‡ºï¼š\n1 2 3 4 5 6 7 8 9 10 $ go run main.go App Name: awesome web Log Level: DEBUG MySQL IP: 127.0.0.1 MySQL Port: 3306 MySQL User: root MySQL Password: 123456 MySQL Database: awesome Redis IP: 127.0.0.1 Redis Port: 6381 é…ç½®æ–‡ä»¶ä¸­å­˜å‚¨çš„éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ç±»å‹ä¸ºå­—ç¬¦ä¸²çš„é…ç½®é¡¹ä¸ä¼šå‡ºç°ç±»å‹è½¬æ¢å¤±è´¥çš„ï¼Œæ•…String()æ–¹æ³•åªè¿”å›ä¸€ä¸ªå€¼ã€‚ ä½†å¦‚æœç±»å‹ä¸ºInt/Uint/Float64è¿™äº›æ—¶ï¼Œè½¬æ¢å¯èƒ½å¤±è´¥ã€‚æ‰€ä»¥Int()/Uint()/Float64()è¿”å›ä¸€ä¸ªå€¼å’Œä¸€ä¸ªé”™è¯¯ã€‚\nè¦ç•™æ„è¿™ç§ä¸ä¸€è‡´ï¼å¦‚æœæˆ‘ä»¬å°†é…ç½®ä¸­ redis ç«¯å£æ”¹æˆéæ³•çš„æ•°å­— x6381ï¼Œé‚£ä¹ˆè¿è¡Œç¨‹åºå°†æŠ¥é”™ï¼š\n1 2 2024/05/16 11:45:00 strconv.ParseInt: parsing \u0026#34;x6381\u0026#34;: invalid syntax exit status 1 # Must*ä¾¿æ·æ–¹æ³• å¦‚æœæ¯æ¬¡å–å€¼éƒ½éœ€è¦è¿›è¡Œé”™è¯¯åˆ¤æ–­ï¼Œé‚£ä¹ˆä»£ç å†™èµ·æ¥ä¼šéå¸¸ç¹çã€‚ä¸ºæ­¤ï¼Œgo-iniä¹Ÿæä¾›å¯¹åº”çš„MustTypeï¼ˆType ä¸ºInit/Uint/Float64ç­‰ï¼‰æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åªè¿”å›ä¸€ä¸ªå€¼ã€‚ åŒæ—¶å®ƒæ¥å—å¯å˜å‚æ•°ï¼Œå¦‚æœç±»å‹æ— æ³•è½¬æ¢ï¼Œå–å‚æ•°ä¸­ç¬¬ä¸€ä¸ªå€¼è¿”å›ï¼Œå¹¶ä¸”è¯¥å‚æ•°è®¾ç½®ä¸ºè¿™ä¸ªé…ç½®çš„å€¼ï¼Œä¸‹æ¬¡è°ƒç”¨è¿”å›è¿™ä¸ªå€¼ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;gopkg.in/ini.v1\u0026#34; ) func main() { cfg, err := ini.Load(\u0026#34;my.ini\u0026#34;) if err != nil { log.Fatal(\u0026#34;Fail to read file: \u0026#34;, err) } redisPort, err := cfg.Section(\u0026#34;redis\u0026#34;).Key(\u0026#34;port\u0026#34;).Int() if err != nil { fmt.Println(\u0026#34;before must, get redis port error:\u0026#34;, err) } else { fmt.Println(\u0026#34;before must, get redis port:\u0026#34;, redisPort) } fmt.Println(\u0026#34;redis Port:\u0026#34;, cfg.Section(\u0026#34;redis\u0026#34;).Key(\u0026#34;port\u0026#34;).MustInt(6381)) redisPort, err = cfg.Section(\u0026#34;redis\u0026#34;).Key(\u0026#34;port\u0026#34;).Int() if err != nil { fmt.Println(\u0026#34;after must, get redis port error:\u0026#34;, err) } else { fmt.Println(\u0026#34;after must, get redis port:\u0026#34;, redisPort) } } é…ç½®æ–‡ä»¶è¿˜æ˜¯ redis ç«¯å£ä¸ºéæ•°å­— x6381 æ—¶çš„çŠ¶æ€ï¼Œè¿è¡Œç¨‹åºï¼š\n1 2 3 4 $ go run main.go before must, get redis port error: strconv.ParseInt: parsing \u0026#34;x6381\u0026#34;: invalid syntax redis Port: 6381 after must, get redis port: 6381 æˆ‘ä»¬çœ‹åˆ°ç¬¬ä¸€æ¬¡è°ƒç”¨Intè¿”å›é”™è¯¯ï¼Œä»¥ 6381 ä¸ºå‚æ•°è°ƒç”¨MustIntä¹‹åï¼Œå†æ¬¡è°ƒç”¨Intï¼ŒæˆåŠŸè¿”å› 6381ã€‚MustIntæºç ä¹Ÿæ¯”è¾ƒç®€å•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 func (k *Key) MustInt(defaultVal ...int) int { val, err := k.Int() if len(defaultVal) \u0026gt; 0 \u0026amp;\u0026amp; err != nil { k.value = strconv.FormatInt(int64(defaultVal[0]), 10) return defaultVal[0] } return val } func (k *Key) Int() (int, error) { v, err := strconv.ParseInt(k.String(), 0, 64) return int(v), err } # åŠ è½½iniæ–‡ä»¶å¯¹è±¡ go-iniæ”¯æŒä»å¤šä¸ªæ•°æ®æºåŠ è½½inié…ç½®æ–‡ä»¶ã€‚\næ•°æ®æº å¯ä»¥æ˜¯ []byte ç±»å‹çš„åŸå§‹æ•°æ®ï¼Œstring ç±»å‹çš„æ–‡ä»¶è·¯å¾„æˆ– io.ReadCloserã€‚å¯ä»¥åŠ è½½è¿™ä¸‰ä¸ª ä»»æ„å¤šä¸ª æ•°æ®ï¼Œå¦‚æœæ˜¯å…¶ä»–çš„ç±»å‹ä¼šè¿”å›é”™è¯¯ã€‚è°ƒç”¨Load(source interface{}, others ...interface{})å‡½æ•°ã€‚\nå½“åˆ›å»ºå¥½iniæ–‡ä»¶å¯¹è±¡ä¹‹åï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¾€é‡Œé¢æ·»åŠ æ•°æ®æºã€‚è°ƒç”¨func (f *File) Append(source interface{}, others ...interface{})æ–¹æ³•ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 package main import ( \u0026#34;bytes\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;io\u0026#34; \u0026#34;log\u0026#34; \u0026#34;strings\u0026#34; \u0026#34;github.com/go-ini/ini\u0026#34; ) func main() { raw := []byte(`raw=åŸå§‹æ•°æ®`) noClose := strings.NewReader(\u0026#34;string=noClose\u0026#34;) cfg, err := ini.Load(raw, \u0026#34;./my.cfg\u0026#34;, io.NopCloser(noClose), io.NopCloser(bytes.NewBufferString(\u0026#34;close=have closer\u0026#34;)), ) if err != nil { log.Fatal(\u0026#34;Load error:\u0026#34;, err) } fmt.Println(cfg.Section(\u0026#34;\u0026#34;).Key(\u0026#34;raw\u0026#34;).String()) fmt.Println(cfg.Section(\u0026#34;\u0026#34;).Key(\u0026#34;username\u0026#34;).String()) fmt.Println(cfg.Section(\u0026#34;\u0026#34;).Key(\u0026#34;string\u0026#34;).String()) fmt.Println(cfg.Section(\u0026#34;\u0026#34;).Key(\u0026#34;close\u0026#34;).String()) err = cfg.Append(io.NopCloser(bytes.NewReader([]byte(\u0026#34;append=append\u0026#34;)))) if err != nil { log.Fatal(\u0026#34;Append error:\u0026#34;, err) } fmt.Println(cfg.Section(\u0026#34;\u0026#34;).Key(\u0026#34;append\u0026#34;).String()) } io.NopCloserå‡½æ•°ï¼ˆno optiontion closerï¼‰æ˜¯å°†æ²¡æœ‰Closeæ–¹æ³•çš„Readeræ·»åŠ Closeæ–¹æ³•ï¼ˆè½¬æ¢æˆå®ç°ReadCloseræ¥å£çš„Readerï¼‰ï¼Œåªä¸è¿‡æ˜¯ä¸ºäº†é˜²æ­¢å‘bytes.NewReaderã€strings.NewReaderè¿™æ ·çš„Readeræ²¡æœ‰Closeæ–¹æ³•ï¼Œåº•å±‚åœ¨è‡ªåŠ¨å…³é—­çš„æ—¶å€™å‡ºé”™ã€‚æ²¡æœ‰å…³é—­æ“ä½œçš„Readerï¼Œå…³é—­æ—¶æ²¡ä»»ä½•æ“ä½œï¼Œæœ‰çš„è°ƒç”¨è‡ªèº«çš„Closeæ–¹æ³•ã€‚\nè¿è¡Œç¨‹åºè¾“å‡ºï¼š\n1 2 3 4 5 6 $ go run main.go åŸå§‹æ•°æ® arlettebrook noClose have closer append è¿˜å¯ä»¥åˆ›å»ºä¸€ä¸ªæ²¡æœ‰ä»»ä½•æ•°æ®æºçš„æ–‡ä»¶å¯¹è±¡ã€‚è°ƒç”¨Emptyå‡½æ•°ã€‚\n1 cfg := ini.Empty() è°ƒç”¨ç”¨LooseLoadçš„å‡½æ•°åŠ è½½æ–‡ä»¶å¯¹è±¡ï¼Œè‹¥æŒ‡å®šçš„æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¸ä¼šè¿”å›é”™è¯¯ã€‚Loadä¼šè¿”å›é”™è¯¯ã€‚\næ›´ç‰›é€¼çš„æ˜¯ï¼Œå½“é‚£äº›ä¹‹å‰ä¸å­˜åœ¨çš„æ–‡ä»¶åœ¨é‡æ–°è°ƒç”¨ Reload() æ–¹æ³•çš„æ—¶å€™çªç„¶å‡ºç°äº†ï¼Œé‚£ä¹ˆå®ƒä»¬ä¼šè¢«æ­£å¸¸åŠ è½½ã€‚\næºç æ˜¯ï¼šåˆ›å»ºæ–‡ä»¶å¯¹è±¡çš„æ—¶å€™ä¼šåŠ è½½ä¸€æ¬¡ï¼Œåˆ›å»ºå®Œæ¯•ä¹‹ååˆä¼šåŠ è½½ä¸€æ¬¡ã€‚ 1 cfg, err := ini.LooseLoad(\u0026#34;filename\u0026#34;, \u0026#34;filename_404\u0026#34;) é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“å¤šä¸ªæ•°æ®æºä¸­æœ‰ç›¸åŒçš„é”®æ—¶ï¼Œåé¢çš„æ•°æ®æºä¼šè¦†ç›–å‰é¢çš„æ•°æ®æºã€‚\nè°ƒç”¨ ShadowLoadå‡½æ•°ï¼Œåˆ›å»ºçš„æ•°æ®æºä¸ä¼šè¦†ç›–å­˜åœ¨çš„å€¼ã€‚ # è‡ªå®šä¹‰åŠ è½½iniæ–‡ä»¶å¯¹è±¡ å®ç°ä¸Šè°ƒç”¨Loadã€LooseLoadã€InsensitiveLoadï¼ˆåé¢ä¼šä»‹ç»ï¼‰ã€ShadowLoadåŠ è½½ä¸åŒé…ç½®çš„æ–‡ä»¶å¯¹è±¡ï¼Œåº•å±‚éƒ½æ˜¯è°ƒç”¨LoadSources(opts LoadOptions, source interface{}, others ...interface{})å‡½æ•°å®ç°çš„ã€‚ä¸åŒçš„é…ç½®æ˜¯é€šè¿‡LoadOptionsé…ç½®çš„ã€‚åé¢çš„å‚æ•°éƒ½æ˜¯æ•°æ®æºï¼Œé»˜è®¤å¿…é¡»æœ‰ä¸€ä¸ªæ•°æ®æºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 func Load(source interface{}, others ...interface{}) (*File, error) { return LoadSources(LoadOptions{}, source, others...) } func LooseLoad(source interface{}, others ...interface{}) (*File, error) { return LoadSources(LoadOptions{Loose: true}, source, others...) } func InsensitiveLoad(source interface{}, others ...interface{}) (*File, error) { return LoadSources(LoadOptions{Insensitive: true}, source, others...) } func ShadowLoad(source interface{}, others ...interface{}) (*File, error) { return LoadSources(LoadOptions{AllowShadows: true}, source, others...) } ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œéƒ½å°†ä¸åŒçš„é…ç½®å°è£…åˆ°äº†ä¸åŒçš„å‡½æ•°ã€‚\næ‰€ä»¥åˆ©ç”¨LoadSourcesæˆ‘ä»¬å¯ä»¥å®ç°è‡ªå®šä¹‰åŠ è½½ä¸åŒé…ç½®çš„æ–‡ä»¶å¯¹è±¡ã€‚\nåŠ è½½é€‰é¡¹LoadOptionså¸¸ç”¨çš„å±æ€§ï¼š\nLooseï¼šæ˜¯å¦å¿½ç•¥æ–‡ä»¶è·¯å¾„ä¸å­˜åœ¨çš„é”™è¯¯ã€‚\nInsensitiveï¼šæ˜¯å¦å¯ç”¨ä¸æ•æ„ŸåŠ è½½ï¼Œä½œç”¨ï¼šå¿½ç•¥é”®åçš„å¤§å°å†™ã€‚åº•å±‚æ˜¯å°†é”®éƒ½è½¬æ¢ä¸ºå°å†™ã€‚é”®ååŒ…æ‹¬åˆ†åŒºåã€‚\nAllowShadowsï¼šæ˜¯å¦ä¸è¦†ç›–å­˜åœ¨é”®çš„å€¼ã€‚å¼€å¯ä¸è¦†ç›–ä¹‹åï¼Œå¯ä»¥è°ƒç”¨ValueWithShadowsæ–¹æ³•ï¼Œè·å–æŒ‡å®šåˆ†åŒºä¸‹æ‰€æœ‰çš„é‡å¤é”®çš„å€¼ã€‚\nUnescapeValueDoubleQuotesï¼šæ˜¯å¦å¼ºåˆ¶å¿½ç•¥é”®å€¼ä¸¤ç«¯çš„åŒå¼•å·ã€‚ç”¨åœ¨å¤šä¸ªåŒå¼•å·çš„å€¼ä¸­ã€‚\nSkipUnrecognizableLinesï¼šæ˜¯å¦è·³è¿‡æ— æ³•è¯†åˆ«çš„è¡Œã€‚é»˜è®¤æ— æ³•è¯†åˆ«å°±ä¼šæŠ¥é”™ã€‚\nIgnoreContinuationï¼šæ˜¯å¦å¿½ç•¥è¿ç»­æ¢è¡Œã€‚å°±æ˜¯é”®å€¼ä¸æ”¯æŒæ¢æ¢è¡Œå†™\\ã€‚\nUnparseableSectionsï¼šæ ‡è®°ä¸€ä¸ªåˆ†åŒºä¸ºæ— æ³•è§£æã€‚å½“è·å–æ— æ³•è§£æçš„åˆ†åŒºæ—¶ï¼Œè°ƒç”¨Bodyæ–¹æ³•ä¼šè·å–è¯¥åˆ†åŒºçš„åŸå§‹æ•°æ®ï¼Œæœªæ ‡è®°æ— æ³•è·å–ï¼ŒåŒæ—¶æœªæ ‡è®°ä¸€ä¸ªæ— æ³•è§£æçš„åˆ†åŒºï¼Œè§£æä¼šæŠ¥é”™ã€‚é™¤éå¼€è·³è¿‡æ— æ³•è§£æçš„è¡Œã€‚\nAllowBooleanKeys: æ˜¯å¦å¼€å¯å¸ƒå°”é”®ã€‚å¼€å¯å…è®¸åªæœ‰ä¸€ä¸ªé”®ï¼Œè€Œæ²¡æœ‰å€¼ã€‚è§£æä¸ä¼šæŠ¥é”™ã€‚å€¼æ°¸è¿œä¸ºtrueã€‚ä¿å­˜æ—¶ä¹Ÿåªæœ‰é”®ã€‚\nAllowPythonMultilineValuesï¼šæ˜¯å¦å…è®¸è§£æå¤šè¡Œå€¼ï¼Œç”¨äºè§£ææ¢è¡Œä¹‹åå¯¹é½çš„å­—ç¬¦ä¸²ã€‚\n1 2 3 4 5 str = --- a b c --- å¼€å¯åç±»ä¼¼ä¸Šé¢çš„å­—ç¬¦ä¸²éƒ½å¯ä»¥è§£æã€‚\nIgnoreInlineCommentï¼šå¿½ç•¥è¡Œå†…æ³¨é‡Šã€‚\nSpaceBeforeInlineCommentï¼šè¦æ±‚æ³¨é‡Šç¬¦å·å‰å¿…é¡»å¸¦æœ‰ä¸€ä¸ªç©ºæ ¼\nç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 cfg, err := ini.LoadSources(ini.LoadOptions{ Loose: true, Insensitive: true, UnescapeValueDoubleQuotes: true, AllowShadows: true, IgnoreContinuation: true, SkipUnrecognizableLines: true, UnparseableSections: []string{\u0026#34;COMMENTS\u0026#34;}, }, \u0026#34;my.cfg\u0026#34;, \u0026#34;my.ini\u0026#34;) if err != nil { log.Fatal(err) } body := cfg.Section(\u0026#34;COMMENTS\u0026#34;).Body() fmt.Println(body) // \u0026lt;1\u0026gt;\u0026lt;L.Slide#2\u0026gt; This slide has the fuel listed in the wrong units \u0026lt;e.1\u0026gt; my.cfg:\n1 2 [COMMENTS] \u0026lt;1\u0026gt;\u0026lt;L.Slide#2\u0026gt; This slide has the fuel listed in the wrong units \u0026lt;e.1\u0026gt; # æ³¨æ„äº‹é¡¹ é»˜è®¤æƒ…å†µä¸‹ï¼Œæœ¬åº“ä¼šåœ¨æ‚¨è¿›è¡Œè¯»å†™æ“ä½œæ—¶é‡‡ç”¨é”æœºåˆ¶æ¥ç¡®ä¿æ•°æ®æ—¶é—´ã€‚ä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨éå¸¸ç¡®å®šåªè¿›è¡Œè¯»æ“ä½œã€‚æ­¤æ—¶ï¼Œæ‚¨å¯ä»¥é€šè¿‡è®¾ç½® cfg.BlockMode = false æ¥å°†è¯»æ“ä½œæå‡å¤§çº¦ 50-70% çš„æ€§èƒ½ã€‚\n# æ“ä½œåˆ†åŒºï¼ˆSectionï¼‰ # è·å–åˆ†åŒº åœ¨åŠ è½½é…ç½®ä¹‹åï¼Œå¯ä»¥é€šè¿‡Sectionsæ–¹æ³•è·å–æ‰€æœ‰åˆ†åŒºå¯¹è±¡ï¼Œæ˜¯åˆ‡ç‰‡ç±»å‹çš„*Sectionå¯¹è±¡ï¼ŒSectionStrings()æ–¹æ³•è·å–æ‰€æœ‰åˆ†åŒºåã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;gopkg.in/ini.v1\u0026#34; ) func main() { cfg, err := ini.Load(\u0026#34;my.ini\u0026#34;) if err != nil { log.Fatal(\u0026#34;Fail to read file: \u0026#34;, err) } sections := cfg.Sections() sectionStrings := cfg.SectionStrings() for k, v := range sections { fmt.Printf(\u0026#34;section%v: %s\\n\u0026#34;, k+1, v.Name()) } fmt.Print(\u0026#34;sections:\u0026#34;, sectionStrings) } è¿è¡Œè¾“å‡º 3 ä¸ªåˆ†åŒºï¼š\n1 2 3 4 5 $ go run main.go section1: DEFAULT section2: mysql section3: redis sections:[DEFAULT mysql redis] è°ƒç”¨GetSection(name)è·å–æŒ‡å®šåˆ†åŒºï¼Œå¦‚æœåˆ†åŒºä¸å­˜åœ¨ï¼Œä¼šè¿”å›é”™è¯¯ä¿¡æ¯ã€‚è¿”å›çš„åˆ†åŒºä¸ºnilã€‚\nä½†è°ƒç”¨Section(name)ä¼šè·å–æŒ‡å®šåˆ†åŒºï¼Œå¦‚æœè¯¥åˆ†åŒºä¸å­˜åœ¨ï¼Œåˆ™ä¼šè‡ªåŠ¨åˆ›å»ºæŒ‡å®šç©ºåˆ†åŒºå¹¶è¿”å›ï¼š\nç¤ºä¾‹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;gopkg.in/ini.v1\u0026#34; ) func main() { cfg, err := ini.Load(\u0026#34;my.ini\u0026#34;) if err != nil { log.Fatal(\u0026#34;Fail to read file: \u0026#34;, err) } newSection, err := cfg.GetSection(\u0026#34;new\u0026#34;) if err != nil { fmt.Println(err) } fmt.Println(newSection) fmt.Println(cfg.SectionStrings()) newSection = cfg.Section(\u0026#34;new\u0026#34;) fmt.Println(newSection) fmt.Println(cfg.SectionStrings()) } åˆ›å»ºä¹‹åè°ƒç”¨SectionStringsæ–¹æ³•ï¼Œæ–°åˆ†åŒºä¹Ÿä¼šè¿”å›ï¼š\n1 2 3 4 5 6 $ go run main.go section \u0026#34;new\u0026#34; does not exist \u0026lt;nil\u0026gt; [DEFAULT mysql redis] \u0026amp;{0xc000152000 new map[] [] map[] false } [DEFAULT mysql redis new] ä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªæ–°åˆ†åŒºï¼Œå¦‚æœåˆ†åŒºå·²å­˜åœ¨ï¼Œåˆ™è¿”å›å­˜åœ¨çš„åˆ†åŒºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;gopkg.in/ini.v1\u0026#34; ) func main() { cfg, err := ini.Load(\u0026#34;my.ini\u0026#34;) if err != nil { log.Fatal(\u0026#34;Fail to read file: \u0026#34;, err) } fmt.Println(cfg.SectionStrings()) mysqlSection, err := cfg.NewSection(\u0026#34;mysql\u0026#34;) if err != nil { fmt.Println(err) } fmt.Println(mysqlSection.Keys()) fmt.Println(cfg.SectionStrings()) newSection, err := cfg.NewSection(\u0026#34;new\u0026#34;) if err != nil { fmt.Println(err) } fmt.Println(newSection.Keys()) fmt.Println(cfg.SectionStrings()) } è¿è¡Œè¾“å‡ºï¼š\n1 2 3 4 5 6 $ go run main.go [DEFAULT mysql redis] [127.0.0.1 3306 root 123456 awesome] [DEFAULT mysql redis] [] [DEFAULT mysql redis new] # è¯»å–çˆ¶å­åˆ†åŒº # é€’å½’è¯»å–é”®å€¼ åœ¨è·å–æ‰€æœ‰é”®å€¼çš„è¿‡ç¨‹ä¸­ï¼Œç‰¹æ®Šè¯­æ³• %(\u0026lt;name\u0026gt;)s ä¼šè¢«åº”ç”¨ï¼Œå…¶ä¸­ \u0026lt;name\u0026gt; å¯ä»¥æ˜¯ç›¸åŒåˆ†åŒºæˆ–è€…é»˜è®¤åˆ†åŒºä¸‹çš„é”®åã€‚å­—ç¬¦ä¸² %(\u0026lt;name\u0026gt;)s ä¼šè¢«ç›¸åº”çš„é”®å€¼æ‰€æ›¿ä»£ï¼Œå¦‚æœæŒ‡å®šçš„é”®ä¸å­˜åœ¨ï¼Œåˆ™ä¼šç”¨ç©ºå­—ç¬¦ä¸²æ›¿ä»£ï¼ˆæˆ‘æµ‹è¯•æ˜¯ä¿ç•™å­—ç¬¦ä¸²ï¼‰ã€‚æ‚¨å¯ä»¥æœ€å¤šä½¿ç”¨ 99 å±‚çš„é€’å½’åµŒå¥—ã€‚\nåœ¨inié…ç½®æ–‡ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å ä½ç¬¦%(name)sè¡¨ç¤ºç”¨ä¹‹å‰å·²å®šä¹‰çš„é”®nameçš„å€¼æ¥æ›¿æ¢ï¼Œè¿™é‡Œçš„sè¡¨ç¤ºå€¼ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼š\n1 2 3 4 5 6 7 8 9 10 # parent_child.ini NAME = ini VERSION = v1 IMPORT_PATH = gopkg.in/%(NAME)s.%(VERSION)s USERNAME = arlettebrook [package] CLONE_URL = https://%(IMPORT_PATH)s [package.sub] ä¸Šé¢åœ¨é»˜è®¤åˆ†åŒºä¸­è®¾ç½®IMPORT_PATHçš„å€¼æ—¶ï¼Œä½¿ç”¨äº†å‰é¢å®šä¹‰çš„NAMEå’ŒVERSIONã€‚ åœ¨packageåˆ†åŒºä¸­è®¾ç½®CLONE_URLçš„å€¼æ—¶ï¼Œä½¿ç”¨äº†é»˜è®¤åˆ†åŒºä¸­å®šä¹‰çš„IMPORT_PATHã€‚\næˆ‘ä»¬è¿˜å¯ä»¥åœ¨åˆ†åŒºåä¸­ä½¿ç”¨.è¡¨ç¤ºä¸¤ä¸ªæˆ–å¤šä¸ªåˆ†åŒºä¹‹é—´çš„çˆ¶å­å…³ç³»ï¼Œä¾‹å¦‚package.subçš„çˆ¶åˆ†åŒºä¸ºpackageï¼Œpackageæ²¡æœ‰çˆ¶åˆ†åŒºã€‚ å¦‚æœæŸä¸ªé”®åœ¨å­åˆ†åŒºä¸­ä¸å­˜åœ¨ï¼Œåˆ™ä¼šåœ¨å®ƒçš„çˆ¶åˆ†åŒºä¸­å†æ¬¡æŸ¥æ‰¾ï¼Œç›´åˆ°æ²¡æœ‰çˆ¶åˆ†åŒºä¸ºæ­¢ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;gopkg.in/ini.v1\u0026#34; ) func main() { cfg, err := ini.Load(\u0026#34;parent_child.ini\u0026#34;) if err != nil { log.Fatal(\u0026#34;Fail to read file: \u0026#34;, err) } fmt.Println(\u0026#34;Clone url from package.sub:\u0026#34;, cfg.Section(\u0026#34;package.sub\u0026#34;).Key(\u0026#34;CLONE_URL\u0026#34;).String()) fmt.Println(\u0026#34;packageæ²¡æœ‰çˆ¶åˆ†åŒº:\u0026#34;, cfg.Section(\u0026#34;package\u0026#34;).Key(\u0026#34;USERNAME\u0026#34;).String() == \u0026#34;\u0026#34;) } è¿è¡Œç¨‹åºè¾“å‡ºï¼š\n1 2 3 $ go run main.go Clone url from package.sub: https://gopkg.in/ini.v1 packageæ²¡æœ‰çˆ¶åˆ†åŒº: true å­åˆ†åŒºä¸­package.subä¸­æ²¡æœ‰é”®CLONE_URLï¼Œè¿”å›äº†çˆ¶åˆ†åŒºpackageä¸­çš„å€¼ã€‚\npackageåˆ†åŒºä¸­æ²¡æœ‰USERNAME,å®ƒå¹¶æ²¡æœ‰çˆ¶åˆ†åŒºï¼Œæ‰€ä»¥è¿”å›ç©ºå­—ç¬¦ä¸²ã€‚ï¼ˆè°ƒç”¨Keyæ–¹æ³•å¦‚æœé”®ä¸å­˜åœ¨ï¼Œä¼šåˆ›å»ºè¯¥é”®ï¼Œå€¼ä¸ºç©ºå­—ç¬¦ä¸²ã€‚ï¼‰åé¢ä¼šä»‹ç»ã€‚\nâ€‹\n# æ“ä½œé”®ï¼ˆKeyï¼‰ # è·å–é”® åœ¨æŒ‡å®šåˆ†åŒºè°ƒç”¨GetKeyæ–¹æ³•ï¼Œå¯ä»¥è·å–æŒ‡å®šçš„é”®ã€‚å¦‚æœé”®ä¸å­˜åœ¨ï¼Œä¼šè¿”å›Errorå¯¹è±¡å’Œnilã€‚ å’Œåˆ†åŒºä¸€æ ·ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è·å–é”®è€Œå¿½ç•¥é”™è¯¯å¤„ç†ï¼Œè°ƒç”¨Keyæ–¹æ³•è·å–æŒ‡å®šçš„é”®ï¼Œå¦‚æœé”®ä¸å­˜åœ¨ï¼Œä¼šåˆ›å»ºè¯¥é”®ï¼Œå€¼ä¸ºç©ºå­—ç¬¦ä¸²ã€‚ ç¤ºä¾‹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;gopkg.in/ini.v1\u0026#34; ) func main() { cfg, err := ini.Load(\u0026#34;my.ini\u0026#34;) if err != nil { log.Fatal(\u0026#34;Fail to read file: \u0026#34;, err) } key, err := cfg.Section(ini.DefaultSection).GetKey(\u0026#34;app_name123\u0026#34;) if err != nil { fmt.Println(err) } fmt.Println(key) nothingness := cfg.Section(\u0026#34;mysql\u0026#34;).Key(\u0026#34;app_name123\u0026#34;) fmt.Println(nothingness.String() == \u0026#34;\u0026#34;) } è¿è¡Œç¨‹åºè¾“å‡ºï¼š\n1 2 3 4 $ go run main.go error when getting key of section \u0026#34;DEFAULT\u0026#34;: key \u0026#34;app_name123\u0026#34; not exists \u0026lt;nil\u0026gt; true é»˜è®¤åˆ†åŒºä¸­ï¼Œä¸å­˜åœ¨app_name123æ‰€ä»¥GetKyè¿”å›Errorå’Œnilã€‚è€ŒKeyæ–¹æ³•è¿”å›å€¼ä¸ºç©ºå­—ç¬¦ä¸²çš„*Keyç±»å‹ã€‚\n# é”®çš„å…¶ä»–æ“ä½œ åœ¨æŸä¸ªåˆ†åŒºä¸‹ï¼Œè°ƒç”¨HasKeyæ–¹æ³•ï¼Œèƒ½åˆ¤æ–­è¯¥é”®æ˜¯å¦å­˜åœ¨ã€‚\nåœ¨æŸä¸ªåˆ†åŒºä¸‹ï¼Œè°ƒç”¨NewKeyæ–¹æ³•ï¼Œèƒ½å¤Ÿåœ¨æŒ‡å®šåˆ†åŒºä¸‹åˆ›å»ºé”®ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªï¼šé”®åï¼Œç¬¬äºŒä¸ªï¼šå€¼ã€‚\nè¿™ä¸åˆ›å»ºåˆ†åŒºä¸ä¸€æ ·ï¼Œåˆ†åŒºå¦‚æœå­˜åœ¨ï¼Œä¼šè¿”å›å­˜åœ¨çš„åˆ†åŒºã€‚ é”®å¦‚æœå­˜åœ¨ï¼Œä¼šè¦†ç›–å€¼ã€‚ åœ¨æŸä¸ªåˆ†åŒºä¸‹ï¼Œè°ƒç”¨Keysæ–¹æ³•ï¼Œèƒ½å¤Ÿè·å–æŒ‡å®šåˆ†åŒºä¸‹æ‰€æœ‰çš„*Keyå¯¹è±¡ï¼Œæ˜¯[]*Keyç±»å‹ã€‚\nä¸SectionStringsæ–¹æ³•å·®ä¸å¤šï¼Œè°ƒç”¨KeyStringsæ–¹æ³•ï¼Œèƒ½å¤Ÿè·å–æ‰€æœ‰çš„é”®åï¼Œæ˜¯[]stringç±»å‹ã€‚ åœ¨æŸåˆ†åŒºä¸‹ï¼Œè°ƒç”¨KeysHashæ–¹æ³•ï¼Œèƒ½å¤Ÿè·å–è¯¥åˆ†åŒºä¸‹çš„æ‰€æœ‰é”®å€¼å¯¹çš„mapé›†åˆã€‚é”®å’Œå€¼çš„ç±»å‹éƒ½ä¸ºstringã€‚\nç¤ºä¾‹å¦‚ä¸‹:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;gopkg.in/ini.v1\u0026#34; ) func main() { cfg, err := ini.Load(\u0026#34;my.ini\u0026#34;) if err != nil { log.Fatal(\u0026#34;Fail to read file: \u0026#34;, err) } key := cfg.Section(ini.DefaultSection).HasKey(\u0026#34;app_name\u0026#34;) if key { fmt.Println(cfg.Section(ini.DefaultSection).Key(\u0026#34;app_name\u0026#34;).String()) } newKey, err := cfg.Section(ini.DefaultSection).NewKey(\u0026#34;app_name\u0026#34;, \u0026#34;awesome go\u0026#34;) if err != nil { log.Fatal(err) } fmt.Println(newKey.String()) fmt.Printf(\u0026#34;%#v\\n\u0026#34;, cfg.Section(\u0026#34;\u0026#34;).Keys()) fmt.Println(cfg.Section(\u0026#34;\u0026#34;).KeyStrings()) keysHash := cfg.Section(\u0026#34;\u0026#34;).KeysHash() for k, v := range keysHash { fmt.Printf(\u0026#34;%s=%s\\n\u0026#34;, k, v) } } è¿è¡Œç¨‹åºè¾“å‡ºï¼š\n1 2 3 4 5 6 7 $ go run main.go awesome web awesome go []*ini.Key{(*ini.Key)(0xc00010a690), (*ini.Key)(0xc00010a700)} [app_name log_level] app_name=awesome go log_level=DEBUG è·å–ä¸Šçº§çˆ¶åˆ†åŒºä¸‹æ‰€æœ‰çš„é”®å¯¹è±¡ã€‚\n1 cfg.Section(\u0026#34;package.sub\u0026#34;).ParentKeys() å½“é”®åä¸º-è¡¨ç¤ºè‡ªå¢é”®åï¼Œåœ¨ç¨‹åºä¸­æ˜¯ä»#1å¼€å§‹ï¼Œ#numberè¡¨ç¤ºï¼Œåˆ†åŒºä¹‹é—´æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚\n1 2 3 4 [features] -: Support read/write comments of keys and sections -: Support auto-increment of key names -: Support load multiple files to overwrite key values 1 cfg.Section(\u0026#34;features\u0026#34;).KeyStrings() // []{\u0026#34;#1\u0026#34;, \u0026#34;#2\u0026#34;, \u0026#34;#3\u0026#34;} # å¿½ç•¥é”®åçš„å¤§å°å†™ é»˜è®¤æƒ…å†µä¸‹åˆ†åŒºåå’Œé”®åéƒ½åŒºåˆ†å¤§å°å†™ï¼Œå½“è°ƒç”¨ini.InsensitiveLoadæ–¹æ³•åŠ è½½é…ç½®æ–‡ä»¶æ—¶ï¼Œèƒ½å¤Ÿå°†æ‰€æœ‰åˆ†åŒºå’Œé”®ååœ¨è¯»å–é‡Œå¼ºåˆ¶è½¬æ¢ä¸ºå°å†™ï¼Œè¿™æ ·å½“åœ¨è·å–åˆ†åŒºæˆ–è€…é”®çš„æ—¶å€™ï¼Œæ‰€æŒ‡å®šçš„åˆ†åŒºåæˆ–é”®åä¸åŒºåˆ†å¤§å°å†™ï¼š\n1 2 3 4 5 6 7 8 9 10 cfg, err := ini.InsensitiveLoad(\u0026#34;filename\u0026#34;) //... // sec1 å’Œ sec2 æŒ‡å‘åŒä¸€ä¸ªåˆ†åŒºå¯¹è±¡ sec1, err := cfg.GetSection(\u0026#34;Section\u0026#34;) sec2, err := cfg.GetSection(\u0026#34;SecTIOn\u0026#34;) // key1 å’Œ key2 æŒ‡å‘åŒä¸€ä¸ªé”®å¯¹è±¡ key1, err := sec1.GetKey(\u0026#34;Key\u0026#34;) key2, err := sec2.GetKey(\u0026#34;KeY\u0026#34;) ä¸ºä»€ä¹ˆåœ¨åŠ è½½çš„æ—¶å€™å¼€å¯è½¬æ¢ä¸ºå°å†™ï¼Œåœ¨è°ƒç”¨çš„æ—¶å€™å°±èƒ½å¿½ç•¥å¤§å°ï¼Ÿ å› ä¸ºåœ¨è°ƒç”¨çš„æ—¶å€™ä¼šåˆ¤æ–­æ˜¯å¦å¼€å¯è½¬æ¢ä¸ºå°å†™ï¼Œæ˜¯ä¼šå°†æŸ¥è¯¢çš„åˆ†åŒºåæˆ–é”®åå¼ºåˆ¶è½¬æ¢ä¸ºå°å†™ã€‚éƒ½è½¬æ¢ä¸ºå°å†™äº†ï¼Œä¹Ÿå°±èƒ½å¤Ÿè·å–äº†ã€‚ â€‹\n# æ“ä½œé”®å€¼ï¼ˆValueï¼‰ è·å–ä¸€ä¸ªç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼ˆstringï¼‰çš„å€¼ï¼š\n1 val := cfg.Section(\u0026#34;\u0026#34;).Key(\u0026#34;key name\u0026#34;).String() è·å–å€¼çš„åŒæ—¶é€šè¿‡è‡ªå®šä¹‰å‡½æ•°è¿›è¡Œå¤„ç†éªŒè¯ï¼š\n1 2 3 4 5 6 val := cfg.Section(\u0026#34;\u0026#34;).Key(\u0026#34;key name\u0026#34;).Validate(func(in string) string { if len(in) == 0 { return \u0026#34;default\u0026#34; } return in }) å¦‚æœæ‚¨ä¸éœ€è¦ä»»ä½•å¯¹å€¼çš„è‡ªåŠ¨è½¬å˜åŠŸèƒ½ï¼ˆä¾‹å¦‚é€’å½’è¯»å–ï¼‰ï¼Œå¯ä»¥ç›´æ¥è·å–åŸå€¼ï¼ˆè¿™ç§æ–¹å¼æ€§èƒ½æœ€ä½³ï¼‰ï¼š\n1 val := cfg.Section(\u0026#34;\u0026#34;).Key(\u0026#34;key name\u0026#34;).Value() åˆ¤æ–­æŸä¸ªåŸå€¼æ˜¯å¦å­˜åœ¨ï¼š\n1 yes := cfg.Section(\u0026#34;\u0026#34;).HasValue(\u0026#34;test value\u0026#34;) è·å–å…¶å®ƒç±»å‹çš„å€¼è°ƒç”¨å¯¹åº”ç±»å‹çš„æ–¹æ³•ã€‚è¿”å›å€¼å¸¦æœ‰Errorä¿¡æ¯ï¼Œå¦‚æœä¸éœ€è¦Errorä¿¡æ¯å¯ä»¥è°ƒç”¨MustXxxæ–¹æ³•ã€‚è¯¥æ–¹æ³•å¯ä»¥æŒ‡å®šé»˜è®¤å€¼ï¼Œç”¨äºè½¬æ¢å¤±è´¥çš„é»˜è®¤å€¼ã€‚æ²¡æœ‰æŒ‡å®šé»˜è®¤å€¼ä¸ºå¯¹åº”ç±»å‹çš„é›¶å€¼ã€‚\n1 2 3 4 5 6 7 8 v, err = cfg.Section(\u0026#34;\u0026#34;).Key(\u0026#34;INT\u0026#34;).Int() v, err = cfg.Section(\u0026#34;\u0026#34;).Key(\u0026#34;TIME\u0026#34;).TimeFormat(time.RFC3339) v, err = cfg.Section(\u0026#34;\u0026#34;).Key(\u0026#34;TIME\u0026#34;).Time() // RFC3339 v = cfg.Section(\u0026#34;\u0026#34;).Key(\u0026#34;INT\u0026#34;).MustInt() v = cfg.Section(\u0026#34;\u0026#34;).Key(\u0026#34;INT\u0026#34;).MustInt(10) v = cfg.Section(\u0026#34;\u0026#34;).Key(\u0026#34;TIME\u0026#34;).MustTimeFormat(time.RFC3339, time.Now()) v = cfg.Section(\u0026#34;\u0026#34;).Key(\u0026#34;TIME\u0026#34;).MustTime(time.Now()) // RFC3339 \u0026quot;\u0026quot;\u0026quot;\u0026quot;\u0026quot;\u0026quot;åŒ…è£¹çš„å¤šè¡Œå­—ç¬¦ä¸²è·Ÿæ™®é€šçš„è·å–æ–¹å¼ä¸€æ ·ã€‚\n\\ï¼šä¸€è¡Œå†™ä¸ä¸‹æ¢è¡Œå†™ï¼Œä¹Ÿæ˜¯è·Ÿæ™®é€šçš„è·å–æ–¹å¼ä¸€æ ·ï¼Œåªä¸è¿‡å±æ€§IgnoreContinuationï¼Œå¯ä»¥å¿½ç•¥è¿ç»­æ¢è¡Œã€‚å°±æ˜¯\\ä¸èµ·ä½œç”¨ã€‚\né»˜è®¤æƒ…å†µä¸‹å­—ç¬¦ä¸²ä¸­åªæœ‰ä¸¤ç«¯æœ‰å¼•å·ï¼Œæ— è®ºæ˜¯å•ã€åŒã€ä¸‰ï¼Œéƒ½ä¼šè‡ªåŠ¨å‰”é™¤ã€‚ä½†å½“å­—ç¬¦ä¸²é‡Œé¢æœ‰ä¸ä¸¤ç«¯ç›¸åŒçš„å¼•å·ï¼Œé‚£ä¹ˆå¼•å·éƒ½ä¼šä¿ç•™ã€‚\nUnescapeValueDoubleQuoteså±æ€§ä¼šç§»é™¤ä¸¤ç«¯çš„åŒå¼•å·ï¼Œåªèƒ½æ˜¯åŒå¼•å·ã€‚ è·å–å€¼çš„æ—¶å€™æˆ‘ä»¬è¿˜å¯ä»¥æŒ‡å®šå€™é€‰ã€‚å¦‚æœé…ç½®æ–‡ä»¶ä¸­çš„å€¼ä¸æ˜¯å€™é€‰ä¸­çš„å€¼ï¼Œé‚£ä¹ˆå°†é€‰ç”¨é»˜è®¤å€¼ï¼Œé»˜è®¤å€¼å¯ä»¥ä¸æ˜¯å€™é€‰é‡Œé¢çš„å€¼ã€‚stringç±»å‹æ˜¯Inæ–¹æ³•ï¼Œå…¶ä»–çš„æ˜¯InXxxæ–¹æ³•\n1 2 v := cfg.Section(\u0026#34;\u0026#34;).Key(\u0026#34;STRING\u0026#34;).In(\u0026#34;default\u0026#34;, []string{\u0026#34;str\u0026#34;, \u0026#34;arr\u0026#34;, \u0026#34;types\u0026#34;}) v = cfg.Section(\u0026#34;\u0026#34;).Key(\u0026#34;INT\u0026#34;).InInt(10, []int{10, 20, 30}) éªŒè¯è·å–çš„å€¼æ˜¯å¦åœ¨æŒ‡å®šèŒƒå›´å†…ï¼šæœ‰ä¸‰ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªï¼šæ²¡æœ‰åœ¨èŒƒå›´å†…çš„é»˜è®¤å€¼ã€‚ç¬¬äºŒä¸ªï¼šæœ€å°å€¼ã€‚ç¬¬ä¸‰ä¸ªï¼šæœ€å¤§å€¼ã€‚stringç±»å‹æ²¡æœ‰èŒƒå›´ã€‚\n1 2 3 4 vals = cfg.Section(\u0026#34;\u0026#34;).Key(\u0026#34;FLOAT64\u0026#34;).RangeFloat64(0.0, 1.1, 2.2) vals = cfg.Section(\u0026#34;\u0026#34;).Key(\u0026#34;INT\u0026#34;).RangeInt(0, 10, 20) vals = cfg.Section(\u0026#34;\u0026#34;).Key(\u0026#34;TIME\u0026#34;).RangeTimeFormat(time.RFC3339, time.Now(), minTime, maxTime) vals = cfg.Section(\u0026#34;\u0026#34;).Key(\u0026#34;TIME\u0026#34;).RangeTime(time.Now(), minTime, maxTime) // RFC3339 è‡ªåŠ¨åˆ†å‰²é”®å€¼åˆ°åˆ‡ç‰‡ï¼ˆsliceï¼‰ã€‚ä½œç”¨ï¼šè·å–ä¸€ä¸ªé”®çš„å¤šä¸ªå€¼ã€‚æ–¹æ³•æ˜¯å¯¹åº”ç±»å‹åŠ sï¼Œå¹¶æŒ‡å®šåˆ†éš”ç¬¦ã€‚\nå½“å­˜åœ¨æ— æ•ˆè¾“å…¥æ—¶ï¼Œä½¿ç”¨é›¶å€¼ä»£æ›¿ã€‚ æ³¨æ„åˆ†éš”ç¬¦ä¸èƒ½ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œä¼šå‡ºç°æ­»å¾ªç¯ã€‚å¯ä»¥ä¸ºç©ºæ ¼ã€‚ å½“åœ¨å‰é¢åŠ ä¸ŠValidXxxsï¼Œå­˜åœ¨æ— æ•ˆè¾“å…¥æ—¶ï¼Œä¼šå¿½ç•¥æ‰ã€‚ å½“åœ¨å‰é¢åŠ ä¸ŠStrictXxxsï¼Œå­˜åœ¨æ— æ•ˆè¾“å…¥æ—¶ï¼Œç›´æ¥è¿”å›é”™è¯¯ã€‚ 1 2 3 vals = cfg.Section(\u0026#34;\u0026#34;).Key(\u0026#34;INTS\u0026#34;).Ints(\u0026#34;,\u0026#34;) vals = cfg.Section(\u0026#34;\u0026#34;).Key(\u0026#34;INTS\u0026#34;).ValidInts(\u0026#34;,\u0026#34;) vals = cfg.Section(\u0026#34;\u0026#34;).Key(\u0026#34;INTS\u0026#34;).StrictInts(\u0026#34;,\u0026#34;) ä¿®æ”¹é”®çš„å€¼ï¼Œè°ƒç”¨SetValueæ–¹æ³•ã€‚\n1 2 username := cfg.Section(\u0026#34;\u0026#34;).Key(\u0026#34;username\u0026#34;) username.SetValue(\u0026#34;Mark\u0026#34;) åœ¨æŸåˆ†åŒºä¸‹è°ƒç”¨NewBooleanKeyæ–¹æ³•ï¼Œä¼šåˆ›å»ºå¸ƒå°”é”®ï¼Œå€¼æ°¸è¿œä¸ºtrueã€‚ä¿å­˜æ—¶åªæœ‰é”®åã€‚è§£ææ—¶æ³¨æ„è¦å¼€å¯AllowBooleanKeysï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚\n1 key, err := sec.NewBooleanKey(\u0026#34;skip-host-cache\u0026#34;) é»˜è®¤æƒ…å†µä¸‹åé¢å‡ºç°çš„é”®ä¼šè¦†ç›–å‰é¢å­˜åœ¨çš„é”®ï¼Œå½“å¼€å¯AllowShadowsé…ç½®é€‰é¡¹æ—¶ï¼Œå°±æ˜¯è°ƒç”¨ShadowLoadåŠ è½½æ•°æ®æºã€‚åå‡ºç°çš„é”®ä¸ä¼šè¦†ç›–å‰é¢çš„å€¼ã€‚è¿˜å¯ä»¥é€šè¿‡ValueWithShadowsæ–¹æ³•è·å–æŒ‡å®šåˆ†åŒºä¸‹é‡å¤é”®çš„æ‰€æœ‰å€¼ã€‚\nâ€‹\n# æ“ä½œæ³¨é‡Šï¼ˆCommentï¼‰ ä¸‹è¿°å‡ ç§æƒ…å†µçš„å†…å®¹å°†è¢«è§†ä¸ºæ³¨é‡Šï¼š\næ‰€æœ‰ä»¥ # æˆ– ; å¼€å¤´çš„è¡Œ æ‰€æœ‰åœ¨ # æˆ– ; ä¹‹åçš„å†…å®¹ åˆ†åŒºæ ‡ç­¾åçš„æ–‡å­— (å³ [åˆ†åŒºå] ä¹‹åçš„å†…å®¹) å¦‚æœä½ å¸Œæœ›ä½¿ç”¨åŒ…å« # æˆ– ; çš„å€¼ï¼Œè¯·ä½¿ç”¨ ``` æˆ– \u0026quot;\u0026quot;\u0026quot; è¿›è¡ŒåŒ…è¦†ã€‚\né™¤æ­¤ä¹‹å¤–ï¼Œæ‚¨è¿˜å¯ä»¥é€šè¿‡ LoadOptions å®Œå…¨å¿½ç•¥è¡Œå†…æ³¨é‡Šï¼š\n1 2 3 cfg, err := ini.LoadSources(ini.LoadOptions{ IgnoreInlineComment: true, }, \u0026#34;app.ini\u0026#34;) æˆ–è¦æ±‚æ³¨é‡Šç¬¦å·å‰å¿…é¡»å¸¦æœ‰ä¸€ä¸ªç©ºæ ¼ï¼š\n1 2 3 cfg, err := ini.LoadSources(ini.LoadOptions{ SpaceBeforeInlineComment: true, }, \u0026#34;app.ini\u0026#34;) åœ¨åˆ†åŒºæˆ–è€…é”®ä¸Šè°ƒç”¨Commentå±æ€§ï¼Œä¼šè·å–è¯¥åˆ†åŒºæˆ–è€…é”®çš„æ‰€æœ‰æ³¨é‡Šï¼ˆèƒ½è·å–å¤´ä¸Šå’Œåè¾¹çš„ï¼‰ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;gopkg.in/ini.v1\u0026#34; ) func main() { cfg, _ := ini.Load(\u0026#34;my.ini\u0026#34;) c1 := cfg.Section(\u0026#34;mysql\u0026#34;).Comment fmt.Println(c1) fmt.Println() c2 := cfg.Section(\u0026#34;\u0026#34;).Key(\u0026#34;log_level\u0026#34;).Comment fmt.Println(c2) } è¿è¡Œç¨‹åºè¾“å‡ºï¼š\n1 2 3 4 5 $ go run main.go ; database=mysql # possible values: DEBUG, INFO, WARNING, ERROR, FATAL # è¿™ä¹Ÿæ˜¯æ³¨é‡Š # ä¿å­˜é…ç½® å°†é…ç½®ä¿å­˜åˆ°æŸä¸ªæ–‡ä»¶ï¼Œè°ƒç”¨SaveToæˆ–SaveToIndentï¼Œç¬¬äºŒä¸ªæ–¹æ³•å¤šä¸€ä¸ªå‚æ•°ï¼Œç”¨äºæŒ‡å®šåˆ†åŒºä¸‹é”®çš„ç¼©è¿›ï¼ˆé™¤é»˜è®¤åˆ†åŒºï¼‰ï¼Œå¯ä»¥æ˜¯\\tç­‰ï¼š\n1 2 3 // ... err = cfg.SaveTo(\u0026#34;my.ini\u0026#34;) err = cfg.SaveToIndent(\u0026#34;my.ini\u0026#34;, \u0026#34;\\t\u0026#34;) è¿˜å¯ä»¥å†™å…¥åˆ°ä»»ä½•å®ç° io.Writer æ¥å£çš„å¯¹è±¡ä¸­ï¼Œä¹Ÿæ˜¯æä¾›äº†ä¸¤ä¸ªæ–¹æ³•WriteToã€WriteToIndentï¼šç¬¬äºŒä¸ªå¯ä»¥æŒ‡å®šåˆ†åŒºä¸‹é”®çš„ç¼©è¿›ï¼ˆé™¤é»˜è®¤åˆ†åŒºï¼‰ï¼š\n1 2 3 // ... cfg.WriteTo(writer) cfg.WriteToIndent(writer, \u0026#34;\\t\u0026#34;) é»˜è®¤æƒ…å†µä¸‹ï¼Œç©ºæ ¼å°†è¢«ç”¨äºå¯¹é½é”®å€¼ä¹‹é—´çš„ç­‰å·ä»¥ç¾åŒ–è¾“å‡ºç»“æœï¼Œä»¥ä¸‹ä»£ç å¯ä»¥ç¦ç”¨è¯¥åŠŸèƒ½ï¼š\n1 ini.PrettyFormat = false ä¸‹é¢æˆ‘ä»¬é€šè¿‡ç¨‹åºç”Ÿæˆå‰é¢ä½¿ç”¨çš„é…ç½®æ–‡ä»¶my.iniå¹¶ä¿å­˜ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;os\u0026#34; \u0026#34;gopkg.in/ini.v1\u0026#34; ) func main() { cfg := ini.Empty() defaultSection := cfg.Section(\u0026#34;\u0026#34;) defaultSection.NewKey(\u0026#34;app_name\u0026#34;, \u0026#34;awesome web\u0026#34;) defaultSection.NewKey(\u0026#34;log_level\u0026#34;, \u0026#34;DEBUG\u0026#34;) mysqlSection, err := cfg.NewSection(\u0026#34;mysql\u0026#34;) if err != nil { fmt.Println(\u0026#34;new mysql section failed:\u0026#34;, err) return } mysqlSection.NewKey(\u0026#34;ip\u0026#34;, \u0026#34;127.0.0.1\u0026#34;) mysqlSection.NewKey(\u0026#34;port\u0026#34;, \u0026#34;3306\u0026#34;) mysqlSection.NewKey(\u0026#34;user\u0026#34;, \u0026#34;root\u0026#34;) mysqlSection.NewKey(\u0026#34;password\u0026#34;, \u0026#34;123456\u0026#34;) mysqlSection.NewKey(\u0026#34;database\u0026#34;, \u0026#34;awesome\u0026#34;) redisSection, err := cfg.NewSection(\u0026#34;redis\u0026#34;) if err != nil { fmt.Println(\u0026#34;new redis section failed:\u0026#34;, err) return } redisSection.NewKey(\u0026#34;ip\u0026#34;, \u0026#34;127.0.0.1\u0026#34;) redisSection.NewKey(\u0026#34;port\u0026#34;, \u0026#34;6381\u0026#34;) err = cfg.SaveTo(\u0026#34;my.ini\u0026#34;) if err != nil { fmt.Println(\u0026#34;SaveTo failed: \u0026#34;, err) } err = cfg.SaveToIndent(\u0026#34;my-pretty.ini\u0026#34;, \u0026#34;\\t\u0026#34;) if err != nil { fmt.Println(\u0026#34;SaveToIndent failed: \u0026#34;, err) } cfg.WriteTo(os.Stdout) fmt.Println() cfg.WriteToIndent(os.Stdout, \u0026#34;\\t\u0026#34;) } è¿è¡Œç¨‹åºï¼Œç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶my.iniå’Œmy-pretty.iniï¼ŒåŒæ—¶æ§åˆ¶å°è¾“å‡ºæ–‡ä»¶å†…å®¹ã€‚\nmy.iniï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 app_name = awesome web log_level = DEBUG [mysql] ip = 127.0.0.1 port = 3306 user = root password = 123456 database = awesome [redis] ip = 127.0.0.1 port = 6381 my-pretty.iniï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 app_name = awesome web log_level = DEBUG [mysql] ip = 127.0.0.1 port = 3306 user = root password = 123456 database = awesome [redis] ip = 127.0.0.1 port = 6381 *Indentæ–¹æ³•ä¼šå¯¹é»˜è®¤åˆ†åŒºä»¥å¤–åˆ†åŒºä¸‹çš„é”®å¢åŠ ç¼©è¿›ï¼Œçœ‹èµ·æ¥ç¾è§‚ä¸€ç‚¹ã€‚\n# åˆ†åŒºä¸ç»“æ„ä½“å­—æ®µæ˜ å°„ # æ˜ å°„åˆ°ç»“æ„ä½“ è°ƒç”¨MapToå‡½æ•°æˆ–è€…æ–¹æ³•ï¼Œå¯ä»¥å°†æ–‡ä»¶å¯¹è±¡æ˜ å°„åˆ°ç»“æ„ä½“ã€‚\nå½“MapToä¸ºæ–¹æ³•æ—¶ï¼Œå¯¹è±¡æ˜¯æ–‡ä»¶å¯¹è±¡æˆ–åˆ†åŒºï¼Œå‚æ•°æ˜¯è¦æ˜ å°„çš„ç»“æ„ä½“ã€‚ ä¸ºäº†ä½¿ç”¨æ–¹ä¾¿ï¼Œç›´æ¥å°†MapToå°è£…æˆäº†å‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ï¼šç»“æ„ä½“ã€‚ç¬¬äºŒä¸ªï¼šæ•°æ®æºã€‚ å½“å¯¹è±¡ä¸ºåˆ†åŒºæ—¶ï¼Œæ˜ å°„åˆ°ä¸€ä¸ªåˆ†åŒº åˆ›å»ºç»“æ„ä½“çš„æ—¶å€™å¯ä»¥æŒ‡å®šé»˜è®¤å€¼ï¼Œå¦‚æœæ•°æ®æºæ²¡æœ‰æˆ–ç±»å‹è§£æé”™è¯¯å°†ä½¿ç”¨é»˜è®¤å€¼ ç¤ºä¾‹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;gopkg.in/ini.v1\u0026#34; ) type Config struct { AppName string `ini:\u0026#34;app_name\u0026#34;` LogLevel string `ini:\u0026#34;log_level\u0026#34;` MySQL MySQLConfig `ini:\u0026#34;mysql\u0026#34;` Redis RedisConfig `ini:\u0026#34;redis\u0026#34;` } type MySQLConfig struct { IP string `ini:\u0026#34;ip\u0026#34;` Port int `ini:\u0026#34;port\u0026#34;` User string `ini:\u0026#34;user\u0026#34;` Password string `ini:\u0026#34;password\u0026#34;` Database string `ini:\u0026#34;database\u0026#34;` } type RedisConfig struct { IP string `ini:\u0026#34;ip\u0026#34;` Port int `ini:\u0026#34;port\u0026#34;` } func main() { cfg, err := ini.Load(\u0026#34;my.ini\u0026#34;) if err != nil { log.Fatal(\u0026#34;load my.ini failed: \u0026#34;, err) } assertMapToError := func(e error) { if e != nil { log.Fatal(\u0026#34;MapTo error:\u0026#34;, err) } } c1 := new(Config) err = cfg.MapTo(\u0026amp;c1) assertMapToError(err) fmt.Println(c1) c2 := new(Config) err = ini.MapTo(c2, \u0026#34;my.ini\u0026#34;) assertMapToError(err) fmt.Println(c2) m := \u0026amp;MySQLConfig{ IP: \u0026#34;localhost\u0026#34;, } err = cfg.Section(\u0026#34;mysql\u0026#34;).MapTo(m) assertMapToError(err) fmt.Println(m) } MapToå†…éƒ¨ä½¿ç”¨äº†åå°„ï¼Œæ‰€ä»¥ç»“æ„ä½“å­—æ®µå¿…é¡»éƒ½æ˜¯å¯¼å‡ºçš„ã€‚å¦‚æœé”®åä¸å­—æ®µåä¸ç›¸åŒï¼Œé‚£ä¹ˆéœ€è¦åœ¨ç»“æ„æ ‡ç­¾ä¸­æŒ‡å®šå¯¹åº”çš„é”®åã€‚ è¿™ä¸€ç‚¹ä¸ Go æ ‡å‡†åº“encoding/jsonå’Œencoding/xmlä¸åŒã€‚æ ‡å‡†åº“json/xmlè§£ææ—¶å¯ä»¥å°†é”®åapp_nameå¯¹åº”åˆ°å­—æ®µåAppNameã€‚è€Œgo-iniéœ€è¦[è‡ªå®šä¹‰é”®åæ˜ å°„å™¨](#é”®åæ˜ å°„å™¨ï¼ˆName Mapperï¼‰)æ‰èƒ½å®ç°è¿™ç§æ•ˆæœã€‚\nè¿è¡Œç¨‹åºè¾“å‡ºï¼š\n1 2 3 4 $ go run main.go \u0026amp;{awesome web DEBUG {127.0.0.1 3306 root 123456 awesome} {127.0.0.1 6381}} \u0026amp;{awesome web DEBUG {127.0.0.1 3306 root 123456 awesome} {127.0.0.1 6381}} \u0026amp;{127.0.0.1 3306 root 123456 awesome} # ä»ç»“æ„ä½“åå°„ æˆ‘ä»¬å¯ä»¥è°ƒç”¨ReflectFromå‡½æ•°æˆ–æ–¹æ³•ï¼Œå°†ç»“æ„ä½“åå°„æˆæ–‡ä»¶å¯¹è±¡ã€‚\nå½“ä¸ºæ–¹æ³•æ—¶ï¼Œå¯¹è±¡æ˜¯åå°„åˆ°çš„æ–‡ä»¶å¯¹è±¡æˆ–åˆ†åŒºï¼Œå‚æ•°æ˜¯ç»“æ„ä½“ã€‚\nä¸ºäº†ä½¿ç”¨æ–¹ä¾¿ï¼Œå°†å…¶å°è£…æˆäº†å‡½æ•°ï¼Œæ¥æ”¶ä¸¤ä¸ªå‚æ•°ã€‚ç¬¬ä¸€ä¸ªï¼šåå°„åˆ°çš„æ–‡ä»¶å¯¹è±¡ï¼Œç¬¬äºŒä¸ªï¼šç»“æ„ä½“ å½“å¯¹è±¡ä¸ºåˆ†åŒºæ—¶ï¼Œåå°„åˆ°åˆ†åŒºã€‚\næ³¨æ„å½“ç»“æ„ä½“å­—æ®µä¸é…ç½®é”®ä¸åŒåæ—¶éœ€è¦ç”¨ç»“æ„ä½“æ ‡ç­¾æŒ‡å®šã€‚\næ”¯æŒçš„æ ‡ç­¾ï¼š\niniï¼šæŒ‡å®šé”®åï¼Œæˆ–è€…åˆ†åŒºåã€‚\næœ‰ç¬¬äºŒä¸ªå‚æ•°omitemptyï¼Œç”¨ï¼Œåˆ†éš”å¼€ã€‚å€¼ä¸ºç©ºæ—¶ï¼Œçœç•¥æ‰ï¼Œä¸å†™å…¥æ–‡ä»¶å¯¹è±¡ã€‚\næœ‰ç¬¬ä¸‰å‚æ•°allowshadowï¼Œå¦‚æœä¸éœ€è¦å‰ä¸¤ä¸ªæ ‡ç­¾è§„åˆ™ï¼Œå¯ä»¥ä½¿ç”¨ ini:\u0026quot;,,allowshadow\u0026quot; è¿›è¡Œç®€å†™ã€‚\nä½œç”¨ï¼šå°†ä¸€ä¸ªé”®çš„ä¸åŒå€¼åˆ†è¡Œä¿å­˜ï¼Œä¸ç”¨åˆ†éš”ç¬¦åˆ†å¼€ã€‚ 1 2 3 4 [IP] value = 192.168.31.201 value = 192.168.31.211 value = 192.168.31.221 1 2 3 type IP struct { Value []string `ini:\u0026#34;value,omitempty,allowshadow\u0026#34;` } commentï¼šæŒ‡å®šæ³¨é‡Šï¼Œä¿å­˜åˆ°é…ç½®æ³¨é‡Šä¼šåœ¨é”®çš„å¤´ä¸Šã€‚\ndelimï¼šæŒ‡å®šåˆ†éš”ç¬¦ã€‚ä¸€ä¸ªé”®å­˜åœ¨å¤šä¸ªå€¼çš„æƒ…å†µï¼Œéœ€è¦æŒ‡å®šåˆ†éš”ç¬¦ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 type Embeded struct { Dates []time.Time `delim:\u0026#34;|\u0026#34; comment:\u0026#34;Time data\u0026#34;` Places []string `ini:\u0026#34;places,omitempty\u0026#34;` None []int `ini:\u0026#34;,omitempty\u0026#34;` } ... Embeded{ []time.Time{time.Now(), time.Now()}, []string{\u0026#34;HangZhou\u0026#34;, \u0026#34;Boston\u0026#34;}, []int{}, } ... 1 2 3 4 5 ; Embeded section [Embeded] ; Time data Dates = 2015-08-07T22:14:22+08:00|2015-08-07T22:14:22+08:00 places = HangZhou,Boston ç¤ºä¾‹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;gopkg.in/ini.v1\u0026#34; ) type Config struct { AppName string `ini:\u0026#34;app_name\u0026#34;` LogLevel string `ini:\u0026#34;log_level\u0026#34;` MySQL MySQLConfig `ini:\u0026#34;mysql\u0026#34;` Redis RedisConfig `ini:\u0026#34;redis\u0026#34;` } type MySQLConfig struct { IP string `ini:\u0026#34;ip\u0026#34;` Port int `ini:\u0026#34;port\u0026#34;` User string `ini:\u0026#34;user\u0026#34;` Password string `ini:\u0026#34;password\u0026#34;` Database string `ini:\u0026#34;database\u0026#34;` } type RedisConfig struct { IP string `ini:\u0026#34;ip\u0026#34;` Port int `ini:\u0026#34;port\u0026#34;` } func main() { cfg1 := ini.Empty() c1 := Config{ AppName: \u0026#34;awesome web\u0026#34;, LogLevel: \u0026#34;DEBUG\u0026#34;, MySQL: MySQLConfig{ IP: \u0026#34;127.0.0.1\u0026#34;, Port: 3306, User: \u0026#34;root\u0026#34;, Password: \u0026#34;123456\u0026#34;, Database: \u0026#34;awesome\u0026#34;, }, Redis: RedisConfig{ IP: \u0026#34;127.0.0.1\u0026#34;, Port: 6381, }, } assertReflectError := func(e error) { if e != nil { log.Fatal(\u0026#34;Reflect error:\u0026#34;, e) } } err := ini.ReflectFrom(cfg1, \u0026amp;c1) assertReflectError(err) fmt.Println(cfg1.Section(\u0026#34;\u0026#34;).Key(\u0026#34;app_name\u0026#34;).String()) c2 := Config{ AppName: \u0026#34;awesome go\u0026#34;, } cfg2 := ini.Empty() err = cfg2.ReflectFrom(\u0026amp;c2) assertReflectError(err) fmt.Println(cfg2.Section(\u0026#34;\u0026#34;).Key(\u0026#34;app_name\u0026#34;).String()) m := MySQLConfig{ IP: \u0026#34;localhost\u0026#34;, } cfg3 := ini.Empty() err = cfg3.Section(\u0026#34;mysql\u0026#34;).ReflectFrom(\u0026amp;m) assertReflectError(err) fmt.Println(cfg3.Section(\u0026#34;mysql\u0026#34;).Key(\u0026#34;ip\u0026#34;).String()) } è¿è¡Œç¨‹åºè¾“å‡ºï¼š\n1 2 3 4 $ go run main.go awesome web awesome go localhost # æ˜ å°„/åå°„çš„å…¶å®ƒè¯´æ˜ ä»»ä½•åµŒå…¥çš„ç»“æ„éƒ½ä¼šè¢«é»˜è®¤è®¤ä½œä¸€ä¸ªä¸åŒçš„åˆ†åŒºï¼Œå¹¶ä¸”ä¸ä¼šè‡ªåŠ¨äº§ç”Ÿæ‰€è°“çš„çˆ¶å­åˆ†åŒºå…³è”ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 type Child struct { Age string } type Parent struct { Name string Child } type Config struct { City string Parent } ç¤ºä¾‹é…ç½®æ–‡ä»¶ï¼š\n1 2 3 4 5 6 7 City = Boston [Parent] Name = Unknwon [Child] Age = 21 å¦‚æœéœ€è¦æŒ‡å®šåµŒå…¥ç»“æ„ä½“æ˜¯åŒä¸€ä¸ªåˆ†åŒºï¼Œéœ€è¦æŒ‡å®šæ ‡ç­¾æŒ‡å®šåˆ†åŒºåå¦‚ï¼šini:\u0026ldquo;Parent\u0026rdquo;ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 type Child struct { Age string } type Parent struct { Name string Child `ini:\u0026#34;Parent\u0026#34;` } type Config struct { City string Parent } ç¤ºä¾‹é…ç½®æ–‡ä»¶ï¼š\n1 2 3 4 5 City = Boston [Parent] Name = Unknwon Age = 21 # è‡ªå®šä¹‰é”®åå’Œé”®å€¼æ˜ å°„å™¨ # é”®åæ˜ å°„å™¨ï¼ˆName Mapperï¼‰ å½“æˆ‘ä»¬åˆ©ç”¨ç»“æ„ä½“æ ‡ç­¾æŒ‡å®šé”®åæ—¶ï¼Œä¼šè§‰å¾—å¤ªéº»çƒ¦ã€‚ä¸ºäº†èŠ‚çœæ—¶é—´å¹¶ç®€åŒ–ä»£ç ï¼Œgo-iniåº“æ”¯æŒç±»å‹ä¸º NameMapper çš„åç§°æ˜ å°„å™¨ï¼Œè¯¥æ˜ å°„å™¨è´Ÿè´£ç»“æ„å­—æ®µåä¸åˆ†åŒºåå’Œé”®åä¹‹é—´çš„æ˜ å°„ã€‚\nç›®å‰æœ‰ 2 æ¬¾å†…ç½®çš„æ˜ å°„å™¨ï¼š\nAllCapsUnderscoreï¼šè¯¥æ˜ å°„å™¨å°†å­—æ®µåè½¬æ¢è‡³æ ¼å¼ ALL_CAPS_UNDERSCORE åå†å»åŒ¹é…åˆ†åŒºåå’Œé”®åã€‚ TitleUnderscoreï¼šè¯¥æ˜ å°„å™¨å°†å­—æ®µåè½¬æ¢è‡³æ ¼å¼ title_underscore åå†å»åŒ¹é…åˆ†åŒºåå’Œé”®åã€‚ ä½¿ç”¨æ–¹æ³•ï¼šåªéœ€è¦å°†æ˜ å°„MapToã€åå°„ReflectFromå‡½æ•°åé¢åŠ ä¸ŠWithMapperï¼Œä¼ æƒ¨æ—¶ï¼Œä¼ å…¥å¯¹åº”æ˜ å°„å™¨å³å¯ã€‚æˆ–è€…ç»™æŒ‡å®šçš„æ–‡ä»¶å¯¹è±¡æŒ‡å®šæ˜ å°„å™¨ã€‚å±æ€§æ˜¯ NameMapperï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 type Info struct { PackageName string } func main() { err = ini.MapToWithMapper(\u0026amp;Info{}, ini.TitleUnderscore, []byte(\u0026#34;package_name=ini\u0026#34;)) // ... cfg, err := ini.Load([]byte(\u0026#34;PACKAGE_NAME=ini\u0026#34;)) // ... info := new(Info) cfg.NameMapper = ini.AllCapsUnderscore err = cfg.MapTo(info) // ... err = ini.ReflectFromWithMapper(cfg, \u0026amp;Info{}, ini.TitleUnderscore) } # é”®å€¼æ˜ å°„å™¨ï¼ˆValue Mapperï¼‰ å€¼æ˜ å°„å™¨å…è®¸ä½¿ç”¨ä¸€ä¸ªè‡ªå®šä¹‰å‡½æ•°è‡ªåŠ¨å±•å¼€å€¼çš„å…·ä½“å†…å®¹ï¼Œä¾‹å¦‚åœ¨è¿è¡Œæ—¶è·å–ç¯å¢ƒå˜é‡ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;os\u0026#34; \u0026#34;gopkg.in/ini.v1\u0026#34; ) type Env struct { Foo string `ini:\u0026#34;foo\u0026#34;` } func main() { cfg, _ := ini.Load([]byte(\u0026#34;[env]\\nfoo = ${USERNAME}\\n\u0026#34;)) cfg.ValueMapper = os.ExpandEnv env := \u0026amp;Env{} _ = cfg.Section(\u0026#34;env\u0026#34;).MapTo(env) fmt.Println(env) } è¿è¡Œç¨‹åºè¾“å‡ºï¼š\n1 2 $ go run main.go \u0026amp;{Lenovo} ä¼šè¾“å‡ºä½ ç”µè„‘çš„ç”¨æˆ·åã€‚\n# æ€»ç»“ æœ¬æ–‡ç®€å•ä»‹ç»äº†inié…ç½®æ–‡ä»¶æ ¼å¼ï¼Œå†…å®¹æ¥è‡ªäº’è”ç½‘ï¼Œä»…ä¾›å‚è€ƒã€‚è¿˜ä»‹ç»äº†go-iniåº“ï¼ŒåŸºæœ¬ä¸Šå‚è€ƒçš„æ˜¯å…¶å®˜æ–¹æ–‡æ¡£ï¼Œå®˜æ–¹æ–‡æ¡£å†™çš„éå¸¸è¯¦ç»†ï¼Œæ¨èå»çœ‹ï¼Œè€Œä¸”æœ‰ä¸­æ–‡ã€‚ ä½œè€…æ˜¯æ— é—»ï¼Œç›¸ä¿¡åš Go å¼€å‘çš„éƒ½ä¸é™Œç”Ÿã€‚\n# å‚è€ƒ inié…ç½®æ–‡ä»¶æ ¼å¼ go-ini GitHub ä»“åº“ go-ini å®˜æ–¹æ–‡æ¡£ Go æ¯æ—¥ä¸€åº“ä¹‹ go-ini ","date":"2024-05-15T22:26:10+08:00","permalink":"https://arlettebrook.github.io/p/go-ini-introduction/","title":"Go-ini Introduction"},{"content":" # ç®€ä»‹ ä¸€çº¿å¼€å‘äººå‘˜æ¯å¤©éƒ½è¦ä½¿ç”¨æ—¥æœŸå’Œæ—¶é—´ç›¸å…³çš„åŠŸèƒ½ï¼Œå„ç§å®šæ—¶å™¨ï¼Œæ´»åŠ¨æ—¶é—´å¤„ç†ç­‰ã€‚æ ‡å‡†åº“timeä½¿ç”¨èµ·æ¥ä¸å¤ªçµæ´»ï¼Œç‰¹åˆ«æ˜¯æ—¥æœŸæ—¶é—´çš„åˆ›å»ºå’Œè¿ç®—ã€‚carbonåº“æ˜¯ä¸€ä¸ªæ—¶é—´æ‰©å±•åº“ï¼ŒåŸºäº PHP çš„carbonåº“ç¼–å†™ã€‚æä¾›æ˜“äºä½¿ç”¨çš„æ¥å£ã€‚Goç¤¾åŒºè¿˜æœ‰å¦å¤–ä¸€ä¸ªåŒååº“carbonï¼Œæˆ‘ç§°ä¹‹ä¸ºå¢å¼ºç‰ˆï¼Œæœ¬æ–‡å°±æ¥ä»‹ç»ä¸€ä¸‹è¿™ä¸¤ä¸ªåº“ï¼Œä¸»è¦ä»‹ç»ä½é…ç‰ˆï¼ŒäºŒè€…å·®ä¸å¤šï¼Œä¼šäº†ä½é…ç‰ˆï¼Œå¢å¼ºç‰ˆä¹Ÿå°±ä¼šäº†ã€‚å¢å¼ºç‰ˆç”¨çš„äººæ›´å¤šï¼Œæ¨èä½¿ç”¨å¢å¼ºç‰ˆã€‚\n# å¿«é€Ÿä½¿ç”¨ ç¬¬ä¸‰æ–¹åº“éœ€è¦å…ˆå®‰è£…ï¼š\n1 $ go get -u github.com/uniplaces/carbon åä½¿ç”¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;time\u0026#34; \u0026#34;github.com/uniplaces/carbon\u0026#34; ) func main() { fmt.Printf(\u0026#34;Right now is %s\\n\u0026#34;, carbon.Now().DateTimeString()) today, _ := carbon.NowInLocation(\u0026#34;Japan\u0026#34;) fmt.Printf(\u0026#34;Right now in Japan is %s\\n\u0026#34;, today) fmt.Printf(\u0026#34;Tomorrow is %s\\n\u0026#34;, carbon.Now().AddDay()) fmt.Printf(\u0026#34;Last week is %s\\n\u0026#34;, carbon.Now().SubWeek()) nextOlympics, _ := carbon.CreateFromDate(2016, time.August, 5, \u0026#34;Europe/London\u0026#34;) nextOlympics = nextOlympics.AddYears(4) fmt.Printf(\u0026#34;Next olympics are in %d\\n\u0026#34;, nextOlympics.Year()) if carbon.Now().IsWeekend() { fmt.Printf(\u0026#34;Happy time!\u0026#34;) } } carbonåº“çš„ä½¿ç”¨å¾ˆä¾¿æ·ï¼Œé¦–å…ˆå®ƒå®Œå…¨å…¼å®¹æ ‡å‡†åº“çš„time.Timeç±»å‹ï¼Œå®é™…ä¸Šè¯¥åº“çš„æ—¥æœŸæ—¶é—´ç±»å‹Carbonç›´æ¥å°†time.Timeå†…åµŒåˆ°ç»“æ„ä¸­ï¼ˆç»§æ‰¿äº†time.Timeç»“æ„ä½“ï¼‰ï¼Œæ‰€ä»¥time.Timeçš„æ–¹æ³•å¯ç›´æ¥è°ƒç”¨ï¼š\n1 2 3 4 5 6 7 8 9 // github.com/uniplaces/carbon/carbon.go type Carbon struct { time.Time weekStartsAt time.Weekday weekEndsAt time.Weekday weekendDays []time.Weekday stringFormat string Translator *Translator } å…¶æ¬¡ï¼Œç®€åŒ–äº†åˆ›å»ºæ“ä½œã€‚æ ‡å‡†åº“timeåˆ›å»ºä¸€ä¸ªTimeå¯¹è±¡ï¼Œå¦‚æœä¸æ˜¯æœ¬åœ°æˆ– UTC æ—¶åŒºï¼Œéœ€è¦è‡ªå·±å…ˆè°ƒç”¨LoadLocationåŠ è½½å¯¹åº”æ—¶åŒºã€‚ç„¶åå°†è¯¥æ—¶åŒºå¯¹è±¡ä¼ ç»™time.Time.Inæˆ–è€…time.Dateæ–¹æ³•åˆ›å»ºã€‚carbonå¯ä»¥ç›´æ¥ä¼ æ—¶åŒºåå­—ã€‚åº•å±‚å…¶å®ä¹Ÿæ˜¯ç”¨åŸå§‹æ–¹æ³•åˆ›å»ºçš„ï¼Œcarbonå¸®æˆ‘ä»¬å°è£…åˆ°äº†NowInLocationæ–¹æ³•ä¸­ã€‚åªéœ€è¦ä¼ å…¥æ—¶åŒºï¼Œå°±èƒ½è·å–æŒ‡å®šæ—¶åŒºå½“å‰æ—¶é—´ã€‚\ncarbonè¿˜æä¾›äº†å¾ˆå¤šæ–¹æ³•åšæ—¥æœŸè¿ç®—ï¼Œå¦‚ä¾‹å­ä¸­çš„AddDayï¼ŒSubWeekï¼ŒAddyearsç­‰ã€‚æ²¡æœ‰sé»˜è®¤+1ï¼Œæœ‰sæŒ‡å®šåŠ å¤šå°‘ï¼Œæ³¨æ„å•ä½ï¼Œéƒ½æ˜¯è§åçŸ¥ä¹‰çš„ã€‚\nï¼ˆä¸Šé¢çš„æºç å¾ˆç®€å•ï¼Œçœ‹ä¸æ‡‚çš„è¯ï¼Œå»ºè®®å»çœ‹ä¸€ä¸‹æºç ï¼‰\nCreateFromDateæ–¹æ³•ï¼Œç”¨äºæŒ‡å®šæ—¥æœŸã€æ—¶åŒºåˆ›å»ºCarbonå¯¹è±¡ã€‚æ—¶é—´éƒ¨åˆ†é»˜è®¤æ˜¯å½“å‰æ—¶é—´ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šæ—¶åŒº(ä¸ºç©ºå­—ç¬¦ä¸²ï¼‰ï¼Œé»˜è®¤ä¸ºUTCæ—¶åŒºã€‚å­—ç¬¦ä¸²ä¸ºLocal,ä¸ºæœ¬åœ°æ—¶åŒºã€‚\nä¸€ç‚¹ç‚¹æºç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 // github.com\\uniplaces\\carbon\\carbon.go func CreateFromDate(y int, mon time.Month, d int, location string) (*Carbon, error) { h, m, s := Now().Clock() ns := Now().Nanosecond() return Create(y, mon, d, h, m, s, ns, location) func Create(y int, mon time.Month, d, h, m, s, ns int, location string) (*Carbon, error) { l, err := time.LoadLocation(location) if err != nil { return nil, err } return create(y, mon, d, h, m, s, ns, l), nil } // time\\zoneinfo.go func LoadLocation(name string) (*Location, error) { if name == \u0026#34;\u0026#34; || name == \u0026#34;UTC\u0026#34; { return UTC, nil } if name == \u0026#34;Local\u0026#34; { return Local, nil } ... // time\\time.go func Now() Time { sec, nsec, mono := now() mono -= startNano sec += unixToInternal - minWall if uint64(sec)\u0026gt;\u0026gt;33 != 0 { // Seconds field overflowed the 33 bits available when // storing a monotonic time. This will be true after // March 16, 2157. return Time{uint64(nsec), sec + minWall, Local} } return Time{hasMonotonic | uint64(sec)\u0026lt;\u0026lt;nsecShift | uint64(nsec), mono, Local} // è¿™é‡Œç”¨æœ¬åœ°æ—¶åŒºã€‚ } æ€»ç»“ï¼šæ²¡æœ‰æŒ‡å®šæ—¶åŒºæ—¶ï¼Œé»˜è®¤æœ¬åœ°åŒºæ—¶åŒºï¼Œå½“è¦æŒ‡å®šæ—¶åŒºæ—¶ï¼Œé»˜è®¤UTCæ—¶åŒºã€‚ï¼ˆåº•å±‚æºç ç›®å‰çœ‹ä¸æ‡‚ğŸ˜ğŸ˜ğŸ˜ï¼‰\n# æ—¶åŒº åœ¨ä»‹ç»å…¶å®ƒå†…å®¹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆè¯´ä¸€è¯´è¿™ä¸ªæ—¶åŒºçš„é—®é¢˜ã€‚ä»¥ä¸‹å¼•ç”¨ç»´åŸºç™¾ç§‘çš„æè¿°ï¼š\næ—¶åŒºæ˜¯åœ°çƒä¸Šçš„åŒºåŸŸä½¿ç”¨åŒä¸€ä¸ªæ—¶é—´å®šä¹‰ã€‚ä»¥å‰ï¼Œäººä»¬é€šè¿‡è§‚å¯Ÿå¤ªé˜³çš„ä½ç½®ï¼ˆæ—¶è§’ï¼‰å†³å®šæ—¶é—´ï¼Œè¿™å°±ä½¿å¾—ä¸åŒç»åº¦çš„åœ°æ–¹çš„æ—¶é—´æœ‰æ‰€ä¸åŒï¼ˆåœ°æ–¹æ—¶ï¼‰ã€‚1863å¹´ï¼Œé¦–æ¬¡ä½¿ç”¨æ—¶åŒºçš„æ¦‚å¿µã€‚æ—¶åŒºé€šè¿‡è®¾ç«‹ä¸€ä¸ªåŒºåŸŸçš„æ ‡å‡†æ—¶é—´éƒ¨åˆ†åœ°è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ ä¸–ç•Œå„å›½ä½äºåœ°çƒä¸åŒä½ç½®ä¸Šï¼Œå› æ­¤ä¸åŒå›½å®¶ï¼Œç‰¹åˆ«æ˜¯ä¸œè¥¿è·¨åº¦å¤§çš„å›½å®¶æ—¥å‡ºã€æ—¥è½æ—¶é—´å¿…å®šæœ‰æ‰€åå·®ã€‚è¿™äº›åå·®å°±æ˜¯æ‰€è°“çš„æ—¶å·®ã€‚\nä¾‹å¦‚ï¼Œæ—¥æœ¬ä¸œäº¬ä½äºä¸œä¹åŒºï¼ŒåŒ—äº¬ä½äºä¸œå…«åŒºï¼Œæ‰€ä»¥æ—¥æœ¬æ¯”ä¸­å›½å¿«ä¸€ä¸ªå°æ—¶ï¼Œæ—¥æœ¬14:00çš„æ—¶å€™ä¸­å›½13:00ã€‚\nåœ¨ Linux ä¸­ï¼Œæ—¶åŒºä¸€èˆ¬å­˜æ”¾åœ¨ç±»ä¼¼/usr/share/zoneinfoè¿™æ ·çš„ç›®å½•ã€‚è¿™ä¸ªç›®å½•ä¸­æœ‰å¾ˆå¤šæ–‡ä»¶ï¼Œæ¯ä¸ªæ—¶åŒºä¸€ä¸ªæ–‡ä»¶ã€‚æ—¶åŒºæ–‡ä»¶æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ä»¥æ‰§è¡Œinfo tzfileæŸ¥çœ‹å…·ä½“æ ¼å¼ã€‚\næ—¶åŒºåç§°çš„ä¸€èˆ¬æ ¼å¼ä¸ºcityï¼Œæˆ–country/cityï¼Œæˆ–continent/cityã€‚å³è¦ä¹ˆå°±æ˜¯ä¸€ä¸ªåŸå¸‚åï¼Œè¦ä¹ˆæ˜¯å›½å®¶å+/+åŸå¸‚åï¼Œè¦ä¹ˆæ˜¯æ´²å+/+åŸå¸‚åã€‚\nä¾‹å¦‚ä¸Šæµ·æ—¶åŒºä¸ºAsia/Shanghai(åœ¨æ—¶åŒºæ–‡ä»¶ä¸­è¡¨ç¤ºä¸œå…«åŒºçš„æ—¶åŒºï¼Œå³åŒ—äº¬æ—¶é—´ï¼‰ï¼Œé¦™æ¸¯æ—¶åŒºä¸ºAsia/Hong_Kongæˆ–è€…Hongkongï¼ˆå¸¸è¯†ï¼šä¸­å›½æ ‡å‡†æ—¶é—´ï¼ˆCST)ä¸ºä¸œå…«åŒºæ—¶é—´,èŒƒå›´ä¸­å›½å…¨å¢ƒï¼ˆå¤§é™†ã€æ¸¯æ¾³ã€å°æ¹¾ï¼‰ï¼‰æ„å‘³ç€é¦™æ¸¯æ—¶é—´ä¸åŒ—äº¬æ—¶é—´ä¸€æ ·ï¼Œæ³¨æ„åŒ—äº¬æ—¶é—´å¹¶ä¸æ˜¯åŒ—äº¬çš„åœ°æ–¹æ—¶ï¼Œä¸œå…«åŒºåœ¨ä¸œç»120Â°çš„åœ°æ–¹ï¼ŒåŒ—äº¬åœ¨ä¸œç»116.4Â°ã€‚æ•…ä¸œç»120åº¦åœ°æ–¹æ—¶æ¯”åŒ—äº¬çš„åœ°æ–¹æ—¶æ—©çº¦14åˆ†åŠé’Ÿ(äº†è§£ï¼‰ã€‚è¿˜æœ‰CST,å¯èƒ½ä¸ºå…¶ä»–åœ°åŒºçš„æ ‡å‡†æ—¶é—´ï¼Œå¦‚ç¾å›½ä¸­éƒ¨æ ‡å‡†æ—¶é—´ï¼ˆCentral Standard Timeï¼‰ï¼Œä½¿ç”¨çš„æ—¶å€™è¦æ³¨æ„ä¸Šä¸‹æ–‡ã€‚\nä¹Ÿæœ‰ä¸€äº›ç‰¹æ®Šçš„ï¼Œå¦‚ UTCï¼ŒLocalç­‰ã€‚\nGo è¯­è¨€ä¸ºäº†å¯ç§»æ¤æ€§ï¼Œåœ¨å®‰è£…åŒ…ä¸­æä¾›äº†æ—¶åŒºæ–‡ä»¶ï¼Œåœ¨Goå®‰è£…ç›®å½•ä¸‹çš„lib/time/zoneinfo.zipæ–‡ä»¶ï¼Œå¤§å®¶å¯ä»¥æ‰§è¡Œè§£å‹çœ‹çœ‹ğŸ˜€ã€‚\nä½¿ç”¨ Go æ ‡å‡†åº“timeåˆ›å»ºæŸä¸ªæ—¶åŒºçš„æ—¶é—´ï¼Œéœ€è¦å…ˆåŠ è½½æ—¶åŒºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;time\u0026#34; ) func main() { loc, err := time.LoadLocation(\u0026#34;Japan\u0026#34;) if err != nil { log.Fatal(\u0026#34;failed to load location: \u0026#34;, err) } //t := time.Now().In(loc) // è¿™é‡Œæ¼”ç¤ºæŒ‡å®šæ—¥æœŸæ—¶é—´åˆ›å»ºTimeå¯¹è±¡ d := time.Date(2020, time.July, 24, 20, 0, 0, 0, loc) fmt.Printf(\u0026#34;The opening ceremony of next olympics will start at %s in Japan\\n\u0026#34;, d) } ä½¿ç”¨carbonå°±ä¸ç”¨è¿™ä¹ˆéº»çƒ¦ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;time\u0026#34; \u0026#34;github.com/uniplaces/carbon\u0026#34; ) func main() { c, err := carbon.Create(2020, time.July, 24, 20, 0, 0, 0, \u0026#34;Japan\u0026#34;) if err != nil { log.Fatal(err) } fmt.Printf(\u0026#34;The opening ceremony of next olympics will start at %s in Japan\\n\u0026#34;, c) } # åˆ›å»ºå¯¹è±¡ åˆ›å»ºCarbonå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡ï¼š\nNowæ–¹æ³•ï¼Œè¿”å›æœ¬åœ°æ—¶åŒºçš„å½“å‰æ—¶é—´å¯¹è±¡ã€‚\nNewCarbonæ–¹æ³•ï¼Œè¿”å›æŒ‡å®šæ—¶é—´çš„æœ¬åœ°æ—¶åŒºæ—¶é—´å¯¹è±¡ã€‚Nowæ–¹æ³•æ˜¯åŸºäºå®ƒåˆ›å»ºçš„ã€‚\nCreateFromDateæ–¹æ³•ï¼Œç”¨äºæŒ‡å®šæ—¥æœŸã€æ—¶åŒºåˆ›å»ºCarbonå¯¹è±¡ã€‚æ—¶é—´éƒ¨åˆ†é»˜è®¤æ˜¯å½“å‰æ—¶é—´ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šæ—¶åŒº(ä¸ºç©ºå­—ç¬¦ä¸²ï¼‰ï¼Œé»˜è®¤ä¸ºUTCæ—¶åŒºã€‚å­—ç¬¦ä¸²ä¸ºLocal,ä¸ºæœ¬åœ°æ—¶åŒºã€‚\nCrreateFromTimeæ–¹æ³•ä¸€æ ·ï¼Œåªä¸è¿‡æ˜¯æŒ‡å®šæ—¶é—´ã€‚ æ³¨æ„ï¼Œåˆ›å»ºçš„æ—¥æœŸï¼Œé»˜è®¤ä¸ºå½“å‰æ—¥æœŸã€‚è™½ç„¶æ²¡æœ‰æŒ‡å®šï¼Œä½†ä¸ä¼šæ²¡æœ‰ã€‚ Createæ–¹æ³•ï¼Œè¿”å›æ ¹æ®æ—¥æœŸã€æ—¶é—´ã€æ—¶åŒºåˆ›å»ºçš„æ—¶é—´å¯¹è±¡\nParseæ–¹æ³•ï¼Œè¿”å›æ ¹æ®æ—¥æœŸæ—¶é—´æ ¼å¼ã€æŒ‡å®šçš„æ—¶é—´ã€æ—¶åŒºè§£æçš„æ—¶é—´å¯¹è±¡ã€‚\nç¤ºä¾‹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;time\u0026#34; \u0026#34;github.com/uniplaces/carbon\u0026#34; ) func main() { now := carbon.NewCarbon(time.Now()) fmt.Printf(\u0026#34;New carbon from time instance: %s\\n\u0026#34;, now) now = carbon.Now() fmt.Printf(\u0026#34;New carbon from Now function: %s\\n\u0026#34;, now) fromDate, _ := carbon.CreateFromDate(2000, 1, 1, \u0026#34;Europe/London\u0026#34;) fmt.Printf(\u0026#34;Created from date: %s\\n\u0026#34;, fromDate) fromTime, _ := carbon.CreateFromTime(9, 16, 11, 0, \u0026#34;Europe/Madrid\u0026#34;) fmt.Printf(\u0026#34;Created from time: %s\\n\u0026#34;, fromTime) create, _ := carbon.Create(2024, 5, 14, 15, 3, 3, 3, \u0026#34;Local\u0026#34;) fmt.Println(create) parsed, _ := carbon.Parse(carbon.DateFormat, \u0026#34;2000-08-20\u0026#34;, \u0026#34;Europe/Berlin\u0026#34;) fmt.Printf(\u0026#34;Parsed time: %s\\n\u0026#34;, parsed) parse, _ := carbon.Parse(time.DateTime, \u0026#34;2024-05-14 22:10:22\u0026#34;, \u0026#34;Local\u0026#34;) fmt.Println(parse) timestamp, _ := carbon.CreateFromTimestamp(-1, \u0026#34;Local\u0026#34;) fmt.Println(timestamp) // 1970-01-01 07:59:59 } åé¢ä¼šä»‹ç»æ—¶é—´æ ¼å¼åŒ–ã€‚\n# æ—¶é—´è¿ç®— ä½¿ç”¨æ ‡å‡†åº“timeçš„æ—¶é—´è¿ç®—éœ€è¦å…ˆå®šä¹‰ä¸€ä¸ªtime.Durationå¯¹è±¡ï¼Œtimeåº“é¢„å®šä¹‰çš„åªæœ‰çº³ç§’åˆ°å°æ—¶çš„ç²¾åº¦ï¼š\n1 2 3 4 5 6 7 8 const ( Nanosecond Duration = 1 Microsecond = 1000 * Nanosecond Millisecond = 1000 * Microsecond Second = 1000 * Millisecond Minute = 60 * Second Hour = 60 * Minute ) å…¶å®ƒçš„æ—¶é•¿å°±éœ€è¦è‡ªå·±ä½¿ç”¨time.ParseDurationæ„é€ äº†ï¼Œè€Œä¸”time.ParseDurationä¸èƒ½æ„é€ å…¶å®ƒç²¾åº¦çš„æ—¶é—´ã€‚ å¦‚æœæƒ³è¦å¢åŠ /å‡å°‘å¹´æœˆæ—¥ï¼Œå°±éœ€è¦ä½¿ç”¨time.Timeçš„AddDateæ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;time\u0026#34; ) func main() { now := time.Now() fmt.Println(\u0026#34;now is:\u0026#34;, now) fmt.Println(\u0026#34;one second later is:\u0026#34;, now.Add(time.Second)) fmt.Println(\u0026#34;one minute later is:\u0026#34;, now.Add(time.Minute)) fmt.Println(\u0026#34;one hour later is:\u0026#34;, now.Add(time.Hour)) d, err := time.ParseDuration(\u0026#34;3m20s\u0026#34;) if err != nil { log.Fatal(err) } fmt.Println(\u0026#34;3 minutes and 20 seconds later is:\u0026#34;, now.Add(d)) d, err = time.ParseDuration(\u0026#34;2h30m\u0026#34;) if err != nil { log.Fatal(err) } fmt.Println(\u0026#34;2 hours and 30 minutes later is:\u0026#34;, now.Add(d)) fmt.Println(\u0026#34;3 days and 2 hours later is:\u0026#34;, now.AddDate(0, 0, 3).Add(time.Hour*2)) } éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ—¶é—´æ“ä½œéƒ½æ˜¯è¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼ŒåŸå¯¹è±¡ä¸ä¼šä¿®æ”¹ã€‚carbonåº“ä¹Ÿæ˜¯å¦‚æ­¤ã€‚Go çš„æ ‡å‡†åº“ä¹Ÿå»ºè®®æˆ‘ä»¬ä¸è¦ä½¿ç”¨time.Timeçš„æŒ‡é’ˆã€‚ å½“ç„¶carbonåº“ä¹Ÿèƒ½ä½¿ç”¨ä¸Šé¢çš„æ–¹æ³•ï¼Œå®ƒè¿˜æä¾›äº†å¤šç§ç²’åº¦çš„æ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/uniplaces/carbon\u0026#34; ) func main() { now := carbon.Now() fmt.Println(\u0026#34;now is:\u0026#34;, now) fmt.Println(\u0026#34;one second later is:\u0026#34;, now.AddSecond()) fmt.Println(\u0026#34;one minute later is:\u0026#34;, now.AddMinute()) fmt.Println(\u0026#34;one hour later is:\u0026#34;, now.AddHour()) fmt.Println(\u0026#34;3 minutes and 20 seconds later is:\u0026#34;, now.AddMinutes(3).AddSeconds(20)) fmt.Println(\u0026#34;2 hours and 30 minutes later is:\u0026#34;, now.AddHours(2).AddMinutes(30)) fmt.Println(\u0026#34;3 days and 2 hours later is:\u0026#34;, now.AddDays(3).AddHours(2)) } carbonè¿˜æä¾›äº†ï¼š\nå¢åŠ å­£åº¦çš„æ–¹æ³•ï¼šAddQuarters/AddQuarterï¼Œå¤æ•°å½¢å¼ä»‹ç»ä¸€ä¸ªè¡¨ç¤ºå€æ•°çš„å‚æ•°ï¼Œå•æ•°å½¢å¼å€æ•°ä¸º1ï¼› å¢åŠ ä¸–çºªçš„æ–¹æ³•ï¼šAddCenturies/AddCenturyï¼› å¢åŠ å·¥ä½œæ—¥çš„æ–¹æ³•ï¼šAddWeekdays/AddWeekdayï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè·³è¿‡éå·¥ä½œæ—¥ï¼› å¢åŠ å‘¨çš„æ–¹æ³•ï¼šAddWeeks/AddWeekã€‚ å…¶å®ç»™ä¸Šé¢æ–¹æ³•ä¼ å…¥è´Ÿæ•°å°±è¡¨ç¤ºå‡å°‘ï¼Œå¦å¤–carbonä¹Ÿæä¾›äº†å¯¹åº”çš„Sub*æ–¹æ³•ã€‚\n# æ—¶é—´æ¯”è¾ƒ æ³¨æ„ï¼šæ—¶é—´æ¯”è¾ƒçš„æ˜¯å¿«æ…¢ã€‚\næ ‡å‡†åº“timeå¯ä»¥ä½¿ç”¨time.Timeå¯¹è±¡çš„Before/After/Equalåˆ¤æ–­æ˜¯å¦åœ¨å¦ä¸€ä¸ªæ—¶é—´å¯¹è±¡å‰ï¼Œåï¼Œæˆ–ç›¸ç­‰ã€‚carbonåº“ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸Šé¢çš„æ–¹æ³•æ¯”è¾ƒæ—¶é—´ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒè¿˜æä¾›äº†å¤šç»„æ–¹æ³•ï¼Œæ¯ä¸ªæ–¹æ³•æä¾›ä¸€ä¸ªç®€çŸ­åï¼Œä¸€ä¸ªè¯¦ç»†åï¼š\nEq/EqualToï¼šæ˜¯å¦ç›¸ç­‰ï¼›ä¸åŒæ—¶åŒºçš„æ—¥æœŸæ—¶é—´ä¸åŒï¼Œä½†æ—¶é—´å¯èƒ½ä¼šç›¸ç­‰ã€‚å¦‚ 6:00 +0200 and 4:00 UTC are Equal. Ne/NotEqualToï¼šæ˜¯å¦ä¸ç­‰ï¼› Gt/GreaterThanï¼šæ˜¯å¦åœ¨ä¹‹åï¼› Gte/GreaterThanOrEqualTo:å¿«æˆ–è€…ç›¸ç­‰ã€‚ Lt/LessThanï¼šæ˜¯å¦åœ¨ä¹‹å‰ï¼› Lte/LessThanOrEqualToï¼šæ˜¯å¦ç›¸åŒæˆ–åœ¨ä¹‹å‰ï¼› Betweenï¼šæ˜¯å¦åœ¨ä¸¤ä¸ªæ—¶é—´ä¹‹é—´ã€‚ å¦å¤–carbonæä¾›äº†ï¼š\nåˆ¤æ–­å½“å‰æ—¶é—´æ˜¯å‘¨å‡ çš„æ–¹æ³•ï¼šIsMonday/IsTuesday/.../IsSundayï¼› æ˜¯å¦æ˜¯å·¥ä½œæ—¥ï¼Œå‘¨æœ«ï¼Œé—°å¹´ï¼Œè¿‡å»æ—¶é—´è¿˜æ˜¯æœªæ¥æ—¶é—´ï¼šIsWeekday/IsWeekend/IsLeapYear/IsPast/IsFutureã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/uniplaces/carbon\u0026#34; ) func main() { t1, _ := carbon.CreateFromDate(2010, 10, 1, \u0026#34;Asia/Shanghai\u0026#34;) t2, _ := carbon.CreateFromDate(2011, 10, 20, \u0026#34;Asia/Shanghai\u0026#34;) fmt.Printf(\u0026#34;t1 equal to t2: %t\\n\u0026#34;, t1.Eq(t2)) fmt.Printf(\u0026#34;t1 not equal to t2: %t\\n\u0026#34;, t1.Ne(t2)) fmt.Printf(\u0026#34;t1 greater than t2: %t\\n\u0026#34;, t1.Gt(t2)) fmt.Printf(\u0026#34;t1 less than t2: %t\\n\u0026#34;, t1.Lt(t2)) fmt.Printf(\u0026#34;t1 greater than or equal: %t\u0026#34;, t1.Gte(t2)) t3, _ := carbon.CreateFromDate(2011, 1, 20, \u0026#34;Asia/Shanghai\u0026#34;) fmt.Printf(\u0026#34;t3 between t1 and t2: %t\\n\u0026#34;, t3.Between(t1, t2, true)) now := carbon.Now() fmt.Printf(\u0026#34;Weekday? %t\\n\u0026#34;, now.IsWeekday()) fmt.Printf(\u0026#34;Weekend? %t\\n\u0026#34;, now.IsWeekend()) fmt.Printf(\u0026#34;LeapYear? %t\\n\u0026#34;, now.IsLeapYear()) fmt.Printf(\u0026#34;Past? %t\\n\u0026#34;, now.IsPast()) fmt.Printf(\u0026#34;Future? %t\\n\u0026#34;, now.IsFuture()) } # æ—¶é—´å·® æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨carbonè®¡ç®—ä¸¤ä¸ªæ—¥æœŸä¹‹é—´ç›¸å·®å¤šå°‘ç§’ã€åˆ†ã€å°æ—¶ã€å¤©ã€‚\nç”¨åˆ°çš„æ–¹æ³•æ˜¯func (c *Carbon) DiffInXXX(carb *Carbon, abs bool),è¡¨ç¤ºçš„æ˜¯ç›¸å¯¹äºå¯¹è±¡cå¿«äº†è¿˜æ…¢äº†å¤šå°‘XXXã€‚æ­£æ•°è¡¨ç¤ºcæ…¢äº†ï¼Œè´Ÿæ•°è¡¨ç¤ºcå¿«äº†ã€‚åŸç†ï¼š\n1 diff := carb.Timestamp() - c.Timestamp() absè¡¨ç¤ºæ˜¯å¦å¯ç”¨ç»å¯¹å€¼ã€‚\nç¤ºä¾‹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/uniplaces/carbon\u0026#34; ) func main() { cst, _ := carbon.Today(\u0026#34;Asia/Shanghai\u0026#34;) hongKong, _ := carbon.Today(\u0026#34;Hongkong\u0026#34;) Japan, _ := carbon.Today(\u0026#34;Japan\u0026#34;) fmt.Println(cst.DiffInSeconds(hongKong, true)) // 0 fmt.Println(cst.DiffInHours(Japan, false)) // 0 Beijing, _ := carbon.CreateFromDate(2000, 1, 1, \u0026#34;Asia/Shanghai\u0026#34;) Tokyo, _ := carbon.CreateFromDate(2000, 1, 1, \u0026#34;Japan\u0026#34;) fmt.Println(Beijing.DiffInHours(Tokyo, true)) // 1 fmt.Println(Beijing.DiffInHours(Tokyo, false)) // -1 fmt.Println(Tokyo.DiffInHours(Beijing, false)) // 1 t, _ := carbon.CreateFromDate(2012, 1, 1, \u0026#34;UTC\u0026#34;) fmt.Println(t.DiffInDays(t.Copy().AddMonth(), false)) // 31 fmt.Println(t.DiffInDays(t.Copy().SubMonth(), false)) // -31 t, _ = carbon.CreateFromDate(2012, 4, 30, \u0026#34;UTC\u0026#34;) fmt.Println(t.DiffInDays(t.Copy().AddMonth(), false)) // 30 fmt.Println(t.DiffInDays(t.Copy().AddWeek(), false)) // 7 t, _ = carbon.CreateFromTime(10, 1, 1, 0, \u0026#34;UTC\u0026#34;) fmt.Println(t.DiffInMinutes(t.Copy().AddSeconds(59), true)) // 0 fmt.Println(t.DiffInMinutes(t.Copy().AddSeconds(60), true)) // 1 fmt.Println(t.DiffInMinutes(t.Copy().AddSeconds(119), true)) // 1 fmt.Println(t.DiffInMinutes(t.Copy().AddSeconds(120), true)) // 2 fmt.Println(t.DiffInHours(t.Copy().AddMinutes(59), false)) // 0 fmt.Println(t.DiffInHours(t.Copy().AddMinutes(60), false)) // 1 fmt.Println(t.DiffInHours(t.Copy().AddHours(2).AddMinutes(60), false)) // 3 } æ³¨æ„ï¼š\nä¸Šé¢è¾“å‡ºå®Œå…¨æ­£ç¡®ã€‚ ä¸ç†è§£æ˜¯å› ä¸ºï¼š æ­£æ•°è¡¨ç¤ºcæ…¢äº†ï¼Œè´Ÿæ•°è¡¨ç¤ºcå¿«äº†ã€‚ å½“åŒ—äº¬æ—¶é—´å’Œä¸œäº¬æ—¶é—´æ•°å­—ç›¸åŒæ—¶ï¼Œå…¶å®åŒ—äº¬æ—¶é—´è¦å¿«ä¸€ä¸ªå°æ—¶ã€‚å³ç›¸åŒæ•°å­—çš„åŒ—äº¬æ—¶é—´å’Œä¸œäº¬æ—¶é—´ï¼ŒåŒ—äº¬æ—¶é—´çš„æ—¶é—´æˆ³è¦å¤§ä¸€ç‚¹ã€‚å› ä¸ºå®é™…åŒ—äº¬æ—¶é—´æ¯”ä¸œäº¬æ—¶é—´æ…¢ä¸€ä¸ªå°æ—¶ã€‚ # æ ¼å¼åŒ– æˆ‘ä»¬çŸ¥é“time.Timeæä¾›äº†ä¸€ä¸ªFormatæ–¹æ³•ï¼Œç›¸æ¯”äºå…¶ä»–ç¼–ç¨‹è¯­è¨€ä½¿ç”¨æ ¼å¼åŒ–ç¬¦æ¥æè¿°æ ¼å¼ï¼ˆéœ€è¦è®°å¿†%d/%m/%hç­‰çš„å«ä¹‰ï¼‰ï¼ŒGo æä¾›äº†ä¸€ä¸ªä¸€ç§æ›´ç®€å•ã€ç›´è§‚çš„æ–¹å¼â€”â€”ä½¿ç”¨ layoutã€‚å³æˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªæ—¥æœŸå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæˆ‘ä»¬æƒ³è¦æ ¼å¼åŒ–æˆä»€ä¹ˆæ ·å­ã€‚Go ä¼šç”¨å½“å‰çš„æ—¶é—´æ›¿æ¢å­—ç¬¦ä¸²ä¸­çš„å¯¹åº”éƒ¨åˆ†ï¼š\n1 2 3 4 5 6 7 8 9 10 11 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;time\u0026#34; ) func main() { t := time.Now() fmt.Println(t.Format(\u0026#34;2006-01-02 15:04:05\u0026#34;)) } ä¸Šé¢æˆ‘ä»¬åªéœ€è¦ä¼ å…¥ä¸€ä¸ª2006-01-02 15:04:05è¡¨ç¤ºæˆ‘ä»¬æƒ³è¦çš„æ ¼å¼ä¸ºyyyy-mm-dd hh:mm:ssï¼Œçœå»äº†æˆ‘ä»¬éœ€è¦è®°å¿†çš„éº»çƒ¦ã€‚\nä¸ºäº†ä½¿ç”¨æ–¹ä¾¿ï¼ŒGo å†…ç½®äº†ä¸€äº›æ ‡å‡†çš„æ—¶é—´æ ¼å¼ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 // time/format.go const ( Layout = \u0026#34;01/02 03:04:05PM \u0026#39;06 -0700\u0026#34; // The reference time, in numerical order. ANSIC = \u0026#34;Mon Jan _2 15:04:05 2006\u0026#34; UnixDate = \u0026#34;Mon Jan _2 15:04:05 MST 2006\u0026#34; RubyDate = \u0026#34;Mon Jan 02 15:04:05 -0700 2006\u0026#34; RFC822 = \u0026#34;02 Jan 06 15:04 MST\u0026#34; RFC822Z = \u0026#34;02 Jan 06 15:04 -0700\u0026#34; // RFC822 with numeric zone RFC850 = \u0026#34;Monday, 02-Jan-06 15:04:05 MST\u0026#34; RFC1123 = \u0026#34;Mon, 02 Jan 2006 15:04:05 MST\u0026#34; RFC1123Z = \u0026#34;Mon, 02 Jan 2006 15:04:05 -0700\u0026#34; // RFC1123 with numeric zone RFC3339 = \u0026#34;2006-01-02T15:04:05Z07:00\u0026#34; RFC3339Nano = \u0026#34;2006-01-02T15:04:05.999999999Z07:00\u0026#34; Kitchen = \u0026#34;3:04PM\u0026#34; // Handy time stamps. Stamp = \u0026#34;Jan _2 15:04:05\u0026#34; StampMilli = \u0026#34;Jan _2 15:04:05.000\u0026#34; StampMicro = \u0026#34;Jan _2 15:04:05.000000\u0026#34; StampNano = \u0026#34;Jan _2 15:04:05.000000000\u0026#34; DateTime = \u0026#34;2006-01-02 15:04:05\u0026#34; DateOnly = \u0026#34;2006-01-02\u0026#34; TimeOnly = \u0026#34;15:04:05\u0026#34; ) åé¢ä¸‰ä¸ªæ˜¯åœ¨åé¢ç‰ˆæœ¬åŠ ä¸Šè¿›çš„ã€‚\né™¤äº†ä¸Šé¢è¿™äº›æ ¼å¼ï¼Œcarbonè¿˜æä¾›äº†å…¶ä»–ä¸€äº›æ ¼å¼ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // github.com/uniplaces/carbon const ( DefaultFormat = \u0026#34;2006-01-02 15:04:05\u0026#34; DateFormat = \u0026#34;2006-01-02\u0026#34; FormattedDateFormat = \u0026#34;Jan 2, 2006\u0026#34; TimeFormat = \u0026#34;15:04:05\u0026#34; HourMinuteFormat = \u0026#34;15:04\u0026#34; HourFormat = \u0026#34;15\u0026#34; DayDateTimeFormat = \u0026#34;Mon, Jan 2, 2006 3:04 PM\u0026#34; CookieFormat = \u0026#34;Monday, 02-Jan-2006 15:04:05 MST\u0026#34; RFC822Format = \u0026#34;Mon, 02 Jan 06 15:04:05 -0700\u0026#34; RFC1036Format = \u0026#34;Mon, 02 Jan 06 15:04:05 -0700\u0026#34; RFC2822Format = \u0026#34;Mon, 02 Jan 2006 15:04:05 -0700\u0026#34; RFC3339Format = \u0026#34;2006-01-02T15:04:05-07:00\u0026#34; RSSFormat = \u0026#34;Mon, 02 Jan 2006 15:04:05 -0700\u0026#34; ) æ³¨æ„ä¸€ç‚¹ï¼Œtimeåº“é»˜è®¤ä½¿ç”¨2006-01-02 15:04:05.999999999 -0700 MSTæ ¼å¼ï¼Œæœ‰ç‚¹å¤æ‚äº†ï¼Œcarbonåº“é»˜è®¤ä½¿ç”¨æ›´ç®€æ´çš„2006-01-02 15:04:05ã€‚\nä½¿ç”¨åªéœ€è¦è°ƒfunc (t Time) Format(layout string)æ–¹æ³•ï¼Œlayoutä¸ºä¸Šé¢æä¾›çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ã€‚\ncarbonä¸ºäº†è¿›ä¸€æ­¥æ–¹ä¾¿ä½¿ç”¨ï¼Œéƒ½å°†Fomatæ–¹æ³•å°è£…åˆ°äº†æŒ‡å®šXxxStringæ–¹æ³•ä¸­.\nç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;time\u0026#34; \u0026#34;github.com/uniplaces/carbon\u0026#34; ) func main() { now := carbon.Now() fmt.Println(now.Format(time.DateTime)) fmt.Println(now.Format(carbon.DefaultFormat), \u0026#34;=\u0026#34;, now.DateTimeString()) fmt.Println(now.Format(time.RFC3339)) fmt.Println(now.Format(carbon.RFC3339Format), \u0026#34;=\u0026#34;, now.RFC3339String()) fmt.Println(now.Format(carbon.DateFormat), \u0026#34;=\u0026#34;, now.DateString()) } è¿è¡Œè¾“å‡ºï¼š\n1 2 3 4 5 6 $ go run main.go 2024-05-14 11:23:01 2024-05-14 11:23:01 = 2024-05-14 11:23:01 2024-05-14T11:23:01+08:00 2024-05-14T11:23:01+08:00 = 2024-05-14T11:23:01+08:00 2024-05-14 = 2024-05-14 # é«˜çº§ç‰¹æ€§ # ä¿®é¥°å™¨ # Boundaryï¼šè¾¹ç•Œ æ‰€è°“ä¿®é¥°å™¨ï¼ˆmodifierï¼‰å°±æ˜¯å¯¹ä¸€äº›ç‰¹å®šçš„æ—¶é—´æ“ä½œï¼Œè·å–å¼€å§‹å’Œç»“æŸæ—¶é—´ã€‚å¦‚å½“å¤©ã€æœˆã€å­£åº¦ã€å¹´ã€åå¹´ã€ä¸–çºªã€å‘¨çš„å¼€å§‹å’Œç»“æŸæ—¶é—´ï¼Œè¿˜èƒ½è·å¾—ä¸Šä¸€ä¸ªå‘¨äºŒã€ä¸‹ä¸€ä¸ªå‘¨ä¸€ã€ä¸‹ä¸€ä¸ªå·¥ä½œæ—¥çš„æ—¶é—´ç­‰ç­‰ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;time\u0026#34; \u0026#34;github.com/uniplaces/carbon\u0026#34; ) func main() { t := carbon.Now() fmt.Printf(\u0026#34;Start of day:%s\\n\u0026#34;, t.StartOfDay()) fmt.Printf(\u0026#34;End of day:%s\\n\u0026#34;, t.EndOfDay()) fmt.Printf(\u0026#34;Start of month:%s\\n\u0026#34;, t.StartOfMonth()) fmt.Printf(\u0026#34;End of month:%s\\n\u0026#34;, t.EndOfMonth()) fmt.Printf(\u0026#34;Start of year:%s\\n\u0026#34;, t.StartOfYear()) fmt.Printf(\u0026#34;End of year:%s\\n\u0026#34;, t.EndOfYear()) fmt.Printf(\u0026#34;Start of decade:%s\\n\u0026#34;, t.StartOfDecade()) fmt.Printf(\u0026#34;End of decade:%s\\n\u0026#34;, t.EndOfDecade()) fmt.Printf(\u0026#34;Start of century:%s\\n\u0026#34;, t.StartOfCentury()) fmt.Printf(\u0026#34;End of century:%s\\n\u0026#34;, t.EndOfCentury()) fmt.Printf(\u0026#34;Start of week:%s\\n\u0026#34;, t.StartOfWeek()) fmt.Printf(\u0026#34;End of week:%s\\n\u0026#34;, t.EndOfWeek()) fmt.Printf(\u0026#34;Next:%s\\n\u0026#34;, t.Next(time.Wednesday)) fmt.Printf(\u0026#34;Previous:%s\\n\u0026#34;, t.Previous(time.Wednesday)) } # è‡ªå®šä¹‰å·¥ä½œæ—¥å’Œå‘¨æœ« æœ‰äº›åœ°åŒºæ¯å‘¨çš„å¼€å§‹ã€å‘¨æœ«å’Œæˆ‘ä»¬çš„ä¸ä¸€æ ·ã€‚Carboné»˜è®¤æ˜¯\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 func NewCarbon(t time.Time) *Carbon { wds := []time.Weekday{ time.Saturday, time.Sunday, } return \u0026amp;Carbon{ Time: t, weekStartsAt: time.Monday, weekEndsAt: time.Sunday, weekendDays: wds, stringFormat: DefaultFormat, Translator: translator(), } } ä¾‹å¦‚ï¼Œåœ¨ç¾å›½å‘¨æ—¥æ˜¯æ–°çš„ä¸€å‘¨å¼€å§‹ã€‚æ²¡å…³ç³»ï¼Œcarbonå¯ä»¥è‡ªå®šä¹‰æ¯å‘¨çš„å¼€å§‹å’Œå‘¨æœ«ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;time\u0026#34; \u0026#34;github.com/uniplaces/carbon\u0026#34; ) func main() { t, err := carbon.Create(2020, 02, 11, 0, 0, 0, 0, \u0026#34;Asia/Shanghai\u0026#34;) if err != nil { log.Fatal(err) } t.SetWeekStartsAt(time.Sunday) t.SetWeekEndsAt(time.Saturday) t.SetWeekendDays([]time.Weekday{time.Monday, time.Tuesday, time.Wednesday}) fmt.Printf(\u0026#34;Today is %s, weekend? %t\\n\u0026#34;, t.Weekday(), t.IsWeekend()) } è¿™ä¸ªåº“ä¸€èˆ¬é»˜è®¤å°±è¡Œã€‚\n# æ‰¹é‡ç”Ÿæˆæ—¥æœŸ åˆ©ç”¨Periodæ–¹æ³•ï¼Œå¯ä»¥æ‰¹é‡ç”Ÿæˆæ—¥æœŸï¼Œæ¥æ”¶ä¸‰ä¸ªå‚æ•°ã€‚\nç¬¬ä¸€ä¸ªï¼šå¼€å§‹çš„æ—¶é—´ã€‚ ç¬¬äºŒä¸ªï¼šæ—¥æœŸé—´éš”ã€‚ ç¬¬ä¸‰ä¸ªï¼šç»“æŸçš„æ—¶é—´ã€‚ è¿”å›å€¼æ˜¯ä¸€ä¸ªæ—¶é—´å¯¹è±¡åˆ‡ç‰‡ã€‚ æ•ˆæœä¸ºï¼šä»å¼€å§‹æ—¶é—´æ¯éš”å¤šå°‘å¤©åˆ›å»ºä¸€ä¸ªæ—¶é—´å¯¹è±¡ï¼Œç›´åˆ°ç»“æŸæ—¥æœŸã€‚\nç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/uniplaces/carbon\u0026#34; ) func main() { t1, _ := carbon.Create(2012, 1, 1, 12, 0, 0, 0, \u0026#34;UTC\u0026#34;) t2, _ := carbon.Create(2012, 1, 31, 12, 0, 0, 0, \u0026#34;UTC\u0026#34;) days := 7 periods, err := carbon.Period(t1, days, t2) if err != nil { return } for _, val := range periods { fmt.Println(val) } } è¿è¡Œè¾“å‡ºï¼š\n1 2 3 4 5 6 $ go run main.go 2012-01-01 12:00:00 2012-01-08 12:00:00 2012-01-15 12:00:00 2012-01-22 12:00:00 2012-01-29 12:00:00 ï¼ˆä¸å¸¸ç”¨ï¼‰\n# å¢å¼ºç‰ˆä»‹ç» ä¸‹è½½ï¼š\n1 2 # å¢å¼ºç‰ˆ $ go get -u github.com/golang-module/carbon/v2 # å¢å¼ºç‰ˆåˆ›å»ºå¯¹è±¡ åˆ›å»ºæ—¶é—´å¯¹è±¡ä¸ä½é…ç‰ˆä¸ä¸€æ ·ã€‚\nå¢å¼ºç‰ˆçš„Nowå‡½æ•°ï¼Œå‚æ•°æ˜¯æ—¶åŒºï¼Œä¸ºå¯é€‰å‚æ•°ï¼Œé»˜è®¤ä¸ºæœ¬åœ°æ—¶åŒºã€‚å¢å¼ºç‰ˆçš„æ—¶åŒºï¼Œæ²¡æœ‰æŒ‡å®šï¼Œä¸€å¾‹ä¸ºæœ¬åœ°æ—¶åŒºã€‚\nä½é…ç‰ˆç›´æ¥é€šè¿‡NewCarbonæŒ‡å®šæ—¶é—´åˆ›å»ºæ—¶é—´å¯¹è±¡ï¼Œè€Œé«˜é…ç‰ˆè¿˜éœ€è¦è°ƒCreateXxxæ–¹æ³•æŒ‡å®šæ—¶é—´æ‰èƒ½å®Œæˆåˆ›å»ºã€‚\nå¹¶ä¸”ä½é…ç‰ˆå¦‚æœåªåˆ›å»ºæ—¥æœŸï¼Œé‚£ä¹ˆæ—¶é—´ä¸ºå½“å‰æ—¶é—´ã€‚è€Œé«˜é…ç‰ˆåªåˆ›å»ºæ—¥æœŸï¼Œæ—¶é—´ä¸º0:0:0.\nå½“åªåˆ›å»ºæ—¶é—´æ—¶ï¼ŒäºŒè€…çš„æ—¥æœŸéƒ½æ˜¯ä¸ºå½“å‰æ—¥æœŸã€‚ é«˜é…ç‰ˆç§»é™¤äº†Createæ–¹æ³•ï¼Œåˆ›å»ºäº†æ›´å¤šCreateXxxæ–¹æ³•ã€‚ç”¨äºæŒ‡å®šæ—¶é—´æˆ–æ—¥æœŸåˆ›å»ºå¯¹è±¡ã€‚\nå¯¹Parseæ–¹æ³•è¿›è¡Œäº†å¢å¼ºï¼Œå¹¶ä¸”è¿˜æä¾›äº†å¦å¤–ä¸¤ä¸ªæ–¹æ³•ï¼Œè¿›è¡Œåˆ›å»ºå¯¹è±¡ã€‚è¿™å‡ ä¸ªæ–¹æ³•çš„æ—¶åŒºéƒ½å¯é€‰çš„ï¼Œé»˜è®¤ä¸ºæœ¬åœ°æ—¶åŒºã€‚\nå¢å¼ºç‰ˆParseæ–¹æ³•åªèƒ½æŒ‡å®šè¦è§£æçš„å­—ç¬¦ä¸²å’Œæ—¶åŒºï¼ˆå¯é€‰ï¼‰åˆ›å»ºå¯¹è±¡ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šæ—¶åŒºï¼Œé»˜è®¤æœ¬åœ°æ—¶åŒºã€‚æ—¶é—´å¸ƒå±€ä»»æ„ã€‚åº•å±‚ä¼šéå†æ‰€æœ‰æ”¯æŒçš„å¸ƒå±€æ¨¡æ¿ï¼ˆå¢å¼ºç‰ˆå«Layoutï¼‰ã€‚\nParseByLayoutæ–¹æ³•åœ¨Parseæ–¹æ³•çš„åŸºç¡€ä¸Šå¢åŠ äº†ä¸€ä¸ªå¸ƒå±€æ¨¡æ¿å‚æ•°ã€‚\nParseByFormatæ–¹æ³•åœ¨Parseæ–¹æ³•çš„åŸºç¡€ä¸Šå¢åŠ äº†ä¸€ä¸ªæ ¼å¼æ¨¡ç‰ˆå‚æ•°ã€‚\nå¸ƒå±€æ¨¡æ¿ä»¥Layoutç»“å°¾ï¼Œå°±æ˜¯åŸæ¥çš„Formatæ–¹æ³•çš„å‚æ•°ã€‚\n1 DateLayout = \u0026#34;2006-01-02\u0026#34; æ ¼å¼æ¨¡ç‰ˆä»¥formatç»“å°¾ï¼Œå¢å¼ºç‰ˆæ–°åŠ çš„ï¼Œç”±æ—¥æœŸæ—¶é—´çš„æ ¼å¼åŒ–å­—ç¬¦ç»„æˆçš„å­—ç¬¦ä¸²\n1 DateTimeFormat = \u0026#34;Y-m-d H:i:s\u0026#34; æ³¨æ„carbonåŒ…çš„å†…éƒ¨é”™è¯¯ï¼Œéƒ½å°è£…åˆ°äº†æ—¶é—´å¯¹è±¡çš„Errorå±æ€§ä¸‹ã€‚\nå¦‚æœæœ‰å¤šä¸ªé”™è¯¯å‘ç”Ÿï¼Œåªè¿”å›ç¬¬ä¸€ä¸ªé”™è¯¯ï¼Œå‰ä¸€ä¸ªé”™è¯¯æ’é™¤åæ‰è¿”å›ä¸‹ä¸€ä¸ªé”™è¯¯\n1 2 3 4 5 6 7 c := carbon.SetTimezone(\u0026#34;xxx\u0026#34;).Parse(\u0026#34;2020-08-05\u0026#34;) if c.Error != nil { // é”™è¯¯å¤„ç† log.Fatal(c.Error) } // è¾“å‡º invalid timezone \u0026#34;xxx\u0026#34;, please see the file \u0026#34;$GOROOT/lib/time/zoneinfo.zip\u0026#34; for all valid timezones å®ä¾‹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;github.com/golang-module/carbon/v2\u0026#34; ) func main() { now := carbon.Now() now = carbon.NewCarbon().Now() fmt.Println(now) // stdTime := carbon.CreateFromStdTime(time.Now()) fmt.Println(stdTime) // fromDate := carbon.CreateFromDate(2024, 5, 14) fromDate = carbon.NewCarbon().CreateFromDate(2024, 5, 14) fmt.Println(fromDate) // 2024-05-14 00:00:00 dateTime := carbon.CreateFromDateTime(2024, 5, 14, 10, 22, 33) dateTime = carbon.NewCarbon().CreateFromDateTime(2024, 5, 14, 10, 22, 33) fmt.Println(dateTime) // 2024-05-14 10:22:33 assertErr := func(carbon carbon.Carbon) { if carbon.Error != nil { log.Fatal(carbon.Error) } } parse := carbon.Parse(\u0026#34;2024-05-20 10:22:33\u0026#34;) assertErr(parse) fmt.Println(parse) // 2024-05-20 10:22:33 parse = carbon.ParseByLayout(\u0026#34;2024-05-20\u0026#34;, carbon.DateLayout) assertErr(parse) fmt.Println(parse) // 2024-05-20 00:00:00 parse = carbon.ParseByFormat(\u0026#34;2024-05-20 10:22:33\u0026#34;, carbon.DateTimeFormat) assertErr(parse) fmt.Println(parse) // 2024-05-20 10:22:33 toString := carbon.CreateFromTimestamp(-1) fmt.Println(toString) // 1970-01-01 07:59:59 } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 // Create a Carbon instance from a given hour, minute and second carbon.CreateFromTime(13, 14, 15).ToString() // 2020-08-05 13:14:15 +0800 CST // Create a Carbon instance from a given hour, minute and second with millisecond carbon.CreateFromTimeMilli(13, 14, 15, 999).ToString() // 2020-08-05 13:14:15.999 +0800 CST // Create a Carbon instance from a given hour, minute and second with microsecond carbon.CreateFromTimeMicro(13, 14, 15, 999999).ToString() // 2020-08-05 13:14:15.999999 +0800 CST // Create a Carbon instance from a given hour, minute and second with nanosecond carbon.CreateFromTimeNano(13, 14, 15, 999999999).ToString() // 2020-08-05 13:14:15.999999999 +0800 CST carbon.Parse(\u0026#34;now\u0026#34;).ToString() // 2020-08-05 13:14:15 +0800 CST carbon.Parse(\u0026#34;yesterday\u0026#34;).ToString() // 2020-08-04 13:14:15 +0800 CST carbon.Parse(\u0026#34;tomorrow\u0026#34;).ToString() // 2020-08-06 13:14:15 +0800 CST carbon.Parse(\u0026#34;2020\u0026#34;).ToString() // 2020-01-01 00:00:00 +0800 CST carbon.Parse(\u0026#34;2020-8\u0026#34;).ToString() // 2020-08-01 00:00:00 +0800 CST carbon.ParseByFormat(\u0026#34;2020|08|05 13|14|15\u0026#34;, \u0026#34;Y|m|d H|i|s\u0026#34;).ToDateTimeString() // 2020-08-05 13:14:15 carbon.ParseByFormat(\u0026#34;It is 2020-08-05 13:14:15\u0026#34;, \u0026#34;\\\\I\\\\t \\\\i\\\\s Y-m-d H:i:s\u0026#34;).ToDateTimeString() // 2020-08-05 13:14:15 carbon.ParseByFormat(\u0026#34;ä»Šå¤©æ˜¯ 2020å¹´08æœˆ05æ—¥13æ—¶14åˆ†15ç§’\u0026#34;, \u0026#34;ä»Šå¤©æ˜¯ Yå¹´mæœˆdæ—¥Hæ—¶iåˆ†sç§’\u0026#34;).ToDateTimeString() // 2020-08-05 13:14:15 carbon.ParseByLayout(\u0026#34;2020|08|05 13|14|15\u0026#34;, \u0026#34;2006|01|02 15|04|05\u0026#34;).ToDateTimeString() // 2020-08-05 13:14:15 carbon.ParseByLayout(\u0026#34;It is 2020-08-05 13:14:15\u0026#34;, \u0026#34;It is 2006-01-02 15:04:05\u0026#34;).ToDateTimeString() // 2020-08-05 13:14:15 carbon.ParseByLayout(\u0026#34;ä»Šå¤©æ˜¯ 2020å¹´08æœˆ05æ—¥13æ—¶14åˆ†15ç§’\u0026#34;, \u0026#34;ä»Šå¤©æ˜¯ 2006å¹´01æœˆ02æ—¥15æ—¶04åˆ†05ç§’\u0026#34;).ToDateTimeString() // 2020-08-05 13:14:15 # ä¸€äº›é»˜è®¤å€¼ å¢å¼ºç‰ˆåˆ›å»ºçš„æ—¶é—´å¯¹è±¡çš„é»˜è®¤å€¼ï¼š\næ—¶é—´æ ¼å¼ä¸ä½é…ç‰ˆä¸€ç›´ï¼Œåå­—æ”¹æˆcarbon.DateTimeLayoutã€‚ æ—¶åŒºé»˜è®¤éƒ½ä¸ºæœ¬åœ°æ—¶åŒºã€‚ å·¥ä½œæ—¥å¼€å§‹æ˜¯åœ¨Sundayï¼Œä½é…ç‰ˆæ˜¯åœ¨æ˜ŸæœŸä¸€ã€‚ é»˜è®¤çš„è¯­è¨€åŒºåŸŸæ˜¯enã€‚æ”¯æŒçš„è¯­è¨€åœ¨github.com\\golang-module\\carbon\\langç›®å½•ä¸‹ã€‚ è¿™äº›å±æ€§å¯ä»¥é€šè¿‡func SetDefault(d Default)æ–¹æ³•ä¿®æ”¹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/golang-module/carbon/v2\u0026#34; ) func main() { now := carbon.Now() fmt.Println(now) carbon.SetDefault(carbon.Default{Layout: carbon.RFC3339Layout, Timezone: carbon.Local, WeekStartsAt: carbon.Monday, Locale: \u0026#34;zh-CN\u0026#34;}) fmt.Println(now) } å®˜æ–¹å»ºè®®åœ¨main.goç­‰å…¥å£æ–‡ä»¶ä¸­ä¿®æ”¹é»˜è®¤å€¼ã€‚\n# å¯¹è±¡äº’è½¬ å¢å¼ºç‰ˆå¯ä»¥å®ç°time.Timeå¯¹è±¡ä¸Carbonå¯¹è±¡ç›¸äº’è½¬æ¢ã€‚\nç¤ºä¾‹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;time\u0026#34; \u0026#34;github.com/golang-module/carbon/v2\u0026#34; ) func main() { carbonTime := carbon.CreateFromTime(22, 22, 22) stdTime := carbonTime.StdTime() fmt.Println(stdTime) // 2024-05-14 22:22:22 +0800 CST stdTime = time.Date(2024, 5, 14, 22, 22, 22, 0, time.Local) carbonTime = carbon.CreateFromStdTime(stdTime) fmt.Println(carbonTime) // 2024-05-14 22:22:22 } # æ›´å¤šç»†èŠ‚çš„å¢å¼º # å¯¹è±¡è½¬å­—ç¬¦ä¸² å¢å¼ºç‰ˆæä¾›äº†æ›´å¤šæ—¶é—´å¯¹è±¡è½¬å­—ç¬¦ä¸²çš„æ–¹æ³•ã€‚é™¤äº†Stringæ–¹æ³•å¤–ï¼Œæ·»åŠ äº†ToXxxStringæ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 carbon.Now().String() // 2020-08-05 13:14:15 carbon.Now().ToString() // 2020-08-05 13:14:15 +0800 CST carbon.Now().ToDateTimeString() // 2020-08-05 13:14:15 // Return date of today carbon.Now().ToDateString() // 2020-08-05 // Return time of today carbon.Now().ToTimeString() // 13:14:15 // Return datetime of today in a given timezone carbon.Now(Carbon.NewYork).ToDateTimeString() // 2020-08-05 14:14:15 æ³¨æ„ï¼šå¢å¼ºç‰ˆæœ‰ä¸€ä¸ªå‘ï¼šå½“æˆ‘ä»¬ç›´æ¥è¾“å‡ºCarbonå¯¹è±¡æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨Stringæ–¹æ³•ï¼Œè¿™ä¸ªStringæ–¹æ³•ä¼šå°†æ—¶åŒºæ”¹æˆæœ¬åœ°ã€‚è‹¥ä¸å¸Œæœ›ä¿®æ”¹æ—¶åŒºï¼Œè¯·ä¸è¦è°ƒç”¨Stringæ–¹æ³•ï¼Œç”¨åˆ«çš„è½¬å­—ç¬¦ä¸²çš„æ–¹æ³•ï¼Œå¦‚ToDateTimeStringã€‚\næ›´å¤šå†…å®¹å‚è€ƒæ—¶é—´è¾“å‡º\n# å¯¹è±¡è½¬æ—¶é—´æˆ³ é€šè¿‡å¢å¼ºç‰ˆï¼Œæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿çš„å°†Carbonå¯¹è±¡è½¬æ¢æˆæŒ‡å®šå•ä½çš„æ—¶é—´æˆ³ï¼š\n1 2 3 4 5 6 7 8 9 carbon.Now(Carbon.NewYork).ToDateTimeString() // 2020-08-05 14:14:15 // Return timestamp with second of today carbon.Now().Timestamp() // 1596604455 // Return timestamp with millisecond of today carbon.Now().TimestampMilli() // 1596604455999 // Return timestamp with microsecond of today carbon.Now().TimestampMicro() // 1596604455999999 // Return timestamp with nanosecond of today carbon.Now().TimestampNano() // 1596604455999999999 # è·å–æ˜¨å¤©ã€æ˜å¤©çš„å¯¹è±¡ å¢å¼ºç‰ˆï¼Œä¸ä»…èƒ½å¤Ÿè·å–å½“å‰çš„æ—¶é—´å¯¹è±¡ï¼Œè¿˜èƒ½è·å–æ˜¨å¤©æˆ–è€…æ˜å¤©çš„æ—¶é—´ï¼š\n1 2 3 4 5 6 7 8 fmt.Printf(\u0026#34;%s\u0026#34;, carbon.Yesterday()) // 2020-08-04 13:14:15 carbon.Yesterday().String() // 2020-08-04 13:14:15 carbon.Yesterday().ToString() // 2020-08-04 13:14:15 +0800 CST carbon.Yesterday(Carbon.NewYork).ToDateTimeString() // 2020-08-04 13:14:15 carbon.Tomorrow().String() // 2020-08-06 13:14:15 carbon.Tomorrow().ToString() // 2020-08-06 13:14:15 +0800 CST carbon.Tomorrow().ToDateTimeString() // 2020-08-06 13:14:15 # å¢å¼ºæ—¶é—´æˆ³åˆ›å»ºå¯¹è±¡ ä½é…ç‰ˆåªèƒ½é€šè¿‡CreateFromTimestampå’ŒCreateFromTimestampUTCå‡½æ•°åˆ›å»ºå¯¹è±¡ï¼Œå¢å¼ºç‰ˆæä¾›äº†æ¯«ç§’ã€å¾®ç§’ã€çº³ç§’æ—¶é—´æˆ³åˆ›å»ºå¯¹è±¡ã€‚æ—¶åŒºé»˜è®¤æœ¬åœ°æ—¶åŒºã€‚\n1 2 3 4 5 6 7 8 carbon.CreateFromTimestamp(1649735755).ToString() // 2022-04-12 11:55:55 +0800 CST // Create a Carbon instance from a given timestamp with millisecond carbon.CreateFromTimestampMilli(1649735755981).ToString() // 2022-04-12 11:55:55.981 +0800 CST // Create a Carbon instance from a given timestamp with microsecond carbon.CreateFromTimestampMicro(1649735755981566).ToString() // 2022-04-12 11:55:55.981566 +0800 CST // Create a Carbon instance from a given timestamp with nanosecond carbon.CreateFromTimestampNano(1649735755981566000).ToString() // 2022-04-12 11:55:55.981566 +0800 CST carbon.CreateFromTimestampNano(1649735755981566000, \u0026#34;Japan\u0026#34;).ToString() // 2022-04-12 12:55:55.981566 +0900 JST å¿«ä¸€ä¸ªå°æ—¶ã€‚ å…¶ä»–åˆ›å»ºå¯¹è±¡å¢å¼º\n# æ—¶é—´çš„è¾¹ç•Œ ä¸ä½é…ç‰ˆä¸€æ¨¡ä¸€æ ·ã€‚è¯¦æƒ…è¯·çœ‹ä¿®é¥°å™¨ã€‚\n# å¢å¼ºæ—¶é—´è¿ç®— æ”¯æŒé“¾å¼è°ƒç”¨ï¼Œå¯¹åº”æ—¶é—´çš„è¿ç®—ï¼Œå¢åŠ äº†ä¸ä¼šæº¢å‡ºçš„æ–¹æ³•ã€‚\né»˜è®¤ä½é…ç‰ˆå’Œé«˜é…ç‰ˆè¿›è¡Œæ—¶é—´è¿ç®—æ—¶ï¼Œå½“ä¸º2æœˆ29çš„æ—¶å€™ï¼Œå³é—°å¹´çš„æ—¶å€™ï¼Œè®¡ç®—åˆ°ä¸æ˜¯é—°å¹´ï¼Œéƒ½æ²¡æœ‰29å·ï¼Œé‚£ä¹ˆæ—¶é—´é»˜è®¤ä¼šæº¢å‡ºï¼Œå˜æˆ3æœˆ1å·ã€‚å¢å¼ºç‰ˆæä¾›äº†AddXxxNoOverflowã€SubXxxNoOverflowæ–¹æ³•ï¼ˆä½é…ç‰ˆéƒ¨åˆ†æœ‰ï¼Œé«˜é…ç‰ˆåŸºæœ¬éƒ½æœ‰ï¼‰ï¼Œè®©æ—¶é—´ä¸ä¼šæº¢å‡ºï¼Œä¸º2æœˆ28ã€‚ï¼ˆé—°å¹´æ¯”å…¬å†å¹´å¤š1å¤©ã€‚ï¼‰\nå¢å¼ºç‰ˆè¿˜å¢å¼ºäº†åˆ«çš„å•ä½è¿›è¡Œè¿ç®—,å¦‚XxxDecadesåå¹´ã€XxxDurationæ ¹æ®ç‰‡æ®µè¿›è¡Œè¿ç®—ã€‚è¿˜æ›´å°å•ä½çš„è¿ç®—ï¼Œå¦‚SubMillisecondã€SubNanossecond\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 // ä¸‰ä¸ªå¹´ä»£å carbon.Parse(\u0026#34;2020-02-29 13:14:15\u0026#34;).AddDecades(3).ToDateTimeString() // 2050-03-01 13:14:15 // ä¸‰ä¸ªå¹´ä»£å(æœˆä»½ä¸æº¢å‡º) carbon.Parse(\u0026#34;2020-02-29 13:14:15\u0026#34;).AddDecadesNoOverflow(3).ToDateTimeString() // 2050-02-28 13:14:15 // ä¸€ä¸ªå¹´ä»£å carbon.Parse(\u0026#34;2020-02-29 13:14:15\u0026#34;).AddDecade().ToDateTimeString() // 2030-03-01 13:14:15 // ä¸€ä¸ªå¹´ä»£å(æœˆä»½ä¸æº¢å‡º) carbon.Parse(\u0026#34;2020-02-29 13:14:15\u0026#34;).AddDecadeNoOverflow().ToDateTimeString() // 2030-02-28 13:14:15 // äºŒå°æ—¶åŠå‰ carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).SubDuration(\u0026#34;2.5h\u0026#34;).ToDateTimeString() // 2020-08-05 10:44:15 carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).SubDuration(\u0026#34;2h30m\u0026#34;).ToDateTimeString() // 2020-08-05 10:44:15 // ä¸‰å¾®ç§’å carbon.Parse(\u0026#34;2020-08-05 13:14:15.222222222\u0026#34;).AddMicroseconds(3).ToString() // 2020-08-05 13:14:15.222225222 +0800 CST // ä¸€å¾®ç§’å carbon.Parse(\u0026#34;2020-08-05 13:14:15.222222222\u0026#34;).AddMicrosecond().ToString() // 2020-08-05 13:14:15.222223222 +0800 CST å…¶ä»–çš„ä¸ä½é…ç‰ˆä¸€ç›´ã€‚\n# å¢å¼ºæ—¶é—´å·® å¢å¼ºç‰ˆç§»é™¤äº†æ˜¯å¦å–ç»å¯¹å€¼å‚æ•°ï¼Œå°è£…åˆ°äº†DiffAbsInXxxæ–¹æ³•ä¸­ã€‚ åŸç†å·®ä¸å¤šï¼Œåé¢-å‰é¢ã€‚å¿«ä¸ºè´Ÿæ•°ï¼Œæ…¢ä¸ºæ­£æ•°ï¼ˆç›¸å¯¹è°ƒç”¨çš„æ—¶é—´å¯¹è±¡ï¼‰ã€‚ å…¶ä»–ç›¸å·®å¤šå°‘åˆ†ã€å°æ—¶ã€å¹´ã€ä¸ä½é…ç‰ˆæ—¶é—´å·®ä¸€ç›´ æ–°å¢æ—¶é—´å·®çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œç”¨DiffInStringæ–¹æ³•è·å–ï¼Œé»˜è®¤å‚æ•°ä¸ºå½“å‰æ—¶é—´ã€‚ åŒæ ·æä¾›äº†ç»å¯¹å€¼æ–¹æ³•DiffAbsInString éœ€è¦æ³¨æ„çš„æ˜¯ï¼šç›®å‰æ—¶é—´å·®çš„å­—ç¬¦ä¸²è¡¨ç¤ºåªèƒ½è¡¨ç¤ºå·®é‡Œé¢çš„æœ€å¤§æ—¶é—´å•ä½ã€‚ å¦‚å·®2åˆ†30ç§’ï¼Œç»“æœä¸ºå·®2åˆ†é’Ÿã€‚å·®3æœˆ22å¤©ï¼Œç»“æœä¸ºå·®3ä¸ªæœˆ è¯¥æ–¹æ³•æ”¯æŒå›½é™…åŒ–ã€‚ æ–°å¢ç›¸å·®æ—¶é•¿ï¼ˆç‰‡æ®µï¼‰å­—ç¬¦ä¸²è¡¨ç¤ºã€‚ç”¨DiffInDurationæ–¹æ³•è·å–ï¼Œé»˜è®¤å‚æ•°ä¸ºå½“å‰æ—¶é—´ã€‚ åŒæ ·æä¾›äº†ç»å¯¹å€¼æ–¹æ³•DiffAbsInDuration éœ€è¦æ³¨æ„çš„æ˜¯ï¼šè¿™ä¸ªæ–¹æ³•ä¼šå…·ä½“åˆ°ç›¸å·®å¤šå°‘æ—¶å·®ã€‚å½“æœ€å¤§å•ä½ä¸ºå°æ—¶ã€‚ è¯¥æ–¹æ³•åŒæ ·æ”¯æŒå›½é™…åŒ–ã€‚ æ–°å¢å¯¹äººç±»å‹å¥½çš„å¯è¯»æ ¼å¼æ—¶é—´å·®ã€‚ç”¨DiffForHumansæ–¹æ³•è·å–ï¼Œé»˜è®¤å‚æ•°ä¸ºå½“å‰æ—¶é—´ã€‚ è¯¥æ–¹æ³•äººç±»å¯è¯»ï¼Œç§»é™¤äº†ç»å¯¹å€¼æ–¹æ³•ã€‚èƒ½å¤Ÿç›´è§‚çš„çœ‹è§å‚æ•°æ—¶é—´å¯¹è±¡æ˜¯å‰ï¼ˆè´Ÿæ•°ï¼‰è¿˜æ˜¯åï¼ˆæ­£æ•°ï¼‰ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯è¯¥æ–¹æ³•ï¼Œä¸DiffInStringä¸€æ ·ï¼Œåªèƒ½è¡¨ç¤ºæœ€å¤§çš„æ—¶é—´å•ä½ã€‚ åŒæ ·æ”¯æŒå›½é™…åŒ–ã€‚ ç¤ºä¾‹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/golang-module/carbon/v2\u0026#34; ) func main() { carbon.SetDefault(carbon.Default{ Layout: carbon.DateTimeLayout, Timezone: carbon.Local, WeekStartsAt: carbon.Monday, Locale: \u0026#34;zh-CN\u0026#34;, }) inString := carbon.Now().DiffInString(carbon.Now().AddDays(22).AddMinutes(22)) fmt.Println(inString) // 3 å‘¨ diffInString := carbon.Now().AddHours(22).AddMinutes(22).DiffInString() fmt.Println(diffInString) // -22 å°æ—¶ diffAbsInDuration := carbon.Now().AddYears(2).AddMinutes(22).AddMicroseconds(22).DiffAbsInDuration() fmt.Println(diffAbsInDuration) // 17520h22m0.000022s inString = carbon.Now().DiffForHumans(carbon.Now().AddDays(22).AddMinutes(22)) fmt.Println(inString) // 3 å‘¨å‰ diffInString = carbon.Now().AddHours(22).AddMinutes(22).DiffForHumans() fmt.Println(diffInString) // 22 å°æ—¶å } # è·å–æ—¶é—´æå€¼ ä½é…ç‰ˆåªæä¾›äº†Closestå’ŒFarthestè·å–è·å¯¹è±¡æœ€è¿‘æˆ–æœ€è¿œçš„æ—¶é—´å¯¹è±¡ï¼Œä½é…ç‰ˆå’Œé«˜é…ç‰ˆéƒ½åªèƒ½ä¼ é€’ä¸¤ä¸ªæ—¶é—´å¯¹è±¡ã€‚\né«˜é…ç‰ˆå¢å¼ºç‰ˆæ–°å¢ä¸¤ä¸ªæ–¹æ³•Maxå’Œ``Min`ï¼Œè·å–å¤šä¸ªæ—¶é—´é‡Œé¢çš„æœ€å¤§æˆ–æœ€å°ï¼Œå‚æ•°ä¸ºè‡³å°‘ä¸€ä¸ªæ—¶é—´å¯¹è±¡ã€‚\nç¤ºä¾‹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 c0 := carbon.Parse(\u0026#34;2023-04-01\u0026#34;) c1 := carbon.Parse(\u0026#34;2023-03-28\u0026#34;) c2 := carbon.Parse(\u0026#34;2023-04-16\u0026#34;) // è¿”å›æœ€è¿‘çš„ Carbon å®ä¾‹ c0.Closest(c1, c2) // c1 // è¿”å›æœ€è¿œçš„ Carbon å®ä¾‹ c0.Farthest(c1, c2) // c2 yesterday := carbon.Yesterday() today := carbon.Now() tomorrow := carbon.Tomorrow() // è¿”å›æœ€å¤§çš„ Carbon å®ä¾‹ carbon.Max(yesterday, today, tomorrow) // tomorrow // è¿”å›æœ€å°çš„ Carbon å®ä¾‹ carbon.Min(yesterday, today, tomorrow) // yesterday # å¢å¼ºæ—¶é—´åˆ¤æ–­ å¢å¼ºç‰ˆæ–°å¢åˆ¤æ–­æ—¶é—´æ˜¯å¦æœ‰æ•ˆï¼šIsValidã€IsInvalid\nåŸç†æ˜¯æ—¶é—´æˆ³å¤§äº0ï¼Œå°±æœ‰æ•ˆã€‚å½“ä¸º0æˆ–è€…ä¸ºç©ºæˆ–è€…Errorå±æ€§ä¸ä¸ºnilæ—¶ï¼Œè¯¥æ—¶é—´æ— æ•ˆã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 // æ˜¯å¦æ˜¯æœ‰æ•ˆæ—¶é—´ func (c Carbon) IsValid() bool { if c.Error != nil { return false } if c.time.IsZero() { return false } // å¤§äºé›¶å€¼æ—¶é—´ if c.StdTime().Unix() \u0026gt; -62135596800 { return true } return false } æ–°å¢æ›´å¤šçš„æ—¶é—´åˆ¤æ–­ï¼š\nåˆ¤æ–­æ˜¯å¦æ˜¯æ—©ä¸Šã€ä¸‹åˆã€å½“å‰ã€æœªæ¥ã€è¿‡å»ã€é—°å¹´ã€é•¿å¹´ã€å‡ æœˆã€æ˜ŸæœŸå‡ ã€å·¥ä½œæ—¥ã€å‘¨æœ«ã€æ˜¨å¤©ã€ä»Šå¤©ã€æ˜å¤©ã€åŒä¸€ä¸–çºªã€åŒä¸€å¹´ä»£ã€åŒä¸€å¹´ã€åŒä¸€å­£èŠ‚ã€åŒä¸€æœˆã€åŒä¸€å¤©ã€åŒä¸€å°æ—¶ã€åŒä¸€åˆ†é’Ÿã€åŒä¸€ç§’ã€‚æ–¹æ³•åæ˜¯IsXxxã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼šå¢å¼ºç‰ˆç§»é™¤äº†è‡ªå®šä¹‰å‘¨æœ«ã€‚å‘¨æœ«é»˜è®¤éƒ½ä¸ºæ˜ŸæœŸ6ã€æ˜ŸæœŸå¤©ã€‚åªä¿ç•™äº†è®¾ç½®ä¸€å‘¨å¼€å§‹çš„æ—¥æœŸã€‚\næ–°å¢æ˜Ÿåº§åˆ¤æ–­ï¼Œæ–¹æ³•ä¸ºIsXxx\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 // è·å–æ˜Ÿåº§ carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).Constellation() // Leo // æ˜¯å¦æ˜¯ç™½ç¾Šåº§ carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).IsAries() // false // æ˜¯å¦æ˜¯é‡‘ç‰›åº§ carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).IsTaurus() // false // æ˜¯å¦æ˜¯åŒå­åº§ carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).IsGemini() // false // æ˜¯å¦æ˜¯å·¨èŸ¹åº§ carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).IsCancer() // false // æ˜¯å¦æ˜¯ç‹®å­åº§ carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).IsLeo() // true // æ˜¯å¦æ˜¯å¤„å¥³åº§ carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).IsVirgo() // false // æ˜¯å¦æ˜¯å¤©ç§¤åº§ carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).IsLibra() // false // æ˜¯å¦æ˜¯å¤©èåº§ carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).IsScorpio() // false // æ˜¯å¦æ˜¯å°„æ‰‹åº§ carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).IsSagittarius() // false // æ˜¯å¦æ˜¯æ‘©ç¾¯åº§ carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).IsCapricorn() // false // æ˜¯å¦æ˜¯æ°´ç“¶åº§ carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).IsAquarius() // false // æ˜¯å¦æ˜¯åŒé±¼åº§ carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).IsPisces() // false æ–°å¢å­£èŠ‚åˆ¤æ–­ï¼šæŒ‰ç…§æ°”è±¡åˆ’åˆ†ï¼Œå³3-5æœˆä¸ºæ˜¥å­£ï¼Œ6-8æœˆä¸ºå¤å­£ï¼Œ9-11æœˆä¸ºç§‹å­£ï¼Œ12-2æœˆä¸ºå†¬å­£\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // è·å–å­£èŠ‚ carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).Season() // Summer // æœ¬å­£èŠ‚å¼€å§‹æ—¶é—´ carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).StartOfSeason().ToDateTimeString() // 2020-06-01 00:00:00 // æœ¬å­£èŠ‚ç»“æŸæ—¶é—´ carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).EndOfSeason().ToDateTimeString() // 2020-08-31 23:59:59 // æ˜¯å¦æ˜¯æ˜¥å­£ carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).IsSpring() // false // æ˜¯å¦æ˜¯å¤å­£ carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).IsSummer() // true // æ˜¯å¦æ˜¯ç§‹å­£ carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).IsAutumn() // false // æ˜¯å¦æ˜¯å†¬å­£ carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).IsWinter() // false â€‹\nâ€‹\n# å¢å¼ºæ—¶é—´æ¯”è¾ƒ é«˜é…ç‰ˆä¿ç•™äº†ä½é…ç‰ˆçš„æ‰€æœ‰æ—¶é—´æ¯”è¾ƒæ–¹æ³•ï¼ŒåŒæ—¶æ–°å¢åˆ¤æ–­æ˜¯å¦åœ¨ä¸¤ä¸ªæ—¶é—´ä¹‹é—´ï¼ŒåŒ…æ‹¬ä¸¤ç«¯çš„æ—¶é—´æ–¹æ³•å’Œæ¯”è¾ƒæ–¹æ³•Compareï¼Œè¯¥æ–¹æ³•éœ€è¦æŒ‡å®šæ¯”è¾ƒå­—ç¬¦=,\u0026lt;=,!=,\u0026lt;\u0026gt;ç­‰ï¼ˆåªèƒ½æ¥æ”¶ä¸€ä¸ªæ¯”è¾ƒç¬¦ï¼Œå› ä¸ºåªèƒ½æœ‰ä¸€ä¸ªæ—¶é—´å‚æ•°æ¯”è¾ƒï¼‰ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 // æ˜¯å¦åœ¨ä¸¤ä¸ªæ—¶é—´ä¹‹é—´(åŒ…æ‹¬å¼€å§‹æ—¶é—´) carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).BetweenIncludedStart(carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;), carbon.Parse(\u0026#34;2020-08-06 13:14:15\u0026#34;)) // true // æ˜¯å¦åœ¨ä¸¤ä¸ªæ—¶é—´ä¹‹é—´(åŒ…æ‹¬ç»“æŸæ—¶é—´) carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).BetweenIncludedEnd(carbon.Parse(\u0026#34;2020-08-04 13:14:15\u0026#34;), carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;)) // true // æ˜¯å¦åœ¨ä¸¤ä¸ªæ—¶é—´ä¹‹é—´(åŒ…æ‹¬è¿™ä¸¤ä¸ªæ—¶é—´) carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).BetweenIncludedBoth(carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;), carbon.Parse(\u0026#34;2020-08-06 13:14:15\u0026#34;)) // true carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).Compare(\u0026#34;\u0026gt;=\u0026#34;, carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;)) // true carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).Compare(\u0026#34;\u0026lt;\u0026gt;\u0026#34;, carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;)) // false å°±æ˜¯ä¸ç­‰äº # å¢å¼ºæ—¶é—´è®¾ç½® å¯ä»¥è®¾ç½®æ—¶åŒºã€è®¾ç½®åœ°åŒºï¼šfunc SetTimezone(name string)ã€func SetLocation(loc *time.Location)ã€func LoadLocation(name string)ã€func getLocationByTimezone(timezone string)\næ—¶åŒºä¸åœ°åŒºåŒåã€‚å…³ç³»æ˜¯ï¼šåœ°åŒºä¸æ—¶åŒºå¯ä»¥ç›¸äº’è½¬æ¢ã€‚å¯ä»¥åˆ’ç­‰å·ã€‚ åªè¦æ˜¯æ—¶åŒºæ–‡ä»¶é‡Œé¢æ²¡æœ‰çš„åç§°æ—¶åŒºå’Œåœ°åŒºéƒ½ä¸èƒ½ä½¿ç”¨ã€‚è™½ç„¶å¢å¼ºç‰ˆå°†æ—¶åŒºæ–‡ä»¶ä¸­çš„æ—¶åŒºåéƒ½å°è£…æˆäº†å¸¸é‡ï¼Œæ–¹ä¾¿è°ƒç”¨ã€‚ å¯ä»¥è®¾ç½®åŒºåŸŸï¼ˆå›½é™…åŒ–è®¾ç½®ï¼‰ï¼šSetLocale\nè¿˜å¯ä»¥ä¿®æ”¹å¹´æœˆæ—¥æ—¶åˆ†ç§’ï¼Œç”¨SetXxxæ–¹æ³•\nç¤ºä¾‹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;time\u0026#34; \u0026#34;github.com/golang-module/carbon/v2\u0026#34; ) func main() { Shanghai, _ := time.LoadLocation(carbon.Shanghai) Beijing := carbon.SetLocation(Shanghai).Now() BeijingStr := Beijing.ToDateTimeString() Japan := carbon.SetTimezone(carbon.Japan).Now() JapanStr := Japan.ToDateTimeString() fmt.Printf(\u0026#34;ä¸œäº¬æ—¶é—´%sæ¯”åŒ—äº¬æ—¶é—´%så¿«ä¸€ä¸ªå°æ—¶ï¼Œä½†è¡¨ç¤ºçš„æ˜¯åŒä¸€æ—¶åˆ»\\n\u0026#34;, BeijingStr, JapanStr) Beijing = carbon.SetTimezone(carbon.HongKong).Now() BeijingStr = Beijing.ToDateTimeString() Tokyo, _ := time.LoadLocation(carbon.Tokyo) Japan = carbon.SetLocation(Tokyo).Now() JapanStr = Japan.ToDateTimeString() fmt.Printf(\u0026#34;ä¸œäº¬æ—¶é—´%sæ¯”åŒ—äº¬æ—¶é—´%så¿«ä¸€ä¸ªå°æ—¶ï¼Œä½†è¡¨ç¤ºçš„æ˜¯åŒä¸€æ—¶åˆ»\\n\u0026#34;, BeijingStr, JapanStr) } æ³¨æ„ï¼šå¢å¼ºç‰ˆæœ‰ä¸€ä¸ªå‘ï¼šå½“æˆ‘ä»¬ç›´æ¥è¾“å‡ºCarbonå¯¹è±¡æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨Stringæ–¹æ³•ï¼Œè¿™ä¸ªStringæ–¹æ³•ä¼šå°†æ—¶åŒºæ”¹æˆæœ¬åœ°ã€‚è‹¥ä¸å¸Œæœ›ä¿®æ”¹æ—¶åŒºï¼Œè¯·ä¸è¦è°ƒç”¨Stringæ–¹æ³•ï¼Œç”¨åˆ«çš„è½¬å­—ç¬¦ä¸²çš„æ–¹æ³•ï¼Œå¦‚ToDateTimeStringã€‚\n1 2 3 4 5 6 7 // è®¾ç½®å¹´æœˆæ—¥æ—¶åˆ†ç§’çº³ç§’ carbon.Parse(\u0026#34;2020-01-01\u0026#34;).SetDateTimeNano(2019, 2, 2, 13, 14, 15, 999999999).ToString() // 2019-02-02 13:14:15.999999999 +0800 CST carbon.Parse(\u0026#34;2020-01-01\u0026#34;).SetDateTimeNano(2019, 2, 31, 13, 14, 15, 999999999).ToString() // 2019-03-03 13:14:15.999999999 +0800 CST // å•ç‹¬è®¾ç½®çº³ç§’ carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).SetNanosecond(100000000).Nanosecond() // 100000000 carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).SetNanosecond(999999999).Nanosecond() // 999999999 # æ—¶é—´è·å– ä¸€å¥è¯ï¼šç›´æ¥è°ƒç”¨ä½ æƒ³è·å–çš„æ—¶é—´æˆ–æ—¥æœŸï¼Œåªè¦ä½ æƒ³åˆ°çš„éƒ½èƒ½è·å–ï¼Œå¦‚è·å–æœ¬å¹´æ€»å¤©æ•°DaysInYearã€è·å–æœ¬æœˆæ€»å¤©æ•°DaysInMonthã€è·å–æœ¬å¹´ç¬¬å‡ å¤©ã€ è·å–æœ¬å‘¨ç¬¬å‡ å¤©ï¼šDayOfXxxã€è·å–å…·ä½“æ—¥æœŸæˆ–æ—¶é—´DateTimeã€è·å–å½“å‰ä¸–çºªCenturyã€è·å–å½“å‰å¹´ä»£Decadeåå¹´æœªä¸€ä¸ªå¹´ä»£ã€å¹´æœˆæ—¥æ—¶åˆ†ç§’æ¯«ç±³å¾®ç§’çº³ç§’ã€æ—¶é—´æˆ³å°±ä¸è¯´äº†ã€‚è·å–æ—¶åŒºTimezoneã€è·å–ä½ç½®Locationã€è·å–è·ç¦»UTCæ—¶åŒºçš„åç§»é‡ï¼Œå•ä½ç§’Offsetã€è·å–å½“å‰åŒºåŸŸLocaleã€ è·å–å½“å‰æ˜Ÿåº§Constellationã€è·å–å½“å‰å­£èŠ‚Season\nè·å–å¹´é¾„Ageã€‚ï¼ˆä½ å°±è¯´å¼ºä¸å¼ºå¤§~ï¼‰\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 // è·å–å¹´é¾„ carbon.Parse(\u0026#34;2002-01-01 13:14:15\u0026#34;).Age() // 17 // è·å–å½“å‰æ˜Ÿåº§ carbon.Now().SetLocale(\u0026#34;en\u0026#34;).Constellation() // Leo carbon.Now().SetLocale(\u0026#34;zh-CN\u0026#34;).Constellation() // ç‹®å­åº§ // è·å–æ—¶åŒº carbon.SetTimezone(carbon.PRC).Timezone() // CST carbon.SetTimezone(carbon.Tokyo).Timezone() // JST // è·å–ä½ç½® carbon.SetTimezone(carbon.PRC).Location() // PRC carbon.SetTimezone(carbon.Tokyo).Location() // Asia/Tokyo // è·å–è·ç¦»UTCæ—¶åŒºçš„åç§»é‡ï¼Œå•ä½ç§’ carbon.SetTimezone(carbon.PRC).Offset() // 28800 carbon.SetTimezone(carbon.Tokyo).Offset() // 32400 // è·å–å½“å‰åŒºåŸŸ carbon.Now().Locale() // en carbon.Now().SetLocale(\u0026#34;zh-CN\u0026#34;).Locale() // zh-CN // è·å–æœ¬æœˆç¬¬å‡ å¤© carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).DayOfMonth() // 5 // è·å–æœ¬æœˆç¬¬å‡ å‘¨ carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).WeekOfMonth() // 1 æ›´å¤šç¤ºä¾‹å‚è€ƒ\n# æ—¶é—´è¾“å‡º æ—¶é—´è¾“å‡ºæ˜¯ToXxxStringæ–¹æ³•ã€‚ï¼ˆä½ èƒ½æƒ³åˆ°çš„æ ¼å¼éƒ½èƒ½è¾“å‡ºğŸ˜‚ï¼‰\næ³¨æ„ï¼šå¢å¼ºç‰ˆæœ‰ä¸€ä¸ªå‘ï¼šå½“æˆ‘ä»¬ç›´æ¥è¾“å‡ºCarbonå¯¹è±¡æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨Stringæ–¹æ³•ï¼Œè¿™ä¸ªStringæ–¹æ³•ä¼šå°†æ—¶åŒºæ”¹æˆæœ¬åœ°ã€‚è‹¥ä¸å¸Œæœ›ä¿®æ”¹æ—¶åŒºï¼Œè¯·ä¸è¦è°ƒç”¨Stringæ–¹æ³•ï¼Œç”¨åˆ«çš„è½¬å­—ç¬¦ä¸²çš„æ–¹æ³•ï¼Œå¦‚ToDateTimeStringã€‚\nToStringæ–¹æ³•ä¸ºè¾“å‡ºtimeåŒ…çš„é»˜è®¤æ ¼å¼ã€‚\nè¾“å‡ºæŒ‡å®šå¸ƒå±€çš„å­—ç¬¦ä¸²Layout\nè¾“å‡ºæŒ‡å®šæ ¼å¼çš„å­—ç¬¦ä¸²(å¦‚æœä½¿ç”¨çš„å­—æ¯ä¸æ ¼å¼åŒ–å­—ç¬¦å†²çªæ—¶ï¼Œè¯·ä½¿ç”¨\\ç¬¦å·è½¬ä¹‰è¯¥å­—ç¬¦Format\nç¤ºä¾‹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 // è¾“å‡ºç®€å†™æ—¥æœŸå­—ç¬¦ä¸² carbon.Parse(\u0026#34;2020-08-05 13:14:15.999999999\u0026#34;).ToShortDateString() // 20200805 // è¾“å‡ºç®€å†™æ—¶é—´å­—ç¬¦ä¸² carbon.Parse(\u0026#34;2020-08-05 13:14:15.999999999\u0026#34;).ToShortTimeString() // 131415 // è¾“å‡ºç®€å†™æ—¶é—´å­—ç¬¦ä¸²ï¼ŒåŒ…å«æ¯«ç§’ carbon.Parse(\u0026#34;2020-08-05 13:14:15.999999999\u0026#34;).ToShortTimeMilliString() // 131415.999 // è¾“å‡ºç®€å†™æ—¶é—´å­—ç¬¦ä¸²ï¼ŒåŒ…å«å¾®ç§’ carbon.Parse(\u0026#34;2020-08-05 13:14:15.999999999\u0026#34;).ToShortTimeMicroString() // 131415.999999 // è¾“å‡ºç®€å†™æ—¶é—´å­—ç¬¦ä¸²ï¼ŒåŒ…å«çº³ç§’ carbon.Parse(\u0026#34;2020-08-05 13:14:15.999999999\u0026#34;).ToShortTimeNanoString() // 131415.999999999 // è¾“å‡º UnixDate æ ¼å¼å­—ç¬¦ä¸² carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).ToUnixDateString() // Wed Aug 5 13:14:15 CST 2020 // è¾“å‡º RFC3339 æ ¼å¼å­—ç¬¦ä¸² carbon.Parse(\u0026#34;2020-08-05T13:14:15.999999999+08:00\u0026#34;).ToRfc3339String() // 2020-08-05T13:14:15+08:00 // è¾“å‡º\u0026#34;2006-01-02 15:04:05.999999999 -0700 MST\u0026#34;æ ¼å¼å­—ç¬¦ä¸² carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).ToString() // 2020-08-05 13:14:15.999999 +0800 CST // è¾“å‡º \u0026#34;Jan 2, 2006\u0026#34; æ ¼å¼å­—ç¬¦ä¸² carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).ToFormattedDateString() // Aug 5, 2020 // è¾“å‡º \u0026#34;Mon, Jan 2, 2006\u0026#34; æ ¼å¼å­—ç¬¦ä¸² carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).ToFormattedDayDateString() // Wed, Aug 5, 2020 // è¾“å‡ºæŒ‡å®šå¸ƒå±€çš„å­—ç¬¦ä¸² carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).Layout(carbon.ISO8601Layout) // 2020-08-05T13:14:15+08:00 carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).Layout(\u0026#34;20060102150405\u0026#34;) // 20200805131415 carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).Layout(\u0026#34;2006å¹´01æœˆ02æ—¥ 15æ—¶04åˆ†05ç§’\u0026#34;) // 2020å¹´08æœˆ05æ—¥ 13æ—¶14åˆ†15ç§’ carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).Layout(\u0026#34;It is 2006-01-02 15:04:05\u0026#34;) // It is 2020-08-05 13:14:15 // è¾“å‡ºæŒ‡å®šæ ¼å¼çš„å­—ç¬¦ä¸²(å¦‚æœä½¿ç”¨çš„å­—æ¯ä¸æ ¼å¼åŒ–å­—ç¬¦å†²çªæ—¶ï¼Œè¯·ä½¿ç”¨\\ç¬¦å·è½¬ä¹‰è¯¥å­—ç¬¦) carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).Format(\u0026#34;YmdHis\u0026#34;) // 20200805131415 carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).Format(\u0026#34;Yå¹´mæœˆdæ—¥ Hæ—¶iåˆ†sç§’\u0026#34;) // 2020å¹´08æœˆ05æ—¥ 13æ—¶14åˆ†15ç§’ carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).Format(\u0026#34;l jS \\\\o\\\\f F Y h:i:s A\u0026#34;) // Wednesday 5th of August 2020 01:14:15 PM carbon.Parse(\u0026#34;2020-08-05 13:14:15\u0026#34;).Format(\u0026#34;\\\\I\\\\t \\\\i\\\\s Y-m-d H:i:s\u0026#34;) // It is 2020-08-05 13:14:15 æ›´å¤šç¤ºä¾‹å‚è€ƒ\næ›´å¤šæ ¼å¼åŒ–è¾“å‡ºç¬¦å·è¯·æŸ¥çœ‹é™„å½• æ ¼å¼åŒ–ç¬¦å·è¡¨\n# è¾“å‡ºç»“æ„ä½“ æ—¶é—´è¾“å‡ºä¸ä»…èƒ½å¤Ÿè¾“å‡ºæŒ‡å®šå­—ç¬¦ä¸²ToXxxStringï¼Œè¿˜èƒ½è¾“å‡ºåˆ°æŒ‡å®šçš„ç»“æ„ä½“ç±»å‹ToXxxStructï¼Œç”¨ä¸åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æŒ‡å®šæ—¥æœŸæ—¶é—´æ ¼å¼ã€‚åªä¸è¿‡è¾“å‡ºçš„ç»“æ„ä½“ç±»å‹åªæœ‰Dateå’ŒTimeç»„åˆçš„ã€‚\nç¤ºä¾‹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 package main import ( \u0026#34;encoding/json\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;github.com/golang-module/carbon/v2\u0026#34; ) type Student struct { Birthday1 carbon.DateTime `json:\u0026#34;birthday1\u0026#34;` Birthday2 carbon.Date `json:\u0026#34;birthday2\u0026#34;` } func main() { s := Student{ Birthday1: carbon.Now().SubYears(5).ToDateTimeStruct(), Birthday2: carbon.Now().SubYears(10).ToDateStruct(), } marshal, err := json.Marshal(s) if err != nil { log.Fatal(err) } println(string(marshal)) // {\u0026#34;birthday1\u0026#34;:\u0026#34;2019-05-15 14:57:07\u0026#34;,\u0026#34;birthday2\u0026#34;:\u0026#34;2014-05-15\u0026#34;} s2 := new(Student) err = json.Unmarshal(marshal, s2) if err != nil { log.Fatal(err) } fmt.Println(s2.Birthday1) // 2019-05-15 15:00:27 fmt.Println(s2.Birthday2) // 2014-05-15 } # æ€»ç»“ carbonæä¾›äº†å¾ˆå¤šçš„å®ç”¨æ–¹æ³•ï¼Œå¦å¤–timeçš„æ–¹æ³•å®ƒä¹Ÿèƒ½ä½¿ç”¨ï¼Œä½¿å¾—å®ƒçš„åŠŸèƒ½éå¸¸å¼ºå¤§ã€‚æ—¶é—´å…¶å®æ˜¯ä¸€ä¸ªéå¸¸å¤æ‚çš„é—®é¢˜ï¼Œè€ƒè™‘åˆ°æ—¶åŒºã€é—°ç§’ã€å„åœ°çš„å¤ä»¤æ—¶ç­‰ï¼Œè‡ªå·±å¤„ç†èµ·æ¥ç®€ç›´æ˜¯ç«è‘¬åœºã€‚å¹¸å¥½æœ‰è¿™äº›åº“(â”¬ï¼¿â”¬)\n# å‚è€ƒ carbon GitHub ä»“åº“ï¼š https://github.com/uniplaces/carbon å¢å¼ºç‰ˆcarbon GitHub ä»“åº“ï¼š https://github.com/golang-module/carbon Go æ¯æ—¥ä¸€åº“ä¹‹ carbon ","date":"2024-05-13T10:19:13+08:00","permalink":"https://arlettebrook.github.io/p/carbon-introduction/","title":"Carbon Introduction"},{"content":" # ç®€ä»‹ twelve-factoråº”ç”¨æå€¡å°†é…ç½®å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡ä¸­ã€‚ä»»ä½•ä»å¼€å‘ç¯å¢ƒåˆ‡æ¢åˆ°ç”Ÿäº§ç¯å¢ƒæ—¶éœ€è¦ä¿®æ”¹çš„ä¸œè¥¿éƒ½ä»ä»£ç æŠ½å–åˆ°ç¯å¢ƒå˜é‡é‡Œã€‚ ä½†æ˜¯åœ¨å®é™…å¼€å‘ä¸­ï¼Œå¦‚æœåŒä¸€å°æœºå™¨è¿è¡Œå¤šä¸ªé¡¹ç›®ï¼Œè®¾ç½®ç¯å¢ƒå˜é‡å®¹æ˜“å†²çªï¼Œä¸å®ç”¨ã€‚godotenvåº“ä».envæ–‡ä»¶ä¸­è¯»å–é…ç½®ï¼Œ ç„¶åå­˜å‚¨åˆ°ç¨‹åºçš„ç¯å¢ƒå˜é‡ä¸­ã€‚åœ¨ä»£ç ä¸­å¯ä»¥ä½¿ç”¨è¯»å–éå¸¸æ–¹ä¾¿ã€‚godotenvæºäºä¸€ä¸ª Ruby çš„å¼€æºé¡¹ç›®dotenvã€‚\n# å¿«é€Ÿä½¿ç”¨ ç¬¬ä¸‰æ–¹åº“éœ€è¦å…ˆå®‰è£…ï¼š\n1 $ go get -u github.com/joho/godotenv åä½¿ç”¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;os\u0026#34; \u0026#34;github.com/joho/godotenv\u0026#34; ) func main() { err := godotenv.Load() if err != nil { log.Fatal(err) } fmt.Println(\u0026#34;nameï¼š\u0026#34;, os.Getenv(\u0026#34;name\u0026#34;)) fmt.Println(\u0026#34;ageï¼š\u0026#34;, os.Getenv(\u0026#34;AGE\u0026#34;)) } ç„¶ååœ¨å¯æ‰§è¡Œç¨‹åºç›¸åŒç›®å½•ä¸‹ï¼Œæ·»åŠ ä¸€ä¸ª.envæ–‡ä»¶ï¼ˆå¯ä»¥ç»™ideå®‰è£…æ’ä»¶ï¼Œæ£€æŸ¥.envæ–‡ä»¶è¯­æ³•ï¼Œå®‰è£…ç”¨çš„äººå¤šçš„ã€‚å¦‚GoLandï¼š.env files supportï¼‰ï¼š\n1 2 NAME=arlettebrook AGE=18 è¿è¡Œç¨‹åºï¼Œè¾“å‡ºï¼š\n1 2 3 $ go run main.go nameï¼š arlettebrook ageï¼š 18 å¯è§ï¼Œä½¿ç”¨éå¸¸æ–¹ä¾¿ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œgodotenvè¯»å–é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„.envæ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­ä½¿ç”¨key=valueçš„æ ¼å¼ï¼Œæ¯è¡Œä¸€ä¸ªé”®å€¼å¯¹ã€‚ è°ƒç”¨godotenv.Load()å³å¯åŠ è½½ï¼Œå¯ç›´æ¥è°ƒç”¨os.Getenv(\u0026quot;key\u0026quot;)è¯»å–,os.Getenvæ˜¯ç”¨æ¥è¯»å–ç¯å¢ƒå˜é‡çš„ï¼šwindowsä¸Šä¸åŒºåˆ†å¤§å°å†™ï¼Œä½†ç¯å¢ƒå˜é‡é€šå¸¸éƒ½æ˜¯å¤§å†™ï¼Œå»ºè®®ç”¨å¤§å†™ã€‚æ²¡æ‰¾åˆ°è¿”å›ç©ºå­—ç¬¦ä¸²ã€‚\n1 2 3 4 5 6 7 8 9 10 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;os\u0026#34; ) func main() { fmt.Println(os.Getenv(\u0026#34;GOPATH\u0026#34;)) // ä¼šè¿”å›GOPAHTç¯å¢ƒå˜é‡çš„å€¼ } # åŸºæœ¬ä½¿ç”¨ # è‡ªåŠ¨åŠ è½½ å¦‚æœä½ æœ‰ç¨‹åºå‘˜çš„ä¼˜è‰¯ä¼ ç»Ÿâ€”â€”æ‡’ï¼Œä½ å¯èƒ½è¿Loadæ–¹æ³•éƒ½ä¸æƒ³è‡ªå·±è°ƒç”¨ã€‚æ²¡å…³ç³»ï¼Œgodotenvç»™ä½ æ‡’çš„æƒåŠ›ï¼\nå¯¼å…¥github.com/joho/godotenv/autoloadï¼Œé…ç½®ä¼šè‡ªåŠ¨è¯»å–ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;os\u0026#34; _ \u0026#34;github.com/joho/godotenv/autoload\u0026#34; ) func main() { fmt.Println(\u0026#34;name: \u0026#34;, os.Getenv(\u0026#34;NAME\u0026#34;)) fmt.Println(\u0026#34;age: \u0026#34;, os.Getenv(\u0026#34;AGE\u0026#34;)) } æ³¨æ„ï¼Œç”±äºä»£ç ä¸­æ²¡æœ‰æ˜¾å¼ç”¨åˆ°godotenvåº“ï¼Œéœ€è¦ä½¿ç”¨ç©ºå¯¼å…¥ï¼Œå³å¯¼å…¥æ—¶åŒ…åå‰æ·»åŠ ä¸€ä¸ª_ã€‚ä½œç”¨ï¼šè‡ªåŠ¨è°ƒç”¨initå‡½æ•°ã€‚\nçœ‹autoloadåŒ…çš„æºç ï¼Œå…¶å®å°±æ˜¯åº“å¸®ä½ è°ƒç”¨äº†Loadæ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 package autoload /* You can just read the .env file on import just by doing import _ \u0026#34;github.com/joho/godotenv/autoload\u0026#34; And bob\u0026#39;s your mother\u0026#39;s brother */ import \u0026#34;github.com/joho/godotenv\u0026#34; func init() { godotenv.Load() } ä»”ç»†çœ‹æ³¨é‡Šï¼Œç¨‹åºå‘˜çš„æ¶è¶£å‘³ğŸ˜‚ï¼\n# åŠ è½½è‡ªå®šä¹‰æ–‡ä»¶ é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŠ è½½çš„æ˜¯é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„.envæ–‡ä»¶ã€‚å½“ç„¶æˆ‘ä»¬å¯ä»¥åŠ è½½ä»»æ„åç§°çš„æ–‡ä»¶ï¼Œæ–‡ä»¶ä¹Ÿä¸å¿…ä»¥.envä¸ºåç¼€ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;os\u0026#34; \u0026#34;github.com/joho/godotenv\u0026#34; ) func main() { err := godotenv.Load(\u0026#34;common\u0026#34;, \u0026#34;.env.production\u0026#34;, \u0026#34;.env.development\u0026#34;) if err != nil { log.Fatal(err) } fmt.Println(\u0026#34;name: \u0026#34;, os.Getenv(\u0026#34;NAME\u0026#34;)) fmt.Println(\u0026#34;version: \u0026#34;, os.Getenv(\u0026#34;VERSION\u0026#34;)) fmt.Println(\u0026#34;database: \u0026#34;, os.Getenv(\u0026#34;DATABASE\u0026#34;)) } commonæ–‡ä»¶å†…å®¹ï¼š\n1 2 NAME=awesome web VERSION=0.0.1 .env.developmentï¼š\n1 DATABASE=sqlite .env.productionï¼š\n1 DATABASE=mysql è¿è¡Œè¾“å‡ºï¼š\n1 2 3 4 $ go run main.go name: awesome web version: 0.0.1 database: mysql æ³¨æ„äº‹é¡¹ï¼š\nLoadæ¥æ”¶å¤šä¸ªæ–‡ä»¶åä½œä¸ºå‚æ•°ï¼Œå¦‚æœä¸ä¼ å…¥æ–‡ä»¶åï¼Œé»˜è®¤è¯»å–.envæ–‡ä»¶çš„å†…å®¹ã€‚ å½“æŒ‡å®šäº†ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼Œé»˜è®¤çš„.envæ–‡ä»¶ä¼šå¤±æ•ˆï¼Œé™¤éä½ åŠ è¿›å»ã€‚ å¦‚æœå¤šä¸ªæ–‡ä»¶ä¸­å­˜åœ¨åŒä¸€ä¸ªé”®ï¼Œé‚£ä¹ˆå…ˆå‡ºç°çš„ä¼˜å…ˆï¼Œåå‡ºç°çš„ä¸ç”Ÿæ•ˆã€‚æ‰€ä»¥ï¼Œä¸Šé¢è¾“å‡ºçš„databaseæ˜¯mysqlã€‚ åŸå› ï¼šå…ˆå‡ºç°çš„å·²ç»åŠ è½½åˆ°ç¯å¢ƒå˜é‡ä¸­äº†ï¼Œé»˜è®¤ä¸ä¼šè¦†ç›–ç¯å¢ƒå˜é‡ä¸­çš„å€¼ã€‚ ä½¿ç”¨Loadæ–¹æ³•åŠ è½½çš„ç¯å¢ƒå˜é‡ä¸ä¼šè¦†ç›–é»˜è®¤çš„ç¯å¢ƒå˜é‡ï¼Œè¦è¦†ç›–è¯·ç”¨Overloadæ–¹æ³•ã€‚ ä½¿ç”¨è¿™ä¸ªåŠ è½½ï¼Œä¸Šé¢è¾“å‡ºçš„databaseæ˜¯sqliteã€‚ä¸ä¿¡ä½ å¯ä»¥è¯•è¯•\u0026hellip; ä»¥ä¸Šä¸¤ç§æ–¹æ³•éƒ½ä¼šå¯¹ç¯å¢ƒå˜é‡çš„å‰¯æœ¬ï¼Œè¿›è¡Œæ·»åŠ æˆ–ä¿®æ”¹ã€‚åé¢ä¼šä»‹ç»ï¼Œä¸å­˜å…¥ç¯å¢ƒå˜é‡ã€‚ # æ³¨é‡Š .envæ–‡ä»¶ä¸­å¯ä»¥æ·»åŠ æ³¨é‡Šï¼Œæ³¨é‡Šä»¥#å¼€å§‹ï¼Œç›´åˆ°è¯¥è¡Œç»“æŸã€‚\n1 2 3 4 # app name NAME=awesome web # current version VERSION=0.0.1 # YAML .envæ–‡ä»¶è¿˜å¯ä»¥ä½¿ç”¨ YAML æ ¼å¼ï¼š\n1 2 NAME: \u0026#39;awesome web\u0026#39; VERSION: 0.0.1 1 2 3 4 5 6 7 8 9 10 11 12 13 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;os\u0026#34; _ \u0026#34;github.com/joho/godotenv/autoload\u0026#34; ) func main() { fmt.Println(\u0026#34;name: \u0026#34;, os.Getenv(\u0026#34;NAME\u0026#34;)) fmt.Println(\u0026#34;version: \u0026#34;, os.Getenv(\u0026#34;VERSION\u0026#34;)) } è¿è¡Œè¾“å‡ºï¼š\n1 2 3 $ go run main.go name: awesome web version: 0.0.1 æ³¨æ„ï¼šyamlæ ¼å¼ä¸æ”¯æŒåµŒå¥—ã€‚å®˜æ–¹è§£é‡Šï¼šæ”¯æŒ YAML(ish) é£æ ¼ã€‚\n# ä¸å­˜å…¥ç¯å¢ƒå˜é‡ # ä»æ–‡ä»¶è¯»å– godotenvå…è®¸ä¸å°†.envæ–‡ä»¶å†…å®¹å­˜å…¥ç¯å¢ƒå˜é‡ï¼Œä½¿ç”¨godotenv.Read()è¿”å›ä¸€ä¸ªmap[string]stringï¼Œå¯ç›´æ¥ä½¿ç”¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;github.com/joho/godotenv\u0026#34; ) func main() { myEnv, err := godotenv.Read() if err != nil { log.Fatal(err) } fmt.Println(\u0026#34;name: \u0026#34;, myEnv[\u0026#34;NAME\u0026#34;]) fmt.Println(\u0026#34;version: \u0026#34;, myEnv[\u0026#34;VERSION\u0026#34;]) } æ³¨æ„ï¼š\nç¯å¢ƒé…ç½®æ–‡ä»¶ä¸­çš„é”®å€¼å¯¹ï¼Œä¼šä¿å­˜åœ¨è¿”å›çš„map[string]stringä¸­ï¼Œé”®åä¸é…ç½®é”®å¿…é¡»åŒåã€‚ ç›´æ¥æ“ä½œmapï¼Œç®€å•ç›´æ¥ï¼ è¿™æ ·å°±ä¸ä¼šå°†ç¯å¢ƒé…ç½®æ–‡ä»¶ä¸­çš„å˜é‡å­˜å…¥ç¯å¢ƒå˜é‡ã€‚ Readå¯ä»¥æ¥æ”¶æ–‡ä»¶è·¯å¾„ï¼Œç”¨äºæŒ‡å®šé…ç½®æ–‡ä»¶ã€‚é»˜è®¤./.env,ä¸Loadä¸€è‡´ã€‚ # ä»string, byteä¸­è¯»å–é…ç½® é™¤äº†è¯»å–æ–‡ä»¶ï¼Œè¿˜å¯ä»¥ä»stringä¸­è¯»å–é…ç½®ï¼Œå®ƒä¸ä¼šä¿®æ”¹ç¯å¢ƒï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;github.com/joho/godotenv\u0026#34; ) func main() { stringContent := ` name: awesome web version: 0.0.1 ` byteContent := []byte(` name: awesome web byte version: 1.0.1`) myEnvWithString, err := godotenv.Unmarshal(stringContent) myEnvWithByte, err := godotenv.UnmarshalBytes(byteContent) if err != nil { log.Fatal(err) } fmt.Println(\u0026#34;name: \u0026#34;, myEnvWithString[\u0026#34;name\u0026#34;]) fmt.Println(\u0026#34;version: \u0026#34;, myEnvWithString[\u0026#34;version\u0026#34;]) fmt.Println(\u0026#34;--------UnmarshalBytes--------\u0026#34;) fmt.Println(\u0026#34;name: \u0026#34;, myEnvWithByte[\u0026#34;name\u0026#34;]) fmt.Println(\u0026#34;version: \u0026#34;, myEnvWithByte[\u0026#34;version\u0026#34;]) } é€šè¿‡Unmarshalæ–¹æ³•ï¼Œå¯ä»¥ä»å­—ç¬¦ä¸²ä¸­è¯»å–envæ–‡ä»¶ã€‚å­˜å‚¨åœ¨è¿”å›å€¼map[string]stringç±»å‹ä¸­ã€‚ é€šè¿‡UnmarshalBytesæ–¹æ³•ï¼Œå¯ä»¥ä»å­—èŠ‚åˆ‡ç‰‡ä¸­è¯»å–envæ–‡ä»¶ã€‚ä¹Ÿæ˜¯å­˜å‚¨åœ¨mapä¸­ã€‚ è¿è¡Œè¾“å‡ºï¼š\n1 2 3 4 5 6 $ go run main.go name: awesome web version: 0.0.1 --------UnmarshalBytes-------- name: awesome web byte version: 1.0.1 # ä»io.Readerè·å–é…ç½® é™¤äº†ä»¥ä¸Šæ–¹æ³•å¤–ï¼Œè¿˜å¯ä»¥ä»io.Readerä¸­è¯»å–envæ–‡ä»¶ã€‚è¿™ä¸ªä¹Ÿä¸ä¼šä¿®æ”¹ç¯å¢ƒã€‚\nåªè¦å®ç°äº†io.Readeræ¥å£ï¼Œå°±èƒ½ä½œä¸ºæ•°æ®æºã€‚å¯ä»¥ä»æ–‡ä»¶ï¼ˆos.Fileï¼‰ï¼Œç½‘ç»œï¼ˆnet.Connï¼‰ï¼Œbytes.Bufferç­‰å¤šç§æ¥æºè¯»å–ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 package main import ( \u0026#34;bytes\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;os\u0026#34; \u0026#34;github.com/joho/godotenv\u0026#34; ) func main() { file, _ := os.Open(\u0026#34;.env\u0026#34;) myEnv, err := godotenv.Parse(file) if err != nil { log.Fatal(err) } fmt.Println(\u0026#34;name: \u0026#34;, myEnv[\u0026#34;NAME\u0026#34;]) fmt.Println(\u0026#34;version: \u0026#34;, myEnv[\u0026#34;VERSION\u0026#34;]) buf := bytes.NewBuffer([]byte{}) buf.WriteString(\u0026#34;name: awesome web @buffer\u0026#34;) buf.Write([]byte{\u0026#39;\\n\u0026#39;}) buf.WriteString(\u0026#34;version: 0.0.1 @buffer\u0026#34;) myEnv, err = godotenv.Parse(buf) if err != nil { log.Fatal(err) } fmt.Println(\u0026#34;name: \u0026#34;, myEnv[\u0026#34;name\u0026#34;]) fmt.Println(\u0026#34;version: \u0026#34;, myEnv[\u0026#34;version\u0026#34;]) } é€šè¿‡Parseæ–¹æ³•ï¼Œå¯ä»¥ä¸­ioä¸­è¯»å–envæ–‡ä»¶ã€‚ä»å­—ç¬¦ä¸²ä¸­è¯»å–æ˜¯Unmarshalæ–¹æ³•ï¼ŒäºŒè€…ä¸ä¸€æ ·ã€‚ è¯»å–çš„é…ç½®éƒ½ä¿å­˜åœ¨mapä¸­ï¼Œæ²¡æœ‰å­˜å…¥ç¯å¢ƒå˜é‡ã€‚mapé”®ä¸é…ç½®é”®å¿…é¡»åŒåã€‚é€šè¿‡os.GetenvæŒ‡å®šçš„å¯ä»¥ä¸åŒºåˆ†å¤§å°å†™ï¼Œä½†å»ºè®®å¤§å†™ã€‚ è¿è¡Œè¾“å‡ºï¼š\n1 2 3 4 5 $ go run main.go name: awesome web version: 0.0.1 name: awesome web @buffer version: 0.0.1 @buffer # ç”Ÿæˆ.envæ–‡ä»¶orå­—ç¬¦ä¸² å¯ä»¥é€šè¿‡ç¨‹åºç”Ÿæˆä¸€ä¸ª.envæ–‡ä»¶çš„å†…å®¹ï¼Œå¯ä»¥ç›´æ¥å†™å…¥åˆ°æ–‡ä»¶ä¸­ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 package main import ( \u0026#34;bytes\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;github.com/joho/godotenv\u0026#34; ) func main() { buf := bytes.NewBuffer([]byte{}) buf.WriteString(\u0026#34;NAME=awesome web @write\u0026#34;) buf.WriteByte(\u0026#39;\\n\u0026#39;) buf.WriteString(\u0026#34;VERSION=0.0.1 @write\u0026#34;) envMap, err := godotenv.Parse(buf) if err != nil { log.Fatal(err) } err = godotenv.Write(envMap, \u0026#34;./write.env\u0026#34;) stringEnv, err := godotenv.Marshal(envMap) if err != nil { log.Fatal(err) } fmt.Println(stringEnv) } é€šè¿‡Writeæ–¹æ³•ï¼Œå¯ä»¥å°†mapä¸­çš„ç¯å¢ƒå˜é‡ï¼Œå†™å…¥åˆ°æŒ‡å®šæ–‡ä»¶ä¸­ã€‚ é€šè¿‡Marshalæ–¹æ³•ï¼Œå¯ä»¥å°†mapä¸­çš„ç¯å¢ƒå˜é‡ï¼Œåºåˆ—åŒ–æˆå­—ç¬¦ä¸² è¿è¡Œä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆwrite.envæ–‡ä»¶ï¼š\n1 2 NAME=\u0026#34;awesome web @write\u0026#34; VERSION=\u0026#34;0.0.1 @write\u0026#34; TTYè¾“å‡ºï¼š\n1 2 3 $ go run main.go NAME=\u0026#34;awesome web @write\u0026#34; VERSION=\u0026#34;0.0.1 @write\u0026#34; # å‘½ä»¤è¡Œæ¨¡å¼ godotenvè¿˜æä¾›äº†ä¸€ä¸ªå‘½ä»¤è¡Œçš„æ¨¡å¼ã€‚è¦ä½¿ç”¨å®ƒï¼Œå…ˆè¦ç¡®ä¿å‘½ä»¤å®‰è£…åˆ°$GOPATH/binç›®å½•ä¸‹ï¼š\n1 $ go install github.com/joho/godotenv/cmd/godotenv@latest è¿™ä¸ªå‘½ä»¤è¡Œç¨‹åºï¼Œæºç å¾ˆç®€å•ï¼Œåœ¨github.com/joho/godotenv/cmd/godotenvè·¯å¾„ä¸‹,ç”¨flagåº“è§£æçš„å‘½ä»¤è¡Œå‚æ•°ã€‚ä½œç”¨æ˜¯è¯»å–envæ–‡ä»¶ï¼Œå†™å…¥ç¯å¢ƒå˜é‡ä¸­ï¼Œä¸ç”¨åœ¨ç¨‹åºä¸­è°ƒç”¨godotenvã€‚æœ€åæ˜¯é€šè¿‡Execæ–¹æ³•è°ƒç”¨Loadæ–¹æ³•å®ç°çš„ã€‚æ„Ÿå…´è¶£çš„å¯ä»¥è‡ªå·±å»çœ‹ä¸€ä¸‹ã€‚\nå®‰è£…åä¹‹åå¯ä»¥æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯ï¼Œå¤§è‡´ä¸ºï¼š\n1 2 $ godotenv -h godotenv [-o] [-f ENV_FILE_PATHS] COMMAND_ARGS -oï¼šæ˜¯å¦è¦†ç›–ç¯å¢ƒå˜é‡ï¼Œé»˜è®¤false -fï¼šå­—æ®µenvæ–‡ä»¶ï¼Œé»˜è®¤./.env å‰©ä½™å‚æ•°ï¼šå¯åŠ¨çš„ç¨‹åº ç¤ºä¾‹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;os\u0026#34; ) func main() { fmt.Println(os.Getenv(\u0026#34;NAME\u0026#34;)) fmt.Println(os.Getenv(\u0026#34;VERSION\u0026#34;)) fmt.Println(os.Getenv(\u0026#34;USERNAME\u0026#34;)) } ./.envæ–‡ä»¶ï¼š\n1 2 3 NAME: \u0026#39;awesome web\u0026#39; VERSION: 0.0.1 USERNAME: arlettebrook ä½¿ç”¨godotenvå‘½ä»¤å¯åŠ¨ç¨‹åº,æ¼”ç¤ºå¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 $ godotenv go run main.go awesome web 0.0.1 Lenovo $ godotenv -o go run main.go awesome web 0.0.1 arlettebrook ç¬¬ä¸€æ¬¡æ²¡æœ‰è¦†ç›–USERNAME,ç¬¬äºŒæ¬¡è¦†ç›–äº†ã€‚\né€šè¿‡godotenvå‘½ä»¤è¡Œç¨‹åºï¼Œæˆ‘ä»¬å¯ä»¥ä¸ç”¨å†è‡ªå·±çš„ç¨‹åºä¸­è°ƒç”¨godotenvè¯»å–envæ–‡ä»¶ã€‚\n# æŒ‡å®šç¯å¢ƒå¯åŠ¨ å®è·µä¸­ï¼Œä¸€èˆ¬ä¼šæ ¹æ®APP_ENVç¯å¢ƒå˜é‡çš„å€¼åŠ è½½ä¸åŒçš„æ–‡ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;os\u0026#34; \u0026#34;github.com/joho/godotenv\u0026#34; ) func main() { env := os.Getenv(\u0026#34;LEARN_ENV\u0026#34;) if env == \u0026#34;\u0026#34; { env = \u0026#34;development\u0026#34; } err := godotenv.Load(\u0026#34;.env.\u0026#34; + env) if err != nil { log.Fatal(err) } err = godotenv.Load() if err != nil { log.Fatal(err) } fmt.Println(\u0026#34;name: \u0026#34;, os.Getenv(\u0026#34;NAME\u0026#34;)) fmt.Println(\u0026#34;version: \u0026#34;, os.Getenv(\u0026#34;VERSION\u0026#34;)) fmt.Println(\u0026#34;database: \u0026#34;, os.Getenv(\u0026#34;DATABASE\u0026#34;)) } æˆ‘ä»¬å…ˆè¯»å–ç¯å¢ƒå˜é‡LEARN_ENVï¼Œç„¶åè¯»å–å¯¹åº”çš„.env. + envï¼Œæœ€åè¯»å–é»˜è®¤çš„.envæ–‡ä»¶ã€‚\nå‰é¢ä¹Ÿæåˆ°è¿‡ï¼Œå…ˆè¯»å–åˆ°çš„ä¼˜å…ˆã€‚æˆ‘ä»¬å¯ä»¥åœ¨é»˜è®¤çš„.envæ–‡ä»¶ä¸­é…ç½®åŸºç¡€ä¿¡æ¯å’Œä¸€äº›é»˜è®¤çš„å€¼ï¼Œ å¦‚æœåœ¨å¼€å‘/æµ‹è¯•/ç”Ÿäº§ç¯å¢ƒéœ€è¦ä¿®æ”¹ï¼Œé‚£ä¹ˆåœ¨å¯¹åº”çš„.env.development/.env.test/.env.productionæ–‡ä»¶ä¸­å†é…ç½®ä¸€æ¬¡å³å¯ã€‚\n.envæ–‡ä»¶å†…å®¹ï¼š\n1 2 3 NAME: \u0026#39;awesome web\u0026#39; VERSION: 0.0.1 DATABASE: mongodb .env.developmentï¼š\n1 DATABASE=sqlite .env.productionï¼š\n1 DATABASE=mysql è¿è¡Œè¾“å‡ºæ¼”ç¤ºï¼š\n1 2 3 4 5 6 7 8 9 10 11 # é»˜è®¤æ˜¯å¼€å‘ç¯å¢ƒ $ go run main.go name: awesome web version: 0.0.1 database: sqlite # ç”¨Loadä¸ä¼šè¦†ç›–ï¼Œæ‰€ä»¥è¡¨ç¤ºmongodb # è®¾ç½®ä¸ºç”Ÿæˆç¯å¢ƒ $ LEARN_ENV=production go run main.go name: awesome web version: 0.0.1 database: mysql # ä¸€ç‚¹æºç  (å…¶å®ä½ åº”è¯¥æå‰çœ‹ä¸€ä¸‹æºç ~)\ngodotenvè¯»å–æ–‡ä»¶å†…å®¹ï¼Œä¸ºä»€ä¹ˆå¯ä»¥ä½¿ç”¨os.Getenvè®¿é—®ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 // github.com/joho/godotenv/godotenv.go func loadFile(filename string, overload bool) error { envMap, err := readFile(filename) if err != nil { return err } currentEnv := map[string]bool{} rawEnv := os.Environ() for _, rawEnvLine := range rawEnv { key := strings.Split(rawEnvLine, \u0026#34;=\u0026#34;)[0] currentEnv[key] = true } for key, value := range envMap { if !currentEnv[key] || overload { _ = os.Setenv(key, value) } } return nil } å› ä¸ºgodotenvè°ƒç”¨os.Setenvå°†é”®å€¼å¯¹è®¾ç½®åˆ°ç¯å¢ƒå˜é‡ä¸­äº†ã€‚å°±æ˜¯åœ¨è¿è¡Œçš„æ—¶å€™ä¿®æ”¹äº†ç¯å¢ƒå˜é‡ã€‚\n# æ€»ç»“ æœ¬æ–‡ä»‹ç»äº†godotenvåº“çš„åŸºç¡€å’Œé«˜çº§ç”¨æ³•ã€‚godotenvçš„æºç ä¹Ÿæ¯”è¾ƒå¥½è¯»ï¼Œæœ‰æ—¶é—´ï¼Œæœ‰å…´è¶£çš„ç«¥é‹å»ºè®®ä¸€çœ‹~\n# å‚è€ƒ godotenv GitHub ä»“åº“ï¼š https://github.com/joho/godotenv åŸæ–‡ï¼šGo æ¯æ—¥ä¸€åº“ä¹‹ godotenv ","date":"2024-05-12T14:29:33+08:00","permalink":"https://arlettebrook.github.io/p/godotenv-introduction/","title":"Godotenv Introduction"},{"content":" # ä»‹ç» ä»Šå¤©æˆ‘ä»¬å†æ¥ä»‹ç»Steve Franciaï¼ˆspf13ï¼‰å¤§ç¥çš„å¦ä¸€ä¸ªåº“castã€‚castæ˜¯ä¸€ä¸ªå°å·§ã€å®ç”¨çš„ç±»å‹è½¬æ¢åº“ï¼Œç”¨äºå°†ä¸€ä¸ªç±»å‹è½¬ä¸ºå¦ä¸€ä¸ªç±»å‹ã€‚å®ƒæä¾›äº†ä¸€å¥—é«˜æ•ˆä¸”å®‰å…¨çš„ç±»å‹è½¬æ¢åŠŸèƒ½ã€‚ æœ€åˆå¼€å‘castæ˜¯ç”¨åœ¨hugoä¸­çš„ã€‚\n# å¿«é€Ÿä½¿ç”¨ å…ˆå®‰è£…ï¼š\n1 $ go get -u github.com/spf13/cast åä½¿ç”¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/spf13/cast\u0026#34; ) func main() { // ToString fmt.Println(cast.ToString(\u0026#34;apple\u0026#34;)) // apple fmt.Println(cast.ToString(8)) // 8 fmt.Println(cast.ToString(8.31)) // 8.31 fmt.Println(cast.ToString([]byte(\u0026#34;one time\u0026#34;))) // one time fmt.Println(cast.ToString(nil)) // \u0026#34;\u0026#34; var foo interface{} = \u0026#34;one more time\u0026#34; fmt.Println(cast.ToString(foo)) // one more time // ToInt fmt.Println(cast.ToInt(8)) // 8 fmt.Println(cast.ToInt(8.31)) // 8 fmt.Println(cast.ToInt(\u0026#34;8\u0026#34;)) // 8 fmt.Println(cast.ToInt(true)) // 1 fmt.Println(cast.ToInt(false)) // 0 var eight interface{} = 8 fmt.Println(cast.ToInt(eight)) // 8 fmt.Println(cast.ToInt(nil)) // 0 } å®é™…ä¸Šï¼Œcastå®ç°äº†å¤šç§å¸¸è§ç±»å‹ä¹‹é—´çš„ç›¸äº’è½¬æ¢ï¼Œè¿”å›æœ€ç¬¦åˆç›´è§‰çš„ç»“æœã€‚ä¾‹å¦‚ï¼š\nnilè½¬ä¸ºstringçš„ç»“æœä¸º\u0026quot;\u0026quot;ï¼Œè€Œä¸æ˜¯\u0026quot;nil\u0026quot;ï¼› trueè½¬ä¸ºstringçš„ç»“æœä¸º\u0026quot;true\u0026quot;ï¼Œè€Œtrueè½¬ä¸ºintçš„ç»“æœä¸º1ï¼› interface{}è½¬ä¸ºå…¶ä»–ç±»å‹ï¼Œè¦çœ‹å®ƒé‡Œé¢å­˜å‚¨çš„å€¼ç±»å‹ã€‚ è¿™äº›ç±»å‹åŒ…æ‹¬æ‰€æœ‰çš„åŸºæœ¬ç±»å‹ï¼ˆæ•´å½¢ã€æµ®ç‚¹å‹ã€å¸ƒå°”å€¼å’Œå­—ç¬¦ä¸²ï¼‰ã€ç©ºæ¥å£ã€nilï¼Œæ—¶é—´ï¼ˆtime.Timeï¼‰ã€æ—¶é•¿ï¼ˆtime.Durationï¼‰ä»¥åŠå®ƒä»¬çš„åˆ‡ç‰‡ç±»å‹ï¼Œ è¿˜æœ‰map[string]Typeï¼ˆå…¶ä¸­Typeä¸ºå‰é¢æåˆ°çš„ç±»å‹ï¼‰ï¼š\n1 2 3 4 byte bool float32 float64 string int8 int16 int32 int64 int uint8 uint16 uint32 uint64 uint interface{} time.Time time.Duration nil # åŸºæœ¬ä½¿ç”¨ castæä¾›äº†ä¸¤ç»„å‡½æ•°ï¼š\nToTypeï¼ˆå…¶ä¸­Typeå¯ä»¥ä¸ºä»»ä½•æ”¯æŒçš„ç±»å‹ï¼‰ï¼Œå°†å‚æ•°è½¬æ¢ä¸ºTypeç±»å‹ã€‚å¦‚æœæ— æ³•è½¬æ¢ï¼Œè¿”å›Typeç±»å‹çš„é›¶å€¼æˆ–nilï¼› ToTypeEä»¥ E ç»“å°¾ï¼Œè¿”å›è½¬æ¢åçš„å€¼å’Œä¸€ä¸ªerrorã€‚è¿™ç»„å‡½æ•°å¯ä»¥åŒºåˆ†å‚æ•°ä¸­å®é™…å­˜å‚¨äº†é›¶å€¼ï¼Œè¿˜æ˜¯è½¬æ¢å¤±è´¥äº†ã€‚ # æºç åˆ†æï¼š å®ç°ä¸Šå¤§éƒ¨åˆ†ä»£ç éƒ½ç±»ä¼¼ï¼ŒToTypeåœ¨å†…éƒ¨è°ƒç”¨ToTypeEå‡½æ•°ï¼Œè¿”å›ç»“æœå¹¶å¿½ç•¥é”™è¯¯ã€‚ToTypeå‡½æ•°çš„å®ç°åœ¨æ–‡ä»¶cast.goä¸­ï¼Œ è€ŒToTypeEå‡½æ•°çš„å®ç°åœ¨æ–‡ä»¶caste.goä¸­ã€‚\n1 2 3 4 5 6 7 8 9 10 11 // cast/cast.go func ToBool(i interface{}) bool { v, _ := ToBoolE(i) return v } // ToDuration casts an interface to a time.Duration type. func ToDuration(i interface{}) time.Duration { v, _ := ToDurationE(i) return v } ToTypeEå‡½æ•°éƒ½æ¥å—ä»»æ„ç±»å‹çš„å‚æ•°ï¼ˆinterface{}ï¼‰ï¼Œç„¶åä½¿ç”¨ç±»å‹æ–­è¨€æ ¹æ®å…·ä½“çš„ç±»å‹æ¥æ‰§è¡Œä¸åŒçš„è½¬æ¢ã€‚å¦‚æœæ— æ³•è½¬æ¢ï¼Œè¿”å›é”™è¯¯ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 // cast/caste.go // ToBoolE casts an interface to a bool type. func ToBoolE(i interface{}) (bool, error) { i = indirect(i) switch b := i.(type) { case bool: return b, nil case nil: return false, nil case int: return b != 0, nil case int64: return b != 0, nil case int32: return b != 0, nil case int16: return b != 0, nil case int8: return b != 0, nil case uint: return b != 0, nil case uint64: return b != 0, nil case uint32: return b != 0, nil case uint16: return b != 0, nil case uint8: return b != 0, nil case float64: return b != 0, nil case float32: return b != 0, nil case time.Duration: return b != 0, nil case string: return strconv.ParseBool(i.(string)) case json.Number: v, err := ToInt64E(b) if err == nil { return v != 0, nil } return false, fmt.Errorf(\u0026#34;unable to cast %#v of type %T to bool\u0026#34;, i, i) default: return false, fmt.Errorf(\u0026#34;unable to cast %#v of type %T to bool\u0026#34;, i, i) } } é¦–å…ˆè°ƒç”¨indirectå‡½æ•°å°†å‚æ•°ä¸­å¯èƒ½çš„æŒ‡é’ˆå»æ‰ï¼ˆè¿”å›åŸå§‹ç±»å‹ï¼‰ã€‚å¦‚æœç±»å‹æœ¬èº«ä¸æ˜¯æŒ‡é’ˆï¼Œé‚£ä¹ˆç›´æ¥è¿”å›ã€‚å¦åˆ™è¿”å›æŒ‡é’ˆæŒ‡å‘çš„å€¼ã€‚ å¾ªç¯ç›´åˆ°è¿”å›ä¸€ä¸ªéæŒ‡é’ˆçš„å€¼ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 func indirect(a interface{}) interface{} { if a == nil { return nil } if t := reflect.TypeOf(a); t.Kind() != reflect.Ptr { // Avoid creating a reflect.Value if it\u0026#39;s not a pointer. return a } v := reflect.ValueOf(a) for v.Kind() == reflect.Ptr \u0026amp;\u0026amp; !v.IsNil() { v = v.Elem() } return v.Interface() } æ‰€ä»¥ï¼Œä¸‹é¢ä»£ç è¾“å‡ºéƒ½æ˜¯ 8ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/spf13/cast\u0026#34; ) func main() { /* ä¸makeçš„åŒºåˆ«ï¼š newåˆ›å»ºæŒ‡å‘è¯¥ç±»å‹é›¶å€¼çš„æŒ‡é’ˆ makeåˆ›å»ºæŒ‡å®šçš„ç±»å‹ï¼Œå¹¶åˆ†é…å†…å­˜ï¼Œç”¨ä¸å¼•ç”¨ç±»å‹ */ p := new(int) *p = 8 fmt.Println(cast.ToInt(p)) // 8 pp := \u0026amp;p fmt.Println(cast.ToInt(pp)) // 8 } # æ—¶é—´å’Œæ—¶é•¿è½¬æ¢ æ—¶é—´ç±»å‹çš„è½¬æ¢ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 // cast/caste.go func ToTimeInDefaultLocationE(i interface{}, location *time.Location) (tim time.Time, err error) { i = indirect(i) switch v := i.(type) { case time.Time: return v, nil case string: return StringToDateInDefaultLocation(v, location) case json.Number: s, err1 := ToInt64E(v) if err1 != nil { return time.Time{}, fmt.Errorf(\u0026#34;unable to cast %#v of type %T to Time\u0026#34;, i, i) } return time.Unix(s, 0), nil case int: return time.Unix(int64(v), 0), nil case int64: return time.Unix(v, 0), nil case int32: return time.Unix(int64(v), 0), nil case uint: return time.Unix(int64(v), 0), nil case uint64: return time.Unix(int64(v), 0), nil case uint32: return time.Unix(int64(v), 0), nil default: return time.Time{}, fmt.Errorf(\u0026#34;unable to cast %#v of type %T to Time\u0026#34;, i, i) } } æ ¹æ®ä¼ å…¥çš„ç±»å‹æ‰§è¡Œä¸åŒçš„å¤„ç†ï¼š\nå¦‚æœæ˜¯time.Timeï¼Œç›´æ¥è¿”å›ï¼› å¦‚æœæ˜¯æ•´å‹ï¼Œå°†å‚æ•°ä½œä¸ºæ—¶é—´æˆ³ï¼ˆè‡ª UTC æ—¶é—´1970.01.01 00:00:00åˆ°ç°åœ¨çš„ç§’æ•°ï¼‰è°ƒç”¨time.Unixç”Ÿæˆæ—¶é—´ã€‚Unixæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šç§’ï¼Œç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šçº³ç§’ï¼› å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œè°ƒç”¨StringToDateInDefaultLocationå‡½æ•°ä¾æ¬¡å°è¯•ä»¥ä¸‹é¢è¿™äº›æ—¶é—´æ ¼å¼è°ƒç”¨time.Parseè§£æè¯¥å­—ç¬¦ä¸²ã€‚å¦‚æœæŸä¸ªæ ¼å¼è§£ææˆåŠŸï¼Œåˆ™è¿”å›è·å¾—çš„time.Timeã€‚å¦åˆ™è§£æå¤±è´¥ï¼Œè¿”å›é”™è¯¯ï¼› å…¶ä»–ä»»ä½•ç±»å‹éƒ½æ— æ³•è½¬æ¢ä¸ºtime.Timeã€‚ å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ—¶é—´ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 // cast/caste.go var ( timeFormats = []timeFormat{ // Keep common formats at the top. {\u0026#34;2006-01-02\u0026#34;, timeFormatNoTimezone}, {time.RFC3339, timeFormatNumericTimezone}, {\u0026#34;2006-01-02T15:04:05\u0026#34;, timeFormatNoTimezone}, // iso8601 without timezone {time.RFC1123Z, timeFormatNumericTimezone}, {time.RFC1123, timeFormatNamedTimezone}, {time.RFC822Z, timeFormatNumericTimezone}, {time.RFC822, timeFormatNamedTimezone}, {time.RFC850, timeFormatNamedTimezone}, {\u0026#34;2006-01-02 15:04:05.999999999 -0700 MST\u0026#34;, timeFormatNumericAndNamedTimezone}, // Time.String() {\u0026#34;2006-01-02T15:04:05-0700\u0026#34;, timeFormatNumericTimezone}, // RFC3339 without timezone hh:mm colon {\u0026#34;2006-01-02 15:04:05Z0700\u0026#34;, timeFormatNumericTimezone}, // RFC3339 without T or timezone hh:mm colon {\u0026#34;2006-01-02 15:04:05\u0026#34;, timeFormatNoTimezone}, {time.ANSIC, timeFormatNoTimezone}, {time.UnixDate, timeFormatNamedTimezone}, {time.RubyDate, timeFormatNumericTimezone}, {\u0026#34;2006-01-02 15:04:05Z07:00\u0026#34;, timeFormatNumericTimezone}, {\u0026#34;02 Jan 2006\u0026#34;, timeFormatNoTimezone}, {\u0026#34;2006-01-02 15:04:05 -07:00\u0026#34;, timeFormatNumericTimezone}, {\u0026#34;2006-01-02 15:04:05 -0700\u0026#34;, timeFormatNumericTimezone}, {time.Kitchen, timeFormatTimeOnly}, {time.Stamp, timeFormatTimeOnly}, {time.StampMilli, timeFormatTimeOnly}, {time.StampMicro, timeFormatTimeOnly}, {time.StampNano, timeFormatTimeOnly}, } ) func StringToDateInDefaultLocation(s string, location *time.Location) (time.Time, error) { return parseDateWith(s, location, timeFormats) } func parseDateWith(s string, location *time.Location, formats []timeFormat) (d time.Time, e error) { for _, format := range formats { if d, e = time.Parse(format.format, s); e == nil { // Some time formats have a zone name, but no offset, so it gets // put in that zone name (not the default one passed in to us), but // without that zone\u0026#39;s offset. So set the location manually. if format.typ \u0026lt;= timeFormatNamedTimezone { if location == nil { location = time.Local } year, month, day := d.Date() hour, min, sec := d.Clock() d = time.Date(year, month, day, hour, min, sec, d.Nanosecond(), location) } return } } return d, fmt.Errorf(\u0026#34;unable to parse date: %s\u0026#34;, s) } æ—¶é•¿ç±»å‹çš„è½¬æ¢ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 // cast/caste.go func ToDurationE(i interface{}) (d time.Duration, err error) { i = indirect(i) switch s := i.(type) { case time.Duration: return s, nil case int, int64, int32, int16, int8, uint, uint64, uint32, uint16, uint8: d = time.Duration(ToInt64(s)) return case float32, float64: d = time.Duration(ToFloat64(s)) return case string: if strings.ContainsAny(s, \u0026#34;nsuÂµmh\u0026#34;) { d, err = time.ParseDuration(s) } else { d, err = time.ParseDuration(s + \u0026#34;ns\u0026#34;) } return case json.Number: var v float64 v, err = s.Float64() d = time.Duration(v) return default: err = fmt.Errorf(\u0026#34;unable to cast %#v of type %T to Duration\u0026#34;, i, i) return } } æ ¹æ®ä¼ å…¥çš„ç±»å‹è¿›è¡Œä¸åŒçš„å¤„ç†ï¼š\nå¦‚æœæ˜¯time.Durationç±»å‹ï¼Œç›´æ¥è¿”å›ï¼› å¦‚æœæ˜¯æ•´å‹æˆ–æµ®ç‚¹å‹ï¼Œå°†å…¶æ•°å€¼å¼ºåˆ¶è½¬æ¢ä¸ºtime.Durationç±»å‹ï¼Œå•ä½é»˜è®¤ä¸ºnsï¼› å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œåˆ†ä¸ºä¸¤ç§æƒ…å†µï¼šå¦‚æœå­—ç¬¦ä¸²ä¸­æœ‰æ—¶é—´å•ä½ç¬¦å·nsuÂµmhï¼Œç›´æ¥è°ƒç”¨time.ParseDurationè§£æï¼›å¦åˆ™åœ¨å­—ç¬¦ä¸²åæ‹¼æ¥nså†è°ƒç”¨time.ParseDurationè§£æï¼› å…¶ä»–ç±»å‹è§£æå¤±è´¥ã€‚ # æ—¶é—´ã€æ—¶é•¿ç¤ºä¾‹ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;time\u0026#34; \u0026#34;github.com/spf13/cast\u0026#34; ) func main() { now := time.Now() timestamp := 1579615973 timeStr := \u0026#34;2020-01-21 22:13:48\u0026#34; fmt.Println(cast.ToTime(now)) // 2020-01-22 06:31:50.5068465 +0800 CST m=+0.000997701 fmt.Println(cast.ToTime(timestamp)) // 2020-01-21 22:12:53 +0800 CST fmt.Println(cast.ToTime(timeStr)) // 2020-01-21 22:13:48 +0000 UTC d, _ := time.ParseDuration(\u0026#34;1m30s\u0026#34;) ns := 30000 strWithS := \u0026#34;130s\u0026#34; strWithoutNs := \u0026#34;130\u0026#34; fmt.Println(cast.ToDuration(d)) // 1m30s fmt.Println(cast.ToDuration(ns)) // 30Âµs fmt.Println(cast.ToDuration(strWithS)) // 2m10s fmt.Println(cast.ToDuration(strWithoutNs)) // 130ns } # è½¬æ¢ä¸ºåˆ‡ç‰‡ å®é™…ä¸Šï¼Œè¿™äº›å‡½æ•°çš„å®ç°åŸºæœ¬ç±»ä¼¼ã€‚ä½¿ç”¨ç±»å‹æ–­è¨€åˆ¤æ–­ç±»å‹ã€‚å¦‚æœå°±æ˜¯è¦è¿”å›çš„ç±»å‹ï¼Œç›´æ¥è¿”å›ã€‚å¦åˆ™æ ¹æ®ç±»å‹è¿›è¡Œç›¸åº”çš„è½¬æ¢ã€‚\næˆ‘ä»¬ä¸»è¦åˆ†æä¸¤ä¸ªå®ç°ï¼šToIntSliceEå’ŒToStringSliceEã€‚ToBoolSliceE/ToDurationSliceEä¸ToIntSliceEåŸºæœ¬ç›¸åŒã€‚\né¦–å…ˆæ˜¯ToIntSliceEï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 func ToIntSliceE(i interface{}) ([]int, error) { if i == nil { return []int{}, fmt.Errorf(\u0026#34;unable to cast %#v of type %T to []int\u0026#34;, i, i) } switch v := i.(type) { case []int: return v, nil } kind := reflect.TypeOf(i).Kind() switch kind { case reflect.Slice, reflect.Array: s := reflect.ValueOf(i) a := make([]int, s.Len()) for j := 0; j \u0026lt; s.Len(); j++ { val, err := ToIntE(s.Index(j).Interface()) if err != nil { return []int{}, fmt.Errorf(\u0026#34;unable to cast %#v of type %T to []int\u0026#34;, i, i) } a[j] = val } return a, nil default: return []int{}, fmt.Errorf(\u0026#34;unable to cast %#v of type %T to []int\u0026#34;, i, i) } } æ ¹æ®ä¼ å…¥å‚æ•°çš„ç±»å‹ï¼š\nå¦‚æœæ˜¯nilï¼Œç›´æ¥è¿”å›é”™è¯¯ï¼› å¦‚æœæ˜¯[]intï¼Œä¸ç”¨è½¬æ¢ï¼Œç›´æ¥è¿”å›ï¼› å¦‚æœä¼ å…¥ç±»å‹ä¸ºåˆ‡ç‰‡æˆ–æ•°ç»„ï¼Œæ–°å»ºä¸€ä¸ª[]intï¼Œå°†åˆ‡ç‰‡æˆ–æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ è½¬ä¸ºintæ”¾åˆ°è¯¥[]intä¸­ã€‚æœ€åè¿”å›è¿™ä¸ª[]intï¼› å…¶ä»–æƒ…å†µï¼Œä¸èƒ½è½¬æ¢ã€‚ ToStringSliceEï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 func ToStringSliceE(i interface{}) ([]string, error) { var a []string switch v := i.(type) { case []interface{}: for _, u := range v { a = append(a, ToString(u)) } return a, nil case []string: return v, nil case []int8: for _, u := range v { a = append(a, ToString(u)) } return a, nil case []int: for _, u := range v { a = append(a, ToString(u)) } return a, nil case []int32: for _, u := range v { a = append(a, ToString(u)) } return a, nil case []int64: for _, u := range v { a = append(a, ToString(u)) } return a, nil case []float32: for _, u := range v { a = append(a, ToString(u)) } return a, nil case []float64: for _, u := range v { a = append(a, ToString(u)) } return a, nil case string: return strings.Fields(v), nil case []error: for _, err := range i.([]error) { a = append(a, err.Error()) } return a, nil case interface{}: str, err := ToStringE(v) if err != nil { return a, fmt.Errorf(\u0026#34;unable to cast %#v of type %T to []string\u0026#34;, i, i) } return []string{str}, nil default: return a, fmt.Errorf(\u0026#34;unable to cast %#v of type %T to []string\u0026#34;, i, i) } } æ ¹æ®ä¼ å…¥çš„å‚æ•°ç±»å‹ï¼š\nå¦‚æœæ˜¯[]interface{}ï¼Œå°†è¯¥å‚æ•°ä¸­æ¯ä¸ªå…ƒç´ è½¬ä¸ºstringï¼Œè¿”å›ç»“æœåˆ‡ç‰‡ï¼› å¦‚æœæ˜¯[]stringï¼Œä¸éœ€è¦è½¬æ¢ï¼Œç›´æ¥è¿”å›ï¼› å¦‚æœæ˜¯interface{}ï¼Œå°†å‚æ•°è½¬ä¸ºstringï¼Œè¿”å›åªåŒ…å«è¿™ä¸ªå€¼çš„åˆ‡ç‰‡ï¼› å¦‚æœæ˜¯stringï¼Œè°ƒç”¨strings.Fieldså‡½æ•°æŒ‰ç©ºç™½ç¬¦å°†å‚æ•°æ‹†åˆ†ï¼Œè¿”å›æ‹†åˆ†åçš„å­—ç¬¦ä¸²åˆ‡ç‰‡ï¼› å…¶ä»–æƒ…å†µï¼Œä¸èƒ½è½¬æ¢ã€‚ # è½¬æ¢ä¸ºåˆ‡ç‰‡ç¤ºä¾‹ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/spf13/cast\u0026#34; ) func main() { sliceOfInt := []int{1, 3, 7} arrayOfInt := [3]int{8, 12} // ToIntSlice fmt.Println(cast.ToIntSlice(sliceOfInt)) // [1 3 7] fmt.Println(cast.ToIntSlice(arrayOfInt)) // [8 12 0] sliceOfInterface := []interface{}{1, 2.0, \u0026#34;apple\u0026#34;} sliceOfString := []string{\u0026#34;abc\u0026#34;, \u0026#34;dj\u0026#34;, \u0026#34;banana\u0026#34;} stringFields := \u0026#34; abc def hij hah\u0026#34; common := interface{}(37) // ToStringSliceE fmt.Println(cast.ToStringSlice(sliceOfInterface)) // [1 2 apple] fmt.Println(cast.ToStringSlice(sliceOfString)) toStringFields := cast.ToStringSlice(stringFields) fmt.Println(toStringFields, len(toStringFields)) // [abc dj banana hah] 4 // [abc def hij] fmt.Println(cast.ToStringSlice(common)) // [37] // ToToDurationSlice stringDurationSlice := []string{\u0026#34;1m23s\u0026#34;, \u0026#34;22h\u0026#34;} intDurationArray := [3]int{222222222, 88383838888} fmt.Println(cast.ToDurationSlice(stringDurationSlice)) // [1m23s 22h0m0s] fmt.Println(cast.ToDurationSlice(intDurationArray)) // [222.222222ms 1m28.383838888s 0s] // stringBoolSlice := []string{\u0026#34;true\u0026#34;, \u0026#34;false\u0026#34;, \u0026#34;1\u0026#34;, \u0026#34;0\u0026#34;, \u0026#34;T\u0026#34;} intBoolArray := [3]int{1, 0, 22} fmt.Println(cast.ToBoolSlice(stringBoolSlice)) // /*[true false true false true]*/ fmt.Println(cast.ToBoolSlice(intBoolArray)) // [true false true] } # è½¬ä¸ºmap[string]Typeç±»å‹ caståº“èƒ½å°†ä¼ å…¥çš„å‚æ•°è½¬ä¸ºmap[string]Typeç±»å‹ï¼ŒTypeä¸ºä¸Šé¢æ”¯æŒçš„ç±»å‹ã€‚\nå…¶å®åªéœ€è¦åˆ†æä¸€ä¸ªToStringMapStringEå‡½æ•°å°±å¯ä»¥äº†ï¼Œå…¶ä»–çš„å®ç°åŸºæœ¬ä¸€æ ·ã€‚ToStringMapStringEè¿”å›map[string]stringç±»å‹çš„å€¼ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 func ToStringMapStringE(i interface{}) (map[string]string, error) { var m = map[string]string{} switch v := i.(type) { case map[string]string: return v, nil case map[string]interface{}: for k, val := range v { m[ToString(k)] = ToString(val) } return m, nil case map[interface{}]string: for k, val := range v { m[ToString(k)] = ToString(val) } return m, nil case map[interface{}]interface{}: for k, val := range v { m[ToString(k)] = ToString(val) } return m, nil case string: err := jsonStringToObject(v, \u0026amp;m) return m, err default: return m, fmt.Errorf(\u0026#34;unable to cast %#v of type %T to map[string]string\u0026#34;, i, i) } } æ ¹æ®ä¼ å…¥çš„å‚æ•°ç±»å‹ï¼š\nå¦‚æœæ˜¯map[string]stringï¼Œä¸ç”¨è½¬æ¢ï¼Œç›´æ¥è¿”å›ï¼› å¦‚æœæ˜¯map[string]interface{}ï¼Œå°†æ¯ä¸ªå€¼è½¬ä¸ºstringå­˜å…¥æ–°çš„ mapï¼Œæœ€åè¿”å›æ–°çš„ mapï¼› å¦‚æœæ˜¯map[interface{}]stringï¼Œå°†æ¯ä¸ªé”®è½¬ä¸ºstringå­˜å…¥æ–°çš„ mapï¼Œæœ€åè¿”å›æ–°çš„ mapï¼› å¦‚æœæ˜¯map[interface{}]interface{}ï¼Œå°†æ¯ä¸ªé”®å’Œå€¼éƒ½è½¬ä¸ºstringå­˜å…¥æ–°çš„ mapï¼Œæœ€åè¿”å›æ–°çš„ mapï¼› å¦‚æœæ˜¯stringç±»å‹ï¼Œcastå°†å®ƒçœ‹æˆä¸€ä¸ª JSON ä¸²ï¼Œè§£æè¿™ä¸ª JSON åˆ°map[string]stringï¼Œç„¶åè¿”å›ç»“æœï¼› å…¶ä»–æƒ…å†µï¼Œè¿”å›é”™è¯¯ã€‚ è½¬æ¢ä¸ºæ˜ å°„ç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/spf13/cast\u0026#34; ) func main() { m1 := map[string]string{ \u0026#34;name\u0026#34;: \u0026#34;apple\u0026#34;, \u0026#34;job\u0026#34;: \u0026#34;developer\u0026#34;, } m2 := map[string]interface{}{ \u0026#34;name\u0026#34;: \u0026#34;banana\u0026#34;, \u0026#34;age\u0026#34;: 18, } m3 := map[interface{}]string{ \u0026#34;name\u0026#34;: \u0026#34;orange\u0026#34;, \u0026#34;job\u0026#34;: \u0026#34;designer\u0026#34;, } m4 := map[any]interface{}{ \u0026#34;name\u0026#34;: \u0026#34;strawberry\u0026#34;, \u0026#34;age\u0026#34;: 29, 18: \u0026#34;hi\u0026#34;, } jsonStr := `{\u0026#34;name\u0026#34;:\u0026#34;bibi\u0026#34;, \u0026#34;job\u0026#34;:\u0026#34;manager\u0026#34;}` fmt.Println(cast.ToStringMapString(m1)) // map[job:developer name:apple] fmt.Println(cast.ToStringMapString(m2)) // map[age:18 name:banana] fmt.Println(cast.ToStringMapString(m3)) // map[job:designer name:orange] fmt.Println(cast.ToStringMapString(m4)) // map[18:hi age:29 name:strawberry] fmt.Println(cast.ToStringMapString(jsonStr)) // map[job:manager name:bibi] } # æ€»ç»“ caståº“èƒ½åœ¨å‡ ä¹æ‰€æœ‰å¸¸è§ç±»å‹ä¹‹é—´è½¬æ¢ï¼Œä½¿ç”¨éå¸¸æ–¹ä¾¿ã€‚ä»£ç é‡ä¹Ÿå¾ˆå°ï¼Œæœ‰æ—¶é—´å»ºè®®è¯»è¯»æºç ã€‚å¸¸ç”¨äºè§£æé…ç½®æ•°æ®ã€‚\n# å‚è€ƒ cast GitHub ä»“åº“ åŸä½œè€…ï¼šGo æ¯æ—¥ä¸€åº“ä¹‹ cast ","date":"2024-05-11T18:45:59+08:00","permalink":"https://arlettebrook.github.io/p/cast-introduction/","title":"Cast Introduction"},{"content":" Logrus æ˜¯ç›®å‰ GitHub ä¸Š Star æ•°é‡æœ€å¤šçš„ Go æ—¥å¿—åº“ã€‚å°½ç®¡ç›®å‰ Logrus å¤„äºç»´æŠ¤æ¨¡å¼ï¼Œä¸å†å¼•å…¥æ–°åŠŸèƒ½ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€å®ƒå·²ç»æ­»äº†ã€‚Logrus ä»å°†ç»§ç»­ç»´æŠ¤ï¼Œä»¥ç¡®ä¿å®‰å…¨æ€§ã€é”™è¯¯ä¿®å¤å’Œæé«˜æ€§èƒ½ã€‚ä½œä¸º Go ç¤¾åŒºä¸­æœ€å—æ¬¢è¿çš„æ—¥å¿—åº“ä¹‹ä¸€ï¼ŒLogrus æœ€å¤§çš„è´¡çŒ®æ˜¯æ¨åŠ¨äº† Go ç¤¾åŒºå¹¿æ³›ä½¿ç”¨ç»“æ„åŒ–ï¼ˆå¦‚JSONæ ¼å¼)çš„æ—¥å¿—è®°å½•ã€‚è‘—åçš„ Docker é¡¹ç›®å°±åœ¨ä½¿ç”¨ Logrus è®°å½•æ—¥å¿—ï¼Œè¿™è¿›ä¸€æ­¥è¯æ˜äº†å…¶åœ¨å®é™…åº”ç”¨ä¸­çš„å¯é æ€§å’Œå®ç”¨æ€§ã€‚\n# ç‰¹ç‚¹ Logrus å…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š\nä¸ Go log æ ‡å‡†åº“ API å®Œå…¨å…¼å®¹ï¼Œè¿™æ„å‘³ç€ä»»ä½•ä½¿ç”¨ log æ ‡å‡†åº“çš„ä»£ç éƒ½å¯ä»¥å°†æ—¥å¿—åº“æ— ç¼åˆ‡æ¢åˆ° Logrusã€‚ æ”¯æŒä¸ƒç§æ—¥å¿—çº§åˆ«ï¼šTraceã€Debugã€Infoã€Warnã€Errorã€Fatalã€Panicã€‚ æ”¯æŒç»“æ„åŒ–æ—¥å¿—è®°å½•ï¼ˆkey-value å½¢å¼ï¼Œå®¹æ˜“è¢«ç¨‹åºè§£æï¼Œå¦‚ JSON æ ¼å¼ï¼‰ï¼Œé€šè¿‡ Filed æœºåˆ¶è¿›è¡Œç»“æ„åŒ–çš„æ—¥å¿—è®°å½•ã€‚ æ”¯æŒè‡ªå®šä¹‰æ—¥å¿—æ ¼å¼ï¼Œå†…ç½®ä¸¤ç§æ ¼å¼ JSONFormatterï¼ˆJSON æ ¼å¼ï¼‰ å’Œ TextFormatterï¼ˆæ–‡æœ¬æ ¼å¼ï¼‰ï¼Œå¹¶å…è®¸ç”¨æˆ·é€šè¿‡å®ç° Formatter æ¥å£æ¥è‡ªå®šä¹‰æ—¥å¿—æ ¼å¼ã€‚ æ”¯æŒå¯æ‰©å±•çš„ Hooks æœºåˆ¶ï¼Œå¯ä»¥ä¸ºä¸åŒçº§åˆ«çš„æ—¥å¿—æ·»åŠ  Hooks å°†æ—¥å¿—è®°å½•åˆ°ä¸åŒä½ç½®ï¼Œä¾‹å¦‚å°† Errorã€Fatal å’Œ Panic çº§åˆ«çš„é”™è¯¯æ—¥å¿—å‘é€åˆ° logstashã€kafka ç­‰ã€‚ æ”¯æŒåœ¨æ§åˆ¶å°è¾“å‡ºå¸¦æœ‰ä¸åŒé¢œè‰²çš„æ—¥å¿—ã€‚ å¹¶å‘å®‰å…¨ã€‚ # å¿«é€Ÿä½¿ç”¨ ç¬¬ä¸‰æ–¹åº“éœ€è¦å…ˆå®‰è£…ï¼š\n1 $ go get -u github.com/sirupsen/logrus åä½¿ç”¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 package main import ( \u0026#34;github.com/sirupsen/logrus\u0026#34; ) func main() { logrus.SetLevel(logrus.TraceLevel) logrus.Trace(\u0026#34;trace msg\u0026#34;) logrus.Debug(\u0026#34;debug msg\u0026#34;) logrus.Info(\u0026#34;info msg\u0026#34;) logrus.Warn(\u0026#34;warn msg\u0026#34;) logrus.Error(\u0026#34;error msg\u0026#34;) logrus.Fatal(\u0026#34;fatal msg\u0026#34;) logrus.Panic(\u0026#34;panic msg\u0026#34;) } logrusçš„ä½¿ç”¨éå¸¸ç®€å•ï¼Œä¸æ ‡å‡†åº“logç±»ä¼¼ã€‚logrusæ”¯æŒæ›´å¤šçš„æ—¥å¿—çº§åˆ«ï¼š\nPanicï¼šè®°å½•æ—¥å¿—ï¼Œç„¶åpanicã€‚ Fatalï¼šè‡´å‘½é”™è¯¯ï¼Œå‡ºç°é”™è¯¯æ—¶ç¨‹åºæ— æ³•æ­£å¸¸è¿è½¬ã€‚è¾“å‡ºæ—¥å¿—åï¼Œç¨‹åºé€€å‡ºï¼› Errorï¼šé”™è¯¯æ—¥å¿—ï¼Œéœ€è¦æŸ¥çœ‹åŸå› ï¼› Warnï¼šè­¦å‘Šä¿¡æ¯ï¼Œæé†’ç¨‹åºå‘˜æ³¨æ„ï¼› Infoï¼šå…³é”®æ“ä½œï¼Œæ ¸å¿ƒæµç¨‹çš„æ—¥å¿—ï¼› Debugï¼šä¸€èˆ¬ç¨‹åºä¸­è¾“å‡ºçš„è°ƒè¯•ä¿¡æ¯ï¼› Traceï¼šå¾ˆç»†ç²’åº¦çš„ä¿¡æ¯ï¼Œä¸€èˆ¬ç”¨ä¸åˆ°ï¼› æ—¥å¿—çº§åˆ«ä»ä¸Šå‘ä¸‹ä¾æ¬¡å‡å°ï¼ŒTraceæœ€å°ï¼ŒPanicæœ€å¤§ã€‚logrusæœ‰ä¸€ä¸ªæ—¥å¿—çº§åˆ«ï¼Œä½äºè¿™ä¸ªçº§åˆ«çš„æ—¥å¿—ä¸ä¼šè¾“å‡ºã€‚ é»˜è®¤çš„çº§åˆ«ä¸ºInfoLevelã€‚æ‰€ä»¥ä¸ºäº†èƒ½çœ‹åˆ°Traceå’ŒDebugæ—¥å¿—ï¼Œæˆ‘ä»¬åœ¨mainå‡½æ•°ç¬¬ä¸€è¡Œè®¾ç½®æ—¥å¿—çº§åˆ«ä¸ºTraceLevelã€‚\nè¿è¡Œç¨‹åºï¼Œéæ ‡å‡†TTYè¾“å‡ºï¼š\n1 2 3 4 5 6 7 8 $ go run main.go time=\u0026#34;2024-05-09T11:31:42+08:00\u0026#34; level=trace msg=\u0026#34;trace msg\u0026#34; time=\u0026#34;2024-05-09T11:31:42+08:00\u0026#34; level=debug msg=\u0026#34;debug msg\u0026#34; time=\u0026#34;2024-05-09T11:31:42+08:00\u0026#34; level=info msg=\u0026#34;info msg\u0026#34; time=\u0026#34;2024-05-09T11:31:42+08:00\u0026#34; level=warning msg=\u0026#34;warn msg\u0026#34; time=\u0026#34;2024-05-09T11:31:42+08:00\u0026#34; level=error msg=\u0026#34;error msg\u0026#34; time=\u0026#34;2024-05-09T11:31:42+08:00\u0026#34; level=fatal msg=\u0026#34;fatal msg\u0026#34; exit status 1 logrusé»˜è®¤è¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯ã€‚æ ¼å¼æ˜¯æ–‡æœ¬æ ¼å¼ï¼Œå³é»˜è®¤çš„Formatteræ˜¯TextFormatterã€‚\nè¿˜æœ‰é»˜è®¤æƒ…å†µä¸‹ï¼Œlog.SetFormatter(\u0026amp;log.TextFormatter{})ï¼ˆå³é»˜è®¤çš„TextFormatterï¼‰æœªè¿æ¥ TTY æ—¶ï¼Œè¾“å‡ºä¸ logfmtæ ¼å¼å…¼å®¹ï¼ˆå°±æ˜¯ä¸Šé¢è¾“å‡ºçš„æ ¼å¼ï¼‰ã€‚å½“è¿æ¥TTYæ—¶,ä¼šå¯¹è¾“å‡ºçš„æ—¥å¿—è¿›è¡Œé¢œè‰²ç¼–ç ï¼Œå‚è€ƒå®˜æ–¹å›¾ç‰‡:\nä¸ºäº†ç¡®ä¿å³ä½¿è¿æ¥äº† TTY ä¹Ÿèƒ½å®ç°ä¸å¸¦é¢œè‰²è¾“å‡ºï¼Œè¯·æŒ‰å¦‚ä¸‹æ–¹å¼è®¾ç½®æ ¼å¼åŒ–ç¨‹åºï¼š\n1 2 3 logrus.SetFormatter(\u0026amp;log.TextFormatter{ DisableColors: true, }) å¦‚æœè¿æ¥äº†TTYæ²¡æœ‰å®ç°é¢œè‰²è¾“å‡ºï¼ˆåŸå› ä¹‹ä¸€ï¼šéæ ‡å‡†TTYã€è‡ªå®šä¹‰çš„Formatterç­‰)ï¼Œéœ€è¦é¢œè‰²è¾“å‡ºï¼Œè¯·æŒ‰å¦‚ä¸‹æ–¹å¼è®¾ç½®æ ¼å¼åŒ–ç¨‹åºï¼š\n1 2 3 4 logrus.SetFormatter(\u0026amp;logrus.TextFormatter{ ForceColors: true, // å¼ºåˆ¶è¾“å‡ºé¢œè‰²ï¼ŒåŸç†ï¼šç»•è¿‡TTYæ£€æŸ¥ã€‚ FullTimestamp: true, // æ˜¾ç¤ºå®Œæ•´çš„æ—¶é—´æˆ³ }) å½“ç»•è¿‡TTYæ£€æŸ¥æ—¶ä¼šä¸¢å¤±æ—¥æœŸæ—¶é—´ï¼Œæ·»åŠ FullTimestamp: true,å³å¯æ­£å¸¸æ˜¾ç¤ºã€‚\nåé¢ä¼šä»‹ç»æ›´å¤šæ ¼å¼åŒ–å™¨ã€‚\nç”±äºlogrus.Fatalä¼šå¯¼è‡´ç¨‹åºé€€å‡ºï¼Œä¸‹é¢çš„logrus.Panicä¸ä¼šæ‰§è¡Œåˆ°ã€‚\nå¦å¤–ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°è¾“å‡ºä¸­æœ‰ä¸‰ä¸ªå…³é”®ä¿¡æ¯ï¼Œtimeã€levelå’Œmsgï¼š\ntimeï¼šè¾“å‡ºæ—¥å¿—çš„æ—¶é—´ï¼›ä¸ºæœ¬åœ°åŒºæ ‡å‡†æ—¶é—´ã€‚ è¡¥å……ï¼š+08:00ä¸ºåŒ—äº¬æ ‡å‡†æ—¶é—´ï¼Œæ”¹ä¸ºZä¸ºUTCï¼ˆä¸–ç•Œæ ‡å‡†æ—¶é—´ï¼Œé›¶æ—¶åŒºæ—¶é—´ï¼‰ Tä¸ºæ—¥æœŸä¸æ—¶é—´çš„åˆ†éš”ç¬¦ã€‚æ˜¯ISOå®šåˆ¶çš„ä¸€ç§æ ‡å‡†æ—¥æœŸæ—¶é—´çš„è¡¨ç¤ºæ–¹å¼ã€‚ levelï¼šæ—¥å¿—çº§åˆ«ï¼› msgï¼šæ—¥å¿—ä¿¡æ¯ã€‚ # ä½¿ç”¨ # æ›¿ä»£ Go log æ ‡å‡†åº“ åœ¨æ·±å…¥æ¢ç©¶ Go log æ ‡å‡†åº“ä¸€æ–‡ä¸­ä¸¾è¿‡ä¸€ä¸ªä½¿ç”¨ Go log æ ‡å‡†åº“çš„ç®€å•ç¤ºä¾‹ï¼Œç°åœ¨å¯ä»¥å°†å…¶æ— ç¼åˆ‡æ¢åˆ° Logrusï¼Œåªéœ€è¦æŠŠ import \u0026quot;log\u0026quot; æ”¹æˆ import log \u0026quot;github.com/sirupsen/logrus\u0026quot; å³å¯å®ç°ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 package main // æ›¿ä»£ import \u0026#34;log\u0026#34; import ( log \u0026#34;github.com/sirupsen/logrus\u0026#34; ) func main() { log.Print(\u0026#34;Print\u0026#34;) log.Printf(\u0026#34;Printf: %s\u0026#34;, \u0026#34;print\u0026#34;) log.Println(\u0026#34;Println\u0026#34;) log.Fatal(\u0026#34;Fatal\u0026#34;) log.Fatalf(\u0026#34;Fatalf: %s\u0026#34;, \u0026#34;fatal\u0026#34;) log.Fatalln(\u0026#34;Fatalln\u0026#34;) log.Panic(\u0026#34;Panic\u0026#34;) log.Panicf(\u0026#34;Panicf: %s\u0026#34;, \u0026#34;panic\u0026#34;) log.Panicln(\u0026#34;Panicln\u0026#34;) } æ‰§è¡Œä»¥ä¸Šä»£ç ï¼Œå¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š\n1 2 3 4 5 6 $ go run main.go time=\u0026#34;2024-05-09T14:13:43+08:00\u0026#34; level=info msg=Print time=\u0026#34;2024-05-09T14:13:43+08:00\u0026#34; level=info msg=\u0026#34;Printf: print\u0026#34; time=\u0026#34;2024-05-09T14:13:43+08:00\u0026#34; level=info msg=Println time=\u0026#34;2024-05-09T14:13:43+08:00\u0026#34; level=fatal msg=Fatal exit status 1 è™½ç„¶è¾“å‡ºæ ¼å¼ä¸ä½¿ç”¨ Go log æ ‡å‡†åº“è¡¨ç°ç•¥æœ‰ä¸åŒï¼Œä½†ç¨‹åºæ‰§è¡Œå¹¶ä¸ä¼šæŠ¥é”™ï¼Œè¯´æ˜äºŒè€…å®Œå…¨å…¼å®¹ã€‚\n# åŸºæœ¬ä½¿ç”¨ # ä¿®æ”¹æ—¥å¿—çº§åˆ« è°ƒç”¨logrus.SetLevel(level Level)ï¼Œå°±å¯ä»¥ä¿®æ”¹æ—¥å¿—çº§åˆ«ã€‚\nlogrusé»˜è®¤çš„textè®°å½•å™¨æ—¥å¿—çº§åˆ«æ˜¯InfoLevelã€‚è¦æƒ³è¦è¾“å‡ºinfoä»¥ä¸‹çº§åˆ«çš„æ—¥å¿—ï¼Œå°±å¿…é¡»ä¿®æ”¹ã€‚\nå¦‚\n1 logrus.SetLevel(logrus.TraceLevel) levelå¯é€‰æ‹©ç±»å‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 // logrus/logrus.go const ( // PanicLevel level, highest level of severity. Logs and then calls panic with the // message passed to Debug, Info, ... PanicLevel Level = iota // FatalLevel level. Logs and then calls `logger.Exit(1)`. It will exit even if the // logging level is set to Panic. FatalLevel // ErrorLevel level. Logs. Used for errors that should definitely be noted. // Commonly used for hooks to send errors to an error tracking service. ErrorLevel // WarnLevel level. Non-critical entries that deserve eyes. WarnLevel // InfoLevel level. General operational entries about what\u0026#39;s going on inside the // application. InfoLevel // DebugLevel level. Usually only enabled when debugging. Very verbose logging. DebugLevel // TraceLevel level. Designates finer-grained informational events than the Debug. TraceLevel ) # è¾“å‡ºè°ƒç”¨ä¿¡æ¯ è°ƒç”¨logrus.SetReportCaller(true)ï¼Œä¼šåœ¨è¾“å‡ºæ—¥å¿—ä¸­æ·»åŠ æ–¹æ³•ã€æ–‡ä»¶ä»¥åŠè¡Œå·ä¿¡æ¯ï¼š\n1 2 3 4 5 6 7 8 9 10 11 package main import ( \u0026#34;github.com/sirupsen/logrus\u0026#34; ) func main() { logrus.SetReportCaller(true) logrus.Info(\u0026#34;info msg\u0026#34;) } è¾“å‡ºå¤šäº†ä¸¤ä¸ªå­—æ®µï¼šfuncä¸ºå‡½æ•°åï¼Œfileä¸ºè°ƒç”¨logrusç›¸å…³æ–¹æ³•çš„æ–‡ä»¶åä»¥åŠè¡Œå·ï¼š\n1 2 3 $ go run main.go time=\u0026#34;2024-05-09T14:26:00+08:00\u0026#34; level=info msg=\u0026#34;info msg\u0026#34; func=main.main file=\u0026#34;F:/GoProject/learn /main.go:10\u0026#34; # æ·»åŠ å­—æ®µ Logrus é¼“åŠ±ç”¨æˆ·é€šè¿‡æ—¥å¿—å­—æ®µè®°å½•ç»“æ„åŒ–æ—¥å¿—ï¼Œå¯ä»¥ä½¿ç”¨ WithFields å’Œ WithField ä¸¤ç§å½¢å¼ï¼Œå¹¶ä¸”å¯ä»¥é“¾å¼è°ƒç”¨ã€‚\nå°½é‡åˆ«ç”¨logrus.Fatalf(\u0026quot;Failed to send event %s to topic %s with key %d\u0026quot;) è¿™ç§çº¯æ–‡æœ¬å½¢å¼ï¼Œå› ä¸ºç»“æ„åŒ–æ—¥å¿—æœ‰åˆ©äºå·¥å…·æå–å¹¶åˆ†ææ—¥å¿—ã€‚\næœ‰æ—¶å€™éœ€è¦åœ¨è¾“å‡ºä¸­æ·»åŠ ä¸€äº›å­—æ®µï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨logrus.WithFieldï¼ˆæ¥æ”¶å•ä¸ªå­—æ®µï¼‰å’Œlogrus.WithFieldsï¼ˆæ¥æ”¶å¤šä¸ªå­—æ®µï¼‰å®ç°ã€‚ logrus.WithFieldsæ¥å—ä¸€ä¸ªlogrus.Fieldsç±»å‹çš„å‚æ•°ï¼Œå…¶åº•å±‚å®é™…ä¸Šä¸ºmap[string]interface{}ï¼š\n1 2 // github.com/sirupsen/logrus/logrus.go type Fields map[string]interface{} äºŒè€…éƒ½å¯ä»¥é“¾å¼è°ƒç”¨ï¼Œä¼šè¿”å›ä¸€ä¸ªæŒ‡å‘Entryç±»å‹çš„ç»“æ„ä½“ï¼ˆæ—¥å¿—æ¡ç›®logrus.Entryï¼‰ï¼Œè¯¥ç»“æ„ä½“ç»‘å®šäº†å„ç§çº§åˆ«çš„æ—¥å¿—æ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 package main import ( \u0026#34;github.com/sirupsen/logrus\u0026#34; ) func main() { logrus. WithField(\u0026#34;name\u0026#34;, \u0026#34;arlettebrook\u0026#34;). WithField(\u0026#34;age\u0026#34;, 18). Info(\u0026#34;WithFiled\u0026#34;) logrus.WithFields(logrus.Fields{ \u0026#34;name\u0026#34;: \u0026#34;arlettebrook\u0026#34;, \u0026#34;age\u0026#34;: 18, }).Info(\u0026#34;WithFields\u0026#34;) } è¿è¡Œè¾“å‡ºï¼š\n1 2 3 $ go run main.go time=\u0026#34;2024-05-09T15:22:24+08:00\u0026#34; level=info msg=WithFiled age=18 name=arlettebrook time=\u0026#34;2024-05-09T15:22:24+08:00\u0026#34; level=info msg=WithFields age=18 name=arlettebrook é»˜è®¤å­—æ®µï¼šå¦‚æœåœ¨ä¸€ä¸ªå‡½æ•°ä¸­çš„æ‰€æœ‰æ—¥å¿—éƒ½éœ€è¦æ·»åŠ æŸäº›å­—æ®µï¼Œå¯ä»¥ä½¿ç”¨WithFieldsçš„è¿”å›çš„*Entryæ›¿æ¢logrusã€‚è¿™æ ·åç»­è¾“å‡ºéƒ½ä¼šåŒ…å«æŒ‡å®šå­—æ®µï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 package main import \u0026#34;github.com/sirupsen/logrus\u0026#34; func main() { withFieldsLog := logrus.WithFields(logrus.Fields{ \u0026#34;name\u0026#34;: \u0026#34;arlettebrook\u0026#34;, \u0026#34;age\u0026#34;: 18, }) withFieldsLog.Error(\u0026#34;error msg\u0026#34;) withFieldsLog.Info(\u0026#34;info msg\u0026#34;) } è¿è¡Œè¾“å‡ºï¼š\n1 2 3 $ go run main.go time=\u0026#34;2024-05-09T15:37:56+08:00\u0026#34; level=error msg=\u0026#34;error msg\u0026#34; age=18 name=arlettebrook time=\u0026#34;2024-05-09T15:37:56+08:00\u0026#34; level=info msg=\u0026#34;info msg\u0026#34; age=18 name=arlettebrook ä½¿ç”¨åŒä¸€ä¸ªlogrus.Entryè°ƒä¸åŒçº§åˆ«çš„æ—¥å¿—æ–¹æ³•ï¼Œå³å¯å®ç°æºå¸¦ç›¸åŒçš„å­—æ®µï¼ˆé»˜è®¤å­—æ®µï¼‰ã€‚\næ³¨æ„ï¼šé»˜è®¤å­—æ®µä¹Ÿæ”¯æŒé“¾å¼è°ƒç”¨ã€‚\n# é‡å®šå‘è¾“å‡º é»˜è®¤æƒ…å†µä¸‹ï¼Œæ—¥å¿—è¾“å‡ºåˆ°io.Stderrã€‚å¯ä»¥è°ƒç”¨logrus.SetOutputä¼ å…¥ä¸€ä¸ªio.Writerå‚æ•°ã€‚åç»­è°ƒç”¨ç›¸å…³æ–¹æ³•æ—¥å¿—å°†å†™åˆ°io.Writerä¸­ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬å°±èƒ½åƒä»‹ç»logæ—¶ä¸€æ ·ï¼Œå¯ä»¥æç‚¹äº‹æƒ…äº†ã€‚ä¼ å…¥ä¸€ä¸ªio.MultiWriterï¼Œ åŒæ—¶å°†æ—¥å¿—å†™åˆ°bytes.Bufferã€æ ‡å‡†è¾“å‡ºå’Œæ–‡ä»¶ä¸­ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 package main import ( \u0026#34;bytes\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;io\u0026#34; \u0026#34;log\u0026#34; \u0026#34;os\u0026#34; \u0026#34;github.com/sirupsen/logrus\u0026#34; ) func main() { writer1 := bytes.NewBuffer(nil) writer2 := os.Stdout writer3, err := os.OpenFile(\u0026#34;./log.txt\u0026#34;, os.O_WRONLY|os.O_CREATE, 0755) defer func(writer3 *os.File) { err := writer3.Close() if err != nil { log.Fatal(err) } }(writer3) if err != nil { log.Fatalf(\u0026#34;create file log.txt failed: %v\u0026#34;, err) } logrus.SetOutput(io.MultiWriter(writer1, writer2, writer3)) logrus.Info(\u0026#34;info msg\u0026#34;) fmt.Println(\u0026#34;Buffer:\u0026#34;, writer1.String()) } è¿è¡Œï¼Œä¼šåœ¨æ–‡ä»¶log.txtå’Œæ§åˆ¶å°è¾“å‡ºæ—¥å¿—ã€‚\n# å¤„ç†ä¸åŒç¯å¢ƒ Logrus å¹¶æ²¡æœ‰åƒ zap é‚£æ ·æä¾›ç°æˆçš„ API æ¥æ”¯æŒåœ¨ä¸åŒçš„ç¯å¢ƒä¸‹ä½¿ç”¨ï¼ˆProduction å’Œ Developmentï¼‰ï¼Œå¦‚æœä½ æƒ³åœ¨ç”Ÿäº§å’Œæµ‹è¯•ç¯å¢ƒä½¿ç”¨ä¸åŒçš„æ ¼å¼è¾“å‡ºæ—¥å¿—ï¼Œåˆ™éœ€è¦é€šè¿‡ä»£ç åˆ¤æ–­åœ¨ä¸åŒç¯å¢ƒè®¾ç½®ä¸åŒçš„ Formatter æ¥å®ç°ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 package main import ( \u0026#34;os\u0026#34; nested \u0026#34;github.com/antonfisher/nested-logrus-formatter\u0026#34; \u0026#34;github.com/sirupsen/logrus\u0026#34; ) func init() { // å‡è®¾ç¯å¢ƒå˜é‡APP_ENVå·²ç»è¢«è®¾ç½® env := os.Getenv(\u0026#34;APP_ENV\u0026#34;) // æ ¹æ®ç¯å¢ƒè®¾ç½®æ—¥å¿—çº§åˆ« switch env { case \u0026#34;development\u0026#34;: // åœ¨å¼€å‘ç¯å¢ƒä¸­æ˜¾ç¤ºæ‰€æœ‰æ—¥å¿— logrus.SetLevel(logrus.DebugLevel) logrus.SetFormatter(\u0026amp;nested.Formatter{}) case \u0026#34;testing\u0026#34;: // åœ¨æµ‹è¯•ç¯å¢ƒä¸­åªæ˜¾ç¤ºè­¦å‘Šå’Œé”™è¯¯æ—¥å¿— logrus.SetLevel(logrus.WarnLevel) case \u0026#34;production\u0026#34;: // åœ¨ç”Ÿäº§ç¯å¢ƒä¸­åªæ˜¾ç¤ºé”™è¯¯æ—¥å¿— logrus.SetLevel(logrus.ErrorLevel) logrus.SetFormatter(\u0026amp;logrus.JSONFormatter{}) default: // é»˜è®¤æƒ…å†µä¸‹ï¼Œæ˜¾ç¤ºæ‰€æœ‰æ—¥å¿— logrus.SetLevel(logrus.DebugLevel) logrus.SetFormatter(\u0026amp;nested.Formatter{}) } // ä½ è¿˜å¯ä»¥è®¾ç½®æ—¥å¿—æ ¼å¼ã€è¾“å‡ºä½ç½®ç­‰ // ... } func main() { logrus.Error(\u0026#34;error log\u0026#34;) logrus.Warn(\u0026#34;warn log\u0026#34;) logrus.Info(\u0026#34;info log\u0026#34;) logrus.Debug(\u0026#34;debug log\u0026#34;) } è¿è¡Œè¾“å‡ºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 $ go run main.go May 11 15:31:46.122 [ERRO] error log May 11 15:31:46.168 [WARN] warn log May 11 15:31:46.168 [INFO] info log May 11 15:31:46.169 [DEBU] debug log $ app_env=production go run main.go {\u0026#34;level\u0026#34;:\u0026#34;error\u0026#34;,\u0026#34;msg\u0026#34;:\u0026#34;error log\u0026#34;,\u0026#34;time\u0026#34;:\u0026#34;2024-05-11T15:31:53+08:00\u0026#34;} $ app_env=development go run main.go May 11 15:32:05.563 [ERRO] error log May 11 15:32:05.609 [WARN] warn log May 11 15:32:05.609 [INFO] info log May 11 15:32:05.609 [DEBU] debug log # æµ‹è¯• å¦‚æœä½ çš„å•å…ƒæµ‹è¯•ç¨‹åºä¸­éœ€è¦æµ‹è¯•æ—¥å¿—å†…å®¹ï¼ŒLogrus æä¾›äº† test.NewNullLogger æ—¥å¿—è®°å½•å™¨ï¼Œå®ƒåªä¼šè®°å½•æ—¥å¿—ï¼Œä¸è¾“å‡ºä»»ä½•å†…å®¹ã€‚ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 package main import ( \u0026#34;testing\u0026#34; \u0026#34;github.com/sirupsen/logrus\u0026#34; \u0026#34;github.com/sirupsen/logrus/hooks/test\u0026#34; \u0026#34;github.com/stretchr/testify/assert\u0026#34; ) func TestLogrus(t *testing.T) { logger, hook := test.NewNullLogger() logger.Error(\u0026#34;Hello error\u0026#34;) assert.Equal(t, 1, len(hook.Entries)) assert.Equal(t, logrus.ErrorLevel, hook.LastEntry().Level) assert.Equal(t, \u0026#34;Hello error\u0026#34;, hook.LastEntry().Message) hook.Reset() assert.Nil(t, hook.LastEntry()) } ç¬¬äºŒä¸ªè¿”å›å€¼æ˜¯ä¸€ä¸ªç»“æ„ä½“:\n1 2 3 4 5 6 7 type Hook struct { // Entries is an array of all entries that have been received by this hook. // For safe access, use the AllEntries() method, rather than reading this // value directly. Entries []logrus.Entry // æ¡ç›®åˆ‡ç‰‡ mu sync.RWMutex } æ–¹æ³•LastEntry()è¿”å›Entriesçš„æœ€åä¸€æ¡æ—¥å¿—æ¡ç›®å¯¹è±¡ã€‚\nè¿è¡Œè¾“å‡ºï¼š\n1 2 3 4 5 $ go test -run TestLogrus -v === RUN TestLogrus --- PASS: TestLogrus (0.07s) PASS ok github.com/arlettebrook/learn 0.643s # è‡ªå®šä¹‰ Logger é™¤äº†é€šè¿‡ logrus.Info(\u0026quot;Info msg\u0026quot;) è¿™ç§å¼€ç®±å³ç”¨çš„æ–¹å¼ä½¿ç”¨ Logrus é»˜è®¤çš„ Loggerï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰ Loggerã€‚\n**å®é™…ä¸Šï¼Œè€ƒè™‘åˆ°æ˜“ç”¨æ€§ï¼Œåº“ä¸€èˆ¬ä¼šä½¿ç”¨é»˜è®¤å€¼åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…æœ€å¤–å±‚çš„æ–¹æ³•ä¸€èˆ¬éƒ½æ˜¯æ“ä½œè¿™ä¸ªé»˜è®¤å¯¹è±¡ã€‚**ç”¨åˆ°çš„è®¾è®¡æ¨¡å¼æ˜¯å•ä¾‹æ¨¡å¼ã€‚\næˆ‘ä»¬ä¹‹å‰å¥½å‡ ç¯‡æ–‡ç« éƒ½æåˆ°è¿‡è¿™ç‚¹ï¼š\nflagæ ‡å‡†åº“ä¸­çš„CommandLineå¯¹è±¡ï¼› logæ ‡å‡†åº“ä¸­çš„stdå¯¹è±¡ã€‚ è¿™ä¸ªæŠ€å·§åº”ç”¨åœ¨å¾ˆå¤šåº“çš„å¼€å‘ä¸­ï¼Œlogrusä¹Ÿæ˜¯å¦‚æ­¤ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 // github.com/sirupsen/logrus/exported.go var ( // std is the name of the standard logger in stdlib `log` std = New() ) func New() *Logger { return \u0026amp;Logger{ Out: os.Stderr, Formatter: new(TextFormatter), Hooks: make(LevelHooks), Level: InfoLevel, ExitFunc: os.Exit, ReportCaller: false, } } func StandardLogger() *Logger { return std } // SetOutput sets the standard logger output. func SetOutput(out io.Writer) { std.SetOutput(out) } // SetFormatter sets the standard logger formatter. func SetFormatter(formatter Formatter) { std.SetFormatter(formatter) } // SetReportCaller sets whether the standard logger will include the calling // method as a field. func SetReportCaller(include bool) { std.SetReportCaller(include) } // SetLevel sets the standard logger level. func SetLevel(level Level) { std.SetLevel(level) } é¦–å…ˆï¼Œä½¿ç”¨é»˜è®¤é…ç½®å®šä¹‰ä¸€ä¸ªLoggerå¯¹è±¡stdï¼ŒSetOutput/SetFormatter/SetReportCaller/SetLevelè¿™äº›æ–¹æ³•éƒ½æ˜¯è°ƒç”¨stdå¯¹è±¡çš„å¯¹åº”æ–¹æ³•ï¼\næˆ‘ä»¬å½“ç„¶ä¹Ÿå¯ä»¥åˆ›å»ºè‡ªå·±çš„Loggerå¯¹è±¡ï¼Œä½¿ç”¨æ–¹å¼ä¸ç›´æ¥è°ƒç”¨logrusçš„æ–¹æ³•ç±»ä¼¼ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 package main import \u0026#34;github.com/sirupsen/logrus\u0026#34; func main() { log := logrus.New() log.Info(\u0026#34;info msg\u0026#34;) // ç”¨è‡ªå®šä¹‰logger log.SetLevel(logrus.DebugLevel) log.SetFormatter(\u0026amp;logrus.JSONFormatter{}) log.Debug(\u0026#34;debug msg\u0026#34;) } New()å‡½æ•°åˆ›å»ºçš„loggerä¸é»˜è®¤çš„loggerç›¸åŒã€‚è¿è¡Œè¾“å‡ºï¼š\n1 2 3 $ go run main.go time=\u0026#34;2024-05-09T22:55:30+08:00\u0026#34; level=info msg=\u0026#34;info msg\u0026#34; {\u0026#34;level\u0026#34;:\u0026#34;debug\u0026#34;,\u0026#34;msg\u0026#34;:\u0026#34;debug msg\u0026#34;,\u0026#34;time\u0026#34;:\u0026#34;2024-05-09T22:55:30+08:00\u0026#34;} é€šè¿‡åˆ›å»ºçš„loggerå¯¹è±¡å¯ä»¥ç›´æ¥èµ‹å€¼ä¿®æ”¹Levelã€Outã€Formatterç­‰ï¼Œä¸ç”¨è°ƒå¯¹åº”çš„Setæ–¹æ³•ã€‚\n1 2 3 4 5 6 7 8 9 10 func New() *Logger { return \u0026amp;Logger{ Out: os.Stderr, Formatter: new(TextFormatter), Hooks: make(LevelHooks), Level: InfoLevel, ExitFunc: os.Exit, ReportCaller: false, } } ç¤ºä¾‹ä¿®æ”¹å¦‚ä¸‹ï¼š\n1 2 3 log.Out=os.Stdout log.Level=logrus.DebugLevel log.Formatter=\u0026amp;logrus.JSONFormatter{} æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡FieldMapå±æ€§ä¿®æ”¹é»˜è®¤å­—æ®µçš„é”®å\n1 2 type FieldMap map[fieldKey]string type fieldKey string æ”¯æŒé‡å‘½åçš„é»˜è®¤å­—æ®µfieldKeyå¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 const ( defaultTimestampFormat = time.RFC3339 FieldKeyMsg = \u0026#34;msg\u0026#34; FieldKeyLevel = \u0026#34;level\u0026#34; FieldKeyTime = \u0026#34;time\u0026#34; FieldKeyLogrusError = \u0026#34;logrus_error\u0026#34; FieldKeyFunc = \u0026#34;func\u0026#34; FieldKeyFile = \u0026#34;file\u0026#34; ) å®ä¾‹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 package main import ( \u0026#34;github.com/sirupsen/logrus\u0026#34; ) func main() { log := logrus.New() log.Formatter = \u0026amp;logrus.TextFormatter{ DisableColors: true, FieldMap: logrus.FieldMap{ logrus.FieldKeyMsg: \u0026#34;message\u0026#34;, // å°†msgæ”¹æˆmessage }, } log.Info(\u0026#34;info msg\u0026#34;) log.Level = logrus.DebugLevel log.Formatter = \u0026amp;logrus.JSONFormatter{ // ä¼šè¦†ç›–TextFormatter FieldMap: logrus.FieldMap{ logrus.FieldKeyTime: \u0026#34;TIME\u0026#34;,// å°† timeæ”¹æˆTIME }, } log.Debug(\u0026#34;debug msg\u0026#34;) } è¿è¡Œè¾“å‡ºï¼š\n1 2 3 $ go run main.go time=\u0026#34;2024-05-09T23:23:53+08:00\u0026#34; level=info message=\u0026#34;info msg\u0026#34; {\u0026#34;TIME\u0026#34;:\u0026#34;2024-05-09T23:23:53+08:00\u0026#34;,\u0026#34;level\u0026#34;:\u0026#34;debug\u0026#34;,\u0026#34;msg\u0026#34;:\u0026#34;debug msg\u0026#34;} # ä¿®æ”¹æ—¥å¿—æ ¼å¼ è°ƒç”¨logrus.SetFormatter(formatter Formatter)ï¼Œå³å¯ä¿®æ”¹æ—¥å¿—æ ¼å¼ã€‚\nlogrusæ”¯æŒä¸¤ç§æ—¥å¿—æ ¼å¼ï¼Œæ–‡æœ¬å’Œ JSONï¼Œé»˜è®¤ä¸ºæ–‡æœ¬æ ¼å¼ã€‚å¯ä»¥é€šè¿‡logrus.SetFormatterè®¾ç½®æ—¥å¿—æ ¼å¼ï¼š\nLogrus æä¾›äº† JSONFormatter å’Œ TextFormatter æ¥åˆ†åˆ«å®ç° JSON å’Œ Text æ ¼å¼çš„æ—¥å¿—è¾“å‡ºï¼Œå®ƒä»¬çš„æŒ‡é’ˆç±»å‹éƒ½å®ç°äº† Formatter æ¥å£ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªç¬¬ä¸‰æ–¹å®ç°çš„ Formatter åˆ—è¡¨å¯ä¾›é€‰æ‹©ï¼Œå¦‚æœè¿™äº›ä¾ç„¶æ— æ³•æ»¡è¶³ä½ çš„éœ€æ±‚ï¼Œåˆ™å¯ä»¥è‡ªå·±å®ç° Formatter æ¥å£å¯¹è±¡å®šåˆ¶æ—¥å¿—æ ¼å¼ã€‚\nä½¿ç”¨å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 package main import \u0026#34;github.com/sirupsen/logrus\u0026#34; func main() { logrus.Info(\u0026#34;default formatter:TextFormatter\u0026#34;) //text logrus.SetFormatter(\u0026amp;logrus.JSONFormatter{}) logrus.Info(\u0026#34;JSONFormatter\u0026#34;) //json logrus.SetFormatter(\u0026amp;logrus.TextFormatter{}) logrus.Info(\u0026#34;default formatter:TextFormatter\u0026#34;) //text } logrusé»˜è®¤çš„Formatteræ˜¯TextFormatterã€‚åœ¨éæ ‡å‡†TTYä¸­è¿è¡Œè¾“å‡ºç»“æœï¼ˆä¸å¸¦é¢œè‰²è¾“å‡ºï¼‰å¦‚ä¸‹ï¼š\n1 2 3 4 $ go run main.go time=\u0026#34;2024-05-09T22:06:29+08:00\u0026#34; level=info msg=\u0026#34;default formatter:TextFormatter\u0026#34; {\u0026#34;level\u0026#34;:\u0026#34;info\u0026#34;,\u0026#34;msg\u0026#34;:\u0026#34;JSONFormatter\u0026#34;,\u0026#34;time\u0026#34;:\u0026#34;2024-05-09T22:06:29+08:00\u0026#34;} time=\u0026#34;2024-05-09T22:06:29+08:00\u0026#34; level=info msg=\u0026#34;default formatter:TextFormatter\u0026#34; # ä½¿ç”¨ç¬¬ä¸‰æ–¹æ ¼å¼ é™¤äº†å†…ç½®çš„TextFormatterå’ŒJSONFormatterï¼Œè¿˜æœ‰ä¸å°‘ç¬¬ä¸‰æ–¹æ ¼å¼æ”¯æŒã€‚æˆ‘ä»¬è¿™é‡Œä»‹ç»ä¸€ä¸ªnested-logrus-formatterã€‚\nå…ˆå®‰è£…ï¼š\n1 $ go get -u github.com/antonfisher/nested-logrus-formatter åä½¿ç”¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;time\u0026#34; nested \u0026#34;github.com/antonfisher/nested-logrus-formatter\u0026#34; \u0026#34;github.com/sirupsen/logrus\u0026#34; ) func main() { // éæ ‡å‡†TTYï¼Œå¼ºåˆ¶è¾“å‡ºé¢œè‰² logrus.SetFormatter(\u0026amp;logrus.TextFormatter{ ForceColors: true, FullTimestamp: true, TimestampFormat: time.DateTime, }) logrus.Info(\u0026#34;info msg\u0026#34;) logrus.WithFields(logrus.Fields{ \u0026#34;username\u0026#34;: \u0026#34;arlettebrook\u0026#34;, \u0026#34;age\u0026#34;: 18, }).Warn(\u0026#34;user info\u0026#34;) fmt.Println(\u0026#34;----------------\u0026#34;) logrus.SetFormatter(\u0026amp;nested.Formatter{ HideKeys: true, TimestampFormat: time.DateTime, }) logrus.Info(\u0026#34;info msg\u0026#34;) logrus.WithFields(logrus.Fields{ \u0026#34;username\u0026#34;: \u0026#34;arlettebrook\u0026#34;, \u0026#34;age\u0026#34;: 18, }).Warn(\u0026#34;user info\u0026#34;) } ç¨‹åºè¿è¡Œè¾“å‡ºï¼š\n1 2 3 4 5 6 7 $ go run main.go INFO[2024-05-09 22:33:40] info msg WARN[2024-05-09 22:33:41] user info age=18 username=arlettebro ok ---------------- 2024-05-09 22:33:41 [INFO] info msg 2024-05-09 22:33:41 [WARN] [18] [arlettebrook] user info æ²¡æœ‰æˆªå›¾ï¼Œå‚è€ƒçš„æ˜¯å®˜æ–¹å¯¹æ¯”å›¾ç‰‡ï¼š\nnestedæ ¼å¼æä¾›äº†å¤šä¸ªå­—æ®µç”¨æ¥å®šåˆ¶è¡Œä¸ºï¼š\n1 2 3 4 5 6 7 8 9 10 // github.com/antonfisher/nested-logrus-formatter/formatter.go type Formatter struct { FieldsOrder []string TimestampFormat string HideKeys bool NoColors bool NoFieldsColors bool ShowFullLevel bool TrimMessages bool } é»˜è®¤ï¼Œlogrusè¾“å‡ºæ—¥å¿—ä¸­å­—æ®µæ˜¯key=valueè¿™æ ·çš„å½¢å¼ã€‚ä½¿ç”¨nestedæ ¼å¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®HideKeysä¸ºtrueéšè—é”®ï¼Œåªè¾“å‡ºå€¼ï¼›\nå¦‚æœä¸éšè—é”®ï¼Œç¨‹åºè¾“å‡ºï¼š\n1 2024-05-09 22:40:09 [WARN] [age:18] [username:arlettebrook] user info é»˜è®¤ï¼Œlogrusæ˜¯æŒ‰é”®çš„å­—æ¯åºè¾“å‡ºå­—æ®µï¼Œå¯ä»¥è®¾ç½®FieldsOrderå®šä¹‰è¾“å‡ºå­—æ®µé¡ºåºï¼›stringç±»å‹çš„åˆ‡ç‰‡æŒ‡å®šé¡ºåºã€‚\né€šè¿‡è®¾ç½®TimestampFormatè®¾ç½®æ—¥æœŸæ ¼å¼ã€‚å¦‚time.RFC3339ã€time.DateTimeã€‚\né€šè¿‡å®ç°æ¥å£logrus.Formatterå¯ä»¥å®ç°è‡ªå·±çš„æ ¼å¼ã€‚\n1 2 3 4 // github.com/sirupsen/logrus/formatter.go type Formatter interface { Format(*Entry) ([]byte, error) } # Hooks Hooksæœ¬è´¨æ˜¯ä¸€äº›å‡½æ•°æˆ–æ–¹æ³•ï¼Œç”¨äºä¸ä¿®æ”¹åŸä»£ç ï¼Œæ‰©å±•ç¨‹åºã€‚\nLogrus æœ€ä»¤äººå¿ƒåŠ¨çš„ä¸¤ä¸ªåŠŸèƒ½ï¼Œä¸€ä¸ªæ˜¯ç»“æ„åŒ–æ—¥å¿—ï¼Œå¦ä¸€ä¸ªå°±æ˜¯ Hooks äº†ã€‚\nHooks ä¸º Logrus æä¾›äº†æå¤§çš„çµæ´»æ€§ï¼Œé€šè¿‡ Hooks å¯ä»¥å®ç°å„ç§æ‰©å±•åŠŸèƒ½ã€‚æ¯”å¦‚å¯ä»¥é€šè¿‡ Hooks å®ç°ï¼šError ä»¥ä¸Šçº§åˆ«æ—¥å¿—å‘é€é‚®ä»¶é€šçŸ¥ã€é‡è¦æ—¥å¿—å‘Šè­¦ã€æ—¥å¿—åˆ‡å‰²ã€ç¨‹åºä¼˜é›…é€€å‡ºç­‰ï¼Œéå¸¸å®ç”¨ã€‚\nLogrus æä¾›äº† Hook æ¥å£ï¼Œåªè¦æˆ‘ä»¬å®ç°äº†è¿™ä¸ªæ¥å£ï¼Œå¹¶å°†å…¶æ³¨å†Œåˆ° Logrus ä¸­ï¼Œå°±å¯ä»¥ä½¿ç”¨ Hooks çš„å¼ºå¤§èƒ½åŠ›äº†ã€‚Hook æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š\n1 2 3 4 type Hook interface { Levels() []Level Fire(*Entry) error } Levels æ–¹æ³•è¿”å›ä¸€ä¸ªæ—¥å¿—çº§åˆ«åˆ‡ç‰‡ï¼ŒLogrus è®°å½•çš„æ—¥å¿—çº§åˆ«å¦‚æœå­˜åœ¨äºåˆ‡ç‰‡ä¸­ï¼Œåˆ™ä¼šè§¦å‘ Hooksï¼Œå³è°ƒç”¨ Fire æ–¹æ³•ã€‚\nä¸ºlogrusè®¾ç½®é’©å­ï¼ˆHooksï¼‰ï¼Œç¬¦åˆ[]Levelçš„æ—¥å¿—è¾“å‡ºå‰éƒ½ä¼šæ‰§è¡Œé’©å­çš„ç‰¹å®šæ–¹æ³•ï¼ˆFire æ–¹æ³•ï¼‰ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°æ·»åŠ è¾“å‡ºå­—æ®µã€æ ¹æ®çº§åˆ«å°†æ—¥å¿—è¾“å‡ºåˆ°ä¸åŒçš„ç›®çš„åœ°ã€‚\nå¹¶ä¸”hookå‡½æ•°ä¼šåœ¨è¾“å‡ºæ—¥å¿—ä¹‹å‰æ‰§è¡Œã€‚\nEntryæ˜¯å½“å‰æ—¥å¿—æ¡ç›®ï¼ˆå½“å‰è¾“å‡ºæ—¥å¿—å¯¹è±¡ï¼‰ã€‚æ˜¯ç»“æ„ä½“ç±»å‹ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 type Entry struct { Logger *Logger // Contains all the fields set by the user. Data Fields // Time at which the log entry was created Time time.Time // Level the log entry was logged at: Trace, Debug, Info, Warn, Error, Fatal or Panic // This field will be set on entry firing and the value will be equal to the one in Logger struct field. Level Level // Calling method, with package name Caller *runtime.Frame // Message passed to Trace, Debug, Info, Warn, Error, Fatal or Panic Message string // When formatter is called in entry.log(), a Buffer may be set to entry Buffer *bytes.Buffer // Contains the context set by the user. Useful for hook processing etc. Context context.Context // err may contain a field formatting error err string } å¸¸ç”¨çš„å±æ€§æ˜¯ï¼š\nData Fieldsæ˜¯æ—¥å¿—æ¡ç›®ä¸­æ‰€æœ‰çš„å­—æ®µï¼ŒFieldsç±»å‹æ˜¯type Fields map[string]interface{}ã€‚ Logger *Loggerè®°å½•è¯¥æ—¥å¿—æ¡ç›®çš„loggerã€‚ å•æ¡æ—¥å¿—æ¡ç›®ä¿¡æ¯éƒ½ä¿å­˜åœ¨Entryç»“æ„ä½“ä¸­ã€‚å¦‚ï¼Œåˆ›å»ºæ—¶é—´ã€æ—¥å¿—çº§åˆ«ã€æ—¥å¿—æ¶ˆæ¯ç­‰ã€‚ logrusä¹Ÿå†…ç½®äº†ä¸€ä¸ªsyslogçš„é’©å­ï¼Œå°†æ—¥å¿—è¾“å‡ºåˆ°ç³»ç»Ÿæ—¥å¿—syslogä¸­ã€‚å®ƒä¸é€‚ç”¨ç”¨windowsçš„ç³»ç»Ÿæ—¥å¿—ã€‚\nLogrus å†…ç½® Hooks åˆ—è¡¨ï¼š https://github.com/sirupsen/logrus/tree/master/hooks\n# è‡ªå®šä¹‰Hook # åˆ©ç”¨Hookæ·»åŠ å­—æ®µ è¿™é‡Œæˆ‘ä»¬å®ç°ä¸€ä¸ªé’©å­ï¼Œåœ¨è¾“å‡ºçš„æ—¥å¿—ä¸­å¢åŠ ä¸€ä¸ªapp=awesome-webå­—æ®µã€‚\nç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 package main import ( \u0026#34;github.com/sirupsen/logrus\u0026#34; ) type AppHook struct { AppName string } func (h *AppHook) Levels() []logrus.Level { return logrus.AllLevels } func (h *AppHook) Fire(entry *logrus.Entry) error { entry.Data[\u0026#34;app\u0026#34;] = h.AppName return nil } func main() { h := \u0026amp;AppHook{AppName: \u0026#34;awesome-web\u0026#34;} logrus.AddHook(h) logrus.Info(\u0026#34;info msg\u0026#34;) logrus.WithField(\u0026#34;username\u0026#34;, \u0026#34;arlettebrook\u0026#34;). Warn(\u0026#34;user info\u0026#34;) } éæ ‡å‡†TTYè¿è¡Œè¾“å‡ºï¼š\n1 2 3 4 $ go run main.go time=\u0026#34;2024-05-10T22:58:42+08:00\u0026#34; level=info msg=\u0026#34;info msg\u0026#34; app=awesome-web time=\u0026#34;2024-05-10T22:58:42+08:00\u0026#34; level=warning msg=\u0026#34;user info\u0026#34; app=awesome-web username=arlettebro ok æ€»ç»“ï¼šæ·»åŠ é’©å­ï¼ˆhookï¼‰ï¼Œåªéœ€è¦åˆ›å»ºä¸€ä¸ªç»“æ„ä½“å®ç°Hookæ¥å£ï¼Œåœ¨Levelsæ–¹æ³•ä¸­è®¾ç½®è§¦å‘hookå‡½æ•°çš„æ¡ä»¶ï¼ˆæ—¥å¿—çº§åˆ«ï¼‰ï¼Œåœ¨Fireæ–¹æ³•ä¸­å®šä¹‰hookå‡½æ•°è¡Œä¸ºã€‚ç„¶ååˆ›å»ºå¯¹è±¡ï¼Œåˆ©ç”¨AddHook(hook Hook)å°†hookæ³¨å†Œåˆ°loggerå½“ä¸­ã€‚\n# åˆ©ç”¨Hookæ¨¡æ‹Ÿé‚®ä»¶å‘é€ ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/sirupsen/logrus\u0026#34; ) func init() { logrus.SetFormatter(\u0026amp;logrus.JSONFormatter{}) logrus.AddHook(\u0026amp;EmailHook{}) } type EmailHook struct { } func (e EmailHook) Levels() []logrus.Level { return logrus.AllLevels // æ‰€æœ‰æ—¥å¿—éƒ½å‘é€åˆ°é‚®ä»¶ } func (e EmailHook) Fire(entry *logrus.Entry) error { // æ·»åŠ ä¸€ä¸ªé‚®ç®±å­—æ®µæ ‡è¯† entry.Data[\u0026#34;app\u0026#34;] = \u0026#34;email\u0026#34; // è·å–æ—¥å¿—æ¡ç›® msg, _ := entry.String() // æ¨¡æ‹Ÿå‘é€é‚®ä»¶ fmt.Printf(\u0026#34;fakeSendEmail: %s\u0026#34;, msg) return nil } func main() { logrus.Info(\u0026#34;info msg\u0026#34;) logrus.WithField(\u0026#34;username\u0026#34;, \u0026#34;arlettebrook\u0026#34;). Warn(\u0026#34;user info\u0026#34;) } è¿è¡Œè¾“å‡ºï¼š\n1 2 3 4 5 6 7 $ go run main.go fakeSendEmail: {\u0026#34;app\u0026#34;:\u0026#34;email\u0026#34;,\u0026#34;level\u0026#34;:\u0026#34;info\u0026#34;,\u0026#34;msg\u0026#34;:\u0026#34;info msg\u0026#34;,\u0026#34;time\u0026#34;:\u0026#34;2024-05-10T23:22:13+08:00\u0026#34;} {\u0026#34;app\u0026#34;:\u0026#34;email\u0026#34;,\u0026#34;level\u0026#34;:\u0026#34;info\u0026#34;,\u0026#34;msg\u0026#34;:\u0026#34;info msg\u0026#34;,\u0026#34;time\u0026#34;:\u0026#34;2024-05-10T23:22:13+08:00\u0026#34;} fakeSendEmail: {\u0026#34;app\u0026#34;:\u0026#34;email\u0026#34;,\u0026#34;level\u0026#34;:\u0026#34;warning\u0026#34;,\u0026#34;msg\u0026#34;:\u0026#34;user info\u0026#34;,\u0026#34;time\u0026#34;:\u0026#34;2024-05-10T23:22:13+08:0 0\u0026#34;,\u0026#34;username\u0026#34;:\u0026#34;arlettebrook\u0026#34;} {\u0026#34;app\u0026#34;:\u0026#34;email\u0026#34;,\u0026#34;level\u0026#34;:\u0026#34;warning\u0026#34;,\u0026#34;msg\u0026#34;:\u0026#34;user info\u0026#34;,\u0026#34;time\u0026#34;:\u0026#34;2024-05-10T23:22:13+08:00\u0026#34;,\u0026#34;username\u0026#34;:\u0026#34; arlettebrook\u0026#34;} å¯ä»¥å‘ç°ï¼Œåœ¨æ‰“å°æ¯æ¡æ—¥å¿—ä¹‹å‰ï¼Œéƒ½ä¼šæ‰§è¡ŒHookå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯å®ç°äº†å‘é€é‚®ä»¶ã€‚\n# ç¬¬ä¸‰æ–¹Hook logrusçš„ç¬¬ä¸‰æ–¹ Hook æœ‰å¾ˆå¤šï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº›ç°æˆçš„ Hook ã€‚å¦‚ï¼š\nmgorusï¼šå°†æ—¥å¿—å‘é€åˆ° mongodbï¼› logrus-redis-hookï¼šå°†æ—¥å¿—å‘é€åˆ° redisï¼› logrus-amqpï¼šå°†æ—¥å¿—å‘é€åˆ° ActiveMQã€‚ lumberjackrus ï¼šå®ç°äº†æ—¥å¿—åˆ‡å‰²å’Œå½’æ¡£åŠŸèƒ½ï¼Œå¹¶ä¸”èƒ½å¤Ÿå°†ä¸åŒçº§åˆ«çš„æ—¥å¿—è¾“å‡ºåˆ°ä¸åŒæ–‡ä»¶ã€‚lumberjackrus æ˜¯ä¸“é—¨ä¸º Logrus è€Œæ‰“é€ çš„æ–‡ä»¶æ—¥å¿— Hooksï¼Œå…¶å®˜æ–¹ä»‹ç»ä¸º local filesystem hook for Logrusã€‚ æ›´å¤šè¿‡å†…å®¹è¯·å‚è€ƒå®˜æ–¹æä¾›çš„ç¬¬ä¸‰æ–¹å¼€å‘çš„ Hooks åˆ—è¡¨ã€‚\n# lumberjackrus lumberjackrus ï¼šå®ç°äº†æ—¥å¿—åˆ‡å‰²å’Œå½’æ¡£åŠŸèƒ½ï¼Œå¹¶ä¸”èƒ½å¤Ÿå°†ä¸åŒçº§åˆ«çš„æ—¥å¿—è¾“å‡ºåˆ°ä¸åŒæ–‡ä»¶ã€‚lumberjackrus æ˜¯ä¸“é—¨ä¸º Logrus è€Œæ‰“é€ çš„æ–‡ä»¶æ—¥å¿— Hooksï¼Œå…¶å®˜æ–¹ä»‹ç»ä¸º local filesystem hook for Logrusã€‚\nç”¨äºè®°å½•åˆ°æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿçš„é’©å­ï¼ˆä½¿ç”¨ logrotate å’Œå¯ä»¥å°†ä¸åŒçš„æ—¥å¿—çº§ä¿å­˜åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼‰\nlumberjackrusæ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹åŒ…ï¼Œä½¿ç”¨è¦å…ˆå®‰è£…ï¼š\n1 $ go get -u github.com/orandin/lumberjackrus ç¤ºä¾‹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 package main import ( \u0026#34;github.com/orandin/lumberjackrus\u0026#34; \u0026#34;github.com/sirupsen/logrus\u0026#34; ) func init() { logrus.SetFormatter(\u0026amp;logrus.TextFormatter{}) logrus.SetLevel(logrus.DebugLevel) hook, err := lumberjackrus.NewHook( \u0026amp;lumberjackrus.LogFile{ // æœªæŒ‡å®šçº§åˆ«çš„æ—¥å¿—ä¿å­˜çš„æ–‡ä»¶ï¼Œå±æ€§éƒ½æ˜¯optional Filename: \u0026#34;./tmp/general.log\u0026#34;, // è·¯å¾„+æ–‡ä»¶åï¼Œé»˜è®¤å½“å‰ç›®å½•åå­—\u0026lt;processName\u0026gt;-lumberjack.log MaxSize: 3, // æ–‡ä»¶æœ€å¤§å ç”¨ï¼Œå•ä½MBï¼Œé»˜è®¤100MB MaxBackups: 1, // æ–‡ä»¶æœ€å¤§å¤‡ä»½æ•°ï¼Œé»˜è®¤ä¸é™åˆ¶ MaxAge: 1, // å¤‡ä»½æ–‡ä»¶ä¿å­˜çš„å¤©æ•°ï¼Œé»˜è®¤æ°¸ä¹… Compress: false, // æ˜¯å¦å‹ç¼©ï¼Œé»˜è®¤false LocalTime: false, // æ–‡ä»¶å¯ç”¨æœ¬åœ°æ—¶é—´ï¼Œé»˜è®¤utcï¼Œ }, logrus.InfoLevel, // å®šä¹‰å†™å…¥æ–‡ä»¶çš„æ—¥å¿—çº§åˆ« \u0026amp;logrus.JSONFormatter{}, // æ—¥å¿—æ ¼å¼Formatter \u0026amp;lumberjackrus.LogFileOpts{ // æ ¹æ®æ—¥å¿—çº§åˆ«æŒ‡å®šä¿å­˜ä½ç½® logrus.InfoLevel: \u0026amp;lumberjackrus.LogFile{ Filename: \u0026#34;./tmp/info/info.log\u0026#34;, MaxSize: 1, MaxBackups: 2, MaxAge: 1, Compress: true, LocalTime: true, }, logrus.ErrorLevel: \u0026amp;lumberjackrus.LogFile{ Filename: \u0026#34;./tmp/error/error.log\u0026#34;, }, }, ) if err != nil { panic(err) } logrus.AddHook(hook) } func main() { logrus.Debug(\u0026#34;Debug message\u0026#34;) // It is not written to a file (because debug level \u0026lt; minLevel) logrus.Info(\u0026#34;Info message\u0026#34;) // Written in ./tmp/info.log logrus.Warn(\u0026#34;Warn message\u0026#34;) // Written in ./tmp/general.log logrus.Error(\u0026#34;Error message\u0026#34;) // Written in ./tmp/error.log } è¿è¡Œï¼Œåœ¨éæ ‡å‡†TTYä¸­è¾“å‡ºï¼š\n1 2 3 4 5 $ go run main.go time=\u0026#34;2024-05-11T10:49:22+08:00\u0026#34; level=debug msg=\u0026#34;Debug message\u0026#34; time=\u0026#34;2024-05-11T10:49:22+08:00\u0026#34; level=info msg=\u0026#34;Info message\u0026#34; time=\u0026#34;2024-05-11T10:49:22+08:00\u0026#34; level=warning msg=\u0026#34;Warn message\u0026#34; time=\u0026#34;2024-05-11T10:49:22+08:00\u0026#34; level=error msg=\u0026#34;Error message\u0026#34; å¹¶ä¸”è¿˜ä¼šå†å½“å‰ç›®å½•ä¸‹ç”Ÿæˆtmp/general.log, tmp/info, tmp/error,é‡Œé¢çš„æ ¼å¼ä¸ºjsonã€‚debugæ—¥å¿—æ²¡æœ‰å†™å…¥æ–‡ä»¶ã€‚info.logæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n1 {\u0026#34;level\u0026#34;:\u0026#34;info\u0026#34;,\u0026#34;msg\u0026#34;:\u0026#34;Info message\u0026#34;,\u0026#34;time\u0026#34;:\u0026#34;2024-05-11T10:49:22+08:00\u0026#34;} è‡³æ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨lumberjackruså®ç°äº†æ—¥å¿—è½®è¯¢ä»¥åŠåˆ†çº§åˆ«ä¿å­˜ã€‚è¿™ä¸ªé’©å­ï¼Œå®ç°æ—¥å¿—è½®è¯¢æ˜¯åŸºäºlumberjackåº“å®ç°çš„ã€‚\nä½¿ç”¨è¿™ä¸ªé’©å­ï¼Œæˆ‘ä»¬åªéœ€è¦åˆ©ç”¨NewHook(defaultLogger *LogFile, minLevel logrus.Level, formatter logrus.Formatter, opts *LogFileOpts) (*Hook, error)åˆ›å»ºå¯¹è±¡ï¼Œå°†å¯¹è±¡æ·»åŠ loggerä¸­å³å¯ä½¿ç”¨ã€‚ä»£ç ä¸­æœ‰å¯¹å‚æ•°çš„ä»‹ç»ã€‚æœ€åä¸€ä¸ªå‚æ•°ï¼ˆæœ¬è´¨æ˜¯mapç±»å‹ï¼‰å¦‚æœä¸ºnilæˆ–è€…ä¸ºç©ºmapï¼Œé‚£ä¹ˆæ—¥å¿—å°†ä¸ä¼šåˆ†çº§åˆ«ä¿å­˜ï¼Œéƒ½ä¼šä¿å­˜åˆ°defaultLoggeræŒ‡å®šçš„æ–‡ä»¶ä¸­ã€‚\n# logrus-redis-hook ä¸‹é¢æ¼”ç¤ºåˆ©ç”¨hookå°†æ—¥å¿—å‘é€åˆ°redisï¼Œæˆ‘ä»¬ç”¨åˆ°çš„åŒ…æ˜¯logrus-redis-hook, å…ˆå®‰è£…logrus-redis-hookï¼š\n1 $ go get -u github.com/rogierlommers/logrus-redis-hook é»˜è®¤ä½ å·²ç»å®‰è£…å¥½äº†rediså¹¶ä¸”å¯åŠ¨äº†å®ƒï¼Œå¦‚æœä½ æƒ³äº†è§£redisï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« ã€ŠRedis Introductionã€‹ã€‚\nç„¶åç¼–å†™ç¨‹åºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 package main import ( \u0026#34;io\u0026#34; logredis \u0026#34;github.com/rogierlommers/logrus-redis-hook\u0026#34; \u0026#34;github.com/sirupsen/logrus\u0026#34; ) func init() { logrus.SetFormatter(\u0026amp;logrus.JSONFormatter{}) hookConfig := logredis.HookConfig{ Host: \u0026#34;192.168.245.130\u0026#34;, Password: \u0026#34;123456\u0026#34;, Key: \u0026#34;demo_log\u0026#34;, Format: \u0026#34;v0\u0026#34;, App: \u0026#34;awesome_demo\u0026#34;, Port: 6379, Hostname: \u0026#34;localhost\u0026#34;, // will be sent to field @source_host DB: 1, // optional TTL: 3600, } hook, err := logredis.NewHook(hookConfig) if err == nil { logrus.AddHook(hook) } else { logrus.Errorf(\u0026#34;logredis error: %q\u0026#34;, err) } } func main() { // when hook is injected successfully, logs will be sent to redis server logrus.Info(\u0026#34;just some info logging...\u0026#34;) // we also support log.WithFields() logrus.WithFields(logrus.Fields{ \u0026#34;animal\u0026#34;: \u0026#34;walrus\u0026#34;, \u0026#34;foo\u0026#34;: \u0026#34;bar\u0026#34;, \u0026#34;this\u0026#34;: \u0026#34;that\u0026#34;}). Info(\u0026#34;additional fields are being logged as well\u0026#34;) // If you want to disable writing to stdout, use setOutput logrus.SetOutput(io.Discard) logrus.Info(\u0026#34;This will only be sent to Redis\u0026#34;) } æ³¨æ„ï¼šè¯·è¿æ¥ä½ è‡ªå·±çš„redisã€‚\nè¿è¡Œç¨‹åºåï¼Œç»ˆç«¯è¾“å‡ºï¼š\n1 2 3 4 $ go run main.go {\u0026#34;level\u0026#34;:\u0026#34;info\u0026#34;,\u0026#34;msg\u0026#34;:\u0026#34;just some info logging...\u0026#34;,\u0026#34;time\u0026#34;:\u0026#34;2024-05-11T11:56:17+08:00\u0026#34;} {\u0026#34;animal\u0026#34;:\u0026#34;walrus\u0026#34;,\u0026#34;foo\u0026#34;:\u0026#34;bar\u0026#34;,\u0026#34;level\u0026#34;:\u0026#34;info\u0026#34;,\u0026#34;msg\u0026#34;:\u0026#34;additional fields are being logged as well\u0026#34;,\u0026#34; this\u0026#34;:\u0026#34;that\u0026#34;,\u0026#34;time\u0026#34;:\u0026#34;2024-05-11T11:56:17+08:00\u0026#34;} æˆ‘ä»¬ä½¿ç”¨redis-cliæŸ¥çœ‹ï¼š\n1 2 3 4 127.0.0.1:6379[1]\u0026gt; lrange demo_log 0 -1 1) \u0026#34;{\\\u0026#34;@fields\\\u0026#34;:{\\\u0026#34;application\\\u0026#34;:\\\u0026#34;awesome_demo\\\u0026#34;,\\\u0026#34;level\\\u0026#34;:\\\u0026#34;info\\\u0026#34;},\\\u0026#34;@message\\\u0026#34;:\\\u0026#34;just some info logging...\\\u0026#34;,\\\u0026#34;@source_host\\\u0026#34;:\\\u0026#34;localhost\\\u0026#34;,\\\u0026#34;@timestamp\\\u0026#34;:\\\u0026#34;2024-05-11T03:56:17.867867Z\\\u0026#34;}\u0026#34; 2) \u0026#34;{\\\u0026#34;@fields\\\u0026#34;:{\\\u0026#34;animal\\\u0026#34;:\\\u0026#34;walrus\\\u0026#34;,\\\u0026#34;application\\\u0026#34;:\\\u0026#34;awesome_demo\\\u0026#34;,\\\u0026#34;foo\\\u0026#34;:\\\u0026#34;bar\\\u0026#34;,\\\u0026#34;level\\\u0026#34;:\\\u0026#34;info\\\u0026#34;,\\\u0026#34;this\\\u0026#34;:\\\u0026#34;that\\\u0026#34;},\\\u0026#34;@message\\\u0026#34;:\\\u0026#34;additional fields are being logged as well\\\u0026#34;,\\\u0026#34;@source_host\\\u0026#34;:\\\u0026#34;localhost\\\u0026#34;,\\\u0026#34;@timestamp\\\u0026#34;:\\\u0026#34;2024-05-11T03:56:17.933777Z\\\u0026#34;}\u0026#34; 3) \u0026#34;{\\\u0026#34;@fields\\\u0026#34;:{\\\u0026#34;application\\\u0026#34;:\\\u0026#34;awesome_demo\\\u0026#34;,\\\u0026#34;level\\\u0026#34;:\\\u0026#34;info\\\u0026#34;},\\\u0026#34;@message\\\u0026#34;:\\\u0026#34;This will only be sent to Redis\\\u0026#34;,\\\u0026#34;@source_host\\\u0026#34;:\\\u0026#34;localhost\\\u0026#34;,\\\u0026#34;@timestamp\\\u0026#34;:\\\u0026#34;2024-05-11T03:56:17.9351074Z\\\u0026#34;}\u0026#34; æˆ‘ä»¬çœ‹åˆ°demo_logæ˜¯ä¸€ä¸ªlistï¼Œæ¯è¿‡æ¥ä¸€æ¡æ—¥å¿—ï¼Œå°±åœ¨liståæ–°å¢ä¸€é¡¹ã€‚\né»˜è®¤çš„loggeræ˜¯è¾“å‡ºåˆ°stderrï¼Œä½†ä¿®æ”¹ä¸ºdiscardï¼Œå°†ä¸ä¼šè¾“å‡ºåˆ°ä»»ä½•åœ°æ–¹ï¼Œä½†æ˜¯é’©å­ä¾ç„¶æ‰§è¡Œã€‚å› ä¸ºé’©å­é‡Œé¢æŒ‡å®šå‘é€åˆ°çš„æ˜¯redisï¼Œä¸å—å½±å“ã€‚\n# æ€»ç»“ æœ¬æ–‡ä»‹ç»äº† Logrus çš„åŸºæœ¬ç‰¹ç‚¹ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ã€‚\nLogrus å®Œå…¨å…¼å®¹ log æ ‡å‡†åº“ï¼Œæ‰€ä»¥å¯ä»¥å®ç°æ— ç¼æ›¿æ¢ã€‚å…¶ API è®¾è®¡æ€è·¯è·Ÿ log æ ‡å‡†åº“çš„é£æ ¼ä¹Ÿæœ‰å¾ˆå¤šç›¸ä¼¼ä¹‹å¤„ï¼Œéƒ½æä¾›äº†ä¸€ä¸ªé»˜è®¤çš„ std æ—¥å¿—å¯¹è±¡è¾¾åˆ°å¼€ç®±å³ç”¨çš„æ•ˆæœã€‚Logrus æœ€å®ç”¨çš„ä¸¤ä¸ªåŠŸèƒ½ï¼Œä¸€ä¸ªæ˜¯æ”¯æŒç»“æ„åŒ–æ—¥å¿—ï¼Œä¸€ä¸ªæ˜¯æ”¯æŒ Hooks æœºåˆ¶ï¼Œè¿™æå¤§çš„æå‡äº†å¯ç”¨æ€§å’Œçµæ´»æ€§ï¼Œä¹Ÿä½¿å¾— Logrus æˆä¸ºæœ€å—æ¬¢è¿çš„ Go æ—¥å¿—åº“ã€‚\n# å‚è€ƒ logrus GitHub ä»“åº“ Go æ¯æ—¥ä¸€åº“ä¹‹ logrus Go ç¬¬ä¸‰æ–¹ log åº“ä¹‹ logrus ä½¿ç”¨ ","date":"2024-05-09T10:31:23+08:00","permalink":"https://arlettebrook.github.io/p/logrus-introduction/","title":"Logrus Introduction"},{"content":" Linuxå¸¸ç”¨å‘½ä»¤æœ‰å¾ˆå¤šï¼Œæœ¬æ–‡ä¸ä¼šé€ä¸ªä»‹ç»ã€‚ä»¥ä¸‹å‘½ä»¤æ˜¯æˆ‘åœ¨åæœŸä½¿ç”¨ä¸­é‡åˆ°çš„ï¼Œç®—æ˜¯æˆ‘å¯¹Linuxå¸¸ç”¨å‘½ä»¤çš„è¡¥å……ã€å›é¡¾ã€æ€»ç»“ã€‚æœ¬ç¯‡æ–‡ç« é˜…è¯»éœ€è¦ä¸€å®šçš„LinuxåŸºç¡€ã€‚æ›´å¤šå¸¸è§å‘½ä»¤å¯å‚è€ƒï¼š600æ¡Linuxå‘½ä»¤æ€»ç»“ã€‚\næŒç»­æ›´æ–°ä¸­\u0026hellip;\n# ln lnå‘½ä»¤åœ¨Linuxç³»ç»Ÿä¸­ç”¨äºåˆ›å»ºæ–‡ä»¶é“¾æ¥ã€‚\nLinuxä¸­æ–‡ä»¶é“¾æ¥çš„æ–¹å¼æœ‰ä¸¤ç§ï¼š ç¬¦å·é“¾æ¥ï¼ˆä¹Ÿç§°ä¸ºè½¯é“¾æ¥Symbolic Linkï¼‰ï¼šåŒ…å«äº†åˆ°åŸæ–‡ä»¶çš„è·¯å¾„ä¿¡æ¯ï¼Œç›¸å½“äºä¸€ä¸ªæŒ‡å‘åŸæ–‡ä»¶çš„å¿«æ·æ–¹å¼ã€‚ ç¬¦å·é“¾æ¥æœ‰è‡ªå·±çš„æ–‡ä»¶å±æ€§åŠæƒé™ç­‰ã€‚ å¯å¯¹ä¸å­˜åœ¨çš„æ–‡ä»¶æˆ–ç›®å½•åˆ›å»ºç¬¦å·é“¾æ¥ã€‚ ç¬¦å·é“¾æ¥å¯äº¤å‰æ–‡ä»¶ç³»ç»Ÿï¼Œå³å¯ä»¥åœ¨ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿä¹‹é—´åˆ›å»ºã€‚ åˆ é™¤ç¬¦å·é“¾æ¥å¹¶ä¸å½±å“è¢«æŒ‡å‘çš„æ–‡ä»¶ï¼Œä½†è‹¥è¢«æŒ‡å‘çš„åŸæ–‡ä»¶è¢«åˆ é™¤ï¼Œåˆ™ç›¸å…³ç¬¦å·é“¾æ¥è¢«ç§°ä¸ºæ­»é“¾æ¥ï¼ˆdangling linkï¼‰ã€‚è‹¥è¢«æŒ‡å‘çš„æ–‡ä»¶é‡æ–°è¢«åˆ›å»ºï¼Œæ­»é“¾æ¥å¯æ¢å¤ä¸ºæ­£å¸¸çš„ç¬¦å·é“¾æ¥ã€‚ ç¬¦å·é“¾æ¥æ–‡ä»¶çš„å¤§å°æ˜¯å…¶æŒ‡å‘çš„æ–‡ä»¶çš„è·¯å¾„å­—ç¬¦ä¸²çš„å­—èŠ‚æ•°ã€‚ ç¡¬é“¾æ¥ï¼šç¡¬é“¾æ¥æœ¬è´¨ä¸Šæ˜¯ç»™ä¸€ä¸ªæ–‡ä»¶å–ä¸€ä¸ªæ–°çš„åç§°ï¼ŒåŸæ–‡ä»¶å’Œç¡¬é“¾æ¥åœ¨ç‰©ç†ä¸Šä»ç„¶æ˜¯åŒä¸€ä¸ªæ–‡ä»¶ã€‚å®ƒä»¬å…±äº«ç›¸åŒçš„inodeï¼ˆç´¢å¼•èŠ‚ç‚¹ï¼‰å’Œæ•°æ®å—ã€‚ åˆ›å»ºç¡¬é“¾æ¥ä¼šåœ¨å¯¹åº”çš„ç›®å½•ä¸­å¢åŠ é¢å¤–çš„è®°å½•é¡¹ä»¥å¼•ç”¨æ–‡ä»¶ã€‚ åŸæ–‡ä»¶å’Œç¡¬é“¾æ¥æ–‡ä»¶å¯¹åº”äºåŒä¸€æ–‡ä»¶ç³»ç»Ÿä¸Šçš„ä¸€ä¸ªç‰©ç†æ–‡ä»¶ã€‚ åˆ›å»ºç¡¬é“¾æ¥æ—¶åŸæ–‡ä»¶çš„è¿æ¥æ•°ï¼ˆi_nlinkï¼‰ä¼šé€’å¢ã€‚å³ç¡¬é“¾æ¥æ•°é€’å¢ã€‚ åˆ é™¤æ–‡ä»¶æ—¶ï¼Œrmå‘½ä»¤ä¼šé€’å‡è®¡æ•°çš„é“¾æ¥æ•°ã€‚æ–‡ä»¶è¦æ˜¯å­˜åœ¨ï¼Œè‡³å°‘æœ‰ä¸€ä¸ªé“¾æ¥æ•°ã€‚å½“é“¾æ¥æ•°ä¸ºé›¶æ—¶ï¼Œè¯¥æ–‡ä»¶æ‰ä¼šè¢«çœŸæ­£åˆ é™¤ã€‚ ç¡¬é“¾æ¥ä¸èƒ½è·¨åŸŸé©±åŠ¨å™¨æˆ–åˆ†åŒºï¼Œä¹Ÿä¸æ”¯æŒå¯¹ç›®å½•åˆ›å»ºç¡¬é“¾æ¥ã€‚ æ€»ç»“æ¥è¯´ï¼Œç¬¦å·é“¾æ¥ï¼ˆè½¯é“¾æ¥ï¼‰å’Œç¡¬é“¾æ¥çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼š ç¬¦å·é“¾æ¥æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶ï¼Œå®ƒåŒ…å«äº†åˆ°åŸæ–‡ä»¶çš„è·¯å¾„ä¿¡æ¯ï¼ˆå¿«æ·æ–¹å¼ï¼‰ï¼›è€Œç¡¬é“¾æ¥åˆ™ä¸åŸæ–‡ä»¶å…±äº«ç›¸åŒçš„inodeå’Œæ•°æ®å—ï¼ˆæ–‡ä»¶åˆ«åï¼‰ã€‚ ç¬¦å·é“¾æ¥å¯ä»¥è·¨æ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶ä¸”å¯ä»¥å¯¹ä¸å­˜åœ¨çš„æ–‡ä»¶æˆ–ç›®å½•åˆ›å»ºï¼›è€Œç¡¬é“¾æ¥åˆ™ä¸èƒ½è·¨åŸŸé©±åŠ¨å™¨æˆ–åˆ†åŒºï¼Œä¹Ÿä¸èƒ½å¯¹ç›®å½•åˆ›å»ºã€‚ åˆ é™¤ç¬¦å·é“¾æ¥ä¸å½±å“åŸæ–‡ä»¶ï¼Œä½†åˆ é™¤åŸæ–‡ä»¶ä¼šä½¿ç¬¦å·é“¾æ¥æˆä¸ºæ­»é“¾æ¥ï¼›è€Œåˆ é™¤ç¡¬é“¾æ¥æ–‡ä»¶æ—¶ï¼Œåªæœ‰å½“æ‰€æœ‰ç¡¬é“¾æ¥éƒ½è¢«åˆ é™¤ä¸”åŸæ–‡ä»¶çš„é“¾æ¥æ•°ä¸ºé›¶æ—¶ï¼Œæ–‡ä»¶æ‰ä¼šè¢«çœŸæ­£åˆ é™¤ã€‚å³ç¡¬é“¾æ¥æ•°ä¸º0ï¼Œæ–‡ä»¶æ‰çœŸæ­£è¢«åˆ é™¤ã€‚ è¿™ä¸ªå‘½ä»¤å…è®¸ä½ åœ¨ä¸åŒçš„ä½ç½®ä¸ºåŒä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•å»ºç«‹åŒæ­¥çš„é“¾æ¥ï¼Œä»è€Œé¿å…äº†åœ¨å¤šä¸ªä½ç½®é‡å¤å­˜å‚¨ç›¸åŒçš„æ–‡ä»¶å†…å®¹ï¼ŒèŠ‚çœäº†ç£ç›˜ç©ºé—´ã€‚\nlnå‘½ä»¤çš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š\n1 ln [é€‰é¡¹] \u0026lt;æºæ–‡ä»¶æˆ–ç›®å½•\u0026gt; \u0026lt;é“¾æ¥æ–‡ä»¶æˆ–ç›®å½•\u0026gt; å¸¸ç”¨é€‰é¡¹åŒ…æ‹¬ï¼š -sï¼šåˆ›å»ºç¬¦å·é“¾æ¥ï¼ˆè½¯é“¾æ¥ï¼‰ã€‚è¿™ä¼šåœ¨ä½ é€‰å®šçš„ä½ç½®ä¸Šç”Ÿæˆä¸€ä¸ªæ–‡ä»¶çš„é•œåƒï¼Œä¸ä¼šå ç”¨ç£ç›˜ç©ºé—´ï¼Œè€Œæ˜¯ä¿å­˜äº†åŸå§‹æ–‡ä»¶çš„è·¯å¾„ã€‚ï¼ˆåˆ›å»ºå¿«æ·æ–¹å¼ï¼‰ ä¸ä½¿ç”¨-sé€‰é¡¹æ—¶åˆ›å»ºç¡¬é“¾æ¥ã€‚ -fï¼šå¼ºåˆ¶æ‰§è¡Œï¼Œå¦‚æœé“¾æ¥æ–‡ä»¶å·²å­˜åœ¨åˆ™è¦†ç›–ã€‚ -vï¼šæ˜¾ç¤ºè¯¦ç»†çš„è¾“å‡ºä¿¡æ¯ã€‚ --helpï¼šæŸ¥çœ‹å¸®åŠ©æ–‡æ¡£ã€‚ ç†è§£è®°å¿†ï¼šlnå¯ä»¥ç†è§£ä¸ºlinkçš„ç¼©å†™ï¼Œså¯ä»¥ç†è§£ä¸ºsoftè½¯çš„æ„æ€ã€‚ æ³¨æ„ï¼šæºæ–‡ä»¶ä¸€èˆ¬ç”¨ç»å¯¹è·¯å¾„ï¼Œç›¸å¯¹ä¼šå‡ºç°æ­»é“¾æ¥æƒ…å†µã€‚ ç®€å•ä»‹ç»ä¸€äº›ls -lhè¾“å‡º\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 $ ls -lh total 20K -rw-r--r--. 1 root root 19K May 8 22:49 abc.txt drwxr-xr-x. 3 root root 18 May 8 23:15 demo # læ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ï¼Œhæ–‡ä»¶å¤§å°ç”¨äººç±»å¯è¯»æ‡‚çš„æ–¹å¼æ˜¾ç¤ºã€‚ -rw- r-- r-- -å¼€å¤´è¡¨ç¤ºæ–‡ä»¶ï¼Œdè¡¨ç¤ºç›®å½•ï¼Œlè¡¨ç¤ºé“¾æ¥ï¼Œä¸‰ä½ä¸ºä¸€ç»„ç”¨rwx drwx r-x r-x å½“å‰ç”¨æˆ·æƒé™ ç”¨æˆ·æ‰€å±ç»„æƒé™\tå…¶ä»–ç”¨æˆ·æƒé™ æ•°å­—1è¡¨ç¤ºç¡¬é“¾æ¥æ•°ï¼Œç†è§£ä¸ºåˆ«åï¼Œåˆ«åä¸º0ï¼Œæ–‡ä»¶æ‰ä¼šè¢«åˆ é™¤ã€‚ æœ‰å¤šå°‘ç§æ–¹å¼å¯ä»¥è®¿é—®è¯¥æ–‡ä»¶æˆ–ç›®å½• æ–‡ä»¶ä¸€èˆ¬ä¸º1ï¼šç»å¯¹è·¯å¾„ ç›®å½•åªæœ‰ä¸€å±‚ä¸€èˆ¬ä¸º2ï¼šç»å¯¹å’Œcd . 2å±‚ä¸º3ï¼šç»å¯¹ã€cd . ã€cd .. root ï¼šæ‹¥æœ‰è€… root ï¼šæ‰€åœ¨ç»„ï¼Œæ²¡æŒ‡å®šé»˜è®¤åŒåã€‚ 5æœˆ 8 22:49 æ–‡ä»¶æœ€åä¿®æ”¹æ—¥æœŸæ—¶é—´ æœ€åï¼šæ–‡ä»¶æˆ–ç›®å½•åç§° æœ‰ç®­å¤´è¡¨ç¤ºè½¯è¿æ¥ï¼Œæ²¡æœ‰ç¡¬é“¾æ¥ã€‚ æ¼”ç¤ºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 localhost test $ ls -lh total 20K -rw-r--r--. 1 root root 19K May 8 22:49 abc.txt drwxr-xr-x. 3 root root 18 May 8 23:46 demo localhost test $ ln -sv ~/test/abc.txt ./demo/soft â€˜./demo/softâ€™ -\u0026gt; â€˜/root/test/abc.txtâ€™ localhost test $ ln -v ~/test/abc.txt ./demo/hard â€˜./demo/hardâ€™ =\u0026gt; â€˜/root/test/abc.txtâ€™ localhost test $ ls -lh total 20K -rw-r--r--. 2 root root 19K May 8 22:49 abc.txt drwxr-xr-x. 3 root root 42 May 8 23:46 demo localhost test $ cd demo localhost demo $ ls -lh total 20K -rw-r--r--. 2 root root 19K May 8 22:49 hard lrwxrwxrwx. 1 root root 18 May 8 23:46 soft -\u0026gt; /root/test/abc.txt drwxr-xr-x. 2 root root 6 May 8 23:15 test localhost demo $ æ³¨æ„ï¼šæµ‹è¯•ç¯å¢ƒæ˜¯åœ¨Linuxä¸­ï¼Œlnå‘½ä»¤å¹¶ä¸é€‚ç”¨äºwindowsç¯å¢ƒã€‚åˆ›å»ºçš„æ–‡ä»¶é“¾æ¥æ— æ•ˆã€‚\n# curl curlå‘½ä»¤æ˜¯ä¸€ä¸ªåˆ©ç”¨URLè§„åˆ™åœ¨å‘½ä»¤è¡Œä¸‹å·¥ä½œçš„æ–‡ä»¶ä¼ è¾“å·¥å…·ï¼Œå®ƒæ”¯æŒæ–‡ä»¶çš„ä¸Šä¼ å’Œä¸‹è½½ï¼Œå› æ­¤è¢«è§†ä¸ºç»¼åˆä¼ è¾“å·¥å…·ï¼Œä½†ä¼ ç»Ÿä¸Šä¹ æƒ¯ç§°å…¶ä¸ºä¸‹è½½å·¥å…·ã€‚curlæ”¯æŒåŒ…æ‹¬HTTPã€HTTPSã€FTPç­‰ä¼—å¤šåè®®ï¼Œå¹¶å…·å¤‡å¤šç§ç‰¹æ€§ï¼Œå¦‚POSTã€cookiesã€è®¤è¯ã€ä»æŒ‡å®šåç§»å¤„ä¸‹è½½éƒ¨åˆ†æ–‡ä»¶ã€ç”¨æˆ·ä»£ç†å­—ç¬¦ä¸²ã€é™é€Ÿã€æ–‡ä»¶å¤§å°ã€è¿›åº¦æ¡ç­‰ã€‚è¿™äº›ç‰¹æ€§ä½¿å¾—curlåœ¨å¤„ç†ç½‘é¡µå¤„ç†æµç¨‹å’Œæ•°æ®æ£€ç´¢è‡ªåŠ¨åŒ–æ–¹é¢éå¸¸æœ‰ç”¨ã€‚\næ€»ç»“ï¼šç”¨äºå‘é€ç½‘ç»œè¯·æ±‚ï¼Œå¯ä»¥ä¸‹è½½å’Œä¸Šä¼ æ–‡ä»¶ã€‚è€Œwgetåªèƒ½ç”¨äºä¸‹è½½æ–‡ä»¶ï¼Œä½†wgetä¸‹è½½æ–‡ä»¶çš„åŠŸèƒ½æ¯”curlå¼ºå¤§ã€‚\nå®‰è£…ï¼š\nlinuxç³»ç»Ÿï¼šæ ¹æ®ä½ çš„Linuxå‘è¡Œç‰ˆï¼Œä½¿ç”¨ç›¸åº”çš„åŒ…ç®¡ç†å™¨æ¥å®‰è£…curlã€‚ å¯¹äºDebian/Ubuntuç³»ç»Ÿï¼Œä½¿ç”¨apt-getå‘½ä»¤å®‰è£…ï¼šsudo apt install curl å¯¹äºCentOS/Fedoraç³»ç»Ÿï¼Œä½¿ç”¨yumå‘½ä»¤å®‰è£…ï¼šsudo yum install curl å¯¹äºArch Linuxç³»ç»Ÿï¼Œä½¿ç”¨pacmanå‘½ä»¤å®‰è£…ï¼šsudo pacman -S curl windowsç³»ç»Ÿï¼š å®˜ç½‘ä¸‹è½½å¯¹åº”ç‰ˆæœ¬ï¼Œæ·»åŠ ä¸€ä¸ªCURL_HOMEç¯å¢ƒå˜é‡åï¼ŒæŒ‡å‘çš„æ˜¯curl.exeæ–‡ä»¶æ‰€åœ¨è·¯å¾„ã€‚å¹¶å°†å…¶æ·»åŠ åˆ°pathç¯å¢ƒå˜é‡ä¸­ã€‚ æˆ–è€…å®‰è£…msys2åˆ©ç”¨pacmanåŒ…ç®¡ç†å™¨å®‰è£…ã€‚ æˆ–è€…å®‰è£…Mingwè‡ªå¸¦curlï¼ŒMingwä¹Ÿå¯ä»¥ç”¨msys2æ¥å®‰è£…ã€‚ MacOSç³»ç»Ÿè‡ªå¸¦ã€‚ åŸºæœ¬ä½¿ç”¨ï¼š\ncurlå‘½ä»¤çš„åŸºæœ¬è¯­æ³•æ ¼å¼ä¸ºï¼šcurl [é€‰é¡¹] URLã€‚å…¶ä¸­ï¼ŒURLæ˜¯è¦è¯·æ±‚çš„ç›®æ ‡åœ°å€ï¼Œè€Œé€‰é¡¹åˆ™ç”¨äºæŒ‡å®šå„ç§å‚æ•°å’ŒåŠŸèƒ½ã€‚\n-X æˆ– --requestï¼šç”¨äºæŒ‡å®šHTTPè¯·æ±‚æ–¹æ³•ï¼Œå¦‚GETã€POSTã€PUTã€DELETEç­‰ã€‚\né»˜è®¤å‘é€getè¯·æ±‚ã€‚ 1 curl -X POST http://example.com/ -H æˆ– --header: æ·»åŠ è‡ªå®šä¹‰çš„ HTTP å¤´ä¿¡æ¯ã€‚\n1 curl -H \u0026#34;Content-Type: application/json\u0026#34; http://example.com/ -d æˆ– --data: å‘é€ POST è¯·æ±‚æ—¶ï¼Œå°†æ•°æ®ä½œä¸ºè¯·æ±‚ä½“å‘é€ã€‚\n1 curl -d \u0026#34;param1=value1\u0026amp;param2=value2\u0026#34; http://example.com/ å¯¹äº JSON æ•°æ®ï¼š\n1 curl -d \u0026#39;{\u0026#34;key1\u0026#34;:\u0026#34;value1\u0026#34;, \u0026#34;key2\u0026#34;:\u0026#34;value2\u0026#34;}\u0026#39; -H \u0026#34;Content-Type: application/json\u0026#34; http://example.com/ -F æˆ– --form: ç”¨äºå‘é€ multipart/form-data æ ¼å¼çš„æ•°æ®ï¼Œé€šå¸¸ç”¨äºæ–‡ä»¶ä¸Šä¼ ã€‚\nå‚æ•°\u0026quot;æ–‡ä»¶å=@path\u0026quot;,è¿˜å¯ä»¥æŒ‡å®šç±»å‹\u0026quot;æ–‡ä»¶å=@path;type=MIME\u0026quot; 1 curl -F \u0026#34;file=@filename.txt\u0026#34; http://example.com/upload -o æˆ– --output: å°†å“åº”è¾“å‡ºåˆ°æ–‡ä»¶ï¼Œè€Œä¸æ˜¯æ˜¾ç¤ºåœ¨ç»ˆç«¯ä¸Šã€‚é»˜è®¤å½“å‰ç›®å½•\n1 curl -o output.html http://example.com/ -O: å°†å“åº”ä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶ï¼Œæ–‡ä»¶åä¸è¿œç¨‹æ–‡ä»¶çš„æ–‡ä»¶åç›¸åŒã€‚åœ¨å½“å‰ç›®å½•\n1 curl -O http://example.com/file.txt -s æˆ– --silent: é™é»˜æ¨¡å¼ï¼Œä¸æ˜¾ç¤ºè¿›åº¦æˆ–é”™è¯¯æ¶ˆæ¯ã€‚å¸¸ç”¨Sç»„åˆä½¿ç”¨ï¼Œæ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ã€‚\n-v æˆ– --verbose: è¯¦ç»†æ¨¡å¼ï¼Œæ˜¾ç¤ºè¯¦ç»†çš„é€šä¿¡è¿‡ç¨‹ï¼ŒåŒ…æ‹¬è¯·æ±‚å¤´å’Œå“åº”å¤´ã€‚\n-i: æ˜¾ç¤ºå“åº”å¤´ä¿¡æ¯ä»¥åŠè¿”å›çš„å†…å®¹ bodyã€‚\n-I: åªæ˜¾ç¤ºå“åº”å¤´ä¿¡æ¯ã€‚\n-u ç”¨æˆ·å:å¯†ç : æŒ‡å®šç”¨æˆ·åå’Œå¯†ç è¿›è¡Œèº«ä»½éªŒè¯ã€‚\n1 curl -u username:password http://example.com/ -L: è·Ÿéšé‡å®šå‘ã€‚å½“ HTTP å“åº”æ˜¯ä¸€ä¸ªé‡å®šå‘æ—¶ï¼Œcurl ä¼šè‡ªåŠ¨è·å–é‡å®šå‘åçš„å†…å®¹ã€‚\n-k æˆ– --insecure: å…è®¸è¿æ¥åˆ°ä¸å®‰å…¨çš„ SSL ç«™ç‚¹ï¼Œå³å¿½ç•¥ SSL è¯ä¹¦éªŒè¯ã€‚\nå¸¸ç”¨ç»„åˆï¼šcurl -fsSLï¼Œé»˜è®¤getè¯·æ±‚ã€‚\nfä¸æ˜¾ç¤ºå®¢æˆ·ç«¯é”™è¯¯ã€‚ sä¸æ˜¾ç¤ºè¿›åº¦ã€é”™è¯¯æ¶ˆæ¯ã€‚é…åˆSæ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ Læ¥å—é‡å®šå‘ã€‚ # wget wget æ˜¯ä¸€ä¸ªåœ¨ Unix å’Œ Linux ç³»ç»Ÿä¸Šå¸¸ç”¨çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºä»ç½‘ç»œä¸Šä¸‹è½½æ–‡ä»¶ã€‚\nä¼˜ç‚¹ï¼š\næ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼šå¦‚æœä¸‹è½½è¿‡ç¨‹ä¸­è¿æ¥ä¸­æ–­ï¼Œå¯ä»¥åœ¨ä¹‹åä»æ–­ç‚¹å¤„ç»§ç»­ä¸‹è½½ã€‚ æ”¯æŒé€’å½’ä¸‹è½½ï¼šå¯ä»¥ä¸‹è½½ç½‘é¡µä¸Šçš„æ‰€æœ‰é“¾æ¥æ–‡ä»¶ï¼Œå¹¶é‡å»ºç›®å½•ç»“æ„ã€‚ å¼ºå¤§çš„é‡è¯•æœºåˆ¶ï¼šåœ¨ä¸‹è½½è¿‡ç¨‹ä¸­å¦‚æœç½‘ç»œå‡ºç°é—®é¢˜ï¼Œwget ä¼šè‡ªåŠ¨é‡è¯•ï¼Œç›´åˆ°ä¸‹è½½å®Œæˆã€‚ åå°æ‰§è¡Œï¼šæ”¯æŒåœ¨åå°è¿è¡Œä¸‹è½½ä»»åŠ¡ï¼Œç”¨æˆ·æ— éœ€ä¿æŒç™»å½•çŠ¶æ€ã€‚ curlæ²¡æœ‰ä»¥ä¸Šä¼˜ç‚¹ï¼Œä½†å®ƒæ”¯æŒæ›´å¤šçš„åè®®ã€‚wgetåªæ”¯æŒHTTPã€HTTPSå’ŒFTPåè®®ã€‚curlä½¿ç”¨æ›´å¹¿æ³›ã€‚\nå®‰è£…ï¼š\nlinuxç³»ç»Ÿï¼šæ ¹æ®ä½ çš„Linuxå‘è¡Œç‰ˆï¼Œä½¿ç”¨ç›¸åº”çš„åŒ…ç®¡ç†å™¨æ¥å®‰è£…wgetã€‚\nå¯¹äºDebian/Ubuntuç³»ç»Ÿï¼Œä½¿ç”¨apt-getå‘½ä»¤å®‰è£…ï¼šsudo apt install wget\nå¯¹äºCentOS/Fedoraç³»ç»Ÿï¼Œä½¿ç”¨yumå‘½ä»¤å®‰è£…ï¼šsudo yum install wget\nå¯¹äºArch Linuxç³»ç»Ÿï¼Œä½¿ç”¨pacmanå‘½ä»¤å®‰è£…ï¼šsudo pacman -S wget\nwindowsç³»ç»Ÿï¼š\nå®˜ç½‘GNU Wgetä¸‹è½½å®‰è£…æˆ–å…¶ä»–å¯é çš„è½¯ä»¶ä¸‹è½½ï¼Œç„¶åè·¯å¾„æ·»åŠ åˆ°ç¯å¢ƒå˜é‡pathä¸­ã€‚ æˆ–è€…å®‰è£…msys2åˆ©ç”¨pacmanåŒ…ç®¡ç†å™¨å®‰è£…ã€‚ macosç³»ç»Ÿï¼š\nå¯¹äºmacOSï¼Œä½¿ç”¨HomebrewåŒ…ç®¡ç†å™¨æ¥å®‰è£…wgetã€‚\n1 brew install wget åŸºæœ¬ä½¿ç”¨ï¼š\n-b, \u0026ndash;backgroundï¼šåœ¨åå°æ‰§è¡Œä¸‹è½½ä»»åŠ¡ã€‚\n-c, \u0026ndash;continueï¼šç»§ç»­ä¸‹è½½ä¹‹å‰æœªå®Œæˆçš„æ–‡ä»¶ã€‚\n-r, \u0026ndash;recursiveï¼šé€’å½’ä¸‹è½½ï¼Œä¸‹è½½æŒ‡å®š URL ä¸­çš„æ‰€æœ‰é“¾æ¥ã€‚å¯ä»¥ä¸‹è½½æ•´ä¸ªç›®å½•åŠå…¶å­ç›®å½•ã€‚\n1 wget -r http://www.example.com/ æ³¨æ„ï¼šåœ¨ä½¿ç”¨é€’å½’ä¸‹è½½æ—¶ï¼Œå»ºè®®åŠ ä¸Š -np å’Œ -nH é€‰é¡¹ï¼Œä»¥é¿å…ä¸‹è½½è¿‡å¤šçš„ä¸å¿…è¦æ–‡ä»¶å’Œåˆ›å»ºå¤æ‚çš„ç›®å½•ç»“æ„ã€‚\n-np, \u0026ndash;no-parentï¼šä¸é€’å½’ä¸‹è½½ä¸Šçº§ç›®å½•ã€‚\n-nH, \u0026ndash;no-host-directoriesï¼šä¸åˆ›å»ºä¸»æœºç›®å½•ï¼Œå°†æ–‡ä»¶ä¿å­˜åœ¨å½“å‰ç›®å½•ã€‚\n-P DIRECTORY, \u0026ndash;directory-prefix=DIRECTORYï¼šå°†ä¸‹è½½çš„æ–‡ä»¶ä¿å­˜åˆ°æŒ‡å®šçš„ç›®å½•ã€‚\n1 wget -P /tmp http://www.example.com/file.zip -O FILE, \u0026ndash;output-document=FILEï¼šå°†ä¸‹è½½çš„æ–‡ä»¶ä¿å­˜ä¸ºæŒ‡å®šçš„æ–‡ä»¶åã€‚å¦‚æœå­˜åœ¨ä¼šè¦†ç›–ã€‚-Nï¼ˆæ—¶é—´æˆ³æ£€æŸ¥ï¼‰ï¼Œå¦‚æœæ—§ä¼šè¦†ç›–ï¼Œåä¹‹ä¸ä¼šã€‚\n1 wget -O new_file.zip http://www.example.com/file.zip -nc, \u0026ndash;no-clobberï¼šå¦‚æœæ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œä¸è¦†ç›–åŸæœ‰æ–‡ä»¶ã€‚\n-nv, \u0026ndash;no-verboseï¼šä¸‹è½½æ—¶åªæ˜¾ç¤ºæ›´æ–°å’Œå‡ºé”™ä¿¡æ¯ï¼Œä¸æ˜¾ç¤ºè¯¦ç»†çš„æ‰§è¡Œè¿‡ç¨‹ã€‚\n-v, \u0026ndash;verboseï¼šè¯¦ç»†æ¨¡å¼ï¼Œå¢åŠ è¾“å‡ºä¿¡æ¯ã€‚\n-q, \u0026ndash;quietï¼šé™é»˜æ¨¡å¼ï¼Œå‡å°‘è¾“å‡ºä¿¡æ¯ã€‚\n\u0026ndash;no-check-certificateï¼šä¸‹è½½ HTTPS ç½‘ç«™èµ„æºæ—¶ï¼Œè·³è¿‡è¯ä¹¦æ£€æµ‹è¿‡ç¨‹ã€‚\n-t NUM æˆ– \u0026ndash;tries=NUMï¼šæŒ‡å®šæœ€å¤§å°è¯•æ¬¡æ•°ã€‚å¦‚æœä¸‹è½½å¤±è´¥ï¼Œwget ä¼šå°è¯•é‡æ–°ä¸‹è½½æŒ‡å®šçš„æ¬¡æ•°ã€‚\n-U AGENT æˆ– \u0026ndash;user-agent=AGENTï¼šæŒ‡å®š User-Agent å­—ç¬¦ä¸²ã€‚è¿™å¯ä»¥ç”¨æ¥ä¼ªè£…ä¸ºä¸åŒçš„æµè§ˆå™¨æˆ–å®¢æˆ·ç«¯ã€‚\n-N æˆ– \u0026ndash;timestampingï¼šå¦‚æœæœ¬åœ°æ–‡ä»¶å­˜åœ¨ä¸”æ—¶é—´æˆ³è¾ƒæ–°ï¼Œåˆ™ä¸é‡æ–°ä¸‹è½½æ–‡ä»¶ã€‚\n-T SEC æˆ– \u0026ndash;timeout=SECï¼šæŒ‡å®šè¶…æ—¶æ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚\n-A TYPES æˆ– \u0026ndash;accept=TYPESï¼šæŒ‡å®šä¸‹è½½æ–‡ä»¶çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼Œ-A jpg,png,gif è¡¨ç¤ºåªä¸‹è½½ jpgã€png å’Œ gif æ–‡ä»¶ã€‚\n-d æˆ– \u0026ndash;debugï¼šæ‰“å°è°ƒè¯•è¾“å‡ºã€‚è¿™ä¼šåœ¨æ ‡å‡†é”™è¯¯ä¸Šè¾“å‡ºå¤§é‡ä¿¡æ¯ï¼Œé€šå¸¸ç”¨äºè¯Šæ–­é—®é¢˜ã€‚\nå¸¸ç”¨ç»„åˆï¼š\nwget -O-:Oè¡¨ç¤ºæŒ‡å®šæ–‡ä»¶åï¼Œåé¢-è¡¨ç¤ºæ²¡æœ‰æŒ‡å®šæ–‡ä»¶åï¼Œå†…å®¹å°†è¾“å‡ºåˆ°TTYã€‚\né€šå¸¸é…åˆbash -c \u0026quot;$(wget -O- url)\u0026quot;è¿è¡Œè„šæœ¬ã€‚urlä¸ºè„šæœ¬åœ°å€ã€‚\nå…¶ä¸­$()è¡¨ç¤ºåœ¨å½“å‰TTYä¸­è¿è¡Œå­å‘½ä»¤ï¼Œä¸‹è½½è„šæœ¬ã€‚\n[bash -c](#bash -c)è¡¨ç¤ºå°†ä¸‹è½½çš„å­—ç¬¦ä¸²åšä¸ºå‘½ä»¤æ‰§è¡Œã€‚\n# bash -c bash -c å‘½ä»¤ç”¨äºåœ¨ Bash shell ä¸­æ‰§è¡Œä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºå‘½ä»¤ã€‚\nåŸºæœ¬è¯­æ³•ï¼š\n1 bash -c \u0026#39;command_string\u0026#39; [arg0 [arg1 ...]] command_string æ˜¯ä½ æƒ³è¦æ‰§è¡Œçš„å‘½ä»¤å­—ç¬¦ä¸²ã€‚ arg0ã€arg1 ç­‰æ˜¯å¯é€‰çš„ï¼Œå®ƒä»¬ä¼šè¢«ç”¨ä½œ $0ã€$1ã€$2 ç­‰ shell å˜é‡åœ¨ command_string å†…éƒ¨ã€‚ æ³¨æ„è¿™é‡Œçš„$0å¹¶ä¸æ˜¯è„šæœ¬åæˆ–ç»ˆç«¯åï¼Œè€Œæ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ã€‚ å­—ç¬¦ä¸²å¯ä»¥ç”¨\u0026quot;\u0026quot;/''ï¼ŒåŒºåˆ«åœ¨äºåŒå¼•å·ä¼šè½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼Œå•å¼•å·ä¸ä¼šã€‚æ‰§è¡Œè„šæœ¬æ—¶å»ºè®®åŒå¼•å·ã€‚ ç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 $ bash -c \u0026#39;echo Hello, World!\u0026#39; Hello, World! $ bash -c \u0026#39;echo $0 $1\u0026#39; bash test bash test # bash -c \u0026#34;$(wget -O- https://gist.githubusercontent.com/lss233/2fdd75be3f0724739368d0dcd9d1367d/raw/62a790da4a391af096074b3355c2c2b7ecab3c28/chatgpt-mirai-installer-gocqhttp.sh)\u0026#34; chatgpt-qq-botå®‰è£…è„šæœ¬ ","date":"2024-05-08T19:24:26+08:00","permalink":"https://arlettebrook.github.io/p/linux-common-commands/","title":"Linux Common Commands"},{"content":" Viper å¯ä»¥ç›‘å¬æ–‡ä»¶ä¿®æ”¹è¿›è€Œè‡ªåŠ¨é‡æ–°åŠ è½½ã€‚ å…¶å†…éƒ¨ä½¿ç”¨çš„å°±æ˜¯fsnotifyè¿™ä¸ªåº“ï¼Œå®ƒæ˜¯è·¨å¹³å°çš„ã€‚fsæ˜¯filesystemçš„ç¼©å†™ï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯æ–‡ä»¶ç³»ç»Ÿé€šçŸ¥ã€‚èƒ½å¤Ÿç›‘å¬æ–‡ä»¶çš„ä¿®æ”¹ï¼Œè¿›è€Œå‘é€é€šçŸ¥ã€‚ä»Šå¤©æˆ‘ä»¬å°±æ¥ä»‹ç»ä¸€ä¸‹fsnotifyã€‚\n# å¿«é€Ÿä½¿ç”¨ å…ˆå®‰è£…ï¼š\n1 $ go get -u github.com/fsnotify/fsnotify åä½¿ç”¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 package main import ( \u0026#34;log\u0026#34; \u0026#34;github.com/fsnotify/fsnotify\u0026#34; ) func main() { // Create new watcher. watcher, err := fsnotify.NewWatcher() if err != nil { log.Fatal(err) } defer func(watcher *fsnotify.Watcher) { err := watcher.Close() if err != nil { log.Fatal(err) } }(watcher) done := make(chan bool) // Start listening for events. go func() { defer close(done) for { select { case event, ok := \u0026lt;-watcher.Events: if !ok { return } log.Printf(\u0026#34;%s %s\\n\u0026#34;, event.Name, event.Op) /*if event.Has(fsnotify.Write) { log.Println(\u0026#34;modified file:\u0026#34;, event.Name) }*/ case err, ok := \u0026lt;-watcher.Errors: if !ok { return } log.Println(\u0026#34;error:\u0026#34;, err) } } }() // Add a path. err = watcher.Add(\u0026#34;.\u0026#34;) if err != nil { log.Fatal(err) } \u0026lt;-done } fsnotifyçš„ä½¿ç”¨æ¯”è¾ƒç®€å•ï¼š\nå…ˆè°ƒç”¨NewWatcheråˆ›å»ºä¸€ä¸ªç›‘å¬å™¨ï¼› ç„¶åè°ƒç”¨ç›‘å¬å™¨çš„Addå¢åŠ ç›‘å¬çš„æ–‡ä»¶æˆ–ç›®å½•ï¼› å¦‚æœç›®å½•æˆ–æ–‡ä»¶æœ‰äº‹ä»¶äº§ç”Ÿï¼Œç›‘å¬å™¨ä¸­çš„é€šé“Eventså¯ä»¥å–å‡ºäº‹ä»¶ã€‚å¦‚æœå‡ºç°é”™è¯¯ï¼Œç›‘å¬å™¨ä¸­çš„é€šé“Errorså¯ä»¥å–å‡ºé”™è¯¯ä¿¡æ¯ã€‚ ä¸Šé¢ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åœ¨å¦ä¸€ä¸ª goroutine ä¸­å¾ªç¯è¯»å–å‘ç”Ÿçš„äº‹ä»¶åŠé”™è¯¯ï¼Œç„¶åè¾“å‡ºå®ƒä»¬ã€‚\nç¼–è¯‘ã€è¿è¡Œç¨‹åºã€‚åœ¨å½“å‰ç›®å½•åˆ›å»ºä¸€ä¸ªæ–°å»ºæ–‡æœ¬æ–‡æ¡£.txtï¼Œç„¶åé‡å‘½åä¸ºabc.txtæ–‡ä»¶ï¼Œè¾“å…¥å†…å®¹some test textï¼Œç„¶ååˆ é™¤å®ƒã€‚è§‚å¯Ÿæ§åˆ¶å°è¾“å‡ºï¼š\n1 2 3 4 5 6 $ go run main.go 2024/05/08 16:29:52 æ–°å»ºæ–‡æœ¬æ–‡æ¡£.txt CREATE 2024/05/08 16:30:03 æ–°å»ºæ–‡æœ¬æ–‡æ¡£.txt RENAME 2024/05/08 16:30:03 abc.txt CREATE 2024/05/08 16:30:15 abc.txt WRITE 2024/05/08 16:30:26 abc.txt REMOVE å…¶å®ï¼Œé‡å‘½åæ—¶ä¼šäº§ç”Ÿä¸¤ä¸ªäº‹ä»¶ï¼Œä¸€ä¸ªæ˜¯åŸæ–‡ä»¶çš„RENAMEäº‹ä»¶ï¼Œä¸€ä¸ªæ˜¯æ–°æ–‡ä»¶çš„CREATEäº‹ä»¶ã€‚\næ³¨æ„ï¼š\nfsnotifyä½¿ç”¨äº†æ“ä½œç³»ç»Ÿæ¥å£ï¼Œç›‘å¬å™¨ä¸­ä¿å­˜äº†ç³»ç»Ÿèµ„æºçš„å¥æŸ„ï¼Œæ‰€ä»¥ä½¿ç”¨åéœ€è¦å…³é—­ã€‚ ä¿®æ”¹æ–‡ä»¶æ“ä½œå»ºè®®ä¸è¦åœ¨IDEä¸­æ“ä½œï¼Œå¦‚GlLandã€‚IDEçš„ç¼“å­˜å’Œè‡ªåŠ¨ä¿å­˜ä¼šå“åº”è¾“å‡ºç»“æœã€‚å»ºè®®ç›´æ¥åœ¨ç³»ç»Ÿæ–‡ä»¶ç®¡ç†å™¨ä¸­æ“ä½œï¼Œæ‰ä¼šå‡ºç°ä¸Šé¢ç»“æœã€‚ # äº‹ä»¶ ä¸Šé¢ç¤ºä¾‹ä¸­çš„äº‹ä»¶æ˜¯fsnotify.Eventç±»å‹ï¼š\n1 2 3 4 5 // fsnotify/fsnotify.go type Event struct { Name string Op Op } äº‹ä»¶åªæœ‰ä¸¤ä¸ªå­—æ®µï¼ŒNameè¡¨ç¤ºå‘ç”Ÿå˜åŒ–çš„æ–‡ä»¶æˆ–ç›®å½•åï¼ŒOpè¡¨ç¤ºå…·ä½“çš„å˜åŒ–ã€‚Opæœ‰ 5 ç§å–å€¼ï¼š\n1 2 3 4 5 6 7 8 9 10 // fsnotify/fsnotify.go type Op uint32 const ( Create Op = 1 \u0026lt;\u0026lt; iota Write Remove Rename Chmod ) åœ¨å¿«é€Ÿä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬å·²ç»æ¼”ç¤ºäº†å‰ 4 ç§äº‹ä»¶ã€‚Chmodäº‹ä»¶åœ¨æ–‡ä»¶æˆ–ç›®å½•çš„å±æ€§å‘ç”Ÿå˜åŒ–æ—¶è§¦å‘ï¼Œåœ¨ Linux ç³»ç»Ÿä¸­å¯ä»¥é€šè¿‡chmodå‘½ä»¤æ”¹å˜æ–‡ä»¶æˆ–ç›®å½•å±æ€§ã€‚\näº‹ä»¶ä¸­çš„Opæ˜¯æŒ‰ç…§å·¦ç§»ä½è¿ç®—æ¥å­˜å‚¨çš„ï¼Œå¯ä»¥å­˜å‚¨å¤šä¸ªï¼Œå¯ä»¥é€šè¿‡\u0026amp;æ“ä½œåˆ¤æ–­å¯¹åº”äº‹ä»¶æ˜¯ä¸æ˜¯å‘ç”Ÿäº†ã€‚\n1 2 3 if event.Op \u0026amp; fsnotify.Write != 0 { fmt.Println(\u0026#34;Op has Write\u0026#34;) } è¡¥å……ï¼š\nâ€‹\tä¸è¿ç®—\u0026amp;ï¼šåŒä¸º1ä¸º1ã€‚\nâ€‹\tå·¦ç§»è¿ç®—\u0026laquo;ï¼šå‘åšåšç§»åŠ¨æŒ‡å®šä½ï¼Œä½ä½ç”¨0è¡¥é½\nâ€‹\tæˆ–è¿ç®—ï¼šæœ‰1å°±ä¸º1ã€‚ç”¨åœ¨ç»„åˆOpâ€”â€”\u0026gt;|\nâ€‹\täº‹ä»¶ä¸­çš„Opæ˜¯é€šè¿‡å·¦ç§»è¿ç®—ä¹‹åï¼Œç»“æœä¸º1,2,4,6,8åè¿›åˆ¶æ¥å­˜å‚¨çš„ï¼Œå®ƒä»¬çš„äºŒè¿›åˆ¶ä½éƒ½åªæœ‰ä¸€ä¸ª1ï¼Œå½“è¿›è¡Œä¸è¿ç®—æ—¶ï¼Œå°±å°±èƒ½åˆ¤æ–­æ˜¯å¦åŒ…å«æŒ‡å®šOpã€‚\nåˆ¤æ–­äº‹ä»¶ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªOpï¼Œå°è£…åˆ°äº†äº‹ä»¶å¯¹è±¡çš„Hasæ–¹æ³•ä¸‹ï¼š\n1 2 3 4 // fsnotify/fsnotify.go func (e Event) Has(op Op) bool { return e.Op.Has(op) } func (o Op) Has(h Op) bool { return o\u0026amp;h != 0 } // event.Op \u0026amp; fsnotify.Write != 0åŒç† å½“æˆ‘ä»¬ç›´æ¥è¾“å‡ºOpæ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨String()æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å¸®æˆ‘ä»¬å°†å¯¹åº”çš„Opï¼ˆuintç±»å‹ï¼‰è½¬æ¢æˆå®šä¹‰çš„å…·ä½“æ“ä½œï¼Œä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 func (o Op) String() string { var b strings.Builder if o.Has(Create) { b.WriteString(\u0026#34;|CREATE\u0026#34;) } if o.Has(Remove) { b.WriteString(\u0026#34;|REMOVE\u0026#34;) } if o.Has(Write) { b.WriteString(\u0026#34;|WRITE\u0026#34;) } if o.Has(Rename) { b.WriteString(\u0026#34;|RENAME\u0026#34;) } if o.Has(Chmod) { b.WriteString(\u0026#34;|CHMOD\u0026#34;) } if b.Len() == 0 { return \u0026#34;[no events]\u0026#34; } return b.String()[1:] } # åº”ç”¨ fsnotifyçš„åº”ç”¨éå¸¸å¹¿æ³›ï¼Œåœ¨ godoc ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å“ªäº›åº“å¯¼å…¥äº†fsnotifyã€‚åªéœ€è¿›å…¥fsnotify godocç‚¹å‡»Imported by 9,171ï¼Œå°±èƒ½æŸ¥çœ‹ã€‚æœ‰å…´è¶£çš„å¯ä»¥æ‰“å¼€çœ‹çœ‹ã€‚\nåœ¨ã€ŠGoé…ç½®ç®¡ç†ä¹‹ç¬¬ä¸‰æ–¹åº“viperã€‹æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†è°ƒç”¨viper.WatchConfigå°±å¯ä»¥ç›‘å¬é…ç½®ä¿®æ”¹ï¼Œè‡ªåŠ¨é‡æ–°åŠ è½½ã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹WatchConfigæ˜¯æ€ä¹ˆå®ç°çš„ï¼š\né¦–å…ˆæ¼”ç¤ºviperè‡ªåŠ¨æ›´æ–°é…ç½®\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 package main // mian.go import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;time\u0026#34; \u0026#34;github.com/fsnotify/fsnotify\u0026#34; \u0026#34;github.com/spf13/viper\u0026#34; ) func main() { viper.SetConfigFile(\u0026#34;./cfg.yaml\u0026#34;) err := viper.ReadInConfig() if err != nil { log.Fatal(\u0026#34;ReadInConfig error:\u0026#34;, err) } viper.OnConfigChange(func(in fsnotify.Event) { log.Printf(\u0026#34;%s %s usernameï¼š%s\\n\u0026#34;, in.Name, in.Op, viper.Get(\u0026#34;username\u0026#34;)) }) fmt.Println(\u0026#34;ä¿®æ”¹å‰çš„usernameï¼š\u0026#34;, viper.Get(\u0026#34;username\u0026#34;)) viper.WatchConfig() time.Sleep(10 * time.Second) // ä¿®æ”¹æ–‡ä»¶ fmt.Println(\u0026#34;ä¿®æ”¹åçš„usernameï¼š\u0026#34;, viper.Get(\u0026#34;username\u0026#34;)) } 1 2 # ./cfg.yaml username: arlettebrook è¿è¡Œä¹‹åï¼Œæ‰‹åŠ¨ä¿®æ”¹cfg.yamlusernameï¼ˆæ³¨æ„ä¸è¦åœ¨IDEä¸­ä¿®æ”¹ï¼Œä¼šå½±å“è¾“å‡ºæ•ˆæœï¼‰,åœ¨åé¢åˆ†åˆ«è¿½åŠ 1/2/3,å¹¶åˆ«ä¿å­˜ï¼Œè¾“å‡ºï¼š\n1 2 3 4 5 6 $ go run main.go ä¿®æ”¹å‰çš„usernameï¼š arlettebrook 2024/05/08 18:01:32 cfg.yaml WRITE usernameï¼šarlettebrook1 2024/05/08 18:01:36 cfg.yaml WRITE usernameï¼šarlettebrook12 2024/05/08 18:01:39 cfg.yaml WRITE usernameï¼šarlettebrook123 ä¿®æ”¹åçš„usernameï¼š arlettebrook123 å…·ä½“å®ç°ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 // viper/viper.go // WatchConfig starts watching a config file for changes. func WatchConfig() { v.WatchConfig() } // WatchConfig starts watching a config file for changes. func (v *Viper) WatchConfig() { initWG := sync.WaitGroup{} initWG.Add(1) go func() { watcher, err := fsnotify.NewWatcher() if err != nil { v.logger.Error(fmt.Sprintf(\u0026#34;failed to create watcher: %s\u0026#34;, err)) os.Exit(1) } defer watcher.Close() // we have to watch the entire directory to pick up renames/atomic saves in a cross-platform way filename, err := v.getConfigFile() if err != nil { v.logger.Error(fmt.Sprintf(\u0026#34;get config file: %s\u0026#34;, err)) initWG.Done() return } configFile := filepath.Clean(filename) configDir, _ := filepath.Split(configFile) realConfigFile, _ := filepath.EvalSymlinks(filename) eventsWG := sync.WaitGroup{} eventsWG.Add(1) go func() { for { select { case event, ok := \u0026lt;-watcher.Events: if !ok { // \u0026#39;Events\u0026#39; channel is closed eventsWG.Done() return } currentConfigFile, _ := filepath.EvalSymlinks(filename) // we only care about the config file with the following cases: // 1 - if the config file was modified or created // 2 - if the real path to the config file changed (eg: k8s ConfigMap replacement) if (filepath.Clean(event.Name) == configFile \u0026amp;\u0026amp; (event.Has(fsnotify.Write) || event.Has(fsnotify.Create))) || (currentConfigFile != \u0026#34;\u0026#34; \u0026amp;\u0026amp; currentConfigFile != realConfigFile) { realConfigFile = currentConfigFile err := v.ReadInConfig() if err != nil { v.logger.Error(fmt.Sprintf(\u0026#34;read config file: %s\u0026#34;, err)) } if v.onConfigChange != nil { v.onConfigChange(event) } } else if filepath.Clean(event.Name) == configFile \u0026amp;\u0026amp; event.Has(fsnotify.Remove) { eventsWG.Done() return } case err, ok := \u0026lt;-watcher.Errors: if ok { // \u0026#39;Errors\u0026#39; channel is not closed v.logger.Error(fmt.Sprintf(\u0026#34;watcher error: %s\u0026#34;, err)) } eventsWG.Done() return } } }() watcher.Add(configDir) initWG.Done() // done initializing the watch in this go routine, so the parent routine can move on... eventsWG.Wait() // now, wait for event loop to end in this go-routine... }() initWG.Wait() // make sure that the go routine above fully ended before returning } å…¶å®æµç¨‹æ˜¯ç›¸ä¼¼çš„ï¼š\né¦–å…ˆï¼Œè°ƒç”¨NewWatcheråˆ›å»ºä¸€ä¸ªç›‘å¬å™¨ï¼› è°ƒç”¨v.getConfigFile()è·å–é…ç½®æ–‡ä»¶è·¯å¾„ï¼ŒæŠ½å‡ºæ–‡ä»¶åã€ç›®å½•ï¼Œé…ç½®æ–‡ä»¶å¦‚æœæ˜¯ä¸€ä¸ªç¬¦å·é“¾æ¥ï¼Œè·å¾—é“¾æ¥æŒ‡å‘çš„è·¯å¾„ï¼› è°ƒç”¨watcher.Add(configDir)ç›‘å¬é…ç½®æ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼Œå¦èµ·ä¸€ä¸ª goroutine å¤„ç†äº‹ä»¶ã€‚ WatchConfigä¸èƒ½é˜»å¡ä¸» goroutineï¼Œæ‰€ä»¥åˆ›å»ºç›‘å¬å™¨ä¹Ÿæ˜¯æ–°èµ· goroutine è¿›è¡Œçš„ã€‚ä»£ç ä¸­æœ‰ä¸¤ä¸ªsync.WaitGroupå˜é‡ï¼ŒinitWGæ˜¯ä¸ºäº†ä¿è¯ç›‘å¬å™¨åˆå§‹åŒ–ï¼Œ eventsWGæ˜¯åœ¨äº‹ä»¶é€šé“å…³é—­ï¼Œæˆ–é…ç½®è¢«åˆ é™¤äº†ï¼Œæˆ–é‡åˆ°é”™è¯¯æ—¶é€€å‡ºäº‹ä»¶å¤„ç†å¾ªç¯ã€‚\nç„¶åå°±æ˜¯æ ¸å¿ƒäº‹ä»¶å¾ªç¯ï¼š\næœ‰äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œåˆ¤æ–­å˜åŒ–çš„æ–‡ä»¶æ˜¯å¦æ˜¯åœ¨ viper ä¸­è®¾ç½®çš„é…ç½®æ–‡ä»¶ï¼Œå‘ç”Ÿçš„æ˜¯å¦æ˜¯åˆ›å»ºæˆ–ä¿®æ”¹äº‹ä»¶ï¼ˆåªå¤„ç†è¿™ä¸¤ä¸ªäº‹ä»¶ï¼‰ï¼› å¦‚æœé…ç½®æ–‡ä»¶ä¸ºç¬¦å·é“¾æ¥ï¼Œè‹¥ç¬¦åˆé“¾æ¥çš„æŒ‡å‘ä¿®æ”¹äº†ï¼Œä¹Ÿéœ€è¦é‡æ–°åŠ è½½é…ç½®ï¼› å¦‚æœéœ€è¦é‡æ–°åŠ è½½é…ç½®ï¼Œè°ƒç”¨v.ReadInConfig()è¯»å–æ–°çš„é…ç½®ï¼› å¦‚æœæ³¨å†Œäº†äº‹ä»¶å›è°ƒï¼Œä»¥å‘ç”Ÿçš„äº‹ä»¶ä¸ºå‚æ•°æ‰§è¡Œå›è°ƒã€‚ # æ€»ç»“ fsnotifyçš„æ¥å£éå¸¸ç®€å•ç›´æ¥ï¼Œæ‰€æœ‰ç³»ç»Ÿç›¸å…³çš„å¤æ‚æ€§éƒ½è¢«å°è£…èµ·æ¥äº†ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¹³æ—¶è®¾è®¡æ¨¡å—å’Œæ¥å£æ—¶å¯ä»¥å‚è€ƒçš„æ¡ˆä¾‹ã€‚\n# å‚è€ƒ fsnotify API è®¾è®¡ fsnotify GitHub ä»“åº“ åŸæ–‡ï¼šGo æ¯æ—¥ä¸€åº“ä¹‹ fsnotify ","date":"2024-05-08T15:49:50+08:00","permalink":"https://arlettebrook.github.io/p/fsnotify-introduction/","title":"Fsnotify Introduction"},{"content":" å¼€æºåè®®(å¼€æºè®¸å¯è¯)æ˜¯æ¯ä¸€ä¸ªæƒ³è¦åšå¼€æºè½¯ä»¶çš„å¼€å‘è€…éƒ½éœ€è¦äº†è§£çš„ï¼Œå³ä½¿ä½ ä¸æƒ³åšå¼€æºè½¯ä»¶ï¼Œé‚£ä¹ˆå½“ä½ ä½¿ç”¨ä»–äººå¼€æºçš„è½¯ä»¶æ—¶ä¹Ÿéœ€è¦äº†è§£ä¸€äº›å¼€æºåè®®ç›¸å…³çš„å†…å®¹ï¼Œè¿™æ ·èƒ½å¤Ÿå°½é‡é¿å…ä¸€äº›ä¸å¿…è¦çš„éº»çƒ¦ã€‚\n# ä»€ä¹ˆæ˜¯å¼€æº å¼€æºå³å¼€æ”¾æºä»£ç ï¼Œæ˜¯ OSI (Open Source Initiative) è¿™ä¸ªç»„ç»‡æå‡ºæ¥çš„ã€‚è€Œè¢«å¼€æºçš„è½¯ä»¶ï¼Œæˆ‘ä»¬é€šå¸¸ç§°ä¸ºå¼€æºè½¯ä»¶ã€‚ä½ å¯èƒ½è¿˜è§åˆ°è¿‡ Free Software ä¸€è¯ï¼Œå®ƒä»£è¡¨ è‡ªç”±è½¯ä»¶ è€Œé å…è´¹è½¯ä»¶ï¼Œæ˜¯å¼€æºè½¯ä»¶çš„å‰èº«ã€‚\nå¼€æºè½¯ä»¶ = å¼€æ”¾æºä»£ç  + å¼€æºåè®®ï¼Œä¸€ä»½æ²¡æœ‰æ·»åŠ å¼€æºåè®®çš„å¼€æºä»£ç ï¼Œå¹¶ä¸æ˜¯çœŸæ­£çš„å¼€æºè½¯ä»¶ï¼Œä¹Ÿå°±ä¸èƒ½éšæ„ä½¿ç”¨ã€‚\næ³¨æ„ï¼šå¦‚æœä½ åœ¨ GitHub ä¸Šåˆ›å»ºäº†ä¸€ä¸ªæ²¡æœ‰å¼€æºåè®®çš„å…¬å…±ä»£ç ä»“åº“ï¼Œå…¶ä»–ç”¨æˆ·ä»ç„¶æœ‰æƒæŸ¥çœ‹å¹¶ä¸ºå…¶åˆ›å»ºåˆ†æ”¯ï¼Œè¿™æ˜¯ç”± GitHub çš„æœåŠ¡æ¡æ¬¾å†³å®šçš„ã€‚\n# å¼€æºè®¸å¯è¯ å¼€æºåè®®æ˜¯æŒ‡å¼€æºè½¯ä»¶æ‰€æºå¸¦çš„ä¸€ä»½å£°æ˜åè®®ï¼Œè¿™ä»½åè®®ä¹Ÿå«å¼€æºè®¸å¯è¯ã€‚å¼€æºè®¸å¯è¯å£°æ˜äº†å¼€æºåè®®çš„å†…å®¹ï¼Œè§„å®šäº†åŸä½œè€…å’Œä½¿ç”¨è€…çš„æƒåˆ©ä»¥åŠä¹‰åŠ¡ã€‚\nå¼€æºè®¸å¯è¯æ˜¯å¼€æºè½¯ä»¶ç”Ÿæ€ç³»ç»Ÿçš„åŸºç¡€ï¼Œå¯ä»¥ä¿ƒè¿›è½¯ä»¶çš„ååŒå¼€å‘ã€‚\nå¼€æºè®¸å¯è¯æ˜¯å…·æœ‰æ³•å¾‹æ•ˆåŠ›çš„ï¼Œå¹¶ä¸”éœ€è¦å¾—åˆ° OSI è¿™ä¸ªç»„ç»‡çš„è®¤è¯ï¼Œç›®å‰ OSI å…±è®¡è®¤è¯äº† 110+ ä¸ªå¼€æºè®¸å¯è¯ï¼Œè¿™äº›è¢«è®¤è¯çš„å¼€æºè®¸å¯è¯éƒ½å¿…é¡»éµå¾ª OSD (Open Source Definition) è§„åˆ™ã€‚\nè™½ç„¶å¼€æºè®¸å¯è¯éå¸¸å¤šï¼Œä½†å¸¸ç”¨çš„å°±é‚£ä¹ˆå‡ ç§ã€‚å¸¸è§çš„å¼€æºè®¸å¯è¯ä¸»è¦æœ‰ Apacheã€MITã€BSDã€GPLã€LGPLã€MPLã€SSPL ç­‰ã€‚\nå¼€æºè®¸å¯è¯åˆ†æˆä¸¤å¤§ç±»ï¼šå®½æ¾å‹è®¸å¯è¯ï¼ˆPermissive Licensesï¼‰ã€è‘—ä½œæƒå‹è®¸å¯è¯ï¼ˆåç‰ˆæƒè®¸å¯è¯ï¼‰ï¼ˆCopyleft Licensesï¼‰ã€‚\nâ€‹\tå®½æ¾å‹è®¸å¯è¯ï¼ˆPermissive Licensesï¼‰æ˜¯ä¸€ç§å¯¹è½¯ä»¶çš„ä½¿ç”¨ã€ä¿®æ”¹ã€ä¼ æ’­ç­‰æ–¹å¼é‡‡ç”¨æœ€ä½é™åˆ¶çš„è‡ªç”±è½¯ä»¶è®¸å¯åè®®æ¡æ¬¾ç±»å‹ã€‚è¿™ç§ç±»å‹çš„è½¯ä»¶è®¸å¯åè®®å°†ä¸ä¿è¯åŸä½œå“çš„æ´¾ç”Ÿä½œå“ä¼šç»§ç»­ä¿æŒä¸åŸä½œå“å®Œå…¨ç›¸åŒçš„ç›¸å…³é™åˆ¶æ¡ä»¶ï¼Œä»è€Œä¸ºåŸä½œå“çš„è‡ªç”±ä½¿ç”¨ã€ä¿®æ”¹å’Œä¼ æ’­ç­‰æä¾›æ›´å¤§çš„ç©ºé—´ã€‚\nâ€‹\tè‘—ä½œæƒå‹è®¸å¯è¯ï¼ˆCopyleft Licensesï¼‰æ˜¯ç»åŸä½œè€…è®¸å¯åœ¨æœ‰é™ç©ºé—´å†…çš„è‡ªç”±ä½¿ç”¨ã€ä¿®æ”¹å’Œä¼ æ’­ï¼Œä¸”ä¸å¾—è¿èƒŒåŸä½œå“çš„é™åˆ¶æ¡æ¬¾ã€‚å¦‚æœä¸€æ¬¾è½¯ä»¶ä½¿ç”¨ Copyleft ç±»å‹è®¸å¯åè®®è§„å®šè½¯ä»¶ä¸å¾—ç”¨äºå•†ä¸šç”¨é€”ï¼Œä¸”ä¸å¾—é—­æºï¼Œé‚£ä¹ˆåç»­çš„è¡ç”Ÿå­è½¯ä»¶ä¹Ÿå¿…é¡»å¾—éµå¾ªè¯¥æ¡æ¬¾ã€‚\nä¸¤è€…æœ€å¤§çš„å·®åˆ«åœ¨äºï¼šåœ¨è½¯ä»¶è¢«ä¿®æ”¹å¹¶å†å‘è¡Œæ—¶ï¼Œ Copyleft License ä»ç„¶å¼ºåˆ¶è¦æ±‚å…¬å¼€æºä»£ç ï¼ˆè¡ç”Ÿè½¯ä»¶éœ€è¦å¼€æºï¼‰ï¼Œè€Œ Permissive licence ä¸è¦æ±‚å…¬å¼€æºä»£ç ï¼ˆè¡ç”Ÿè½¯ä»¶å¯ä»¥å˜ä¸ºä¸“æœ‰è½¯ä»¶ï¼‰ã€‚\nå…¶ä¸­ï¼ŒApacheã€MITã€BSD éƒ½æ˜¯å®½æ¾å‹è®¸å¯è¯ï¼ŒGPL æ˜¯å…¸å‹çš„è‘—ä½œæƒå‹ï¼ˆcopyleft ï¼‰è®¸å¯è¯ï¼ŒLGPLã€MPL æ˜¯å¼±è‘—ä½œæƒå‹ï¼ˆcopyleft ï¼‰è®¸å¯è¯ã€‚SSPL åˆ™æ˜¯è¿‘å¹´æ¥ MongoDB åˆ›å»ºçš„ä¸€ä¸ªæ–°è®¸å¯è¯ï¼Œå­˜åœ¨è¾ƒå¤§äº‰è®®ï¼Œå¼€æ”¾æºä»£ç ä¿ƒè¿›ä¼š OSI ç”šè‡³è®¤ä¸º SSPL å°±ä¸æ˜¯å¼€æºè®¸å¯åè®®ã€‚\næ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ç±»æ˜¯ Creative Commonsï¼ˆCCï¼‰çŸ¥è¯†å…±äº«åè®®ã€‚ä¸¥æ ¼æ„ä¹‰ä¸Šè¯´è¯¥åè®®å¹¶ä¸èƒ½è¯´æ˜¯çœŸæ­£çš„å¼€æºåè®®ï¼Œå®ƒä»¬å¤§å¤šæ˜¯è¢«ä½¿ç”¨äºè®¾è®¡ç±»çš„å·¥ç¨‹ä¸Šã€‚CC åè®®ç§ç±»ç¹å¤šï¼Œæ¯ä¸€ç§éƒ½æˆæƒç‰¹å®šçš„æƒåˆ©ã€‚å¤§å¤šæ•°çš„æ¯”è¾ƒä¸¥æ ¼çš„ CC åè®®ä¼šå£°æ˜ â€œç½²åæƒï¼Œéå•†ä¸šç”¨é€”ï¼Œç¦æ­¢è¡ç”Ÿâ€ æ¡æ¬¾ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥è‡ªç”±çš„åˆ†äº«è¿™ä¸ªä½œå“ï¼Œä½†ä½ ä¸èƒ½æ”¹å˜å®ƒå’Œå¯¹å…¶æ”¶è´¹ï¼Œè€Œä¸”å¿…é¡»å£°æ˜ä½œå“çš„å½’å±ã€‚è¿™ä¸ªè®¸å¯åè®®éå¸¸çš„æœ‰ç”¨ï¼Œå®ƒå¯ä»¥è®©ä½ çš„ä½œå“ä¼ æ’­å‡ºå»ï¼Œä½†åˆå¯ä»¥å¯¹ä½œå“çš„ä½¿ç”¨ä¿ç•™éƒ¨åˆ†æˆ–å®Œå…¨çš„æ§åˆ¶ã€‚æœ€å°‘é™åˆ¶çš„ CC åè®®ç±»å‹å½“å± â€œç½²åâ€ åè®®ï¼Œè¿™æ„å‘³ç€åªè¦äººä»¬èƒ½ç»´æŠ¤ä½ çš„åèª‰ï¼Œä»–ä»¬å¯¹ä½ çš„ä½œå“æ€ä¹ˆä½¿ç”¨éƒ½è¡Œã€‚\nä¸‹é¢å°±ä¸»è¦ä»‹ç»ä¸‹å‡ ç§å¸¸è§å¼€æºè®¸å¯è¯ã€‚\n# å®½æ¾å‹è®¸å¯è¯ï¼ˆPermissive Licensesï¼‰ é¡¾åæ€ä¹‰ï¼Œè¿™ç±»å¼€æºè®¸å¯è¯æ¯”è¾ƒå®½æ¾ï¼Œé™åˆ¶æ›´å°‘ã€‚å¸¸è§å®½æ¾å¼€æºè®¸å¯è¯æœ‰ï¼š\nBSD (2-Clause) (Berkeley Software Distributionï¼Œä¼¯å…‹åˆ©è½¯ä»¶å‘è¡Œç‰ˆ)\næºä»£ç æˆ–äºŒè¿›åˆ¶å½¢å¼çš„é‡æ–°åˆ†å‘ï¼Œå¿…é¡»ä¿ç•™åŸå§‹çš„è®¸å¯è¯å£°æ˜ã€‚\nBSD (3-Clause)\nåœ¨ BSD(2-Clause) åŸºç¡€ä¸Šå¢åŠ äº†ä¸€æ¡ï¼Œç¦æ­¢ä½¿ç”¨åŸå§‹ä½œè€…çš„åå­—ä¸ºè¡ç”Ÿè½¯ä»¶è¿›è¡Œä¿ƒé”€ã€‚\nGo è¯­è¨€å°±åœ¨ä½¿ç”¨ BSD (3-Clause) å¼€æºè®¸å¯è¯ã€‚\nMIT (Massachusetts Institute of Technologyï¼Œéº»çœç†å·¥å­¦é™¢è®¸å¯è¯)\nå…è´¹æˆäºˆä»»ä½•äººè¯¥è½¯ä»¶åŠç›¸å…³æ–‡æ¡£çš„æƒé™ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºä½¿ç”¨ã€å¤åˆ¶ã€ä¿®æ”¹ã€åˆå¹¶ã€å‘è¡¨ã€åˆ†å‘ã€å†æˆæƒã€å‡ºå”®è½¯ä»¶çš„å‰¯æœ¬ã€‚åˆ†å‘è½¯ä»¶æ—¶ï¼Œå¿…é¡»ä¿ç•™åŸå§‹çš„è®¸å¯è¯å£°æ˜ã€‚\nMIT æ˜¯æœ€ä¸ºå®½æ¾çš„å¼€æºè®¸å¯è¯ï¼Œæ‰€ä»¥è¿™ä¹Ÿä½¿å¾—å®ƒæˆä¸ºæœ€æµè¡Œçš„å¼€æºè®¸å¯è¯ï¼Œå¦‚ç›®å‰åœ¨å‰ç«¯é¢†åŸŸéå¸¸æœ‰åçš„ Vue.js å°±åœ¨ä½¿ç”¨å®ƒã€‚\nApache-2.0 (Apache è½¯ä»¶åŸºé‡‘ä¼šå‘å¸ƒçš„è®¸å¯è¯)\nApache è®¸å¯è¯å†…å®¹éå¸¸å¤šï¼Œä¸è¿‡å¯ä»¥ç®€å•çš„æ€»ç»“å‡ ç‚¹ï¼š\nåˆ†å‘è½¯ä»¶æ—¶ï¼Œå¿…é¡»ä¿ç•™åŸå§‹çš„è®¸å¯è¯å£°æ˜ã€‚\næ‰€æœ‰ä¿®æ”¹è¿‡çš„æ–‡ä»¶ï¼Œå¿…é¡»åŠ ä»¥è¯´æ˜å‘ŠçŸ¥ç”¨æˆ·æ­¤æ–‡ä»¶å·²è¢«æ›´æ”¹ã€‚\næ²¡æœ‰ä¿®æ”¹è¿‡çš„æ–‡ä»¶ï¼Œä¸å¾—ä¿®æ”¹è®¸å¯è¯ã€‚\näº‘åŸç”Ÿé¢†åŸŸè‘—åè½¯ä»¶ Kubernetes ä½¿ç”¨çš„æ­£æ˜¯ Apache-2.0 å¼€æºè®¸å¯è¯ã€‚\n# è‘—ä½œæƒå‹è®¸å¯è¯ï¼ˆCopyleft Licensesï¼‰ Copyleft ä¸€è¯ç”± ç†æŸ¥å¾·Â·æ–¯æ‰˜æ›¼ å‘æ˜ï¼Œè¡¨ç¤º Copyright (ç‰ˆæƒ) çš„åä¹‰è¯ã€‚Copyleft è¡¨ç¤ºä¸ç»è®¸å¯ï¼Œç”¨æˆ·æ— æƒå¤åˆ¶ï¼Œå•†ä¸šè½¯ä»¶å¼€å‘äººå‘˜é€šè¿‡ Copyleftå‰¥å¤ºäº†ç”¨æˆ·çš„è‡ªç”±ã€‚Copyright åˆ™è¡¨ç¤ºä¸ç»è®¸å¯ï¼Œç”¨æˆ·æœ‰æƒå¤åˆ¶ï¼ŒCopyrightä½¿ç”¨ç‰ˆæƒæ¥ç»™äºˆç”¨æˆ·è‡ªç”±ã€‚\nå› æ­¤Copyleft ç±»çš„è®¸å¯è¯è¦æ¯” Permissive è®¸å¯è¯é™åˆ¶æ›´å¤šã€‚æ³¨æ„ï¼šä¸ä¸€å®šè¦ç»è¿‡åŸä½œè€…è®¸å¯ã€‚å¸¸è§ Copyleft å¼€æºè®¸å¯è¯æœ‰ï¼š\nGPL (GNU General Public License)\nGPL æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼ŒGPL-2.0 å’Œ GPL-3ï¼ŒåŒ BSD ä¸€æ ·ï¼Œæ›´é«˜ç‰ˆæœ¬ä¼šå¸¦æ¥æ›´å¤šçš„é™åˆ¶ã€‚GPL åè®®å†…å®¹ä¹Ÿéå¸¸å¤šï¼Œæˆ‘ä»¬æœ€éœ€è¦å…³æ³¨çš„ä¸€ç‚¹æ˜¯ï¼šä½¿ç”¨äº† GPL åè®®çš„å¼€æºè½¯ä»¶ï¼Œå…¶è¡ç”Ÿè½¯ä»¶å¦‚æœéœ€è¦åˆ†å‘ï¼Œå°±å¿…é¡»å¼€æºå¹¶ä¸”åŒæ ·è¦ä½¿ç”¨æ­¤åè®®ã€‚\nç”±äºè¿™æ¡è§„å®šçš„å­˜åœ¨ï¼Œæœ‰äººç”šè‡³æŠŠ GPL åè®®ç§°ä¸º â€œGPL ç—…æ¯’â€ï¼Œå› ä¸ºå®ƒå…·æœ‰è·Ÿç—…æ¯’ä¸€æ ·çš„ä¼ æŸ“æ€§ã€‚ä¸è¿‡ GPL ä»ç„¶æ˜¯éå¸¸æµè¡Œçš„å¼€æºè®¸å¯è¯ï¼Œæ¯”å¦‚å¤§åé¼é¼çš„ Linux å°±é‡‡ç”¨äº† GPL åè®®ã€‚\nGPL æ˜¯æµè¡Œå¼€æºè®¸å¯è¯ä¸­æœ€ä¸ºä¸¥æ ¼çš„ï¼Œæ‰€ä»¥å¯¹äºä½¿ç”¨å¼€æºè½¯ä»¶æ‰€è¡åŒ–çš„å•†ä¸šåŒ–è½¯ä»¶å°±ä¸å¤Ÿå‹å¥½äº†ã€‚\nLGPL (GNU Library General Public License)\nç®—æ˜¯ GPL çš„ä¸€ä¸ªå˜ç§ï¼Œä¸»è¦ä¸ºç±»åº“ä½¿ç”¨è€Œè®¾è®¡çš„å¼€æºåè®®ã€‚\nå•†ç”¨è½¯ä»¶å¦‚æœé‡‡ç”¨ç±»åº“æ–¹å¼å¼•ç”¨ä½¿ç”¨äº† LGPL åè®®çš„å¼€æºè½¯ä»¶ï¼Œåˆ™å¯ä»¥ä¸ç”¨å¼€æºã€‚\nå¦‚æœæ˜¯ä¿®æ”¹æˆ–è¡ç”Ÿè½¯ä»¶éœ€è¦åˆ†å‘ï¼Œåˆ™å¿…é¡»å¼€æºå¹¶ä¸”åŒæ ·è¦ä½¿ç”¨æ­¤åè®®ã€‚è¿™ç‚¹ä¸ GPL åè®®ä¸€æ ·ã€‚\nAGPL (GNU Affero General Public License)\né™¤äº† AGPL è®¸å¯è¯ï¼Œä¸Šé¢ä»‹ç»çš„å…¶ä»–è®¸å¯è¯çš„é™åˆ¶æ¡ä»¶éƒ½æ˜¯åªæœ‰åœ¨åˆ†å‘æ—¶æ‰éœ€è¦éµå®ˆã€‚è€Œ SaaS è½¯ä»¶ä½œä¸ºä¸€é¡¹äº‘æœåŠ¡åˆ™ä¸æ„æˆåˆ†å‘ï¼Œæ‰€ä»¥å¯ä»¥ä¸éµå®ˆè¿™äº›è®¸å¯è¯æ¡æ¬¾ã€‚\nä¸ºäº†è§£å†³è¿™äº›æ—©æœŸå‘å¸ƒçš„è®¸å¯è¯å¯¹ SaaS è½¯ä»¶æ— æ•ˆçš„å°´å°¬ï¼ŒGNU åˆå‘å¸ƒäº† AGPL è®¸å¯è¯ï¼Œå®ƒè§„å®šå¦‚æœ SaaS ç”¨åˆ°çš„ä»£ç æ˜¯è¯¥è®¸å¯è¯ï¼Œé‚£ä¹ˆå…¶äº‘æœåŠ¡çš„ä»£ç ä¹Ÿå¿…é¡»å¼€æºã€‚\nå›½äº§å¼€æºæ—¶åºæ•°æ®åº“ TDengine ä¸ºäº†é˜»æ­¢äº‘å‚å•†å…è´¹ä½¿ç”¨å…¶å¼€æºç‰ˆæœ¬ï¼Œå°±é‡‡ç”¨äº† AGPL åè®®ã€‚\nMPL-2.0 (Mozilla Public License 2.0ï¼ŒMozilla åŸºé‡‘ä¼šå‘å¸ƒçš„è®¸å¯è¯)\nMPL èåˆäº† BSD å¼€æºè®¸å¯è¯ å’Œ GPL å¼€æºè®¸å¯è¯ çš„ç‰¹æ€§ï¼ŒåŠ›äº‰åœ¨ä¸“æœ‰è½¯ä»¶å’Œå¼€æºè½¯ä»¶å¼€å‘è€…ä¹‹é—´å¯»æ±‚å¹³è¡¡ã€‚æ˜¯æ¯” BSD æ›´ä¸¥æ ¼ï¼Œæ¯” GPL æ›´å®½æ¾çš„å¼€æºè®¸å¯è¯ã€‚\nMPL å…è®¸æ–°å¢çš„ç‹¬ç«‹ä»£ç æ–‡ä»¶é—­æºï¼Œä½†åœ¨ MPL æˆæƒä¸‹çš„ä»£ç æ–‡ä»¶å¿…é¡»ä¿æŒ MPL æˆæƒä¸”å¼€æºã€‚è¿™ä½¿å¾— MPL æ—¢ä¸åƒ MIT å’Œ BSD é‚£æ ·å…è®¸æ´¾ç”Ÿä½œå“å®Œå…¨è½¬åŒ–ä¸ºé—­æºï¼Œä¹Ÿä¸åƒ GPL é‚£æ ·è¦æ±‚æ‰€æœ‰çš„æ´¾ç”Ÿä½œå“ï¼ŒåŒ…æ‹¬æ–°çš„ç»„ä»¶åœ¨å†…ï¼Œå¿…é¡»å…¨éƒ¨ä¿æŒä½¿ç”¨ GPLã€‚\nMozilla è‡ªå®¶çš„ Firefox æµè§ˆå™¨å°±ä½¿ç”¨æ­¤å¼€æºè®¸å¯è¯ã€‚\nä»¥ä¸Šä»‹ç»çš„å¼€æºè®¸å¯è¯éƒ½æ˜¯è¾ƒä¸ºå¸¸è§çš„è®¸å¯è¯ï¼Œå¦å¤–è¿˜æœ‰ä¸¤ä¸ªä¸å¤ªå¸¸è§ä½†å´å€¼å¾—ä¸€æçš„è®¸å¯è¯ã€‚\nä¸€ä¸ªæ˜¯ Unlicense è®¸å¯è¯ï¼Œç¿»è¯‘è¿‡æ¥å«ã€Œé›¶çº¦æŸè®¸å¯è¯ã€ï¼Œå¯ä»¥è¯´æ˜¯è¢« OSI è®¤è¯çš„æœ€å¼€æ”¾çš„è®¸å¯è¯äº†ã€‚æ ¹æ®åå­—ä¹Ÿèƒ½çœ‹å‡ºæ¥ï¼ŒUnlicense æ˜¯ä¸€ä¸ªä¸åŒ…å«ä»»ä½•çº¦æŸæ¡ä»¶çš„è®¸å¯è¯ï¼Œä¸“ç”¨äºè´¡çŒ®ä½œå“åˆ°å…¬å…±é¢†åŸŸã€‚ä»»ä½•äººéƒ½å¯ä»¥å¯¹å¼€æºè½¯ä»¶è¿›è¡Œè‡ªç”±å¤åˆ¶ã€ä¿®æ”¹ã€å‘å¸ƒã€ä½¿ç”¨ã€ç¼–è¯‘ã€å‡ºå”®ç­‰ï¼Œå¹¶ä¸”å¯ç”¨äºä»»ä½•å•†ä¸šæˆ–éå•†ä¸šç›®çš„ã€‚\nå¦å¤–ï¼Œåœ¨ OSI å®˜ç½‘å…¬å¸ƒçš„å¼€æºè®¸å¯è¯åˆ—è¡¨ä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªå«ã€Œæœ¨å…°ï¼ˆMulan PSL2ï¼‰ã€çš„å¼€æºè®¸å¯è¯ï¼Œå®ƒæ˜¯ä¸­å›½æœ¬åœŸå”¯ä¸€è·å¾— OSI è®¤å¯çš„å¼€æºè®¸å¯è¯ã€‚Mulan PSL2 ä»¥ä¸­è‹±æ–‡åŒè¯­è¡¨è¿°ï¼Œä¸­è‹±æ–‡ç‰ˆæœ¬å…·æœ‰åŒç­‰æ³•å¾‹æ•ˆåŠ›ã€‚å¦‚æœä¸­è‹±æ–‡ç‰ˆæœ¬å­˜åœ¨ä»»ä½•å†²çªä¸ä¸€è‡´ï¼Œä»¥ä¸­æ–‡ç‰ˆä¸ºå‡†ã€‚\nã€Œæœ¨å…°ã€å¹¶ä¸æ˜¯ä¸€ä¸ªè®¸å¯è¯ï¼Œè€Œæ˜¯ä¸€ç³»åˆ—è®¸å¯è¯ï¼Œå®ƒåŒ…å«æœ¨å…°å®½æ¾è®¸å¯è¯ã€æœ¨å…°å…¬å…±è®¸å¯è¯ã€æœ¨å…°å¼€æ”¾ä½œå“è®¸å¯åè®®ã€‚å…¶ä¸­æœ¨å…°å®½æ¾è®¸å¯è¯ç¬¬ 2 ç‰ˆï¼ˆMulan PSL2ï¼‰åœ¨ 2020 å¹´ 2 æœˆ 14 æ—¥é€šè¿‡ OSI æ‰¹å‡†ã€‚\nå¦‚æœä½ æƒ³ä½¿ç”¨ä¸€ä¸ªä¸­æ–‡çš„å¼€æºè®¸å¯è¯ï¼Œé‚£ä¹ˆ Mulan PSL2 ç›®å‰æ˜¯ä½ å”¯ä¸€çš„é€‰æ‹©ã€‚\n# ä½¿ç”¨å¼€æºè®¸å¯è¯ ä»¥ MIT ä¸ºä¾‹ï¼Œæˆ‘ä»¬æ¥å­¦ä¹ ä¸‹å¦‚ä½•åœ¨è‡ªå·±çš„å¼€æºé¡¹ç›®ä¸­ä½¿ç”¨å¼€æºè®¸å¯è¯ï¼š\né¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨è‡ªå·±çš„å¼€æºé¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªå« LICENSE çš„æ–‡æœ¬æ–‡ä»¶ï¼Œæ³¨æ„æ–‡ä»¶åä¸åŒ…å«ä»»ä½•åç¼€ã€‚\nç„¶åå»åˆ° OSI å®˜ç½‘æ‰¾åˆ° MIT å¼€æºè®¸å¯è¯æ¨¡æ¿ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 Copyright \u0026lt;YEAR\u0026gt; \u0026lt;COPYRIGHT HOLDER\u0026gt; Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the â€œSoftwareâ€), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions: The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software. THE SOFTWARE IS PROVIDED â€œAS ISâ€, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE. å°†å¼€æºè®¸å¯è¯æ¨¡æ¿å†…å®¹å¤åˆ¶åˆ° LICENSE æ–‡æœ¬æ–‡ä»¶ä¸­ï¼Œå¹¶å°†ç¬¬ä¸€è¡Œ Copyright åé¢çš„ \u0026lt;YEAR\u0026gt; æ›¿æ¢ä¸ºå½“å‰å¹´ä»½ï¼Œå°† \u0026lt;COPYRIGHT HOLDER\u0026gt; æ›¿æ¢ä¸ºè‡ªå·±çš„åå­—ã€‚\nå½“å¼€æ”¾é¡¹ç›®æºä»£ç æ—¶ï¼Œå°†æ­¤æ–‡ä»¶ä¸€åŒå¼€æ”¾å‡ºå»å³å¯ã€‚å¦‚æœä½ ä½¿ç”¨ GitHub å¼€æ”¾æºç ï¼Œåˆ™åªéœ€è¦å°†æ­¤ LICENSE åŠ å…¥åˆ° git ç®¡ç†å³å¯ã€‚\nå¦‚æœä½ æ˜¯åœ¨ GitHub ä¸Šæ–°å»ºå¼€æºé¡¹ç›®ï¼Œåœ¨åˆ›å»ºé¡¹ç›®ç•Œé¢ï¼Œæœ‰ä¸€ä¸ª Choose a license æŒ‰é’®å¯ä»¥å¾ˆæ–¹ä¾¿çš„é€‰æ‹©ä¸€æ¬¾å¼€æºåè®®ï¼Œå¹¶ä¸” GitHub ä¼šè‡ªåŠ¨æ›¿æ¢è®¸å¯è¯æ¨¡æ¿ä¸­çš„å¹´ä»½ã€ä½œè€…ç­‰ä¿¡æ¯ã€‚ å¦å¤–ï¼Œæˆ‘ä»¬åœ¨å¼€æ”¾æºä»£ç æ—¶ï¼Œå…¶å®å¯ä»¥ä¸ä½¿ç”¨ OSI è®¤è¯çš„å¼€æºè®¸å¯è¯ï¼Œè€Œæ˜¯é€‰æ‹©è‡ªå·±å†™ä¸€ä»½è®¸å¯è¯ï¼Œç”¨æ¥å£°æ˜ç‰ˆæƒã€‚è¿™åŒæ ·æ˜¯å…·æœ‰æ³•å¾‹æ•ˆåŠ›çš„ï¼Œä¸è¿‡è¿™ä»½è®¸å¯è¯å°±ä¸èƒ½å«åšå¼€æºè®¸å¯è¯äº†ã€‚ # å¦‚ä½•é€‰æ‹©å¼€æºè®¸å¯è¯ ä¹Œå…‹å…°ç¨‹åºå‘˜ Paul Bagwell ç”»äº†ä¸€å¼ å›¾åœ¨ç½‘ä¸Šå¾ˆæ˜¯æµè¡Œï¼Œé˜®ä¸€å³°è€å¸ˆå°†å…¶ç¿»è¯‘æˆäº†ä¸­æ–‡ï¼Œå¦‚ä¸‹ï¼š\næ³¨ï¼š\nå…³äºä»€ä¹ˆæ˜¯è®¸å¯è¯å…¼å®¹æ€§å¯ä»¥å‚è€ƒï¼šã€Šå¼€æºè®¸å¯è¯å…¼å®¹æ€§æŒ‡å—.docxã€‹ ä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œå¤§ä½“ä¸Šå·¦è¾¹çš„è®¸å¯è¯æ¯”è¾ƒä¸¥æ ¼ï¼Œå³è¾¹çš„è®¸å¯è¯è¾ƒä¸ºå®½æ¾ã€‚æ­¤å›¾è™½ç„¶ä¸å¤Ÿä¸¥è°¨ï¼Œèƒœåœ¨æ–¹ä¾¿ç†è§£ã€‚åœ¨å¼€æºè‡ªå·±çš„é¡¹ç›®æ—¶ï¼Œå¯ä»¥æ ¹æ®æ­¤å›¾å¿«é€Ÿé€‰æ‹©å‡ºé€‚åˆè‡ªå·±çš„å¼€æºè®¸å¯è¯ã€‚\næ›´å¤šå‚è€ƒå›¾ï¼š\n# çŸ¥è¯†å…±äº«è®¸å¯è¯Creative Commonsï¼ˆCCï¼‰ æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬æƒ³è¦å¼€æºçš„å¹¶ä¸æ˜¯ä¸€æ¬¾è½¯ä»¶ï¼Œè€Œæ˜¯ä¸€å¥—å¼€æºçš„æ•™ç¨‹æˆ–è€…ä¹¦ç±ç­‰ï¼Œæ­¤æ—¶ä¸¥æ ¼æ¥è®²å¹¶ä¸èƒ½ä½¿ç”¨ä¸Šé¢æ‰€ä»‹ç»çš„å¼€æºè®¸å¯è¯ã€‚\nåœ¨ OSD ç¬¬ 2 æ¡ä¸­æœ‰è§„å®šï¼šå¼€æºè½¯ä»¶æ˜¯å¿…é¡»è¦åŒ…å«æºä»£ç çš„ã€‚\nä¹Ÿå°±æ˜¯è¯´ï¼Œæ•™ç¨‹æˆ–è€…ä¹¦ç±ç­‰æ²¡æœ‰æºä»£ç ï¼Œå¹¶ä¸èƒ½ä½œä¸ºå¼€æºè½¯ä»¶ï¼Œä¹Ÿå°±ä¸èƒ½ä½¿ç”¨å¼€æºè®¸å¯è¯ã€‚\næ­¤ç±»é¡¹ç›®æƒ³è¦å¼€æºï¼Œåº”è¯¥ä½¿ç”¨ã€ŒçŸ¥è¯†å…±äº«è®¸å¯è¯ã€ï¼ˆcreative commons licensesï¼‰ï¼Œé€šå¸¸ä¹Ÿå« CC è®¸å¯è¯ã€‚\nCC è®¸å¯è¯ç”± Creative Commons åŸºé‡‘ä¼šæå‡ºï¼Œè™½ç„¶æ²¡æœ‰å¾—åˆ° OSI çš„è®¤å¯ï¼Œä½†ä»–ä»å…·æœ‰æ³•å¾‹æ•ˆåŠ›ï¼Œå¹¶ä¸”åº”ç”¨å¹¿æ³›ã€‚\nä¸Šé¢æåˆ°çš„ã€Œæœ¨å…°å¼€æ”¾ä½œå“è®¸å¯åè®®ã€å°±æ˜¯å¯¹æ ‡çŸ¥è¯†å…±äº«è®¸å¯è¯çš„ã€‚åŒæœ¨å…°è®¸å¯è¯ç±»ä¼¼ï¼ŒçŸ¥è¯†å…±äº«è®¸å¯è¯ä¹Ÿæ˜¯ä¸€ç³»åˆ—è®¸å¯è¯ï¼Œç›®å‰æœ€æ–°çš„çŸ¥è¯†å…±äº«è®¸å¯è¯ä¸º 4.0 ç‰ˆæœ¬ï¼Œå¸¸è§çš„è®¸å¯è¯æœ‰ 6 ç§ï¼š\nCC BY 4.0 (Attribution 4.0 Internationalï¼Œç½²å 4.0 å›½é™…) CC BY-SA 4.0 (Attribution-ShareAlike 4.0 Internationalï¼Œç½²å-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…) CC BY-ND 4.0 (Attribution-NoDerivatives 4.0 Internationalï¼Œç½²å-ç¦æ­¢æ¼”ç» 4.0 å›½é™…) CC BY-NC 4.0 (Attribution-NonCommercial 4.0 Internationalï¼Œç½²å-éå•†ä¸šæ€§ä½¿ç”¨ 4.0 å›½é™…) CC BY-NC-SA 4.0 (Attribution-NonCommercial-ShareAlike 4.0 Internationalï¼Œç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…) CC BY-NC-ND 4.0 (Attribution-NonCommercial-NoDerivatives 4.0 Internationalï¼Œç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç¦æ­¢æ¼”ç» 4.0 å›½é™…) å¯ä»¥å‘ç°ï¼ŒCC è®¸å¯è¯å‘½åæ–¹å¼å°±æ˜¯å®ƒçš„æƒåˆ©ç®€æ‹¼ç»„åˆã€‚ä»¥ä¸‹æ˜¯å¯¹å…¶ä¸­å‡ºç°çš„å‡ ä¸ªåè¯çš„è§£é‡Šï¼š\nâ€‹\tç½²åï¼šå¿…é¡»ç»™å‡ºåŸä½œè€…çš„ç½²åï¼Œæä¾›æŒ‡å‘æœ¬è®¸å¯åè®®çš„é“¾æ¥ï¼ŒåŒæ—¶æ ‡æ˜æ˜¯å¦å¯¹åŸå§‹ä½œå“ä½œäº†ä¿®æ”¹ã€‚\nâ€‹\téå•†ä¸šæ€§ä½¿ç”¨ï¼šæ‚¨ä¸å¾—å°†æœ¬ä½œå“ç”¨äºå•†ä¸šç›®çš„ã€‚ä¸å¾—ç”¨äºç›ˆåˆ©æ€§ç›®çš„ã€‚\nâ€‹\tç›¸åŒæ–¹å¼å…±äº«ï¼šåœ¨ä»»ä½•åª’ä»‹ä»¥ä»»ä½•å½¢å¼å¤åˆ¶ã€å‘è¡Œæœ¬ä½œå“æ—¶å¿…é¡»é‡‡ç”¨ç›¸åŒçš„è®¸å¯è¯ã€‚\nâ€‹\tç¦æ­¢æ¼”ç»ï¼šç¦æ­¢ä¿®æ”¹ã€è½¬æ¢æˆ–ä»¥æœ¬ä½œå“ä¸ºåŸºç¡€è¿›è¡Œåˆ›ä½œã€‚\nä¹‹æ‰€ä»¥æ¯ä¸ªè®¸å¯è¯åé¢éƒ½å¸¦æœ‰å›½é™…ä¸¤ä¸ªå­—ï¼Œæ˜¯å› ä¸ºè¿™ç³»åˆ—è®¸å¯è¯å‘å¸ƒäº†ä¸åŒçš„åœ°åŸŸç‰ˆï¼Œä¸è¿‡å›½é™…ç‰ˆæ›´ä¸ºé€šç”¨ã€‚\néœ€è¦æ³¨æ„ CC ç³»åˆ—è®¸å¯è¯ä¸€æ—¦å‘å¸ƒï¼Œå°±ä¸å¯æ”¶å›ï¼Œåªè¦ä½ éµå®ˆè®¸å¯åè®®æ¡æ¬¾ï¼Œè®¸å¯äººå°±æ— æ³•æ”¶å›ä½ çš„è¿™äº›æƒåˆ©ã€‚\nå¦‚éœ€ä½¿ç”¨ CC è®¸å¯è¯ï¼Œå¯ä»¥å‚è€ƒç¤ºä¾‹ã€‚\nâ€‹\tæœ¬æ•™ç¨‹é‡‡ç”¨çŸ¥è¯†å…±äº« ç½²å-ç›¸åŒæ–¹å¼å…±äº« 4.0å›½é™…åè®®ã€‚\nâ€‹\tåšå®¢å†…å®¹éµå¾ª çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®\næˆ–å‚è€ƒå®˜ç½‘è‡ªè¡Œç»„åˆã€‚\næ³¨æ„ï¼šåè®®é“¾æ¥å¹¶ä¸å¿…é¡»æŒ‡å®šï¼Œä½†åœ¨ä½¿ç”¨çŸ¥è¯†å…±äº«åè®®æ—¶ï¼Œæä¾›åè®®é“¾æ¥æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åšæ³•ï¼Œå› ä¸ºå®ƒå¯ä»¥å¸®åŠ©å…¶ä»–äººæ–¹ä¾¿åœ°è®¿é—®å¹¶äº†è§£ä½ æ‰€ä½¿ç”¨çš„å…·ä½“åè®®å†…å®¹ã€‚\n# å¼€æºæ¡ˆä¾‹ ä»‹ç»å®Œäº†å¼€æºåè®®ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªå¼€æºæ¡ˆä¾‹ï¼š\n# ä¸­å›½é¦–ä¾‹å› è¿å GPL åè®®è‡´ä¾µå®³è®¡ç®—æœºè½¯ä»¶è‘—ä½œæƒçº çº· 2021-06-30 åœ¨ä¸­å›½è£åˆ¤æ–‡ä¹¦ç½‘ä¸Šå…¬å¸ƒäº†ä¸€åˆ™æ°‘äº‹åˆ¤å†³ä¹¦ï¼Œæ ‡é¢˜ä¸ºï¼šã€Œæµå®å¸‚ç½—ç›’ç½‘ç»œç§‘æŠ€æœ‰é™å…¬å¸è¯‰è¢«å‘Šç¦å»ºé£çµåˆ›æ™¯ç§‘æŠ€æœ‰é™å…¬å¸(ä»¥ä¸‹ç®€ç§°ç¦å»ºé£çµå…¬å¸)ã€è¢«å‘ŠåŒ—äº¬é£çµåˆ›æ™¯ç§‘æŠ€æœ‰é™å…¬å¸(ä»¥ä¸‹ç®€ç§°åŒ—äº¬é£çµå…¬å¸)ã€è¢«å‘Šæ·±åœ³å¸‚è…¾è®¯è®¡ç®—æœºç³»ç»Ÿæœ‰é™å…¬å¸(ä»¥ä¸‹ç®€ç§°è…¾è®¯å…¬å¸)ä¾µå®³è®¡ç®—æœºè½¯ä»¶è‘—ä½œæƒçº çº·ä¸€å®¡æ°‘äº‹åˆ¤å†³ä¹¦ã€ã€‚æ¡ˆä»¶æ¦‚å†µå¦‚ä¸‹ï¼š\nåŸå‘Šæµå®å¸‚ç½—ç›’ç½‘ç»œç§‘æŠ€æœ‰é™å…¬å¸ç‹¬ç«‹å¼€ã€Œç½—ç›’ï¼ˆVirtualAppï¼‰ã€ä» 2016 å¹´ 7 æœˆ 8 æ—¥çš„ç‰ˆæœ¬å¼€å§‹å¼•å…¥å¼€æºåè®®ï¼Œèµ·åˆä¸º LGPL3.0 åè®®ï¼Œä» 2016 å¹´ 8 æœˆ 12 æ—¥å¼€å§‹æ›´æ¢ä¸º GPL3.0 åè®®ã€‚2017 å¹´ 10 æœˆ 29 æ—¥å¼€å§‹åˆ é™¤é€‚ç”¨ GPL3.0 åè®®çš„è¡¨è¿°ï¼Œä½†è‹±æ–‡ä»‹ç»ä¸­ä»ä¿ç•™openplatform çš„è¡¨è¿°ã€‚\n2018 å¹´ 9 æœˆï¼ŒåŸå‘Šè°ƒæŸ¥å‘ç°åä¸ºã€Œç‚¹å¿ƒæ¡Œé¢ã€çš„è½¯ä»¶ä½¿ç”¨äº† VirtualApp çš„ä»£ç ï¼Œå°†ä¸¤ä¸ªè½¯ä»¶æºä»£ç è¿›è¡Œåˆ†ææ¯”å¯¹ï¼Œä¸¤è€…é—´ 421 ä¸ªå¯æ¯”ä»£ç ä¸­æœ‰ 308 ä¸ªä»£ç å…·æœ‰å®è´¨ç›¸ä¼¼æ€§ï¼Œæœ‰ 27 ä¸ªä»£ç å…·æœ‰é«˜åº¦ç›¸ä¼¼æ€§ï¼Œæœ‰ 78 ä¸ªä»£ç å…·æœ‰ä¸€èˆ¬ç›¸ä¼¼æ€§ã€‚å› æ­¤ï¼Œè¢«è¯‰ä¾µæƒè½¯ä»¶ä¸æ¶‰æ¡ˆè½¯ä»¶æ„æˆå®è´¨ç›¸ä¼¼ã€‚\nç»æŸ¥ï¼Œè¢«è¯‰ã€Œç‚¹å¿ƒæ¡Œé¢ã€ä¸­ä½¿ç”¨äº†åŸå‘Šé‡‡ç”¨ GPL3.0 åè®®å‘å¸ƒçš„ VirtualAppï¼Œè¢«å‘Šå¯¹æ­¤äº¦äºˆä»¥ç¡®è®¤ã€‚\nåŸå‘Šç”³è¯·èµ”å¿ 2000 ä¸‡ï¼Œæœ€ç»ˆï¼Œæ³•é™¢é…Œæƒ…ç¡®å®šèµ”å¿æ•°é¢ä¸º 50 ä¸‡å…ƒã€‚åŸå‘Šä¸ºåˆ¶æ­¢æœ¬æ¡ˆä¾µæƒè¡Œä¸ºæ‰€æ”¯å‡ºçš„åˆç†è´¹ç”¨ï¼Œè®¡ç®—åœ¨èµ”å¿æŸå¤±æ•°é¢èŒƒå›´ä¹‹å†…ã€‚\næ›´å¤šç»†èŠ‚å¯ä»¥ç‚¹å‡»ä¸‹è½½æŸ¥çœ‹ã€‚\nè¯¥æ¡ˆä¾‹ç»™å¼€æºè½¯ä»¶ä½¿ç”¨è€…æ•²å“ä¸€è®°è­¦é’Ÿï¼Œä½¿ç”¨å¼€æºè½¯ä»¶ä¸€å®šè¦æŸ¥çœ‹å¹¶éµå¾ªå¼€æºè®¸å¯è¯ã€‚\n# æ€»ç»“ æœ¬æ–‡å¸¦å¤§å®¶ä¸€èµ·è®¤è¯†äº†ä»€ä¹ˆæ˜¯å¼€æºåè®®ï¼Œå¹¶ä¸”è¿˜å¯¹å¸¸ç”¨å¼€æºåè®®è¿›è¡Œäº†åˆ†æï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å¼€æºåè®®ã€‚åŒæ—¶è®²è§£äº†é’ˆå¯¹ä¹¦ç±ç­‰å¼€æºä½œå“ä½¿ç”¨çš„çŸ¥è¯†å…±äº«è®¸å¯åè®®å’Œä½¿ç”¨æ–¹å¼ã€‚æœ€ç»ˆåˆ†äº«äº†ä¸€ä¸ªå¼€æºè½¯ä»¶çº çº·æ¡ˆä¾‹ï¼Œä»¥è¯´æ˜äº†è§£å¼€æºåè®®çš„é‡è¦æ€§ã€‚\næ­¤æ–‡ä»…ä¸ºä½œè€…æœ¬äººå­¦ä¹ å¹¶æ•´ç†çš„å¼€æºåè®®ç›¸å…³çŸ¥è¯†ï¼Œå³ä¸å¤Ÿå…¨é¢ï¼Œä¹Ÿä¸å¤Ÿä¸¥è°¨ï¼Œä¸èƒ½ä½œä¸ºæ³•å¾‹ä¾æ®ã€‚å¸Œæœ›ä½ èƒ½é€šè¿‡æœ¬ç¯‡æ–‡ç« è®¤è¯†å¹¶é‡è§†å¼€æºåè®®ï¼Œå­¦ä¹ å’Œä¹¦å†™æœ¬ç¯‡æ–‡ç« æ—¶é—´æœ‰é™ï¼Œéš¾å…å‡ºç°è¡¨è¾¾ä¸å¤Ÿå‡†ç¡®æˆ–é”™è¯¯çš„åœ°æ–¹ï¼Œæ¬¢è¿æ‰¹è¯„æŒ‡æ­£ã€‚\næœ€åï¼Œæƒ³æé†’å¤§å®¶ï¼Œèº«ä¸ºä¸€åå¼€å‘è€…ï¼ŒæŒæ¡å¼€æºåè®®æ˜¯æœ‰å¿…è¦çš„ã€‚ä¸è¿‡å¼€æºåè®®çš„å†…å®¹éå¸¸å¤šä¸”ä¸“ä¸šï¼Œæƒ³è¦å®Œå…¨äº†è§£ä¹Ÿæ˜¯ä¸€é¡¹ç¹é‡çš„å·¥ä½œï¼Œæ¯•ç«Ÿè¿™ä¸æ˜¯æˆ‘ä»¬çš„ä¸“ä¸šé¢†åŸŸï¼Œå¦‚æœé‡åˆ°æ— æ³•ç¡®å®šçš„é—®é¢˜ï¼Œå¯ä»¥å¯»æ±‚èº«è¾¹çš„ä¸“ä¸šæ³•åŠ¡å¸®å¿™ã€‚\n# å‚è€ƒ å„ç§å¼€æºåè®®ä»‹ç» ä¸€æ–‡çœ‹æ‡‚å¼€æºè®¸å¯è¯ä¸¨å¼€æºçŸ¥è¯†ç§‘æ™® åŸæ–‡ï¼šå¼€æºåè®®ç®€ä»‹ å¦‚ä½•é€‰æ‹©å¼€æºè®¸å¯è¯ï¼Ÿ ","date":"2024-05-06T23:22:29+08:00","permalink":"https://arlettebrook.github.io/p/open-source-license-introduction/","title":"Open Source License Introduction"},{"content":" Viper æ˜¯ä¸€ä¸ªåŠŸèƒ½é½å…¨çš„ Go åº”ç”¨ç¨‹åºé…ç½®åº“ï¼Œæ”¯æŒå¾ˆå¤šåœºæ™¯ã€‚å®ƒå¯ä»¥å¤„ç†å„ç§ç±»å‹çš„é…ç½®éœ€æ±‚å’Œæ ¼å¼ï¼ŒåŒ…æ‹¬è®¾ç½®é»˜è®¤å€¼ã€ä»å¤šç§é…ç½®æ–‡ä»¶å’Œç¯å¢ƒå˜é‡ä¸­è¯»å–é…ç½®ä¿¡æ¯ã€å®æ—¶ç›‘è§†é…ç½®æ–‡ä»¶ç­‰ã€‚æ— è®ºæ˜¯å°å‹åº”ç”¨è¿˜æ˜¯å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿï¼ŒViper éƒ½å¯ä»¥æä¾›çµæ´»è€Œå¯é çš„é…ç½®ç®¡ç†è§£å†³æ–¹æ¡ˆã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ Viper çš„å„ç§ç”¨æ³•å’Œä½¿ç”¨åœºæ™¯ï¼Œä»¥å¸®åŠ©è¯»è€…æ›´å¥½åœ°äº†è§£å’Œä½¿ç”¨ Viper æ¥ç®¡ç†åº”ç”¨ç¨‹åºé…ç½®ã€‚\n# ä¸ºä»€ä¹ˆé€‰æ‹© Viper å½“æˆ‘ä»¬åœ¨åšæŠ€æœ¯é€‰å‹æ—¶ï¼Œè‚¯å®šè¦çŸ¥é“ä¸ºä»€ä¹ˆé€‰æ‹©æŸä¸€é¡¹æŠ€æœ¯ï¼Œè€Œä¹‹æ‰€ä»¥é€‰æ‹©ä½¿ç”¨ Viper æ¥ç®¡ç†åº”ç”¨ç¨‹åºçš„é…ç½®ï¼ŒViper å®˜æ–¹ç»™å‡ºäº†å¦‚ä¸‹ç­”æ¡ˆï¼š\nå½“æ„å»ºåº”ç”¨ç¨‹åºæ—¶ï¼Œä½ ä¸æƒ³æ‹…å¿ƒé…ç½®æ–‡ä»¶æ ¼å¼ï¼Œåªæƒ³ä¸“æ³¨äºæ„å»ºå‡ºè‰²çš„è½¯ä»¶ã€‚Viper å°±æ˜¯ä¸ºäº†å¸®åŠ©æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜è€Œå­˜åœ¨çš„ã€‚\nViper å¯ä»¥å®Œæˆä»¥ä¸‹å·¥ä½œï¼š\næŸ¥æ‰¾ã€åŠ è½½å’Œååºåˆ—åŒ– JSONã€TOMLã€YAMLã€HCLã€INIã€envfile æˆ– Java Properties ç­‰å¤šç§æ ¼å¼çš„é…ç½®æ–‡ä»¶ã€‚ ä¸ºä¸åŒçš„é…ç½®é€‰é¡¹è®¾ç½®é»˜è®¤å€¼ã€‚ ä¸ºé€šè¿‡å‘½ä»¤è¡Œæ ‡å¿—æŒ‡å®šçš„é€‰é¡¹è®¾ç½®è¦†ç›–å€¼ã€‚ æä¾›åˆ«åç³»ç»Ÿï¼Œä»¥ä¾¿è½»æ¾é‡å‘½åé…ç½®é¡¹è€Œä¸ç ´åç°æœ‰ä»£ç ã€‚ å¯ä»¥è½»æ¾åŒºåˆ†ç”¨æˆ·æä¾›çš„å‘½ä»¤è¡Œå‚æ•°æˆ–é…ç½®æ–‡ä»¶ä¸­çš„å€¼æ˜¯å¦ä¸é»˜è®¤å€¼ç›¸åŒã€‚ å¯ä»¥è®¾ç½®ç›‘å¬é…ç½®æ–‡ä»¶çš„ä¿®æ”¹ï¼Œä¿®æ”¹æ—¶è‡ªåŠ¨åŠ è½½æ–°çš„é…ç½®ï¼› ä»ç¯å¢ƒå˜é‡ã€å‘½ä»¤è¡Œé€‰é¡¹å’Œio.Readerä¸­è¯»å–é…ç½®ï¼› ä»è¿œç¨‹é…ç½®ç³»ç»Ÿä¸­è¯»å–å’Œç›‘å¬ä¿®æ”¹ï¼Œå¦‚ etcd/Consulï¼› ä»£ç é€»è¾‘ä¸­æ˜¾ç¤ºè®¾ç½®é”®å€¼ã€‚ \u0026hellip;\u0026hellip; æ³¨ï¼šå…³äºä¸Šé¢ç¬¬ 5 ç‚¹ï¼Œæˆ‘ä¸ªäººç†è§£çš„ä½¿ç”¨åœºæ™¯æ˜¯ï¼š\nå…ˆä»å‘½ä»¤è¡Œå‚æ•°æˆ–é…ç½®æ–‡ä»¶ä¸­è¯»å–é…ç½®ã€‚ å¯ä»¥ä½¿ç”¨ viper.IsSet(key) æ–¹æ³•åˆ¤æ–­ç”¨æˆ·æ˜¯å¦è®¾ç½®äº† key æ‰€å¯¹åº”çš„ valueï¼Œå¦‚æœè®¾ç½®äº†ï¼Œå¯ä»¥é€šè¿‡ viper.Get(key) è·å–å€¼ã€‚ è°ƒç”¨ viper.SetDefault(key, default_value) æ¥è®¾ç½®é»˜è®¤å€¼ï¼ˆé»˜è®¤å€¼ä¸ä¼šè¦†ç›–ä¸Šä¸€æ­¥æ‰€è·å–åˆ°çš„å€¼ï¼‰ã€‚ åœ¨ç¬¬ 2 æ­¥ä¸­å¯ä»¥æ‹¿åˆ°ç”¨æˆ·è®¾ç½®çš„å€¼ valueï¼Œåœ¨ç¬¬ 3 æ­¥ä¸­å¯ä»¥çŸ¥é“é»˜è®¤å€¼ default_valueï¼Œè¿™æ ·å…¶å®å°±å¯ä»¥åˆ¤æ–­ä¸¤è€…æ˜¯å¦ç›¸åŒäº†ã€‚ Viper é‡‡ç”¨ä»¥ä¸‹ä¼˜å…ˆçº§é¡ºåºæ¥åŠ è½½é…ç½®ï¼ŒæŒ‰ç…§ä¼˜å…ˆçº§ç”±é«˜åˆ°ä½æ’åºå¦‚ä¸‹ï¼š\næ˜¾å¼è°ƒç”¨ viper.Set è®¾ç½®çš„é…ç½®å€¼ å‘½ä»¤è¡Œå‚æ•° ç¯å¢ƒå˜é‡ é…ç½®æ–‡ä»¶ key/value å­˜å‚¨ é»˜è®¤å€¼ æ³¨æ„ âš ï¸ï¼šViper é…ç½®ä¸­çš„é”®ä¸åŒºåˆ†å¤§å°å†™ï¼Œå¦‚ user/User/USER è¢«è§†ä¸ºæ˜¯ç›¸ç­‰çš„ keyï¼Œå…³äºæ˜¯å¦å°†å…¶è®¾ä¸ºå¯é€‰ï¼Œç›®å‰è¿˜åœ¨è®¨è®ºä¸­ã€‚\nViper åŒ…ä¸­æœ€æ ¸å¿ƒçš„ä¸¤ä¸ªåŠŸèƒ½æ˜¯ï¼šå¦‚ä½•æŠŠé…ç½®å€¼è¯»å…¥ Viper å’Œä» Viper ä¸­è¯»å–é…ç½®å€¼ï¼Œæ¥ä¸‹æ¥æˆ‘å°†åˆ†åˆ«ä»‹ç»è¿™ä¸¤ä¸ªåŠŸèƒ½ã€‚\n# å¿«é€Ÿä½¿ç”¨ å®‰è£…ï¼š\n1 go get -u github.com/spf13/viper å¯¼å…¥ï¼š\n1 import \u0026#34;github.com/spf13/viper\u0026#34; ä½¿ç”¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;github.com/spf13/viper\u0026#34; ) func main() { viper.SetConfigName(\u0026#34;config\u0026#34;) viper.SetConfigType(\u0026#34;toml\u0026#34;) viper.AddConfigPath(\u0026#34;.\u0026#34;) viper.SetDefault(\u0026#34;redis.port\u0026#34;, 6381) err := viper.ReadInConfig() if err != nil { log.Fatalf(\u0026#34;read config failed: %v\u0026#34;, err) } fmt.Println(viper.Get(\u0026#34;app_name\u0026#34;)) fmt.Println(viper.Get(\u0026#34;log_level\u0026#34;)) fmt.Println(\u0026#34;mysql ip: \u0026#34;, viper.Get(\u0026#34;mysql.ip\u0026#34;)) fmt.Println(\u0026#34;mysql port: \u0026#34;, viper.Get(\u0026#34;mysql.port\u0026#34;)) fmt.Println(\u0026#34;mysql user: \u0026#34;, viper.Get(\u0026#34;mysql.user\u0026#34;)) fmt.Println(\u0026#34;mysql password: \u0026#34;, viper.Get(\u0026#34;mysql.password\u0026#34;)) fmt.Println(\u0026#34;mysql database: \u0026#34;, viper.Get(\u0026#34;mysql.database\u0026#34;)) fmt.Println(\u0026#34;redis ip: \u0026#34;, viper.Get(\u0026#34;redis.ip\u0026#34;)) fmt.Println(\u0026#34;redis port: \u0026#34;, viper.Get(\u0026#34;redis.port\u0026#34;)) } è¿™é‡Œçš„é…ç½®æ–‡ä»¶æ ¼å¼æ˜¯tomlã€‚toml çš„è¯­æ³•å¾ˆç®€å•ï¼Œå¿«é€Ÿå…¥é—¨è¯·çœ‹TOML:ç®€ä½“ä¸­æ–‡ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # config.toml app_name = \u0026#34;awesome web\u0026#34; # possible values: DEBUG, INFO, WARNING, ERROR, FATAL log_level = \u0026#34;DEBUG\u0026#34; [mysql] ip = \u0026#34;127.0.0.1\u0026#34; port = 3306 user = \u0026#34;dj\u0026#34; password = 123456 database = \u0026#34;awesome\u0026#34; [redis] ip = \u0026#34;127.0.0.1\u0026#34; port = 7381 viper çš„ä½¿ç”¨éå¸¸ç®€å•ï¼Œå®ƒéœ€è¦å¾ˆå°‘çš„è®¾ç½®ã€‚è®¾ç½®æ–‡ä»¶åï¼ˆSetConfigNameï¼‰ã€é…ç½®ç±»å‹ï¼ˆSetConfigTypeï¼‰å’Œæœç´¢è·¯å¾„ï¼ˆAddConfigPathï¼‰ï¼Œç„¶åè°ƒç”¨ReadInConfigã€‚ viperä¼šè‡ªåŠ¨æ ¹æ®ç±»å‹æ¥è¯»å–é…ç½®ã€‚ä½¿ç”¨æ—¶è°ƒç”¨viper.Getæ–¹æ³•è·å–é”®å€¼ã€‚\nç¼–è¯‘ã€è¿è¡Œç¨‹åºï¼š\n1 2 3 4 5 6 7 8 9 10 $ go run main.go awesome web DEBUG mysql ip: 127.0.0.1 mysql port: 3306 mysql user: dj mysql password: 123456 mysql database: awesome redis ip: 127.0.0.1 redis port: 7381 æœ‰å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š\nè®¾ç½®æ–‡ä»¶åæ—¶ä¸è¦å¸¦åç¼€ï¼› æœç´¢è·¯å¾„å¯ä»¥è®¾ç½®å¤šä¸ªï¼Œviper ä¼šæ ¹æ®è®¾ç½®é¡ºåºä¾æ¬¡æŸ¥æ‰¾ï¼› viper è·å–å€¼æ—¶ä½¿ç”¨section.keyçš„å½¢å¼ï¼Œå³ä¼ å…¥åµŒå¥—çš„é”®åï¼› é»˜è®¤å€¼å¯ä»¥è°ƒç”¨viper.SetDefaultè®¾ç½®ã€‚ # è¯»å–é”® viper æä¾›äº†å¤šç§å½¢å¼çš„è¯»å–æ–¹æ³•ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†Getæ–¹æ³•çš„ç”¨æ³•ã€‚Getæ–¹æ³•è¿”å›ä¸€ä¸ªinterface{}çš„å€¼ï¼Œä½¿ç”¨æœ‰æ‰€ä¸ä¾¿ã€‚\nGetTypeç³»åˆ—æ–¹æ³•å¯ä»¥è¿”å›æŒ‡å®šç±»å‹çš„å€¼ã€‚ å…¶ä¸­ï¼ŒType å¯ä»¥ä¸ºBool/Float64/Int/String/Time/Duration/IntSlice/StringSliceã€‚ ä½†æ˜¯è¯·æ³¨æ„ï¼Œå¦‚æœæŒ‡å®šçš„é”®ä¸å­˜åœ¨æˆ–ç±»å‹ä¸æ­£ç¡®ï¼ŒGetTypeæ–¹æ³•è¿”å›å¯¹åº”ç±»å‹çš„é›¶å€¼ã€‚\nå¦‚æœè¦åˆ¤æ–­æŸä¸ªé”®æ˜¯å¦å­˜åœ¨ï¼Œä½¿ç”¨IsSetæ–¹æ³•ã€‚ å¦å¤–ï¼ŒGetStringMapå’ŒGetStringMapStringç›´æ¥ä»¥ map è¿”å›æŸä¸ªé”®ä¸‹é¢æ‰€æœ‰çš„é”®å€¼å¯¹ï¼Œå‰è€…è¿”å›map[string]interface{}ï¼Œåè€…è¿”å›map[string]stringã€‚ AllSettingsä»¥map[string]interface{}è¿”å›æ‰€æœ‰è®¾ç½®ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 // çœç•¥åŒ…åå’Œ import éƒ¨åˆ† func main() { viper.SetConfigName(\u0026#34;config\u0026#34;) viper.SetConfigType(\u0026#34;toml\u0026#34;) viper.AddConfigPath(\u0026#34;.\u0026#34;) err := viper.ReadInConfig() if err != nil { log.Fatalf(\u0026#34;read config failed: %v\u0026#34;, err) } fmt.Println(\u0026#34;protocols: \u0026#34;, viper.GetStringSlice(\u0026#34;server.protocols\u0026#34;)) fmt.Println(\u0026#34;ports: \u0026#34;, viper.GetIntSlice(\u0026#34;server.ports\u0026#34;)) fmt.Println(\u0026#34;timeout: \u0026#34;, viper.GetDuration(\u0026#34;server.timeout\u0026#34;)) fmt.Println(\u0026#34;mysql ip: \u0026#34;, viper.GetString(\u0026#34;mysql.ip\u0026#34;)) fmt.Println(\u0026#34;mysql port: \u0026#34;, viper.GetInt(\u0026#34;mysql.port\u0026#34;)) if viper.IsSet(\u0026#34;redis.port\u0026#34;) { fmt.Println(\u0026#34;redis.port is set\u0026#34;) } else { fmt.Println(\u0026#34;redis.port is not set\u0026#34;) } fmt.Println(\u0026#34;mysql settings: \u0026#34;, viper.GetStringMap(\u0026#34;mysql\u0026#34;)) fmt.Println(\u0026#34;redis settings: \u0026#34;, viper.GetStringMap(\u0026#34;redis\u0026#34;)) fmt.Println(\u0026#34;all settings: \u0026#34;, viper.AllSettings()) } æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ config.toml ä¸­æ·»åŠ protocolså’Œportsé…ç½®ï¼š\n1 2 3 4 [server] protocols = [\u0026#34;http\u0026#34;, \u0026#34;https\u0026#34;, \u0026#34;port\u0026#34;] ports = [10000, 10001, 10002] timeout = \u0026#34;3s\u0026#34; ç¼–è¯‘ã€è¿è¡Œç¨‹åºï¼Œè¾“å‡ºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 $ go run main.go protocols: [http https port] ports: [10000 10001 10002] timeout: 3s mysql ip: 127.0.0.1 mysql port: 3306 redis.port is set mysql settings: map[database:awesome ip:127.0.0.1 password:123456 port:3306 user:dj] redis settings: map[ip:127.0.0.1 port:7381] all settings: map[app_name:awesome web log_level:DEBUG mysql:map[database:awesome ip:127.0.0.1 pa ssword:123456 port:3306 user:dj] redis:map[ip:127.0.0.1 port:7381] server:map[ports:[10000 10001 1 0002] protocols:[http https port] timeout:3s]] å¦‚æœå°†é…ç½®ä¸­çš„redis.portæ³¨é‡Šæ‰ï¼Œå°†è¾“å‡ºredis.port is not setã€‚\nä¸Šé¢çš„ç¤ºä¾‹ä¸­è¿˜æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨time.Durationç±»å‹ï¼Œåªè¦æ˜¯time.ParseDurationæ¥å—çš„æ ¼å¼éƒ½å¯ä»¥ï¼Œä¾‹å¦‚3sã€2minã€1min30sç­‰ã€‚\n# è®¾ç½®é”®å€¼ viper æ”¯æŒåœ¨å¤šä¸ªåœ°æ–¹è®¾ç½®ï¼Œä½¿ç”¨ä¸‹é¢çš„é¡ºåºä¾æ¬¡è¯»å–ï¼š\nè°ƒç”¨Setæ˜¾ç¤ºè®¾ç½®çš„ï¼› å‘½ä»¤è¡Œé€‰é¡¹ï¼› ç¯å¢ƒå˜é‡ï¼› é…ç½®æ–‡ä»¶ï¼› é»˜è®¤å€¼ã€‚ viper.Set\nå¦‚æœæŸä¸ªé”®é€šè¿‡viper.Setè®¾ç½®äº†å€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªå€¼çš„ä¼˜å…ˆçº§æœ€é«˜ã€‚\n1 viper.Set(\u0026#34;redis.port\u0026#34;, 5381) å¦‚æœå°†ä¸Šé¢è¿™è¡Œä»£ç æ”¾åˆ°ç¨‹åºä¸­ï¼Œè¿è¡Œç¨‹åºï¼Œè¾“å‡ºçš„redis.portå°†æ˜¯ 5381ã€‚\nviper.SetDefault\nè®¾ç½®é»˜è®¤å€¼ï¼Œå¦‚æœæ²¡æœ‰é…ç½®é”®ï¼Œå°†ä½¿ç”¨é»˜è®¤å€¼\n1 viper.SetDefault(\u0026#34;log_level\u0026#34;, \u0026#34;INFO\u0026#34;) å¦‚æœé…ç½®æ–‡ä»¶ä¸­æ²¡æœ‰é…ç½®log_level,é‚£ä¹ˆå°†ä½¿ç”¨INFO\n# æŠŠé…ç½®å€¼è¯»å…¥Viper Viper æ”¯æŒå¤šç§æ–¹å¼è¯»å…¥é…ç½®ï¼š\nè®¾ç½®é»˜è®¤é…ç½®å€¼ ä»é…ç½®æ–‡ä»¶è¯»å–é…ç½® ç›‘æ§å¹¶é‡æ–°è¯»å–é…ç½®æ–‡ä»¶ ä» io.Reader è¯»å–é…ç½® ä»ç¯å¢ƒå˜é‡è¯»å–é…ç½® ä»å‘½ä»¤è¡Œå‚æ•°è¯»å–é…ç½® ä»è¿œç¨‹ key/value å­˜å‚¨è¯»å–é…ç½® æˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªæ¥çœ‹ã€‚\n# è®¾ç½®é»˜è®¤é…ç½®å€¼ ä¸€ä¸ªå¥½çš„é…ç½®ç³»ç»Ÿåº”è¯¥æ”¯æŒé»˜è®¤å€¼ã€‚Viper æ”¯æŒä½¿ç”¨ viper.SetDefault(key, value) ä¸º key è®¾ç½®é»˜è®¤å€¼ valueï¼Œåœ¨æ²¡æœ‰é€šè¿‡é…ç½®æ–‡ä»¶ã€ç¯å¢ƒå˜é‡ã€è¿œç¨‹é…ç½®æˆ–å‘½ä»¤è¡Œæ ‡å¿—è®¾ç½® key æ‰€å¯¹åº”å€¼çš„æƒ…å†µä¸‹ï¼Œè¿™å¾ˆæœ‰ç”¨ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/spf13/viper\u0026#34; ) func main() { // è®¾ç½®é»˜è®¤é…ç½® viper.SetDefault(\u0026#34;username\u0026#34;, \u0026#34;arlettebrook\u0026#34;) viper.SetDefault(\u0026#34;server\u0026#34;, map[string]string{\u0026#34;ip\u0026#34;: \u0026#34;127.0.0.1\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;8080\u0026#34;}) // è¯»å–é…ç½®å€¼ fmt.Printf(\u0026#34;username: %s\\n\u0026#34;, viper.Get(\u0026#34;Username\u0026#34;)) // key ä¸åŒºåˆ†å¤§å°å†™ fmt.Printf(\u0026#34;server: %+v\\n\u0026#34;, viper.Get(\u0026#34;server\u0026#34;)) } æ‰§è¡Œä»¥ä¸Šç¤ºä¾‹ä»£ç å¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š\n1 2 3 $ go run main.go username: arlettebrook server: map[ip:127.0.0.1 port:8080] # ä»é…ç½®æ–‡ä»¶è¯»å–é…ç½® Viper æ”¯æŒä» JSONã€TOMLã€YAMLã€HCLã€INIã€envfile æˆ– Java Properties æ ¼å¼çš„é…ç½®æ–‡ä»¶ä¸­è¯»å–é…ç½®ã€‚Viper å¯ä»¥æœç´¢å¤šä¸ªè·¯å¾„ï¼Œä½†ç›®å‰å•ä¸ª Viper å®ä¾‹åªæ”¯æŒå•ä¸ªé…ç½®æ–‡ä»¶ã€‚Viper ä¸ä¼šé»˜è®¤é…ç½®ä»»ä½•æœç´¢è·¯å¾„ï¼Œå°†é»˜è®¤å†³å®šç•™ç»™åº”ç”¨ç¨‹åºã€‚\nä¸»è¦æœ‰ä¸¤ç§æ–¹å¼æ¥åŠ è½½é…ç½®æ–‡ä»¶ï¼š\né€šè¿‡ viper.SetConfigFile() æŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œæ˜¾å¼å®šä¹‰é…ç½®æ–‡ä»¶çš„è·¯å¾„ã€åç§°å’Œæ‰©å±•åã€‚ Viperå°†ä½¿ç”¨å®ƒå¹¶ä¸”ä¸æ£€æŸ¥ä»»ä½•é…ç½®è·¯å¾„ã€‚ é€šè¿‡ viper.SetConfigName() æŒ‡å®šä¸å¸¦æ‰©å±•åçš„é…ç½®æ–‡ä»¶ï¼Œviper.SetConfigType()æŒ‡å®šé…ç½®æ–‡ä»¶ç±»å‹ç±»å‹ã€‚ç„¶åé€šè¿‡ viper.AddConfigPath() æŒ‡å®šé…ç½®æ–‡ä»¶çš„æœç´¢è·¯å¾„ä¸­ï¼Œå¯ä»¥é€šè¿‡å¤šæ¬¡è°ƒç”¨ï¼Œæ¥è®¾ç½®å¤šä¸ªé…ç½®æ–‡ä»¶æœç´¢è·¯å¾„ã€‚Viper ä¼šæ ¹æ®æ‰€æ·»åŠ çš„è·¯å¾„é¡ºåºæŸ¥æ‰¾æŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œå¦‚æœæ‰¾åˆ°å°±åœæ­¢æŸ¥æ‰¾ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 package main import ( \u0026#34;errors\u0026#34; \u0026#34;flag\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;github.com/spf13/viper\u0026#34; ) var ( cfg = flag.String(\u0026#34;c\u0026#34;, \u0026#34;\u0026#34;, \u0026#34;config file.\u0026#34;) ) func main() { flag.Parse() if *cfg != \u0026#34;\u0026#34; { viper.SetConfigFile(*cfg) // æŒ‡å®šé…ç½®æ–‡ä»¶ï¼ˆè·¯å¾„ + é…ç½®æ–‡ä»¶åï¼‰ } else { viper.AddConfigPath(\u0026#34;.\u0026#34;) // æŠŠå½“å‰ç›®å½•åŠ å…¥åˆ°é…ç½®æ–‡ä»¶çš„æœç´¢è·¯å¾„ä¸­ viper.AddConfigPath(\u0026#34;$HOME/.config\u0026#34;) // å¯ä»¥å¤šæ¬¡è°ƒç”¨ AddConfigPath æ¥è®¾ç½®å¤šä¸ªé…ç½®æ–‡ä»¶æœç´¢è·¯å¾„ viper.SetConfigName(\u0026#34;config\u0026#34;) viper.SetConfigType(\u0026#34;toml\u0026#34;) // å¦‚æœé…ç½®æ–‡ä»¶åä¸­æ²¡æœ‰æ‰©å±•åï¼Œåˆ™éœ€è¦æ˜¾å¼æŒ‡å®šé…ç½®æ–‡ä»¶çš„æ ¼å¼// æŒ‡å®šé…ç½®æ–‡ä»¶åï¼ˆæ²¡æœ‰æ‰©å±•åï¼‰ } // è¯»å–é…ç½®æ–‡ä»¶ if err := viper.ReadInConfig(); err != nil { var configFileNotFoundError viper.ConfigFileNotFoundError if errors.As(err, \u0026amp;configFileNotFoundError) { log.Fatalln(configFileNotFoundError.Error()) } log.Fatalln(err) } fmt.Printf(\u0026#34;using config file: %s\\n\u0026#34;, viper.ConfigFileUsed()) // è¯»å–é…ç½®å€¼ fmt.Printf(\u0026#34;username: %s\\n\u0026#34;, viper.Get(\u0026#34;username\u0026#34;)) } viper.ConfigFileUsed()è¿”å›ä½¿ç”¨çš„é…ç½®æ–‡ä»¶çš„è·¯å¾„\nå‡å¦‚æœ‰å¦‚ä¸‹é…ç½®æ–‡ä»¶ config.yaml ä¸ç¤ºä¾‹ç¨‹åºåœ¨åŒä¸€ç›®å½•ä¸­ï¼š\n1 2 3 4 5 6 # config.yaml username: arlettebrook password: 123456 server: ip: 127.0.0.1 port: 8080 æ‰§è¡Œä»¥ä¸Šç¤ºä¾‹ä»£ç å¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š\n1 2 3 $ go run main.go -c ./config.yaml using config file: ./config.yaml username: arlettebrook # ç›‘æ§å¹¶é‡æ–°è¯»å–é…ç½®æ–‡ä»¶ Viper æ”¯æŒåœ¨åº”ç”¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­å®æ—¶è¯»å–é…ç½®æ–‡ä»¶ï¼Œå³çƒ­åŠ è½½é…ç½®ã€‚\nåªéœ€è¦è°ƒç”¨ viper.WatchConfig() å³å¯å¼€å¯æ­¤åŠŸèƒ½ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;time\u0026#34; \u0026#34;github.com/fsnotify/fsnotify\u0026#34; \u0026#34;github.com/spf13/viper\u0026#34; ) func main() { viper.SetConfigFile(\u0026#34;./config.yaml\u0026#34;) // æ³¨å†Œæ¯æ¬¡é…ç½®æ–‡ä»¶å‘ç”Ÿå˜æ›´åéƒ½ä¼šè°ƒç”¨çš„å›è°ƒå‡½æ•° viper.OnConfigChange(func(e fsnotify.Event) { fmt.Printf(\u0026#34;config file changed: %s username:%s\\n\u0026#34;, e.Name, viper.Get(\u0026#34;username\u0026#34;)) }) // ç›‘æ§å¹¶é‡æ–°è¯»å–é…ç½®æ–‡ä»¶ï¼Œéœ€è¦ç¡®ä¿åœ¨è°ƒç”¨å‰æ·»åŠ äº†æ‰€æœ‰çš„é…ç½®è·¯å¾„ viper.WatchConfig() err := viper.ReadInConfig() if err != nil { log.Fatalln(\u0026#34;åŠ è½½é…ç½®æ–‡ä»¶é”™è¯¯:\u0026#34;, err) } // è¯»å–é…ç½®å€¼ fmt.Printf(\u0026#34;æœªä¿®æ”¹çš„username: %s\\n\u0026#34;, viper.Get(\u0026#34;username\u0026#34;)) // é˜»å¡ç¨‹åºï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­å¯ä»¥æ‰‹åŠ¨å»ä¿®æ”¹é…ç½®æ–‡ä»¶å†…å®¹ï¼Œè§‚å¯Ÿç¨‹åºè¾“å‡ºå˜åŒ–,æ³¨æ„è¦ä¿å­˜ã€‚ time.Sleep(time.Second * 10) // è¯»å–é…ç½®å€¼ fmt.Printf(\u0026#34;æœ€ç»ˆçš„username: %s\\n\u0026#34;, viper.Get(\u0026#34;username\u0026#34;)) } å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨è°ƒç”¨ viper.WatchConfig() ç›‘æ§å¹¶é‡æ–°è¯»å–é…ç½®æ–‡ä»¶ä¹‹å‰ï¼Œéœ€è¦ç¡®ä¿æ·»åŠ äº†æ‰€æœ‰çš„é…ç½®æœç´¢è·¯å¾„ã€‚\nå¹¶ä¸”ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ viper.OnConfigChange() å‡½æ•°æ³¨å†Œä¸€ä¸ªæ¯æ¬¡é…ç½®æ–‡ä»¶å‘ç”Ÿå˜æ›´åéƒ½ä¼šè°ƒç”¨çš„å›è°ƒå‡½æ•°ã€‚\næˆ‘ä»¬ä¾ç„¶ä½¿ç”¨ä¸Šé¢çš„ config.yaml é…ç½®æ–‡ä»¶ï¼š\n1 2 3 4 5 username: arlettebrook password: 123456 server: ip: 127.0.0.1 port: 8080 æ‰§è¡Œä»¥ä¸Šç¤ºä¾‹ä»£ç ï¼Œå¹¶åœ¨ç¨‹åºé˜»å¡çš„æ—¶å€™ï¼Œæ‰‹åŠ¨ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­ username åé¢åˆ†åˆ«è¿½åŠ 1ä¿å­˜ã€2ä¿å­˜3ä¿å­˜ï¼Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š\n1 2 3 4 5 6 7 8 9 $ go run main.go æœªä¿®æ”¹çš„username: arlettebrook config file changed: config.yaml username:arlettebrook1 config file changed: config.yaml username:arlettebrook1 config file changed: config.yaml username:arlettebrook12 config file changed: config.yaml username:arlettebrook12 config file changed: config.yaml username:arlettebrook123 config file changed: config.yaml username:arlettebrook123 æœ€ç»ˆçš„username: arlettebrook123 æˆ‘è¿™é‡Œä¿®æ”¹ä¸€æ¬¡å›è°ƒå‡½æ•°ä¸çŸ¥é“ä¸ºä»€ä¹ˆæ‰§è¡Œäº†ä¿©æ¬¡ï¼Œä¸è¿‡æ²¡æœ‰å½±å“ã€‚\n# ç›‘å¬æ–‡ä»¶ä¿®æ”¹ viper å¯ä»¥ç›‘å¬æ–‡ä»¶ä¿®æ”¹ï¼Œçƒ­åŠ è½½é…ç½®ã€‚å› æ­¤ä¸éœ€è¦é‡å¯æœåŠ¡å™¨ï¼Œå°±èƒ½è®©é…ç½®ç”Ÿæ•ˆã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;time\u0026#34; \u0026#34;github.com/spf13/viper\u0026#34; ) func main() { viper.SetConfigName(\u0026#34;config\u0026#34;) viper.SetConfigType(\u0026#34;toml\u0026#34;) viper.AddConfigPath(\u0026#34;.\u0026#34;) err := viper.ReadInConfig() if err != nil { log.Fatalf(\u0026#34;read config failed: %v\u0026#34;, err) } viper.WatchConfig() fmt.Println(\u0026#34;redis port before sleep: \u0026#34;, viper.Get(\u0026#34;redis.port\u0026#34;)) time.Sleep(time.Second * 10) fmt.Println(\u0026#34;redis port after sleep: \u0026#34;, viper.Get(\u0026#34;redis.port\u0026#34;)) } åªéœ€è¦è°ƒç”¨viper.WatchConfigï¼Œviper ä¼šè‡ªåŠ¨ç›‘å¬é…ç½®ä¿®æ”¹ã€‚å¦‚æœæœ‰ä¿®æ”¹ï¼Œé‡æ–°åŠ è½½çš„é…ç½®ã€‚\nä¸Šé¢ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å…ˆæ‰“å°redis.portçš„å€¼ï¼Œç„¶åSleep 10sã€‚åœ¨è¿™æœŸé—´ä¿®æ”¹é…ç½®ä¸­redis.portçš„å€¼ï¼ŒSleepç»“æŸåå†æ¬¡æ‰“å°ã€‚ å‘ç°æ‰“å°å‡ºä¿®æ”¹åçš„å€¼ï¼š\n1 2 redis port before sleep: 7381 redis port after sleep: 73810 å¦å¤–ï¼Œè¿˜å¯ä»¥ä¸ºé…ç½®ä¿®æ”¹å¢åŠ ä¸€ä¸ªå›è°ƒï¼š\n1 2 3 viper.OnConfigChange(func(e fsnotify.Event) { fmt.Printf(\u0026#34;Config file:%s Op:%s\\n\u0026#34;, e.Name, e.Op) }) è¿™æ ·æ–‡ä»¶ä¿®æ”¹æ—¶ä¼šæ‰§è¡Œè¿™ä¸ªå›è°ƒã€‚\nviper ä½¿ç”¨fsnotifyè¿™ä¸ªåº“æ¥å®ç°ç›‘å¬æ–‡ä»¶ä¿®æ”¹çš„åŠŸèƒ½ã€‚\n# ä» io.Reader è¯»å–é…ç½® Viper æ”¯æŒä»ä»»ä½•å®ç°äº† io.Reader æ¥å£çš„é…ç½®æºä¸­è¯»å–é…ç½®ã€‚æ³¨æ„éœ€è¦æŒ‡å®šé…ç½®æ–‡ä»¶çš„ç±»å‹ï¼Œæ‰èƒ½è¯†åˆ«io.Readerã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 package main import ( \u0026#34;bytes\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;github.com/spf13/viper\u0026#34; ) func main() { viper.SetConfigType(\u0026#34;yaml\u0026#34;) // æˆ–è€…ä½¿ç”¨ viper.SetConfigType(\u0026#34;YAML\u0026#34;) var yamlExample = []byte(` username: arlettebrook password: 123456 server: ip: 127.0.0.1 port: 8080 `) err := viper.ReadConfig(bytes.NewBuffer(yamlExample)) if err != nil { log.Fatalln(\u0026#34;è¯»å–é…ç½®æ–‡ä»¶é”™è¯¯ï¼š\u0026#34;, err) } // è¯»å–é…ç½®å€¼ fmt.Printf(\u0026#34;username: %s\\n\u0026#34;, viper.Get(\u0026#34;username\u0026#34;)) } è¿™é‡Œæˆ‘ä»¬é€šè¿‡ bytes.NewBuffer() æ„é€ äº†ä¸€ä¸ª bytes.Buffer å¯¹è±¡ï¼Œå®ƒå®ç°äº† io.Reader æ¥å£ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ä¼ é€’ç»™ viper.ReadConfig() æ¥ä»ä¸­è¯»å–é…ç½®ã€‚\næ‰§è¡Œä»¥ä¸Šç¤ºä¾‹ä»£ç å¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š\n1 2 $ go run main.go username: arlettebrook # ä»io.Readerä¸­è¯»å– viper æ”¯æŒä»io.Readerä¸­è¯»å–é…ç½®ã€‚è¿™ç§å½¢å¼å¾ˆçµæ´»ï¼Œæ¥æºå¯ä»¥æ˜¯æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯ç¨‹åºä¸­ç”Ÿæˆçš„å­—ç¬¦ä¸²ï¼Œç”šè‡³å¯ä»¥ä»ç½‘ç»œè¿æ¥ä¸­è¯»å–çš„å­—èŠ‚æµã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 package main import ( \u0026#34;bytes\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;github.com/spf13/viper\u0026#34; ) func main() { viper.SetConfigType(\u0026#34;toml\u0026#34;) tomlConfig := []byte(` app_name = \u0026#34;awesome web\u0026#34; # possible values: DEBUG, INFO, WARNING, ERROR, FATAL log_level = \u0026#34;DEBUG\u0026#34; [mysql] ip = \u0026#34;127.0.0.1\u0026#34; port = 3306 user = \u0026#34;dj\u0026#34; password = 123456 database = \u0026#34;awesome\u0026#34; [redis] ip = \u0026#34;127.0.0.1\u0026#34; port = 7381 `) err := viper.ReadConfig(bytes.NewBuffer(tomlConfig)) if err != nil { log.Fatalf(\u0026#34;read config failed: %v\u0026#34;, err) } fmt.Println(\u0026#34;redis port: \u0026#34;, viper.GetInt(\u0026#34;redis.port\u0026#34;)) } # ä»ç¯å¢ƒå˜é‡è¯»å–é…ç½® Viper è¿˜æ”¯æŒä»ç¯å¢ƒå˜é‡è¯»å–é…ç½®ï¼Œæœ‰ 5 ä¸ªæ–¹æ³•å¯ä»¥å¸®åŠ©æˆ‘ä»¬ä½¿ç”¨ç¯å¢ƒå˜é‡:\nAutomaticEnv()ï¼šä½¿Viperæ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦ä¸ä»»ä½•ç°æœ‰é”®ï¼ˆé…ç½®ã€é»˜è®¤å€¼æˆ–æ ‡å¿—ï¼‰åŒ¹é…ã€‚å¦‚æœæ‰¾åˆ°åŒ¹é…çš„ç¯å¢ƒå˜é‡ï¼Œå®ƒä»¬å°†è¢«åŠ è½½åˆ°Viperä¸­ã€‚\nå¼€å¯è‡ªåŠ¨åŒ¹é…ï¼ˆæ ¹æ®å‰ç¼€åŒ¹é…ï¼‰ç¯å¢ƒå˜é‡ï¼ŒåŠ è½½åˆ°Viperä¸­ã€‚å¦‚ä½•æ²¡æœ‰å‰ç¼€å°†åŠ è½½æ‰€æœ‰ç¯å¢ƒå˜é‡ã€‚ BindEnv(string...) : errorï¼šç»‘å®šä¸€ä¸ªç¯å¢ƒå˜é‡ã€‚éœ€è¦ä¸€ä¸ªæˆ–ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é…ç½®é¡¹çš„é”®åï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ç¯å¢ƒå˜é‡çš„åç§°ã€‚å¦‚æœæœªæä¾›ç¬¬äºŒä¸ªå‚æ•°ï¼Œåˆ™ Viper å°†å‡å®šç¯å¢ƒå˜é‡åä¸ºï¼šç¯å¢ƒå˜é‡å‰ç¼€_é”®åï¼Œä¸”ä¸ºå…¨å¤§å†™å½¢å¼ã€‚ä¾‹å¦‚ç¯å¢ƒå˜é‡å‰ç¼€ä¸º ENVï¼Œé”®åä¸º usernameï¼Œåˆ™ç¯å¢ƒå˜é‡åä¸º ENV_USERNAMEã€‚å½“æ˜¾å¼æä¾›ç¬¬äºŒä¸ªå‚æ•°æ—¶ï¼Œå®ƒä¸ä¼šè‡ªåŠ¨æ·»åŠ å‰ç¼€ï¼Œä¹Ÿä¸ä¼šè‡ªåŠ¨å°†å…¶è½¬æ¢ä¸ºå¤§å†™ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ viper.BindEnv(\u0026quot;username\u0026quot;, \u0026quot;username\u0026quot;) ç»‘å®šé”®åä¸º username çš„ç¯å¢ƒå˜é‡ï¼Œåº”è¯¥ä½¿ç”¨ viper.Get(\u0026quot;username\u0026quot;) è¯»å–ç¯å¢ƒå˜é‡çš„å€¼ã€‚\nåœ¨ä½¿ç”¨ç¯å¢ƒå˜é‡æ—¶ï¼Œéœ€è¦æ³¨æ„ï¼Œæ¯æ¬¡è®¿é—®å®ƒçš„å€¼æ—¶éƒ½ä¼šå»ç¯å¢ƒå˜é‡ä¸­è¯»å–ã€‚å½“è°ƒç”¨ BindEnv æ—¶ï¼ŒViper ä¸ä¼šå›ºå®šå®ƒçš„å€¼ã€‚\nSetEnvPrefix(string)ï¼šå¯ä»¥å‘Šè¯‰ Viper åœ¨è¯»å–ç¯å¢ƒå˜é‡æ—¶ä½¿ç”¨çš„å‰ç¼€ã€‚BindEnv å’Œ AutomaticEnv éƒ½å°†ä½¿ç”¨æ­¤å‰ç¼€ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ viper.SetEnvPrefix(\u0026quot;ENV\u0026quot;) è®¾ç½®äº†å‰ç¼€ä¸º ENVï¼Œå¹¶ä¸”ä½¿ç”¨ viper.BindEnv(\u0026quot;username\u0026quot;) ç»‘å®šäº†ç¯å¢ƒå˜é‡ï¼Œåœ¨ä½¿ç”¨ viper.Get(\u0026quot;username\u0026quot;) è¯»å–ç¯å¢ƒå˜é‡æ—¶ï¼Œå®é™…è¯»å–çš„ key æ˜¯ ENV_USERNAMEã€‚\nSetEnvKeyReplacer(string...) *strings.Replacerï¼šå…è®¸ä½¿ç”¨ strings.Replacer å¯¹è±¡åœ¨ä¸€å®šç¨‹åº¦ä¸Šé‡å†™ç¯å¢ƒå˜é‡çš„é”®åã€‚ä¾‹å¦‚ï¼Œå­˜åœ¨ SERVER_IP=\u0026quot;127.0.0.1\u0026quot; ç¯å¢ƒå˜é‡ï¼Œä½¿ç”¨ viper.SetEnvKeyReplacer(strings.NewReplacer(\u0026quot;.\u0026quot;, \u0026quot;_\u0026quot;, \u0026quot;-\u0026quot;, \u0026quot;_\u0026quot;)) å°†é”®åä¸­çš„ . æˆ– - æ›¿æ¢æˆ _ï¼Œåˆ™é€šè¿‡ viper.Get(\u0026quot;server_ip\u0026quot;)ã€viper.Get(\u0026quot;server.ip\u0026quot;)ã€viper.Get(\u0026quot;server-ip\u0026quot;) ä¸‰ç§æ–¹å¼éƒ½å¯ä»¥è¯»å–ç¯å¢ƒå˜é‡å¯¹åº”çš„å€¼ã€‚\nAllowEmptyEnv(bool)ï¼šå½“ç¯å¢ƒå˜é‡ä¸ºç©ºæ—¶ï¼ˆæœ‰é”®åè€Œæ²¡æœ‰å€¼çš„æƒ…å†µï¼‰ï¼Œé»˜è®¤ä¼šè¢«è®¤ä¸ºæ˜¯æœªè®¾ç½®çš„ï¼Œå¹¶ä¸”ç¨‹åºå°†å›é€€åˆ°ä¸‹ä¸€ä¸ªé…ç½®æ¥æºã€‚è¦å°†ç©ºç¯å¢ƒå˜é‡è§†ä¸ºå·²è®¾ç½®ï¼Œå¯ä»¥ä½¿ç”¨æ­¤æ–¹æ³•ã€‚\nviper.AllSettings()è¯»å–å…¨éƒ¨é…ç½®ï¼Œåªèƒ½è·å–åˆ°é€šè¿‡ BindEnv ç»‘å®šçš„ç¯å¢ƒå˜é‡ï¼Œæ— æ³•è·å–åˆ°é€šè¿‡ AutomaticEnv ç»‘å®šçš„ç¯å¢ƒå˜é‡\næ³¨æ„ âš ï¸ï¼š\nViper åœ¨è¯»å–ç¯å¢ƒå˜é‡æ—¶ï¼Œæ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ã€‚å¦‚æœæŒ‡å®šçš„ç¯å¢ƒå˜é‡ä¸ç»‘å®šçš„å¤§å°å†™ä¸ä¸€è‡´ï¼Œviperä¼šè‡ªåŠ¨å¤§å°å†™è½¬æ¢ã€‚ ä»¥ä¸‹ä»£ç æ˜¯åœ¨windowsä¸‹çš„bashç»ˆç«¯ä¸­è¿è¡Œçš„ã€‚ ä½¿ç”¨ç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;strings\u0026#34; \u0026#34;github.com/spf13/viper\u0026#34; ) func main() { viper.SetEnvPrefix(\u0026#34;env\u0026#34;) // è®¾ç½®è¯»å–ç¯å¢ƒå˜é‡å‰ç¼€ï¼Œä¼šè‡ªåŠ¨è½¬ä¸ºå¤§å†™ ENV viper.AllowEmptyEnv(true) // å°†ç©ºç¯å¢ƒå˜é‡è§†ä¸ºå·²è®¾ç½® viper.AutomaticEnv() // å¼€å¯è‡ªåŠ¨åŒ¹é…ï¼ˆæ ¹æ®å‰ç¼€åŒ¹é…ï¼‰ç¯å¢ƒå˜é‡ï¼ŒåŠ è½½åˆ°Viperä¸­ _ = viper.BindEnv(\u0026#34;username\u0026#34;) // ä¹Ÿå¯ä»¥å•ç‹¬ç»‘å®šæŸä¸€ä¸ªç¯å¢ƒå˜é‡ _ = viper.BindEnv(\u0026#34;password\u0026#34;) // å°†é”®åä¸­çš„ . æˆ– - æ›¿æ¢æˆ _ viper.SetEnvKeyReplacer(strings.NewReplacer(\u0026#34;.\u0026#34;, \u0026#34;_\u0026#34;, \u0026#34;-\u0026#34;, \u0026#34;_\u0026#34;)) // è¯»å–é…ç½® fmt.Printf(\u0026#34;username: %v\\n\u0026#34;, viper.Get(\u0026#34;USERNAME\u0026#34;)) fmt.Printf(\u0026#34;password: %v\\n\u0026#34;, viper.Get(\u0026#34;password\u0026#34;)) fmt.Printf(\u0026#34;server.ip: %v\\n\u0026#34;, viper.Get(\u0026#34;server.ip\u0026#34;)) // fmt.Printf(\u0026#34;GOPATH:%v\\n\u0026#34;,viper.Get(\u0026#34;gopath\u0026#34;)) // è¯·æ³¨é‡Šåˆ°å‰ç¼€åœ¨å–æ¶ˆæ³¨é‡Šè¿è¡Œ // è¯»å–å…¨éƒ¨é…ç½®ï¼Œåªèƒ½è·å–åˆ°é€šè¿‡ BindEnv ç»‘å®šçš„ç¯å¢ƒå˜é‡ï¼Œæ— æ³•è·å–åˆ°é€šè¿‡ AutomaticEnv ç»‘å®šçš„ç¯å¢ƒå˜é‡ fmt.Println(viper.AllSettings()) } æ‰§è¡Œä»¥ä¸Šç¤ºä¾‹ä»£ç å¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š\n1 2 3 4 5 $ ENV_USERNAME=arlettebrook ENV_SERVER_IP=127.0.0.1 ENV_PASSWORD= go run main.go username: arlettebrook password: server.ip: 127.0.0.1 map[password: username:arlettebrook] # ç¯å¢ƒå˜é‡ å¦‚æœä»å‘½ä»¤è¡Œå‚æ•°éƒ½æ²¡æœ‰è·å–åˆ°é”®å€¼ï¼Œå°†å°è¯•ä»ç¯å¢ƒå˜é‡ä¸­è¯»å–ã€‚æˆ‘ä»¬æ—¢å¯ä»¥ä¸€ä¸ªä¸ªç»‘å®šï¼Œä¹Ÿå¯ä»¥è‡ªåŠ¨å…¨éƒ¨ç»‘å®šã€‚\nåœ¨initæ–¹æ³•ä¸­è°ƒç”¨AutomaticEnvæ–¹æ³•ç»‘å®šå…¨éƒ¨ç¯å¢ƒå˜é‡ï¼š\n1 2 3 4 func init() { // ç»‘å®šç¯å¢ƒå˜é‡ viper.AutomaticEnv() } ä¸ºäº†éªŒè¯æ˜¯å¦ç»‘å®šæˆåŠŸï¼Œæˆ‘ä»¬åœ¨mainæ–¹æ³•ä¸­å°†ç¯å¢ƒå˜é‡ GOPATH æ‰“å°å‡ºæ¥ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/spf13/viper\u0026#34; ) func init() { // ç»‘å®šç¯å¢ƒå˜é‡ viper.AutomaticEnv() } func main() { fmt.Println(\u0026#34;GOPATH:\u0026#34;, viper.Get(\u0026#34;gopath\u0026#34;)) fmt.Println(\u0026#34;JAVA_HOME:\u0026#34;, viper.Get(\u0026#34;java_home\u0026#34;)) } å…¶ä»–ç¯å¢ƒå˜é‡ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œä¸Šé¢è¾“å‡ºï¼š\n1 2 3 $ go run main.go GOPATH: D:\\GoSettings\\GoPath JAVA_HOME: E:\\Java\\jdk-17.0.5 ä¹Ÿå¯ä»¥å•ç‹¬ç»‘å®šç¯å¢ƒå˜é‡ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/spf13/viper\u0026#34; ) func init() { // ç»‘å®šç¯å¢ƒå˜é‡ _ = viper.BindEnv(\u0026#34;redis.port\u0026#34;, \u0026#34;redis_port\u0026#34;) _ = viper.BindEnv(\u0026#34;username\u0026#34;) } func main() { fmt.Println(\u0026#34;redis port:\u0026#34;, viper.Get(\u0026#34;redis.port\u0026#34;)) fmt.Println(\u0026#34;username:\u0026#34;, viper.Get(\u0026#34;username\u0026#34;)) } è°ƒç”¨BindEnvæ–¹æ³•ï¼Œå¦‚æœåªä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œåˆ™è¿™ä¸ªå‚æ•°æ—¢è¡¨ç¤ºé”®åï¼Œåˆè¡¨ç¤ºç¯å¢ƒå˜é‡åã€‚ å¦‚æœä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œåˆ™ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºé”®åï¼Œç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºç¯å¢ƒå˜é‡åã€‚\nä¸Šé¢å°†è¿è¡Œå°†è¾“å‡ºï¼š\n1 2 3 $ username=arlettebrook REDIS_PORT=10809 go run main.go redis port: 10809 username: arlettebrook å¦‚æœå¯¹åº”çš„ç¯å¢ƒå˜é‡ä¸å­˜åœ¨ï¼Œviper ä¼šè‡ªåŠ¨å°†é”®åå…¨éƒ¨å¤§å°å†™è½¬æ¢å†æŸ¥æ‰¾ä¸€æ¬¡ã€‚æ‰€ä»¥ï¼Œä½¿ç”¨é”®åREDIS_PORTä¹Ÿèƒ½è¯»å–ç¯å¢ƒå˜é‡redis.portçš„å€¼ã€‚\nå¦å¤–ï¼ŒåµŒå¥—çš„é…ç½®é”®ï¼Œç»‘å®šç¯å¢ƒå˜é‡æ—¶å¿…é¡»æŒ‡å®šç¯å¢ƒå˜é‡åï¼Œå› ä¸º Viper ä¸ä¼šè‡ªåŠ¨å°†ç‚¹è½¬æ¢ä¸ºä¸‹åˆ’çº¿æˆ–å…¶ä»–åˆ†éš”ç¬¦ã€‚\nä½†å¯ä»¥è®¾ç½®ç¯å¢ƒå˜é‡åçš„æ›¿æ¢ç¬¦ï¼Œå°±å¯ä»¥ä¸ç”¨çŸ¥é“ç¬¬äºŒä¸ªå‚æ•°\n1 2 // å°†é”®åä¸­çš„ . æˆ– - æ›¿æ¢æˆ _ viper.SetEnvKeyReplacer(strings.NewReplacer(\u0026#34;.\u0026#34;, \u0026#34;_\u0026#34;, \u0026#34;-\u0026#34;, \u0026#34;_\u0026#34;)) å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;strings\u0026#34; \u0026#34;github.com/spf13/viper\u0026#34; ) func init() { // ç»‘å®šç¯å¢ƒå˜é‡ _ = viper.BindEnv(\u0026#34;redis.port\u0026#34;) _ = viper.BindEnv(\u0026#34;username-a\u0026#34;) viper.SetEnvKeyReplacer(strings.NewReplacer(\u0026#34;.\u0026#34;, \u0026#34;_\u0026#34;, \u0026#34;-\u0026#34;, \u0026#34;_\u0026#34;)) } func main() { fmt.Println(\u0026#34;redis port:\u0026#34;, viper.Get(\u0026#34;redis.port\u0026#34;)) fmt.Println(\u0026#34;username-a:\u0026#34;, viper.Get(\u0026#34;username-a\u0026#34;)) } æ¼”ç¤ºè¾“å‡ºï¼š\n1 2 3 $ username_A=arlettebrook REDIS_PORT=10809 go run main.go redis port: 10809 username-a: arlettebrook # ä»å‘½ä»¤è¡Œå‚æ•°è¯»å–é…ç½® Viper æ”¯æŒ pflag åŒ…ï¼ˆå®ƒä»¬å…¶å®éƒ½åœ¨ spf13 ä»“åº“ä¸‹ï¼‰ï¼Œèƒ½å¤Ÿç»‘å®šå‘½ä»¤è¡Œæ ‡å¿—ï¼Œä»è€Œè¯»å–å‘½ä»¤è¡Œå‚æ•°ã€‚\nåŒ BindEnv ç±»ä¼¼ï¼Œåœ¨è°ƒç”¨ç»‘å®šæ–¹æ³•æ—¶ï¼Œä¸ä¼šè®¾ç½®å€¼ï¼Œè€Œæ˜¯åœ¨æ¯æ¬¡è®¿é—®æ—¶è®¾ç½®ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥éšæ—¶ç»‘å®šå®ƒï¼Œä¾‹å¦‚å¯ä»¥åœ¨ init() å‡½æ•°ä¸­ã€‚\nBindPFlagï¼šå¯¹äºå•ä¸ªæ ‡å¿—ï¼Œå¯ä»¥è°ƒç”¨æ­¤æ–¹æ³•è¿›è¡Œç»‘å®šã€‚ BindPFlagsï¼šå¯ä»¥ç»‘å®šä¸€ç»„ç°æœ‰çš„æ ‡å¿—é›† pflag.FlagSetã€‚ ç¤ºä¾‹ç¨‹åºå¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/spf13/pflag\u0026#34; \u0026#34;github.com/spf13/viper\u0026#34; ) var ( _ = pflag.StringP(\u0026#34;username\u0026#34;, \u0026#34;u\u0026#34;, \u0026#34;\u0026#34;, \u0026#34;help message for username\u0026#34;) _ = pflag.StringP(\u0026#34;password\u0026#34;, \u0026#34;p\u0026#34;, \u0026#34;\u0026#34;, \u0026#34;help message for password\u0026#34;) ) func main() { pflag.Parse() _ = viper.BindPFlag(\u0026#34;username\u0026#34;, pflag.Lookup(\u0026#34;username\u0026#34;)) // ç»‘å®šå•ä¸ªæ ‡å¿— _ = viper.BindPFlags(pflag.CommandLine) // ç»‘å®šæ ‡å¿—é›† // è¯»å–é…ç½®å€¼ fmt.Printf(\u0026#34;username: %s\\n\u0026#34;, viper.Get(\u0026#34;username\u0026#34;)) fmt.Printf(\u0026#34;password: %s\\n\u0026#34;, viper.Get(\u0026#34;password\u0026#34;)) } æ‰§è¡Œä»¥ä¸Šç¤ºä¾‹ä»£ç å¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š\n1 2 3 $ go run main.go -u arlettebrook -p 123456 username: arlettebrook password: 123456 å› ä¸º pflag èƒ½å¤Ÿå…¼å®¹æ ‡å‡†åº“çš„ flag åŒ…ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥å˜ç›¸çš„è®© Viper æ”¯æŒ flagã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 package main import ( \u0026#34;flag\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;github.com/spf13/pflag\u0026#34; \u0026#34;github.com/spf13/viper\u0026#34; ) func main() { _ = flag.String(\u0026#34;username\u0026#34;, \u0026#34;\u0026#34;, \u0026#34;help message for username\u0026#34;) pflag.CommandLine.AddGoFlagSet(flag.CommandLine) // å°† flag å‘½ä»¤è¡Œå‚æ•°æ³¨å†Œåˆ° pflag pflag.Parse() _ = viper.BindPFlags(pflag.CommandLine) // è¯»å–é…ç½®å€¼ fmt.Printf(\u0026#34;username: %s\\n\u0026#34;, viper.Get(\u0026#34;username\u0026#34;)) } æ‰§è¡Œä»¥ä¸Šç¤ºä¾‹ä»£ç å¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š\n1 2 $ go run main.go --username arlettebrook username: arlettebrook å¦‚æœä½ ä¸ä½¿ç”¨ flag æˆ– pflagï¼Œåˆ™ Viper è¿˜æä¾›äº† Go æ¥å£çš„å½¢å¼æ¥æ”¯æŒå…¶ä»– Flagsï¼Œå…·ä½“ç”¨æ³•å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚\n# å‘½ä»¤è¡Œé€‰é¡¹ å¦‚æœä¸€ä¸ªé”®æ²¡æœ‰é€šè¿‡viper.Setæ˜¾ç¤ºè®¾ç½®å€¼ï¼Œé‚£ä¹ˆè·å–æ—¶å°†å°è¯•ä»å‘½ä»¤è¡Œé€‰é¡¹ä¸­è¯»å–ã€‚ å¦‚æœæœ‰ï¼Œä¼˜å…ˆä½¿ç”¨ã€‚viper ä½¿ç”¨ pflag åº“æ¥è§£æé€‰é¡¹ã€‚ æˆ‘ä»¬é¦–å…ˆåœ¨initæ–¹æ³•ä¸­å®šä¹‰é€‰é¡¹ï¼Œå¹¶ä¸”è°ƒç”¨viper.BindPFlagsç»‘å®šé€‰é¡¹åˆ°é…ç½®ä¸­ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/spf13/pflag\u0026#34; \u0026#34;github.com/spf13/viper\u0026#34; ) func init() { pflag.Int(\u0026#34;redis.port\u0026#34;, 8381, \u0026#34;Redis port to connect\u0026#34;) // ç»‘å®šå‘½ä»¤è¡Œ _ = viper.BindPFlags(pflag.CommandLine) } func main() { pflag.Parse() viper.SetConfigFile(\u0026#34;./config.toml\u0026#34;) _ = viper.ReadInConfig() fmt.Println(viper.Get(\u0026#34;app_name\u0026#34;)) fmt.Println(viper.Get(\u0026#34;log_level\u0026#34;)) fmt.Println(\u0026#34;mysql ip: \u0026#34;, viper.Get(\u0026#34;mysql.ip\u0026#34;)) fmt.Println(\u0026#34;mysql port: \u0026#34;, viper.Get(\u0026#34;mysql.port\u0026#34;)) fmt.Println(\u0026#34;mysql user: \u0026#34;, viper.Get(\u0026#34;mysql.user\u0026#34;)) fmt.Println(\u0026#34;mysql password: \u0026#34;, viper.Get(\u0026#34;mysql.password\u0026#34;)) fmt.Println(\u0026#34;mysql database: \u0026#34;, viper.Get(\u0026#34;mysql.database\u0026#34;)) fmt.Println(\u0026#34;redis ip: \u0026#34;, viper.Get(\u0026#34;redis.ip\u0026#34;)) fmt.Println(\u0026#34;redis port: \u0026#34;, viper.Get(\u0026#34;redis.port\u0026#34;)) } ç¼–è¯‘ã€è¿è¡Œç¨‹åºï¼š\n1 2 3 4 5 6 7 8 9 10 $ go run main.go --redis.port 9381 awesome web DEBUG mysql ip: 127.0.0.1 mysql port: 3306 mysql user: dj mysql password: 123456 mysql database: awesome redis ip: 127.0.0.1 redis port: 9381 å¦‚ä½•ä¸ä¼ å…¥é€‰é¡¹ï¼š\nå°†ä½¿ç”¨ç¯å¢ƒå˜é‡çš„é…ç½®ï¼Œæ²¡æœ‰ï¼Œåœ¨ä½¿ç”¨é…ç½®æ–‡ä»¶çš„é…ç½®ï¼Œæ²¡æœ‰ï¼Œåœ¨ä½¿ç”¨é»˜è®¤ï¼Œéƒ½æ²¡æœ‰ï¼Œä¸ºå¯¹åº”ç±»å‹çš„é›¶å€¼ã€‚\nå°†ä½¿ç”¨é…ç½®æ–‡ä»¶çš„é…ç½®redis port: 7381ï¼Œå¦‚æœé…ç½®æ–‡ä»¶æ²¡æœ‰é…ç½®ï¼Œæ‰ä¼šä½¿ç”¨é»˜è®¤å€¼ã€‚è¿™é‡Œæ²¡æœ‰é»˜è®¤å€¼ã€‚\n# ä»è¿œç¨‹ key/value å­˜å‚¨è¯»å–é…ç½® è¦åœ¨ Viper ä¸­å¯ç”¨è¿œç¨‹æ”¯æŒï¼Œéœ€è¦åŒ¿åå¯¼å…¥ viper/remote åŒ…ï¼š\n1 import _ \u0026#34;github.com/spf13/viper/remote\u0026#34; Viper æ”¯æŒ etcdã€Consul ç­‰è¿œç¨‹ key/value å­˜å‚¨ï¼Œè¿™é‡Œä»¥ Consul ä¸ºä¾‹è¿›è¡Œè®²è§£ã€‚\né¦–å…ˆéœ€è¦å‡†å¤‡ Consul ç¯å¢ƒï¼Œæœ€æ–¹ä¾¿å¿«æ·çš„æ–¹å¼å°±æ˜¯å¯åŠ¨ä¸€ä¸ª Docker å®¹å™¨ï¼š\n1 2 3 4 5 6 $ docker run \\ -d \\ -p 8500:8500 \\ -p 8600:8600/udp \\ --name=badger \\ consul agent -server -ui -node=server-1 -bootstrap-expect=1 -client=0.0.0.0 Docker å®¹å™¨å¯åŠ¨å¥½åï¼Œæµè§ˆå™¨è®¿é—® http://localhost:8500/ï¼Œå³å¯è¿›å…¥ Consul æ§åˆ¶å°ï¼Œåœ¨ user/config è·¯å¾„ä¸‹ç¼–å†™ YAML æ ¼å¼çš„é…ç½®ã€‚\nä½¿ç”¨ Viper ä» Consul è¯»å–é…ç½®ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/spf13/viper\u0026#34; _ \u0026#34;github.com/spf13/viper/remote\u0026#34; // å¿…é¡»å¯¼å…¥ï¼Œæ‰èƒ½åŠ è½½è¿œç¨‹ key/value é…ç½® ) func main() { viper.AddRemoteProvider(\u0026#34;consul\u0026#34;, \u0026#34;localhost:8500\u0026#34;, \u0026#34;user/config\u0026#34;) // è¿æ¥è¿œç¨‹ consul æœåŠ¡ viper.SetConfigType(\u0026#34;YAML\u0026#34;) // æ˜¾å¼è®¾ç½®æ–‡ä»¶æ ¼å¼æ–‡ YAML viper.ReadRemoteConfig() // è¯»å–é…ç½®å€¼ fmt.Printf(\u0026#34;username: %s\\n\u0026#34;, viper.Get(\u0026#34;username\u0026#34;)) fmt.Printf(\u0026#34;server.ip: %s\\n\u0026#34;, viper.Get(\u0026#34;server.ip\u0026#34;)) } æ‰§è¡Œä»¥ä¸Šç¤ºä¾‹ä»£ç å¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š\n1 2 3 $ go run main.go username: jianghushinian server.ip: 127.0.0.1 ç¬”è®°ï¼šå¦‚æœä½ æƒ³åœæ­¢é€šè¿‡ Docker å®‰è£…çš„ Consul å®¹å™¨ï¼Œåˆ™å¯ä»¥æ‰§è¡Œ docker stop badger å‘½ä»¤ã€‚å¦‚æœéœ€è¦åˆ é™¤ï¼Œåˆ™å¯ä»¥æ‰§è¡Œ docker rm badger å‘½ä»¤ã€‚\n# ä» Viper ä¸­è¯»å–é…ç½®å€¼ å‰æ–‡ä¸­æˆ‘ä»¬ä»‹ç»äº†å„ç§å°†é…ç½®è¯»å…¥ Viper çš„æŠ€å·§ï¼Œç°åœ¨è¯¥å­¦ä¹ å¦‚ä½•ä½¿ç”¨è¿™äº›é…ç½®äº†ã€‚\nåœ¨ Viper ä¸­ï¼Œæœ‰å¦‚ä¸‹å‡ ç§æ–¹æ³•å¯ä»¥è·å–é…ç½®å€¼ï¼š\nGet(key string) interface{}ï¼šè·å–é…ç½®é¡¹ key æ‰€å¯¹åº”çš„å€¼ï¼Œkey ä¸åŒºåˆ†å¤§å°å†™ï¼Œè¿”å›æ¥å£ç±»å‹ã€‚ Get\u0026lt;Type\u0026gt;(key string) \u0026lt;Type\u0026gt;ï¼šè·å–æŒ‡å®šç±»å‹çš„é…ç½®å€¼ï¼Œ å¯ä»¥æ˜¯ Viper æ”¯æŒçš„ç±»å‹ï¼šGetBoolã€GetFloat64ã€GetIntã€GetIntSliceã€GetStringã€GetStringMapã€GetStringMapStringã€GetStringSliceã€GetTimeã€GetDurationã€‚ AllSettings() map[string]interface{}ï¼šè¿”å›æ‰€æœ‰é…ç½®ã€‚æ ¹æ®æˆ‘çš„ç»éªŒï¼Œå¦‚æœä½¿ç”¨ç¯å¢ƒå˜é‡æŒ‡å®šé…ç½®ï¼Œåˆ™åªèƒ½è·å–åˆ°é€šè¿‡ BindEnv ç»‘å®šçš„ç¯å¢ƒå˜é‡ï¼Œæ— æ³•è·å–åˆ°é€šè¿‡ AutomaticEnv ç»‘å®šçš„ç¯å¢ƒå˜é‡ã€‚ IsSet(key string) boolï¼šå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä½¿ç”¨ Get æˆ– Get\u0026lt;Type\u0026gt; è·å–é…ç½®å€¼ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™æ¯ä¸ª Get å‡½æ•°éƒ½ä¼šè¿”å›ä¸€ä¸ªé›¶å€¼ã€‚ä¸ºäº†æ£€æŸ¥ç»™å®šçš„é”®æ˜¯å¦å­˜åœ¨ï¼Œå¯ä»¥ä½¿ç”¨ IsSet æ–¹æ³•ï¼Œå­˜åœ¨è¿”å› trueï¼Œä¸å­˜åœ¨è¿”å› falseã€‚ # è®¿é—®åµŒå¥—çš„é”® æœ‰å¦‚ä¸‹é…ç½®æ–‡ä»¶ config.yamlï¼š\n1 2 3 4 5 username: arlettebrook password: 123456 server: ip: 127.0.0.1 port: 8080 å¯ä»¥é€šè¿‡ . åˆ†éš”ç¬¦æ¥è®¿é—®åµŒå¥—å­—æ®µã€‚\n1 viper.Get(\u0026#34;server.ip\u0026#34;) ç¤ºä¾‹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;github.com/spf13/viper\u0026#34; ) func main() { viper.SetConfigFile(\u0026#34;./config.yaml\u0026#34;) err := viper.ReadInConfig() if err != nil { log.Fatalln(\u0026#34;åŠ è½½é…ç½®æ–‡ä»¶å¤±è´¥ï¼š\u0026#34;, err) } // è¯»å–é…ç½®å€¼ fmt.Printf(\u0026#34;username: %v\\n\u0026#34;, viper.Get(\u0026#34;username\u0026#34;)) fmt.Printf(\u0026#34;server: %v\\n\u0026#34;, viper.Get(\u0026#34;server\u0026#34;)) fmt.Printf(\u0026#34;server.ip: %v\\n\u0026#34;, viper.Get(\u0026#34;server.ip\u0026#34;)) fmt.Printf(\u0026#34;server.port: %v\\n\u0026#34;, viper.Get(\u0026#34;server.port\u0026#34;)) } æ‰§è¡Œä»¥ä¸Šç¤ºä¾‹ä»£ç å¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š\n1 2 3 4 5 $ go run main.go username: arlettebrook server: map[ip:127.0.0.1 port:8080] server.ip: 127.0.0.1 server.port: 8080 æœ‰ä¸€ç§æƒ…å†µæ˜¯ï¼Œé…ç½®ä¸­æœ¬å°±å­˜åœ¨ç€å« server.ip çš„é”®ï¼Œé‚£ä¹ˆå®ƒä¼šé®è”½ server å¯¹è±¡ä¸‹çš„ ip é…ç½®é¡¹ã€‚\n1 2 3 4 5 6 username: arlettebrook password: 123456 server: ip: 127.0.0.1 port: 8080 server.ip: 10.0.0.1 ç¤ºä¾‹ç¨‹åºå¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;github.com/spf13/viper\u0026#34; ) func main() { viper.SetConfigFile(\u0026#34;./config.yaml\u0026#34;) err := viper.ReadInConfig() if err != nil { log.Println(\u0026#34;åŠ è½½é…ç½®æ–‡ä»¶å‡ºé”™ï¼š\u0026#34;, err) } // è¯»å–é…ç½®å€¼ fmt.Printf(\u0026#34;username: %v\\n\u0026#34;, viper.Get(\u0026#34;username\u0026#34;)) fmt.Printf(\u0026#34;server: %v\\n\u0026#34;, viper.Get(\u0026#34;server\u0026#34;)) fmt.Printf(\u0026#34;server.ip: %v\\n\u0026#34;, viper.Get(\u0026#34;server.ip\u0026#34;)) fmt.Printf(\u0026#34;server.port: %v\\n\u0026#34;, viper.Get(\u0026#34;server.port\u0026#34;)) } æ‰§è¡Œä»¥ä¸Šç¤ºä¾‹ä»£ç å¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š\n1 2 3 4 5 $ go run main.go username: arlettebrook server: map[ip:127.0.0.1 port:8080] server.ip: 10.0.0.1 server.port: 8080 server.ip æ‰“å°ç»“æœä¸º 10.0.0.1ï¼Œè€Œä¸å†æ˜¯ server map ä¸­æ‰€å¯¹åº”çš„å€¼ 127.0.0.1ã€‚\n# æå–å­æ ‘ å½“ä½¿ç”¨ Viper è¯»å– config.yaml é…ç½®æ–‡ä»¶åï¼Œviper å¯¹è±¡å°±åŒ…å«äº†æ‰€æœ‰é…ç½®ï¼Œå¹¶èƒ½é€šè¿‡ viper.Get(\u0026quot;server.ip\u0026quot;) è·å–å­é…ç½®ã€‚\næˆ‘ä»¬å¯ä»¥å°†è¿™ä»½é…ç½®ç†è§£ä¸ºä¸€é¢—æ ‘å½¢ç»“æ„ï¼Œviper å¯¹è±¡å°±åŒ…å«äº†è¿™ä¸ªå®Œæ•´çš„æ ‘ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•è·å– server å­æ ‘ã€‚\n1 srvCfg := viper.Sub(\u0026#34;server\u0026#34;) ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/spf13/viper\u0026#34; ) func main() { viper.SetConfigFile(\u0026#34;./config.yaml\u0026#34;) _ = viper.ReadInConfig() // è·å– server å­æ ‘ srvCfg := viper.Sub(\u0026#34;server\u0026#34;) // è¯»å–é…ç½®å€¼ fmt.Printf(\u0026#34;ip: %v\\n\u0026#34;, srvCfg.Get(\u0026#34;ip\u0026#34;)) fmt.Printf(\u0026#34;port: %v\\n\u0026#34;, srvCfg.Get(\u0026#34;port\u0026#34;)) fmt.Printf(\u0026#34;server.ip: %v\\n\u0026#34;, viper.Get(\u0026#34;server.ip\u0026#34;)) } æ‰§è¡Œä»¥ä¸Šç¤ºä¾‹ä»£ç å¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š\n1 2 3 4 $ go run main.go ip: 127.0.0.1 port: 8080 server.ip: 10.0.0.1 è¿™é‡Œé”®æ²¡æœ‰å‡ºç°è¦†ç›–çš„æƒ…å†µ\n# ååºåˆ—åŒ– Viper æä¾›äº† 2 ä¸ªæ–¹æ³•è¿›è¡Œååºåˆ—åŒ–æ“ä½œï¼Œä»¥æ­¤æ¥å®ç°å°†æ‰€æœ‰æˆ–ç‰¹å®šçš„å€¼è§£æåˆ°ç»“æ„ä½“ã€map ç­‰ã€‚\nUnmarshal(rawVal interface{}) : errorï¼šååºåˆ—åŒ–æ‰€æœ‰é…ç½®é¡¹ã€‚ UnmarshalKey(key string, rawVal interface{}) : errorï¼šååºåˆ—åŒ–æŒ‡å®šé…ç½®é¡¹ã€‚ ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;github.com/spf13/viper\u0026#34; ) type Config struct { Username string Password string // Viper æ”¯æŒåµŒå¥—ç»“æ„ä½“ Server struct { IP string Port int } } func main() { viper.SetConfigFile(\u0026#34;./config.yaml\u0026#34;) _ = viper.ReadInConfig() var cfg Config if err := viper.Unmarshal(\u0026amp;cfg); err != nil { log.Fatalln(\u0026#34;ååºåˆ—åŒ–é”™è¯¯ï¼š\u0026#34;, err) } var Password string if err := viper.UnmarshalKey(\u0026#34;Password\u0026#34;, \u0026amp;Password); err != nil { log.Fatalln(\u0026#34;ååºåˆ—åŒ–é”™è¯¯ï¼š\u0026#34;, err) } fmt.Printf(\u0026#34;cfg: %+v\\n\u0026#34;, cfg) fmt.Printf(\u0026#34;Password: %s\\n\u0026#34;, Password) } æ‰§è¡Œä»¥ä¸Šç¤ºä¾‹ä»£ç å¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š\n1 2 3 $ go run main.go cfg: {Username:arlettebrook Password:123456 Server:{IP:10.0.0.1 Port:8080}} Password: 123456 å¦‚æœé…ç½®é¡¹çš„ key æœ¬èº«å°±åŒ…å« .ï¼Œåˆ™éœ€è¦ä¿®æ”¹åˆ†éš”ç¬¦ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/spf13/viper\u0026#34; ) type Config struct { Chart struct { Values map[string]interface{} } } func main() { // é»˜è®¤çš„é”®åˆ†éš”ç¬¦ä¸º `.`ï¼Œè¿™é‡Œå°†å…¶ä¿®æ”¹ä¸º `::` v := viper.NewWithOptions(viper.KeyDelimiter(\u0026#34;::\u0026#34;)) v.SetDefault(\u0026#34;chart::values\u0026#34;, map[string]interface{}{ \u0026#34;ingress\u0026#34;: map[string]interface{}{ \u0026#34;annotations\u0026#34;: map[string]interface{}{ \u0026#34;traefik.frontend.rule.type\u0026#34;: \u0026#34;PathPrefix\u0026#34;, \u0026#34;traefik.ingress.kubernetes.io/ssl-redirect\u0026#34;: \u0026#34;true\u0026#34;, }, }, }) var cfg Config if err := v.Unmarshal(\u0026amp;cfg); err != nil { panic(err) } fmt.Printf(\u0026#34;cfg: %+v\\n\u0026#34;, cfg) } æ‰§è¡Œä»¥ä¸Šç¤ºä¾‹ä»£ç å¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š\n1 2 3 $ go run main.go cfg: {Chart:{Values:map[ingress:map[annotations:map[traefik.frontend.rule.type:PathPrefix traefik. ingress.kubernetes.io/ssl-redirect:true]]]}} æ³¨æ„âš ï¸ï¼šViper åœ¨åå°ä½¿ç”¨ mapstructure æ¥è§£æå€¼ï¼Œå…¶é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨ mapstructure tagsã€‚å½“æˆ‘ä»¬éœ€è¦å°† Viper è¯»å–çš„é…ç½®ååºåˆ—åˆ°ç»“æ„ä½“ä¸­æ—¶ï¼Œå¦‚æœå‡ºç°ç»“æ„ä½“å­—æ®µè·Ÿé…ç½®é¡¹ä¸åŒ¹é…ï¼Œåˆ™å¯ä»¥è®¾ç½® mapstructure tags æ¥è§£å†³ã€‚\n# Unmarshal viper æ”¯æŒå°†é…ç½®Unmarshalåˆ°ä¸€ä¸ªç»“æ„ä½“ä¸­ï¼Œä¸ºç»“æ„ä½“ä¸­çš„å¯¹åº”å­—æ®µèµ‹å€¼ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;github.com/spf13/viper\u0026#34; ) type Config struct { AppName string LogLevel string MySQL MySQLConfig Redis RedisConfig } type MySQLConfig struct { IP string Port int User string Password string Database string } type RedisConfig struct { IP string Port int } func main() { viper.SetConfigName(\u0026#34;config\u0026#34;) viper.SetConfigType(\u0026#34;toml\u0026#34;) viper.AddConfigPath(\u0026#34;.\u0026#34;) err := viper.ReadInConfig() if err != nil { log.Fatalf(\u0026#34;read config failed: %v\u0026#34;, err) } var c Config err = viper.Unmarshal(\u0026amp;c) if err != nil { log.Fatalf(\u0026#34;ååºåˆ—åŒ–å¤±è´¥ï¼š%v\u0026#34;, err) } fmt.Println(c.MySQL) } ç¼–è¯‘ï¼Œè¿è¡Œç¨‹åºï¼Œè¾“å‡ºï¼š\n1 2 $ go run main.go {127.0.0.1 3306 dj 123456 awesome} # åºåˆ—åŒ– ä¸€ä¸ªå¥½ç”¨çš„é…ç½®åŒ…ä¸ä»…èƒ½å¤Ÿæ”¯æŒååºåˆ—åŒ–æ“ä½œï¼Œè¿˜è¦æ”¯æŒåºåˆ—åŒ–æ“ä½œã€‚Viper æ”¯æŒå°†é…ç½®åºåˆ—åŒ–æˆå­—ç¬¦ä¸²ï¼Œæˆ–ç›´æ¥åºåˆ—åŒ–åˆ°æ–‡ä»¶ä¸­ã€‚\n# åºåˆ—åŒ–æˆå­—ç¬¦ä¸² æˆ‘ä»¬å¯ä»¥å°†å…¨éƒ¨é…ç½®åºåˆ—åŒ–é…ç½®ä¸º YAML æ ¼å¼å­—ç¬¦ä¸²ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/spf13/viper\u0026#34; \u0026#34;gopkg.in/yaml.v3\u0026#34; ) // åºåˆ—åŒ–é…ç½®ä¸º YAML æ ¼å¼å­—ç¬¦ä¸² func yamlStringSettings() string { c := viper.AllSettings() // è·å–å…¨éƒ¨é…ç½® bs, _ := yaml.Marshal(c) // æ ¹æ®éœ€æ±‚åºåˆ—åŒ–æˆä¸åŒæ ¼å¼ return string(bs) } func main() { viper.SetConfigFile(\u0026#34;./config.yaml\u0026#34;) _ = viper.ReadInConfig() fmt.Printf(yamlStringSettings()) } æ‰§è¡Œä»¥ä¸Šç¤ºä¾‹ä»£ç å¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š\n1 2 3 4 5 6 $ go run main.go password: 123456 server: ip: 10.0.0.1 port: 8080 username: arlettebrook # å†™å…¥é…ç½®æ–‡ä»¶ Viper è¿˜æ”¯æŒç›´æ¥å°†é…ç½®åºåˆ—åŒ–åˆ°æ–‡ä»¶ä¸­ï¼Œæä¾›äº†å¦‚ä¸‹å‡ ä¸ªæ–¹æ³•ï¼š\nWriteConfigï¼šå°†å½“å‰çš„ viper é…ç½®å†™å…¥é¢„å®šä¹‰è·¯å¾„ã€‚å¦‚æœæ²¡æœ‰é¢„å®šä¹‰è·¯å¾„ï¼Œåˆ™ä¼šæŠ¥é”™ã€‚å¦‚æœé¢„å®šä¹‰è·¯å¾„å·²ç»å­˜åœ¨é…ç½®æ–‡ä»¶ï¼Œå°†ä¼šè¢«è¦†ç›–ã€‚ SafeWriteConfigï¼šå°†å½“å‰çš„ viper é…ç½®å†™å…¥é¢„å®šä¹‰è·¯å¾„ã€‚å¦‚æœæ²¡æœ‰é¢„å®šä¹‰è·¯å¾„ï¼Œåˆ™ä¼šæŠ¥é”™ã€‚å¦‚æœé¢„å®šä¹‰è·¯å¾„å·²ç»å­˜åœ¨é…ç½®æ–‡ä»¶ï¼Œä¸ä¼šè¦†ç›–ï¼Œä¼šæŠ¥é”™ã€‚ WriteConfigAsï¼š å°†å½“å‰çš„ viper é…ç½®å†™å…¥ç»™å®šçš„æ–‡ä»¶è·¯å¾„ã€‚å¦‚æœç»™å®šçš„æ–‡ä»¶è·¯å¾„å·²ç»å­˜åœ¨é…ç½®æ–‡ä»¶ï¼Œå°†ä¼šè¢«è¦†ç›–ã€‚ SafeWriteConfigAsï¼šå°†å½“å‰çš„ viper é…ç½®å†™å…¥ç»™å®šçš„æ–‡ä»¶è·¯å¾„ã€‚å¦‚æœç»™å®šçš„æ–‡ä»¶è·¯å¾„å·²ç»å­˜åœ¨é…ç½®æ–‡ä»¶ï¼Œä¸ä¼šè¦†ç›–ï¼Œä¼šæŠ¥é”™ã€‚ æ³¨æ„ä¿å­˜çš„æ–‡ä»¶ç±»å‹è¦ä¸é…ç½®ç±»å‹ä¸€ç›´ï¼Œå¦åˆ™ä¼šæŠ¥é”™config type could not be determined for XXXã€‚ ä½¿ç”¨ç¤ºä¾‹ï¼š\n1 2 3 4 5 6 viper.WriteConfig() // å°†å½“å‰é…ç½®å†™å…¥ç”± `viper.AddConfigPath()` å’Œ `viper.SetConfigFile()` è®¾ç½®çš„é¢„å®šä¹‰è·¯å¾„ã€‚ç±»å‹å°±ä¸ºé…ç½®ç±»å‹ã€‚ viper.SafeWriteConfig() // å°†ä¼šæŠ¥é”™ï¼Œå› ä¸ºå®ƒå·²ç»è¢«å†™å…¥äº†ã€‚ viper.WriteConfigAs(\u0026#34;./cfg.yaml\u0026#34;) // æ–‡ä»¶ç±»å‹è¦ä¸é…ç½®ç±»å‹ä¸€ç›´ï¼Œå¦åˆ™æŠ¥é”™ viper.SafeWriteConfigAs(\u0026#34;./cfg.yaml\u0026#34;) // å°†ä¼šæŠ¥é”™ï¼Œå› ä¸ºå®ƒå·²ç»è¢«å†™å…¥äº†ã€‚ viper.SafeWriteConfigAs(\u0026#34;./cfg/cfg.yaml\u0026#34;) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/spf13/viper\u0026#34; \u0026#34;gopkg.in/yaml.v3\u0026#34; ) // åºåˆ—åŒ–é…ç½®ä¸º YAML æ ¼å¼å­—ç¬¦ä¸² func yamlStringSettings() string { c := viper.AllSettings() // è·å–å…¨éƒ¨é…ç½® bs, _ := yaml.Marshal(c) // æ ¹æ®éœ€æ±‚åºåˆ—åŒ–æˆä¸åŒæ ¼å¼ return string(bs) } func main() { viper.SetConfigFile(\u0026#34;./config.yaml\u0026#34;) _ = viper.ReadInConfig() fmt.Printf(yamlStringSettings()) viper.Set(\u0026#34;username\u0026#34;, \u0026#34;å“ˆå“ˆå“ˆ\u0026#34;) err := viper.WriteConfigAs(\u0026#34;./cfg.yaml\u0026#34;) if err != nil { panic(err) } fmt.Println(\u0026#34;ä¿®æ”¹åçš„username:\u0026#34;, viper.Get(\u0026#34;username\u0026#34;)) } è¾“å‡ºï¼š\n1 2 3 4 5 6 7 $ go run main.go password: 123456 server: ip: 10.0.0.1 port: 8080 username: arlettebrook ä¿®æ”¹åçš„username: å“ˆå“ˆå“ˆ # ä¿å­˜é…ç½® æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬æƒ³è¦å°†ç¨‹åºä¸­ç”Ÿæˆçš„é…ç½®ï¼Œæˆ–è€…æ‰€åšçš„ä¿®æ”¹ä¿å­˜ä¸‹æ¥ã€‚viper æä¾›äº†æ¥å£ï¼\nWriteConfigï¼šå°†å½“å‰çš„ viper é…ç½®å†™åˆ°é¢„å®šä¹‰è·¯å¾„ï¼Œå¦‚æœæ²¡æœ‰é¢„å®šä¹‰è·¯å¾„ï¼Œè¿”å›é”™è¯¯ã€‚å°†ä¼šè¦†ç›–å½“å‰é…ç½®ï¼› SafeWriteConfigï¼šä¸ä¸Šé¢åŠŸèƒ½ä¸€æ ·ï¼Œä½†æ˜¯å¦‚æœé…ç½®æ–‡ä»¶å­˜åœ¨ï¼Œåˆ™ä¸è¦†ç›–ï¼› WriteConfigAsï¼šä¿å­˜é…ç½®åˆ°æŒ‡å®šè·¯å¾„ï¼Œå¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œåˆ™è¦†ç›–ï¼› SafeWriteConfigï¼šä¸ä¸Šé¢åŠŸèƒ½ä¸€æ ·ï¼Œä½†æ˜¯å…¥è‚¡é…ç½®æ–‡ä»¶å­˜åœ¨ï¼Œåˆ™ä¸è¦†ç›–ã€‚ ä¸‹é¢æˆ‘ä»¬é€šè¿‡ç¨‹åºç”Ÿæˆä¸€ä¸ªconfig.tomlé…ç½®ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 package main import ( \u0026#34;log\u0026#34; \u0026#34;github.com/spf13/viper\u0026#34; ) func main() { viper.SetConfigName(\u0026#34;config\u0026#34;) viper.SetConfigType(\u0026#34;toml\u0026#34;) viper.AddConfigPath(\u0026#34;.\u0026#34;) viper.Set(\u0026#34;app_name\u0026#34;, \u0026#34;awesome web\u0026#34;) viper.Set(\u0026#34;log_level\u0026#34;, \u0026#34;DEBUG\u0026#34;) viper.Set(\u0026#34;mysql.ip\u0026#34;, \u0026#34;127.0.0.1\u0026#34;) viper.Set(\u0026#34;mysql.port\u0026#34;, 3306) viper.Set(\u0026#34;mysql.user\u0026#34;, \u0026#34;root\u0026#34;) viper.Set(\u0026#34;mysql.password\u0026#34;, \u0026#34;123456\u0026#34;) viper.Set(\u0026#34;mysql.database\u0026#34;, \u0026#34;awesome\u0026#34;) viper.Set(\u0026#34;redis.ip\u0026#34;, \u0026#34;127.0.0.1\u0026#34;) viper.Set(\u0026#34;redis.port\u0026#34;, 6381) err := viper.SafeWriteConfig() if err != nil { log.Fatal(\u0026#34;write config failed: \u0026#34;, err) } } # å¤šå®ä¾‹å¯¹è±¡ ç”±äºå¤§å¤šæ•°åº”ç”¨ç¨‹åºéƒ½å¸Œæœ›ä½¿ç”¨å•ä¸ªé…ç½®å®ä¾‹å¯¹è±¡æ¥ç®¡ç†é…ç½®ï¼Œå› æ­¤ viper åŒ…é»˜è®¤æä¾›äº†è¿™ä¸€åŠŸèƒ½ï¼Œå®ƒç±»ä¼¼äºä¸€ä¸ªå•ä¾‹ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ Viper æ—¶ä¸éœ€è¦é…ç½®æˆ–åˆå§‹åŒ–ï¼ŒViper å®ç°äº†å¼€ç®±å³ç”¨çš„æ•ˆæœã€‚\nåœ¨ä¸Šé¢çš„æ‰€æœ‰ç¤ºä¾‹ä¸­ï¼Œæ¼”ç¤ºäº†å¦‚ä½•ä»¥å•ä¾‹æ–¹å¼ä½¿ç”¨ Viperã€‚æˆ‘ä»¬è¿˜å¯ä»¥åˆ›å»ºå¤šä¸ªä¸åŒçš„ Viper å®ä¾‹ä»¥ä¾›åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ï¼Œæ¯ä¸ªå®ä¾‹éƒ½æœ‰è‡ªå·±å•ç‹¬çš„ä¸€ç»„é…ç½®å’Œå€¼ï¼Œå¹¶ä¸”å®ƒä»¬å¯ä»¥ä»ä¸åŒçš„é…ç½®æ–‡ä»¶ã€key/value å­˜å‚¨ç­‰ä½ç½®è¯»å–é…ç½®ä¿¡æ¯ã€‚\nViper åŒ…æ”¯æŒçš„æ‰€æœ‰åŠŸèƒ½éƒ½è¢«é•œåƒä¸º viper å¯¹è±¡ä¸Šçš„æ–¹æ³•ï¼Œè¿™ç§è®¾è®¡æ€è·¯åœ¨ Go è¯­è¨€ä¸­éå¸¸å¸¸è§ï¼Œå¦‚æ ‡å‡†åº“ä¸­çš„ log åŒ…ã€‚\nå¤šå®ä¾‹ä½¿ç”¨ç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/spf13/viper\u0026#34; ) func main() { x := viper.New() y := viper.New() x.SetConfigFile(\u0026#34;./config.yaml\u0026#34;) _ = x.ReadInConfig() fmt.Printf(\u0026#34;x.username: %v\\n\u0026#34;, x.Get(\u0026#34;username\u0026#34;)) y.SetDefault(\u0026#34;username\u0026#34;, \u0026#34;å¤šå®ä¾‹å¯¹è±¡\u0026#34;) fmt.Printf(\u0026#34;y.username: %v\\n\u0026#34;, y.Get(\u0026#34;username\u0026#34;)) viper.SetDefault(\u0026#34;username\u0026#34;, \u0026#34;é»˜è®¤å•å®ä¾‹å¯¹è±¡\u0026#34;) fmt.Printf(\u0026#34;viper.username: %v\\n\u0026#34;, viper.Get(\u0026#34;username\u0026#34;)) } åœ¨è¿™é‡Œï¼Œæˆ‘åˆ›å»ºäº†ä¸¤ä¸ª Viper å®ä¾‹ x å’Œ yï¼Œå®ƒä»¬åˆ†åˆ«ä»é…ç½®æ–‡ä»¶è¯»å–é…ç½®å’Œé€šè¿‡é»˜è®¤å€¼çš„æ–¹å¼è®¾ç½®é…ç½®ï¼Œä½¿ç”¨æ—¶äº’ä¸å½±å“ï¼Œä½¿ç”¨è€…å¯ä»¥è‡ªè¡Œç®¡ç†å®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸã€‚\næ‰§è¡Œä»¥ä¸Šç¤ºä¾‹ä»£ç å¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š\n1 2 3 4 $ go run main.go x.username: arlettebrook y.username: å¤šå®ä¾‹å¯¹è±¡ viper.username: é»˜è®¤å•å®ä¾‹å¯¹è±¡ # ä½¿ç”¨å»ºè®® Viper æä¾›äº†ä¼—å¤šæ–¹æ³•å¯ä»¥ç®¡ç†é…ç½®ï¼Œåœ¨å®é™…é¡¹ç›®å¼€å‘ä¸­æˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œä½¿ç”¨ã€‚å¦‚æœæ˜¯å°å‹é¡¹ç›®ï¼Œæ¨èç›´æ¥ä½¿ç”¨ viper å®ä¾‹ç®¡ç†é…ç½®ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/spf13/viper\u0026#34; ) func main() { viper.SetConfigFile(\u0026#34;./config.yaml\u0026#34;) if err := viper.ReadInConfig(); err != nil { panic(fmt.Errorf(\u0026#34;read config file error: %s \\n\u0026#34;, err.Error())) } // ç›‘æ§é…ç½®æ–‡ä»¶å˜åŒ– viper.WatchConfig() // use config... fmt.Println(viper.Get(\u0026#34;username\u0026#34;)) } å¦‚æœæ˜¯ä¸­å¤§å‹é¡¹ç›®ï¼Œä¸€èˆ¬éƒ½ä¼šæœ‰ä¸€ä¸ªç”¨æ¥è®°å½•é…ç½®çš„ç»“æ„ä½“ï¼Œå¯ä»¥ä½¿ç”¨ Viper å°†é…ç½®ååºåˆ—åŒ–åˆ°ç»“æ„ä½“ä¸­ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/fsnotify/fsnotify\u0026#34; \u0026#34;github.com/spf13/viper\u0026#34; ) type Config struct { Username string Password string // Viper æ”¯æŒåµŒå¥—ç»“æ„ä½“ Server struct { IP string Port int } } func main() { viper.SetConfigFile(\u0026#34;./config.yaml\u0026#34;) if err := viper.ReadInConfig(); err != nil { panic(fmt.Errorf(\u0026#34;read config file error: %s \\n\u0026#34;, err.Error())) } // å°†é…ç½®ä¿¡æ¯ååºåˆ—åŒ–åˆ°ç»“æ„ä½“ä¸­ var cfg Config if err := viper.Unmarshal(\u0026amp;cfg); err != nil { panic(fmt.Errorf(\u0026#34;unmarshal config error: %s \\n\u0026#34;, err.Error())) } // æ³¨å†Œæ¯æ¬¡é…ç½®æ–‡ä»¶å‘ç”Ÿå˜æ›´åéƒ½ä¼šè°ƒç”¨çš„å›è°ƒå‡½æ•° viper.OnConfigChange(func(e fsnotify.Event) { // æ¯æ¬¡é…ç½®æ–‡ä»¶å‘ç”Ÿå˜åŒ–ï¼Œéœ€è¦é‡æ–°å°†å…¶ååºåˆ—åŒ–åˆ°ç»“æ„ä½“ä¸­ if err := viper.Unmarshal(\u0026amp;cfg); err != nil { panic(fmt.Errorf(\u0026#34;unmarshal config error: %s \\n\u0026#34;, err.Error())) } }) // ç›‘æ§é…ç½®æ–‡ä»¶å˜åŒ– viper.WatchConfig() // use config... fmt.Println(cfg.Username) } éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç›´æ¥ä½¿ç”¨ viper å®ä¾‹ç®¡ç†é…ç½®çš„æƒ…å†µä¸‹ï¼Œå½“æˆ‘ä»¬é€šè¿‡ viper.WatchConfig() ç›‘å¬äº†é…ç½®æ–‡ä»¶å˜åŒ–ï¼Œå¦‚æœé…ç½®å˜åŒ–ï¼Œåˆ™å˜åŒ–ä¼šç«‹åˆ»ä½“ç°åœ¨ viper å®ä¾‹å¯¹è±¡ä¸Šï¼Œä¸‹æ¬¡é€šè¿‡ viper.Get() è·å–çš„é…ç½®å³ä¸ºæœ€æ–°é…ç½®ã€‚ä½†æ˜¯åœ¨ä½¿ç”¨ç»“æ„ä½“ç®¡ç†é…ç½®æ—¶ï¼Œviper å®ä¾‹å¯¹è±¡å˜åŒ–äº†ï¼Œè®°å½•é…ç½®çš„ç»“æ„ä½“ Config æ˜¯ä¸ä¼šè‡ªåŠ¨æ›´æ–°çš„ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ viper.OnConfigChange åœ¨å›è°ƒå‡½æ•°ä¸­é‡æ–°å°†å˜æ›´åçš„é…ç½®ååºåˆ—åŒ–åˆ° Config ä¸­ã€‚\n# æ€»ç»“ æœ¬æ–‡æ¢è®¨ Viper çš„å„ç§ç”¨æ³•å’Œä½¿ç”¨åœºæ™¯ï¼Œé¦–å…ˆè¯´æ˜äº†ä¸ºä»€ä¹ˆä½¿ç”¨ Viperï¼Œå®ƒçš„ä¼˜åŠ¿æ˜¯ä»€ä¹ˆã€‚\næ¥ç€è®²è§£äº† Viper åŒ…ä¸­æœ€æ ¸å¿ƒçš„ä¸¤ä¸ªåŠŸèƒ½ï¼šå¦‚ä½•æŠŠé…ç½®å€¼è¯»å…¥ Viper å’Œä» Viper ä¸­è¯»å–é…ç½®å€¼ã€‚Viper å¯¹ç€ä¸¤ä¸ªåŠŸèƒ½éƒ½æä¾›äº†éå¸¸å¤šçš„æ–¹æ³•æ¥æ”¯æŒã€‚\nç„¶ååˆä»‹ç»äº†å¦‚ä½•ç”¨ Viper æ¥ç®¡ç†å¤šä»½é…ç½®ï¼Œå³ä½¿ç”¨å¤šå®ä¾‹ã€‚\nå¯¹äº Viper çš„ä½¿ç”¨æˆ‘ä¹Ÿç»™å‡ºäº†è‡ªå·±çš„å»ºè®®ï¼Œé’ˆå¯¹å°å‹é¡¹ç›®ï¼Œæ¨èç›´æ¥ä½¿ç”¨ viper å®ä¾‹ç®¡ç†é…ç½®ï¼Œå¦‚æœæ˜¯ä¸­å¤§å‹é¡¹ç›®ï¼Œåˆ™æ¨èä½¿ç”¨ç»“æ„ä½“æ¥ç®¡ç†é…ç½®ã€‚\næœ€åï¼ŒViper æ­£åœ¨å‘ç€ v2 ç‰ˆæœ¬è¿ˆè¿›ï¼Œæ¬¢è¿è¯»è€…åœ¨è¿™é‡Œåˆ†äº«æƒ³æ³•ï¼Œä¹ŸæœŸå¾…ä¸‹æ¬¡æ¥å†™ä¸€ç¯‡ v2 ç‰ˆæœ¬çš„æ–‡ç« ä¸è¯»è€…ä¸€èµ·å­¦ä¹ è¿›æ­¥ã€‚\n# å‚è€ƒ Viper æºç ä»“åº“ï¼š https://github.com/spf13/viper æ¬è¿ï¼šåœ¨ Go ä¸­å¦‚ä½•ä½¿ç”¨ Viper æ¥ç®¡ç†é…ç½® Go æ¯æ—¥ä¸€åº“ä¹‹ viper ","date":"2024-05-03T18:24:28+08:00","permalink":"https://arlettebrook.github.io/p/go%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86%E4%B9%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93viper/","title":"Goé…ç½®ç®¡ç†ä¹‹ç¬¬ä¸‰æ–¹åº“viper"},{"content":" # ä»‹ç» Cobraæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œç¨‹åºåº“ï¼Œå¯ä»¥ç”¨æ¥ç¼–å†™å‘½ä»¤è¡Œç¨‹åºã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿæä¾›äº†ä¸€ä¸ªè„šæ‰‹æ¶ï¼Œ ç”¨äºç”ŸæˆåŸºäº cobra çš„åº”ç”¨ç¨‹åºæ¡†æ¶ã€‚éå¸¸å¤šçŸ¥åçš„å¼€æºé¡¹ç›®ä½¿ç”¨äº† cobra åº“æ„å»ºå‘½ä»¤è¡Œï¼Œå¦‚Kubernetesã€Hugoã€etcdç­‰ç­‰ç­‰ç­‰ã€‚ æœ¬æ–‡ä»‹ç» cobra åº“çš„åŸºæœ¬ä½¿ç”¨å’Œä¸€äº›æœ‰è¶£çš„ç‰¹æ€§ã€‚\nå…³äºä½œè€…spf13ï¼Œè¿™é‡Œå¤šè¯´ä¸¤å¥ã€‚spf13 å¼€æºä¸å°‘é¡¹ç›®ï¼Œè€Œä¸”ä»–çš„å¼€æºé¡¹ç›®è´¨é‡éƒ½æ¯”è¾ƒé«˜ã€‚ ç›¸ä¿¡ä½¿ç”¨è¿‡ vim çš„éƒ½çŸ¥é“spf13-vimï¼Œå·ç§° vim ç»ˆæé…ç½®ã€‚ å¯ä»¥ä¸€é”®é…ç½®ï¼Œå¯¹äºæˆ‘è¿™æ ·çš„æ‡’äººæ¥è¯´ç»å¯¹æ˜¯ç¦éŸ³ã€‚ä»–çš„viperæ˜¯ä¸€ä¸ªå®Œæ•´çš„é…ç½®è§£å†³æ–¹æ¡ˆã€‚ å®Œç¾æ”¯æŒ JSON/TOML/YAML/HCL/envfile/Java properties é…ç½®æ–‡ä»¶ç­‰æ ¼å¼ï¼Œè¿˜æœ‰ä¸€äº›æ¯”è¾ƒå®ç”¨çš„ç‰¹æ€§ï¼Œå¦‚é…ç½®çƒ­æ›´æ–°ã€å¤šæŸ¥æ‰¾ç›®å½•ã€é…ç½®ä¿å­˜ç­‰ã€‚ è¿˜æœ‰éå¸¸ç«çš„é™æ€ç½‘ç«™ç”Ÿæˆå™¨hugoä¹Ÿæ˜¯ä»–çš„ä½œå“ã€‚\nCobra æ˜¯ä¸€ä¸ª Go è¯­è¨€å¼€å‘çš„å‘½ä»¤è¡Œï¼ˆCLIï¼‰æ¡†æ¶ï¼Œå®ƒæä¾›äº†ç®€æ´ã€çµæ´»ä¸”å¼ºå¤§çš„æ–¹å¼æ¥åˆ›å»ºå‘½ä»¤è¡Œç¨‹åºã€‚å®ƒåŒ…å«ä¸€ä¸ªç”¨äºåˆ›å»ºå‘½ä»¤è¡Œç¨‹åºçš„åº“ï¼ˆCobra åº“ï¼‰ï¼Œä»¥åŠä¸€ä¸ªç”¨äºå¿«é€Ÿç”ŸæˆåŸºäº Cobra åº“çš„å‘½ä»¤è¡Œç¨‹åºå·¥å…·ï¼ˆCobra å‘½ä»¤ï¼‰ã€‚Cobra æ˜¯ç”± Go å›¢é˜Ÿæˆå‘˜ spf13 ä¸º Hugo é¡¹ç›®åˆ›å»ºçš„ï¼Œå¹¶å·²è¢«è®¸å¤šæµè¡Œçš„ Go é¡¹ç›®æ‰€é‡‡ç”¨ï¼Œå¦‚ Kubernetesã€Helmã€Docker (distribution)ã€Etcd ç­‰ã€‚\n# æ¦‚å¿µ Cobra å»ºç«‹åœ¨å‘½ä»¤ã€å‚æ•°å’Œæ ‡å¿—è¿™ä¸‰ä¸ªç»“æ„ä¹‹ä¸Šã€‚è¦ä½¿ç”¨ Cobra ç¼–å†™ä¸€ä¸ªå‘½ä»¤è¡Œç¨‹åºï¼Œéœ€è¦æ˜ç¡®è¿™ä¸‰ä¸ªæ¦‚å¿µã€‚\nå‘½ä»¤ï¼ˆCOMMANDï¼‰ï¼šå‘½ä»¤è¡¨ç¤ºè¦æ‰§è¡Œçš„æ“ä½œã€‚ å‚æ•°ï¼ˆARGï¼‰ï¼šæ˜¯å‘½ä»¤çš„å‚æ•°ï¼Œä¸€èˆ¬ç”¨æ¥è¡¨ç¤ºæ“ä½œçš„å¯¹è±¡ã€‚ æ ‡å¿—ï¼ˆFLAGï¼‰ï¼šæ˜¯å‘½ä»¤çš„ä¿®é¥°ï¼Œå¯ä»¥è°ƒæ•´æ“ä½œçš„è¡Œä¸ºã€‚ ä¸€ä¸ªå¥½çš„å‘½ä»¤è¡Œç¨‹åºåœ¨ä½¿ç”¨æ—¶è¯»èµ·æ¥åƒå¥å­ï¼Œç”¨æˆ·ä¼šè‡ªç„¶çš„ç†è§£å¹¶çŸ¥é“å¦‚ä½•ä½¿ç”¨è¯¥ç¨‹åºã€‚\nè¦ç¼–å†™ä¸€ä¸ªå¥½çš„å‘½ä»¤è¡Œç¨‹åºï¼Œéœ€è¦éµå¾ªçš„æ¨¡å¼æ˜¯ APPNAME VERB NOUN --ADJECTIVE æˆ– APPNAME COMMAND ARG --FLAGã€‚\nåœ¨è¿™é‡Œ VERB ä»£è¡¨åŠ¨è¯ï¼ŒNOUN ä»£è¡¨åè¯ï¼ŒADJECTIVE ä»£è¡¨å½¢å®¹è¯ã€‚\nä»¥ä¸‹æ˜¯ä¸€ä¸ªç°å®ä¸–ç•Œä¸­å¥½çš„å‘½ä»¤è¡Œç¨‹åºçš„ä¾‹å­ï¼š\n1 $ hugo server --port=1313 ä»¥ä¸Šç¤ºä¾‹ä¸­ï¼Œserver æ˜¯ä¸€ä¸ªå‘½ä»¤ï¼ˆå­å‘½ä»¤ï¼‰ï¼Œport æ˜¯ä¸€ä¸ªæ ‡å¿—ï¼ˆ1313 æ˜¯æ ‡å¿—çš„å‚æ•°ï¼Œä½†ä¸æ˜¯å‘½ä»¤çš„å‚æ•° ARGï¼‰ã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ª git å‘½ä»¤çš„ä¾‹å­ï¼š\n1 $ git clone URL --bare ä»¥ä¸Šç¤ºä¾‹ä¸­ï¼Œclone æ˜¯ä¸€ä¸ªå‘½ä»¤ï¼ˆå­å‘½ä»¤ï¼‰ï¼ŒURL æ˜¯å‘½ä»¤çš„å‚æ•°ï¼Œbare æ˜¯æ ‡å¿—ã€‚\n# ç‰¹æ€§ cobra æä¾›éå¸¸ä¸°å¯Œçš„åŠŸèƒ½ï¼š\nè½»æ¾æ”¯æŒå­å‘½ä»¤ï¼Œå¦‚app serverï¼Œapp fetchç­‰ï¼› å®Œå…¨å…¼å®¹ POSIX é€‰é¡¹ï¼ˆåŒ…æ‹¬çŸ­ã€é•¿é€‰é¡¹ï¼‰ï¼› åµŒå¥—å­å‘½ä»¤ï¼› å…¨å±€ã€æœ¬åœ°å±‚çº§é€‰é¡¹ã€‚å¯ä»¥åœ¨å¤šå¤„è®¾ç½®é€‰é¡¹ï¼ŒæŒ‰ç…§ä¸€å®šçš„é¡ºåºå–ç”¨ï¼› ä½¿ç”¨è„šæ‰‹æ¶è½»æ¾ç”Ÿæˆç¨‹åºæ¡†æ¶å’Œå‘½ä»¤ã€‚ ç­‰ã€‚ # å¿«é€Ÿä½¿ç”¨ è¦ä½¿ç”¨ Cobra åˆ›å»ºå‘½ä»¤è¡Œç¨‹åºï¼Œéœ€è¦å…ˆé€šè¿‡å¦‚ä¸‹å‘½ä»¤è¿›è¡Œä¸‹è½½å¹¶æ·»åŠ åˆ°é¡¹ç›®ï¼š\n1 go get -u github.com/spf13/cobra@latest å®‰è£…å¥½åï¼Œå°±å¯ä»¥åƒå…¶ä»– Go è¯­è¨€åº“ä¸€æ ·å¯¼å…¥ Cobra åŒ…å¹¶ä½¿ç”¨äº†ã€‚\n1 import \u0026#34;github.com/spf13/cobra\u0026#34; # åˆ›å»ºä¸€ä¸ªå‘½ä»¤ å‡è®¾æˆ‘ä»¬è¦åˆ›å»ºçš„å‘½ä»¤è¡Œç¨‹åºå«ä½œ hugoï¼Œå¯ä»¥ç¼–å†™å¦‚ä¸‹ä»£ç åˆ›å»ºä¸€ä¸ªå‘½ä»¤ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 // hugo/cmd/root.go var rootCmd = \u0026amp;cobra.Command{ Use: \u0026#34;hugo\u0026#34;, Short: \u0026#34;Hugo is a very fast static site generator\u0026#34;, Long: `A Fast and Flexible Static Site Generator built with love by spf13 and friends in Go. Complete documentation is available at https://gohugo.io`, Run: func(cmd *cobra.Command, args []string) { fmt.Println(\u0026#34;run hugo...\u0026#34;) }, } func Execute() { if err := rootCmd.Execute(); err != nil { fmt.Println(err) os.Exit(1) } } cobra.Command æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œä»£è¡¨ä¸€ä¸ªå‘½ä»¤ï¼Œå…¶å„ä¸ªå±æ€§å«ä¹‰å¦‚ä¸‹ï¼š\nUse æ˜¯å‘½ä»¤çš„åç§°ã€‚æŒ‡å®šä½¿ç”¨ä¿¡æ¯ï¼Œå³å‘½ä»¤æ€ä¹ˆè¢«è°ƒç”¨ï¼Œæ ¼å¼ä¸ºname arg1 [arg2]ã€‚nameä¸ºå‘½ä»¤åï¼Œåé¢çš„arg1ä¸ºå¿…å¡«å‚æ•°ï¼Œarg3ä¸ºå¯é€‰å‚æ•°ï¼Œå‚æ•°å¯ä»¥å¤šä¸ªã€‚å‚æ•°ä¸€èˆ¬ç”¨åœ¨å­å‘½ä»¤ä¸Šã€‚\nShort ä»£è¡¨å½“å‰å‘½ä»¤çš„ç®€çŸ­æè¿°ã€‚\nLong è¡¨ç¤ºå½“å‰å‘½ä»¤çš„å®Œæ•´æè¿°ã€‚\nRun å±æ€§æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå½“æ‰§è¡Œå‘½ä»¤æ—¶ä¼šè°ƒç”¨æ­¤å‡½æ•°ã€‚\nrootCmd.Execute() æ˜¯å‘½ä»¤çš„æ‰§è¡Œå…¥å£ï¼Œå…¶å†…éƒ¨ä¼šè§£æ os.Args[1:] å‚æ•°åˆ—è¡¨ï¼ˆé»˜è®¤æƒ…å†µä¸‹æ˜¯è¿™æ ·ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ Command.SetArgs æ–¹æ³•è®¾ç½®å‚æ•°ï¼‰ï¼Œç„¶åéå†å‘½ä»¤æ ‘ï¼Œä¸ºå‘½ä»¤æ‰¾åˆ°åˆé€‚çš„åŒ¹é…é¡¹å’Œå¯¹åº”çš„æ ‡å¿—ã€‚\n# åˆ›å»º main.go æŒ‰ç…§ç¼–å†™ Go ç¨‹åºçš„æƒ¯ä¾‹ï¼Œæˆ‘ä»¬è¦ä¸º hugo ç¨‹åºç¼–å†™ä¸€ä¸ª main.go æ–‡ä»¶ï¼Œä½œä¸ºç¨‹åºçš„å¯åŠ¨å…¥å£ã€‚\n1 2 3 4 5 6 7 8 9 10 // hugo/main.go package main import ( \u0026#34;hugo/cmd\u0026#34; ) func main() { cmd.Execute() } main.go ä»£ç å®ç°éå¸¸ç®€å•ï¼Œåªåœ¨ main å‡½æ•°ä¸­è°ƒç”¨äº† cmd.Execute() å‡½æ•°ï¼Œæ¥æ‰§è¡Œå‘½ä»¤ã€‚\n# ç¼–è¯‘å¹¶è¿è¡Œå‘½ä»¤ ç°åœ¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç¼–è¯‘å¹¶è¿è¡Œè¿™ä¸ªå‘½ä»¤è¡Œç¨‹åºäº†ã€‚\n1 2 3 4 5 # ç¼–è¯‘ $ go build -o hugo # æ‰§è¡Œ $ ./hugo run hugo... ç¬”è®°ï¼šç¤ºä¾‹ä»£ç é‡Œæ²¡æœ‰æ‰“å° Run å‡½æ•°çš„ args å‚æ•°å†…å®¹ï¼Œä½ å¯ä»¥è‡ªè¡Œæ‰“å°çœ‹çœ‹ç»“æœï¼ˆæç¤ºï¼šargs ä¸ºå‘½ä»¤è¡Œå‚æ•°åˆ—è¡¨ï¼‰ã€‚\nä»¥ä¸Šæˆ‘ä»¬ç¼–è¯‘å¹¶æ‰§è¡Œäº† hugo ç¨‹åºï¼Œè¾“å‡ºå†…å®¹æ­£æ˜¯ cobra.Command ç»“æ„ä½“ä¸­ Run å‡½æ•°å†…éƒ¨ä»£ç çš„æ‰§è¡Œç»“æœã€‚\næˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ --help æŸ¥çœ‹è¿™ä¸ªå‘½ä»¤è¡Œç¨‹åºçš„ä½¿ç”¨å¸®åŠ©ã€‚\n1 2 3 4 5 6 7 8 9 10 $ ./hugo --help A Fast and Flexible Static Site Generator built with love by spf13 and friends in Go. Complete documentation is available at https://gohugo.io Usage: hugo [flags] Flags: -h, --help help for hugo è¿™é‡Œæ‰“å°äº† cobra.Command ç»“æ„ä½“ä¸­ Long å±æ€§çš„å†…å®¹ï¼Œå¦‚æœ Long å±æ€§ä¸å­˜åœ¨ï¼Œåˆ™æ‰“å° Short å±æ€§å†…å®¹ã€‚\nhugo å‘½ä»¤ç”¨æ³•ä¸º hugo [flags]ï¼Œå¦‚ hugo --helpã€‚\nè¿™ä¸ªå‘½ä»¤è¡Œç¨‹åºè‡ªåŠ¨æ”¯æŒäº† -h/--help æ ‡å¿—ã€‚\nä»¥ä¸Šå°±æ˜¯ä½¿ç”¨ Cobra ç¼–å†™ä¸€ä¸ªå‘½ä»¤è¡Œç¨‹åºæœ€å¸¸è§çš„å¥—è·¯ï¼Œè¿™ä¹Ÿæ˜¯ Cobra æ¨èå†™æ³•ã€‚\nå½“å‰é¡¹ç›®ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 $ tree hugo hugo â”œâ”€â”€ cmd â”‚ â””â”€â”€ root.go â”œâ”€â”€ go.mod â”œâ”€â”€ go.sum â””â”€â”€ main.go Cobra ç¨‹åºç›®å½•ç»“æ„åŸºæœ¬å¦‚æ­¤ï¼Œmain.go ä½œä¸ºå‘½ä»¤è¡Œç¨‹åºçš„å…¥å£ï¼Œä¸è¦å†™è¿‡å¤šçš„ä¸šåŠ¡é€»è¾‘ï¼Œæ‰€æœ‰å‘½ä»¤éƒ½åº”è¯¥æ”¾åœ¨ cmd/ ç›®å½•ä¸‹ï¼Œä»¥åä¸ç®¡ç¼–å†™å¤šä¹ˆå¤æ‚çš„å‘½ä»¤è¡Œç¨‹åºéƒ½å¯ä»¥è¿™ä¹ˆæ¥è®¾è®¡ã€‚\nåœ¨ cobra ä¸­ï¼Œå‘½ä»¤å’Œå­å‘½ä»¤éƒ½æ˜¯ç”¨Commandç»“æ„è¡¨ç¤ºçš„ã€‚Commandæœ‰éå¸¸å¤šçš„å­—æ®µï¼Œç”¨æ¥å®šåˆ¶å‘½ä»¤çš„è¡Œä¸ºã€‚ åœ¨å®é™…ä¸­ï¼Œæœ€å¸¸ç”¨çš„å°±é‚£ä¹ˆå‡ ä¸ªã€‚æˆ‘ä»¬åœ¨å‰é¢ç¤ºä¾‹ä¸­å·²ç»çœ‹åˆ°äº†Use/Short/Long/Runã€‚\nUseæŒ‡å®šä½¿ç”¨ä¿¡æ¯ï¼Œå³å‘½ä»¤æ€ä¹ˆè¢«è°ƒç”¨ï¼Œæ ¼å¼ä¸ºname arg1 [arg2]ã€‚nameä¸ºå‘½ä»¤åï¼Œåé¢çš„arg1ä¸ºå¿…å¡«å‚æ•°ï¼Œarg3ä¸ºå¯é€‰å‚æ•°ï¼Œå‚æ•°å¯ä»¥å¤šä¸ªã€‚\nShort/Longéƒ½æ˜¯æŒ‡å®šå‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯ï¼Œåªæ˜¯å‰è€…ç®€çŸ­ï¼Œåè€…è¯¦å°½è€Œå·²ã€‚\nRunæ˜¯å®é™…æ‰§è¡Œæ“ä½œçš„å‡½æ•°ã€‚\nå®šä¹‰æ–°çš„å­å‘½ä»¤å¾ˆç®€å•ï¼Œå°±æ˜¯åˆ›å»ºä¸€ä¸ªcobra.Commandå˜é‡ï¼Œè®¾ç½®ä¸€äº›å­—æ®µï¼Œç„¶åæ·»åŠ åˆ°æ ¹å‘½ä»¤ä¸­\n# æ·»åŠ å­å‘½ä»¤ ä¸å®šä¹‰ rootCmd ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ cobra.Command å®šä¹‰å…¶ä»–å‘½ä»¤ï¼Œå¹¶é€šè¿‡ rootCmd.AddCommand() æ–¹æ³•å°†å…¶æ·»åŠ ä¸º rootCmd çš„ä¸€ä¸ªå­å‘½ä»¤ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 var versionCmd = \u0026amp;cobra.Command{ Use: \u0026#34;version\u0026#34;, Short: \u0026#34;Print the version number of Hugo\u0026#34;, Long: `All software has versions. This is Hugo\u0026#39;s`, Run: func(cmd *cobra.Command, args []string) { fmt.Println(\u0026#34;Hugo Static Site Generator v0.9 -- HEAD\u0026#34;) }, } func init() { rootCmd.AddCommand(versionCmd) } ç°åœ¨é‡æ–°ç¼–è¯‘å¹¶è¿è¡Œå‘½ä»¤è¡Œç¨‹åºã€‚\n1 2 3 $ go build -o hugo $ ./hugo version Hugo Static Site Generator v0.9 -- HEAD å¯ä»¥å‘ç° version å‘½ä»¤å·²ç»è¢«åŠ å…¥è¿›æ¥äº†ã€‚\nå†æ¬¡æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 $ ./hugo -h A Fast and Flexible Static Site Generator built with love by spf13 and friends in Go. Complete documentation is available at https://gohugo.io Usage: hugo [flags] hugo [command] Available Commands: completion Generate the autocompletion script for the specified shell help Help about any command version Print the version number of Hugo Flags: -h, --help help for hugo Use \u0026#34;hugo [command] --help\u0026#34; for more information about a command. è¿™æ¬¡çš„å¸®åŠ©ä¿¡æ¯æ›´ä¸ºä¸°å¯Œï¼Œé™¤äº†å¯ä»¥ä½¿ç”¨ hugo [flags] è¯­æ³•ï¼Œç”±äºå­å‘½ä»¤çš„åŠ å…¥ï¼Œåˆå¤šäº†ä¸€ä¸ª hugo [command] è¯­æ³•å¯ä»¥ä½¿ç”¨ï¼Œå¦‚ hugo versionã€‚\nç°åœ¨æœ‰ä¸‰ä¸ªå¯ç”¨å‘½ä»¤ï¼š\ncompletion å¯ä»¥ä¸ºæŒ‡å®šçš„ Shell ç”Ÿæˆè‡ªåŠ¨è¡¥å…¨è„šæœ¬ï¼Œå°†åœ¨ Shell è¡¥å…¨ å°èŠ‚è¿›è¡Œè®²è§£ã€‚\nhelp ç”¨æ¥æŸ¥çœ‹å¸®åŠ©ï¼ŒåŒ -h/--help ç±»ä¼¼ï¼Œå¯ä»¥ä½¿ç”¨ hugo help command è¯­æ³•æŸ¥çœ‹ command å‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯ã€‚\nversion ä¸ºæ–°æ·»åŠ çš„å­å‘½ä»¤ã€‚\næŸ¥çœ‹å­å‘½ä»¤å¸®åŠ©ä¿¡æ¯ï¼š\n1 2 3 4 5 6 7 8 $ ./hugo help version All software has versions. This is Hugo\u0026#39;s Usage: hugo version [flags] Flags: -h, --help help for version # ä½¿ç”¨å‘½ä»¤è¡Œæ ‡å¿— Cobra å®Œç¾é€‚é… pflagï¼Œç»“åˆ pflag å¯ä»¥æ›´çµæ´»çš„ä½¿ç”¨æ ‡å¿—åŠŸèƒ½ã€‚\næç¤ºï¼šå¯¹ pflag ä¸ç†Ÿæ‚‰çš„è¯»è€…å¯ä»¥å‚è€ƒæˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« ã€ŠGoè§£æå‘½ä»¤è¡Œå‚æ•°ä¹‹ç¬¬ä¸‰æ–¹åº“pflagã€‹ã€‚\n# æŒä¹…æ ‡å¿— å¦‚æœä¸€ä¸ªæ ‡å¿—æ˜¯æŒä¹…çš„ï¼Œåˆ™æ„å‘³ç€è¯¥æ ‡å¿—å°†å¯ç”¨äºå®ƒæ‰€åˆ†é…çš„å‘½ä»¤ä»¥åŠè¯¥å‘½ä»¤ä¸‹çš„æ‰€æœ‰å­å‘½ä»¤ã€‚\nå¯¹äºå…¨å±€æ ‡å¿—ï¼Œå¯ä»¥å®šä¹‰åœ¨æ ¹å‘½ä»¤ rootCmd ä¸Šã€‚\n1 2 3 4 5 // hugo/cmd/root.go func init() { var Verbose bool rootCmd.PersistentFlags().BoolVarP(\u0026amp;Verbose, \u0026#34;verbose\u0026#34;, \u0026#34;v\u0026#34;, false, \u0026#34;Verbose output\u0026#34;) } # æœ¬åœ°æ ‡å¿— æ ‡å¿—ä¹Ÿå¯ä»¥æ˜¯æœ¬åœ°çš„ï¼Œè¿™æ„å‘³ç€å®ƒåªé€‚ç”¨äºè¯¥æŒ‡å®šå‘½ä»¤ã€‚\n1 2 3 4 5 // hugo/cmd/root.go func init() { var Source string rootCmd.Flags().StringVarP(\u0026amp;Source, \u0026#34;source\u0026#34;, \u0026#34;s\u0026#34;, \u0026#34;\u0026#34;, \u0026#34;Source directory to read from\u0026#34;) } # çˆ¶å‘½ä»¤çš„æœ¬åœ°æ ‡å¿— é»˜è®¤æƒ…å†µä¸‹ï¼ŒCobra ä»…è§£æç›®æ ‡å‘½ä»¤ä¸Šçš„æœ¬åœ°æ ‡å¿—ï¼Œå¿½ç•¥çˆ¶å‘½ä»¤ä¸Šçš„æœ¬åœ°æ ‡å¿—ã€‚é€šè¿‡åœ¨çˆ¶å‘½ä»¤ä¸Šå¯ç”¨ Command.TraverseChildren å±æ€§ï¼ŒCobra å°†åœ¨æ‰§è¡Œç›®æ ‡å‘½ä»¤ä¹‹å‰è§£ææ¯ä¸ªå‘½ä»¤çš„æœ¬åœ°æ ‡å¿—ã€‚(åœ¨æ‰§è¡Œå­å‘½ä»¤ä¹‹å‰è§£ææ‰€æœ‰çˆ¶çº§ä¸Šçš„æ ‡å¿—ã€‚)\n1 2 3 4 var rootCmd = \u0026amp;cobra.Command{ Use: \u0026#34;hugo\u0026#34;, TraverseChildren: true, } æç¤ºï¼šå¦‚æœä½ ä¸ç†è§£ï¼Œæ²¡å…³ç³»ï¼Œç»§ç»­å¾€ä¸‹çœ‹ï¼Œç¨åä¼šæœ‰ç¤ºä¾‹ä»£ç æ¼”ç¤ºè®²è§£ã€‚\n# å¿…é€‰æ ‡å¿— é»˜è®¤æƒ…å†µä¸‹ï¼Œæ ‡å¿—æ˜¯å¯é€‰çš„ã€‚æˆ‘ä»¬å¯ä»¥å°†å…¶æ ‡è®°ä¸ºå¿…é€‰ï¼Œå¦‚æœè¿è¡Œç›®æ ‡å‘½ä»¤æ—¶æ²¡æœ‰æä¾›ï¼Œåˆ™ä¼šæŠ¥é”™ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 var Verbose bool var Source string var Region string // hugo/cmd/root.go func init() { rootCmd.PersistentFlags().BoolVarP(\u0026amp;Verbose, \u0026#34;verbose\u0026#34;, \u0026#34;v\u0026#34;, false, \u0026#34;Verbose output\u0026#34;) rootCmd.Flags().StringVarP(\u0026amp;Source, \u0026#34;source\u0026#34;, \u0026#34;s\u0026#34;, \u0026#34;\u0026#34;, \u0026#34;Source directory to read from\u0026#34;) rootCmd.Flags().StringVarP(\u0026amp;Region, \u0026#34;region\u0026#34;, \u0026#34;r\u0026#34;, \u0026#34;\u0026#34;, \u0026#34;AWS region (required)\u0026#34;) _ = rootCmd.MarkFlagRequired(\u0026#34;region\u0026#34;) } å®šä¹‰å¥½ä»¥ä¸Šå‡ ä¸ªæ ‡å¿—åï¼Œä¸ºäº†å±•ç¤ºæ•ˆæœï¼Œæˆ‘ä»¬å¯¹ rootCmd.Run æ–¹æ³•åšäº›ä¿®æ”¹ï¼Œåˆ†åˆ«æ‰“å° Verboseã€Sourceã€Region å‡ ä¸ªå˜é‡ã€‚\n1 2 3 4 5 6 7 8 9 var rootCmd = \u0026amp;cobra.Command{ Use: \u0026#34;hugo\u0026#34;, Run: func(cmd *cobra.Command, args []string) { fmt.Println(\u0026#34;run hugo...\u0026#34;) fmt.Printf(\u0026#34;Verbose: %v\\n\u0026#34;, Verbose) fmt.Printf(\u0026#34;Source: %v\\n\u0026#34;, Source) fmt.Printf(\u0026#34;Region: %v\\n\u0026#34;, Region) }, } å¦å¤–ï¼Œä¸ºäº†æµ‹è¯•å¯ç”¨ Command.TraverseChildren çš„æ•ˆæœï¼Œæˆ‘åˆæ·»åŠ äº†ä¸€ä¸ª print å­å‘½ä»¤ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 var printCmd = \u0026amp;cobra.Command{ Use: \u0026#34;print [OPTIONS] [COMMANDS]\u0026#34;, Run: func(cmd *cobra.Command, args []string) { fmt.Println(\u0026#34;run print...\u0026#34;) fmt.Printf(\u0026#34;printFlag: %v\\n\u0026#34;, printFlag) fmt.Printf(\u0026#34;Source: %v\\n\u0026#34;, Source) }, } var printFlag string func init() { // æœ¬åœ°æ ‡å¿— printCmd.Flags().StringVarP(\u0026amp;printFlag, \u0026#34;flag\u0026#34;, \u0026#34;f\u0026#34;, \u0026#34;\u0026#34;, \u0026#34;print flag for local\u0026#34;) rootCmd.AddCommand(printCmd) } ç°åœ¨ï¼Œæˆ‘ä»¬é‡æ–°ç¼–è¯‘å¹¶è¿è¡Œ hugoï¼Œæ¥å¯¹ä¸Šé¢æ·»åŠ çš„è¿™å‡ ä¸ªæ ‡å¿—è¿›è¡Œæµ‹è¯•ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 $ go build -o hugo $ ./hugo -h A Fast and Flexible Static Site Generator built with love by spf13 and friends in Go. Complete documentation is available at https://gohugo.io Usage: hugo [flags] hugo [command] Available Commands: completion Generate the autocompletion script for the specified shell help Help about any command print version Print the version number of Hugo Flags: -h, --help help for hugo -r, --region string AWS region (required) -s, --source string Source directory to read from -v, --verbose verbose output Use \u0026#34;hugo [command] --help\u0026#34; for more information about a command. ä»¥ä¸Šå¸®åŠ©ä¿¡æ¯æ¸…æ™°æ˜äº†ï¼Œæˆ‘å°±ä¸è¿‡å¤šè§£é‡Šäº†ã€‚\næ‰§è¡Œ hugo å‘½ä»¤ï¼š\n1 2 3 4 5 $ ./hugo -r test-region run hugo... Verbose: false Source: Region: test-region ç°åœ¨ -r/--region ä¸ºå¿…é€‰æ ‡å¿—ï¼Œä¸ä¼ å°†ä¼šå¾—åˆ° Error: required flag(s) \u0026quot;region\u0026quot; not set æŠ¥é”™ã€‚\næ‰§è¡Œ print å­å‘½ä»¤ï¼š\n1 2 3 4 $ ./hugo print -f test-flag run print... printFlag: test-flag Source: ä»¥ä¸Šæ‰§è¡Œç»“æœå¯ä»¥å‘ç°ï¼Œçˆ¶å‘½ä»¤çš„æ ‡å¿— Source å†…å®¹ä¸ºç©ºã€‚\nç°åœ¨ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ‰§è¡Œ print å­å‘½ä»¤ï¼š\n1 2 3 4 $ ./hugo -s test-source print -f test-flag run print... printFlag: test-flag Source: test-source åœ¨ print å­å‘½ä»¤å‰ï¼Œæˆ‘ä»¬æŒ‡å®šäº† -s test-source æ ‡å¿—ï¼Œ-s/--source æ˜¯çˆ¶å‘½ä»¤ hugo çš„æ ‡å¿—ï¼Œä¹Ÿèƒ½å¤Ÿè¢«æ­£ç¡®è§£æï¼Œè¿™å°±æ˜¯å¯ç”¨ Command.TraverseChildren çš„æ•ˆæœã€‚\nå¦‚æœæˆ‘ä»¬å°† rootCmd çš„ TraverseChildren å±æ€§ç½®ä¸º falseï¼Œåˆ™ä¼šå¾—åˆ° Error: unknown shorthand flag: 's' in -s æŠ¥é”™ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # æŒ‡å®š rootCmd.TraverseChildren = false åï¼Œé‡æ–°ç¼–è¯‘ç¨‹åº $ go build -o hugo # æ‰§è¡ŒåŒæ ·çš„å‘½ä»¤ï¼Œç°åœ¨ä¼šå¾—åˆ°æŠ¥é”™ $ ./hugo -s test-source print -f test-flag Error: unknown shorthand flag: \u0026#39;s\u0026#39; in -s Usage: hugo print [OPTIONS] [COMMANDS] [flags] Flags: -f, --flag string print flag for local -h, --help help for print Global Flags: -v, --verbose verbose output unknown shorthand flag: \u0026#39;s\u0026#39; in -s æ€»ç»“ï¼šåœ¨çˆ¶å‘½ä»¤ä¸Šè®¾ç½®ç©¿è¶Šå„¿ç«¥ä¸ºtrueï¼Œè¿è¡Œå­å‘½ä»¤æ—¶ä¼šè§£æçˆ¶å‘½ä»¤çš„æœ¬åœ°é€‰é¡¹ï¼Œåä¹‹ï¼Œåªè§£æå­å‘½ä»¤çš„æœ¬åœ°é€‰é¡¹ä»¥åŠæŒä¹…é€‰é¡¹ã€‚\n# å¤„ç†é…ç½® é™¤äº†å°†å‘½ä»¤è¡Œæ ‡å¿—çš„å€¼ç»‘å®šåˆ°å˜é‡ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†æ ‡å¿—ç»‘å®šåˆ° Viperï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨ viper.Get() æ¥è·å–æ ‡å¿—çš„å€¼äº†ã€‚\n1 2 3 4 5 6 var author string func init() { rootCmd.PersistentFlags().StringVar(\u0026amp;author, \u0026#34;author\u0026#34;, \u0026#34;YOUR NAME\u0026#34;, \u0026#34;Author name for copyright attribution\u0026#34;) viper.BindPFlag(\u0026#34;author\u0026#34;, rootCmd.PersistentFlags().Lookup(\u0026#34;author\u0026#34;)) } æç¤ºï¼šå¯¹ Viper ä¸ç†Ÿæ‚‰çš„è¯»è€…å¯ä»¥å‚è€ƒæˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« ã€ŠGoé…ç½®ç®¡ç†ä¹‹ç¬¬ä¸‰æ–¹åº“viperã€‹ã€‚\nå¦å¤–ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ cobra.OnInitialize() æ¥åˆå§‹åŒ–é…ç½®æ–‡ä»¶ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 var cfgFile string func init() { cobra.OnInitialize(initConfig) rootCmd.Flags().StringVarP(\u0026amp;cfgFile, \u0026#34;config\u0026#34;, \u0026#34;c\u0026#34;, \u0026#34;\u0026#34;, \u0026#34;config file\u0026#34;) } func initConfig() { if cfgFile != \u0026#34;\u0026#34; { viper.SetConfigFile(cfgFile) } else { home, err := homedir.Dir() if err != nil { fmt.Println(err) os.Exit(1) } viper.AddConfigPath(home) viper.SetConfigName(\u0026#34;.cobra_test\u0026#34;) } if err := viper.ReadInConfig(); err != nil { fmt.Println(\u0026#34;Can\u0026#39;t read config:\u0026#34;, err) os.Exit(1) } } ä¼ é€’ç»™ cobra.OnInitialize() çš„å‡½æ•° initConfig å‡½æ•°å°†åœ¨è°ƒç”¨å‘½ä»¤çš„ Execute æ–¹æ³•æ—¶è¿è¡Œã€‚\nä¸ºäº†å±•ç¤ºä½¿ç”¨ Cobra å¤„ç†é…ç½®çš„æ•ˆæœï¼Œéœ€è¦ä¿®æ”¹ rootCmd.Run å‡½æ•°çš„æ‰“å°ä»£ç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 var rootCmd = \u0026amp;cobra.Command{ Use: \u0026#34;hugo\u0026#34;, Run: func(cmd *cobra.Command, args []string) { fmt.Println(\u0026#34;run hugo...\u0026#34;) fmt.Printf(\u0026#34;Verbose: %v\\n\u0026#34;, Verbose) fmt.Printf(\u0026#34;Source: %v\\n\u0026#34;, Source) fmt.Printf(\u0026#34;Region: %v\\n\u0026#34;, Region) fmt.Printf(\u0026#34;Author: %v\\n\u0026#34;, viper.Get(\u0026#34;author\u0026#34;)) fmt.Printf(\u0026#34;Config: %v\\n\u0026#34;, viper.AllSettings()) }, } æä¾› config.yaml é…ç½®æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n1 2 3 4 5 password: 123456 server: ip: 10.0.0.1 port: 8080 username: arlettebrook ç°åœ¨é‡æ–°ç¼–è¯‘å¹¶è¿è¡Œ hugo å‘½ä»¤ï¼š\n1 2 3 4 5 6 7 8 $ go run main.go -r test-rergion run hugo... Verbose: false Source: Region: test-rergion Author: YOUR NAME Config: map[author:YOUR NAME password:123456 server:map[ip:10.0.0.1 port:8080] username:arlettebro ok] æ³¨æ„äº‹é¡¹ï¼šviperè¯»å–é…ç½®æ–‡ä»¶è‹¥æ ¹æ®æ–‡ä»¶åè¿›è¡Œæ‰«æï¼Œå½“æ–‡ä»¶åç›¸åŒï¼Œåç¼€ä¸åŒæ—¶ï¼Œè°å…ˆæ‰«åˆ°å°±ç”¨è°ï¼Œåœ¨æ ¹æ®æŒ‡å®šçš„ç±»å‹è¿›è¡Œè§£æã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šç±»å‹ï¼Œè§£æçš„æ˜¯ä»€ä¹ˆç±»å‹ï¼Œå°±æ˜¯ä»€ä¹ˆç±»å‹ï¼Œä½†åœ¨æœ€åä¿å­˜æ—¶ï¼Œéœ€è¦æŒ‡å®šå…·ä½“çš„ç±»å‹ï¼Œä¸ç„¶ä¿å­˜ä¸äº†ï¼ŒæŒ‡å®šäº†ç±»å‹å°±å¯ä»¥ã€‚\nç¬”è®°ï¼šCobra åŒæ—¶æ”¯æŒ pflag å’Œ Viper ä¸¤ä¸ªåº“ï¼Œå®é™…ä¸Šè¿™ä¸‰ä¸ªåº“å‡ºè‡ªåŒä¸€ä½œè€… spf13ã€‚\n# å‚æ•°éªŒè¯ åœ¨æ‰§è¡Œå‘½ä»¤è¡Œç¨‹åºæ—¶ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å¯¹å‘½ä»¤å‚æ•°è¿›è¡Œåˆæ³•æ€§éªŒè¯ï¼Œcobra.Command çš„ Args å±æ€§æä¾›äº†æ­¤åŠŸèƒ½ã€‚\nArgs å±æ€§ç±»å‹ä¸ºä¸€ä¸ªå‡½æ•°ï¼šfunc(cmd *Command, args []string) errorï¼Œå¯ä»¥ç”¨æ¥éªŒè¯å‚æ•°ã€‚\nCobra å†…ç½®äº†ä»¥ä¸‹éªŒè¯å‡½æ•°ï¼š\nNoArgsï¼šå¦‚æœå­˜åœ¨ä»»ä½•å‘½ä»¤å‚æ•°ï¼Œè¯¥å‘½ä»¤å°†æŠ¥é”™ã€‚ ArbitraryArgsï¼šè¯¥å‘½ä»¤å°†æ¥å—ä»»æ„å‚æ•°ã€‚ OnlyValidArgsï¼šå¦‚æœæœ‰ä»»ä½•å‘½ä»¤å‚æ•°ä¸åœ¨ Command çš„ ValidArgs å­—æ®µä¸­ï¼Œè¯¥å‘½ä»¤å°†æŠ¥é”™ã€‚ MinimumNArgs(int)ï¼šå¦‚æœæ²¡æœ‰è‡³å°‘ N ä¸ªå‘½ä»¤å‚æ•°ï¼Œè¯¥å‘½ä»¤å°†æŠ¥é”™ã€‚ MaximumNArgs(int)ï¼šå¦‚æœæœ‰è¶…è¿‡ N ä¸ªå‘½ä»¤å‚æ•°ï¼Œè¯¥å‘½ä»¤å°†æŠ¥é”™ã€‚ ExactArgs(int)ï¼šå¦‚æœå‘½ä»¤å‚æ•°ä¸ªæ•°ä¸ä¸º Nï¼Œè¯¥å‘½ä»¤å°†æŠ¥é”™ã€‚ ExactValidArgs(int)ï¼šå¦‚æœå‘½ä»¤å‚æ•°ä¸ªæ•°ä¸ä¸º Nï¼Œæˆ–è€…æœ‰ä»»ä½•å‘½ä»¤å‚æ•°ä¸åœ¨ Command çš„ ValidArgs å­—æ®µä¸­ï¼Œè¯¥å‘½ä»¤å°†æŠ¥é”™ã€‚ RangeArgs(min, max)ï¼šå¦‚æœå‘½ä»¤å‚æ•°çš„æ•°é‡ä¸åœ¨é¢„æœŸçš„æœ€å°æ•°é‡ min å’Œæœ€å¤§æ•°é‡ max ä¹‹é—´ï¼Œè¯¥å‘½ä»¤å°†æŠ¥é”™ã€‚ å†…ç½®éªŒè¯å‡½æ•°ç”¨æ³•å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 var versionCmd = \u0026amp;cobra.Command{ Use: \u0026#34;version\u0026#34;, Run: func(cmd *cobra.Command, args []string) { fmt.Println(\u0026#34;Hugo Static Site Generator v0.9 -- HEAD\u0026#34;) }, Args: cobra.MaximumNArgs(2), // ä½¿ç”¨å†…ç½®çš„éªŒè¯å‡½æ•°ï¼Œä½ç½®å‚æ•°å¤šäº 2 ä¸ªåˆ™æŠ¥é”™ } é‡æ–°ç¼–è¯‘å¹¶è¿è¡Œ hugo å‘½ä»¤ï¼š\n1 2 3 4 5 6 7 8 # ç¼–è¯‘ $ go build -o hugo # ä¸¤ä¸ªå‘½ä»¤å‚æ•°æ»¡è¶³éªŒè¯å‡½æ•°çš„è¦æ±‚ $ ./hugo version a b Hugo Static Site Generator v0.9 -- HEAD # è¶…è¿‡ä¸¤ä¸ªå‚æ•°åˆ™æŠ¥é”™ $ ./hugo version a b c Error: accepts at most 2 arg(s), received 3 å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰éªŒè¯å‡½æ•°ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 var printCmd = \u0026amp;cobra.Command{ Use: \u0026#34;print [OPTIONS] [COMMANDS]\u0026#34;, Run: func(cmd *cobra.Command, args []string) { fmt.Println(\u0026#34;run print...\u0026#34;) // å‘½ä»¤è¡Œä½ç½®å‚æ•°åˆ—è¡¨ï¼šä¾‹å¦‚æ‰§è¡Œ `hugo print a b c d` å°†å¾—åˆ° [a b c d] fmt.Printf(\u0026#34;args: %v\\n\u0026#34;, args) }, // ä½¿ç”¨è‡ªå®šä¹‰éªŒè¯å‡½æ•° Args: func(cmd *cobra.Command, args []string) error { if len(args) \u0026lt; 1 { return errors.New(\u0026#34;requires at least one arg\u0026#34;) } if len(args) \u0026gt; 4 { return errors.New(\u0026#34;the number of args cannot exceed 4\u0026#34;) } if args[0] != \u0026#34;a\u0026#34; { return errors.New(\u0026#34;first argument must be \u0026#39;a\u0026#39;\u0026#34;) } return nil }, } é‡æ–°ç¼–è¯‘å¹¶è¿è¡Œ hugo å‘½ä»¤ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 # ç¼–è¯‘ $ go build -o hugo # 1~4 ä¸ªå‚æ•°æ»¡è¶³æ¡ä»¶ $ ./hugo print a b c d run print... args: [a b c d] # æ²¡æœ‰å‚æ•°åˆ™æŠ¥é”™ $ ./hugo print Error: requires at least one arg # ç¬¬ä¸€ä¸ªå‚æ•°ä¸æ»¡è¶³éªŒè¯å‡½æ•°é€»è¾‘ï¼Œä¹Ÿä¼šæŠ¥é”™ $ ./hugo print x Error: first argument must be \u0026#39;a\u0026#39; # Hooks åœ¨æ‰§è¡Œ Run å‡½æ•°å‰åï¼Œæˆ‘ä¹ˆå¯ä»¥æ‰§è¡Œä¸€äº›é’©å­å‡½æ•°ï¼Œå…¶ä½œç”¨å’Œæ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼š\nPersistentPreRunï¼šåœ¨ PreRun å‡½æ•°æ‰§è¡Œä¹‹å‰æ‰§è¡Œï¼Œå¯¹æ­¤å‘½ä»¤çš„å­å‘½ä»¤åŒæ ·ç”Ÿæ•ˆã€‚ PreRunï¼šåœ¨ Run å‡½æ•°æ‰§è¡Œä¹‹å‰æ‰§è¡Œã€‚ Runï¼šæ‰§è¡Œå‘½ä»¤æ—¶è°ƒç”¨çš„å‡½æ•°ï¼Œç”¨æ¥ç¼–å†™å‘½ä»¤çš„ä¸šåŠ¡é€»è¾‘ã€‚ PostRunï¼šåœ¨ Run å‡½æ•°æ‰§è¡Œä¹‹åæ‰§è¡Œã€‚ PersistentPostRunï¼šåœ¨ PostRun å‡½æ•°æ‰§è¡Œä¹‹åæ‰§è¡Œï¼Œå¯¹æ­¤å‘½ä»¤çš„å­å‘½ä»¤åŒæ ·ç”Ÿæ•ˆã€‚ ä¿®æ”¹ rootCmd å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 var rootCmd = \u0026amp;cobra.Command{ Use: \u0026#34;hugo\u0026#34;, PersistentPreRun: func(cmd *cobra.Command, args []string) { fmt.Println(\u0026#34;hugo PersistentPreRun\u0026#34;) }, PreRun: func(cmd *cobra.Command, args []string) { fmt.Println(\u0026#34;hugo PreRun\u0026#34;) }, Run: func(cmd *cobra.Command, args []string) { fmt.Println(\u0026#34;run hugo...\u0026#34;) }, PostRun: func(cmd *cobra.Command, args []string) { fmt.Println(\u0026#34;hugo PostRun\u0026#34;) }, PersistentPostRun: func(cmd *cobra.Command, args []string) { fmt.Println(\u0026#34;hugo PersistentPostRun\u0026#34;) }, } é‡æ–°ç¼–è¯‘å¹¶è¿è¡Œ hugo å‘½ä»¤ï¼š\n1 2 3 4 5 6 7 8 9 # ç¼–è¯‘ $ go build -o hugo # æ‰§è¡Œ $ ./hugo hugo PersistentPreRun hugo PreRun run hugo... hugo PostRun hugo PersistentPostRun è¾“å‡ºé¡ºåºç¬¦åˆé¢„æœŸã€‚\nå…¶ä¸­ PersistentPreRunã€PersistentPostRun ä¸¤ä¸ªå‡½æ•°å¯¹å­å‘½ä»¤åŒæ ·ç”Ÿæ•ˆã€‚\n1 2 3 4 $ ./hugo version hugo PersistentPreRun Hugo Static Site Generator v0.9 -- HEAD hugo PersistentPostRun ä»¥ä¸Šå‡ ä¸ªå‡½æ•°éƒ½æœ‰å¯¹åº”çš„ \u0026lt;Hooks\u0026gt;E ç‰ˆæœ¬ï¼ŒE è¡¨ç¤º Errorï¼Œå³å‡½æ•°æ‰§è¡Œå‡ºé”™å°†ä¼šè¿”å› Errorï¼Œæ‰§è¡Œé¡ºåºä¸å˜ï¼š\nPersistentPreRunE PreRunE RunE PostRunE PersistentPostRunE å¦‚æœå®šä¹‰äº† \u0026lt;Hooks\u0026gt;E å‡½æ•°ï¼Œåˆ™ \u0026lt;Hooks\u0026gt; å‡½æ•°ä¸ä¼šæ‰§è¡Œã€‚æ¯”å¦‚åŒæ—¶å®šä¹‰äº† Run å’Œ RunEï¼Œåˆ™åªä¼šæ‰§è¡Œ RunEï¼Œä¸ä¼šæ‰§è¡Œ Runï¼Œå…¶ä»– Hooks å‡½æ•°åŒç†ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 var rootCmd = \u0026amp;cobra.Command{ Use: \u0026#34;hugo\u0026#34;, PersistentPreRun: func(cmd *cobra.Command, args []string) { fmt.Println(\u0026#34;hugo PersistentPreRun\u0026#34;) }, PersistentPreRunE: func(cmd *cobra.Command, args []string) error { fmt.Println(\u0026#34;hugo PersistentPreRunE\u0026#34;) return nil }, PreRun: func(cmd *cobra.Command, args []string) { fmt.Println(\u0026#34;hugo PreRun\u0026#34;) }, PreRunE: func(cmd *cobra.Command, args []string) error { fmt.Println(\u0026#34;hugo PreRunE\u0026#34;) return errors.New(\u0026#34;PreRunE err\u0026#34;) }, Run: func(cmd *cobra.Command, args []string) { fmt.Println(\u0026#34;run hugo...\u0026#34;) }, PostRun: func(cmd *cobra.Command, args []string) { fmt.Println(\u0026#34;hugo PostRun\u0026#34;) }, PersistentPostRun: func(cmd *cobra.Command, args []string) { fmt.Println(\u0026#34;hugo PersistentPostRun\u0026#34;) }, } é‡æ–°ç¼–è¯‘å¹¶è¿è¡Œ hugo å‘½ä»¤ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # ç¼–è¯‘ $ go build -o hugo # æ‰§è¡Œ $ ./hugo hugo PersistentPreRunE hugo PreRunE Error: PreRunE err Usage: hugo [flags] hugo [command] Available Commands: completion Generate the autocompletion script for the specified shell help Help about any command print version Print the version number of Hugo Flags: --author string Author name for copyright attribution (default \u0026#34;YOUR NAME\u0026#34;) -c, --config string config file -h, --help help for hugo -r, --region string AWS region (required) -s, --source string Source directory to read from -v, --verbose verbose output Use \u0026#34;hugo [command] --help\u0026#34; for more information about a command. PreRunE err å¯ä»¥å‘ç°ï¼Œè™½ç„¶åŒæ—¶å®šä¹‰äº† PersistentPreRunã€PersistentPreRunE ä¸¤ä¸ªé’©å­å‡½æ•°ï¼Œä½†åªæœ‰ PersistentPreRunE ä¼šè¢«æ‰§è¡Œã€‚\nåœ¨æ‰§è¡Œ PreRunE æ—¶è¿”å›äº†ä¸€ä¸ªé”™è¯¯ PreRunE errï¼Œç¨‹åºä¼šç»ˆæ­¢è¿è¡Œå¹¶æ‰“å°é”™è¯¯ä¿¡æ¯ã€‚\nå¦‚æœå­å‘½ä»¤å®šä¹‰äº†è‡ªå·±çš„ Persistent*Run å‡½æ•°ï¼Œåˆ™ä¸ä¼šç»§æ‰¿çˆ¶å‘½ä»¤çš„ Persistent*Run å‡½æ•°ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 var versionCmd = \u0026amp;cobra.Command{ Use: \u0026#34;version\u0026#34;, PersistentPreRun: func(cmd *cobra.Command, args []string) { fmt.Println(\u0026#34;version PersistentPreRun\u0026#34;) }, PreRun: func(cmd *cobra.Command, args []string) { fmt.Println(\u0026#34;version PreRun\u0026#34;) }, Run: func(cmd *cobra.Command, args []string) { fmt.Println(\u0026#34;Hugo Static Site Generator v0.9 -- HEAD\u0026#34;) }, } é‡æ–°ç¼–è¯‘å¹¶è¿è¡Œ hugo å‘½ä»¤ï¼š\n1 2 3 4 5 6 7 8 # ç¼–è¯‘ $ go build -o hugo # æ‰§è¡Œå­å‘½ä»¤ $ ./hugo version version PersistentPreRun version PreRun Hugo Static Site Generator v0.9 -- HEAD hugo PersistentPostRun æ³¨æ„äº‹é¡¹ï¼šcobra.OnInitialize()ä¼ å…¥è°ƒç”¨å‘½ä»¤æ—¶æ‰§è¡Œçš„å‡½æ•°ï¼ˆå¯ä»¥ç”¨æ¥åˆå§‹åŒ–é…ç½®ï¼‰ï¼šæ‰§è¡Œé¡ºåºéƒ½åœ¨Hookså‡½æ•°çš„å‰é¢ã€‚\n# å®šä¹‰è‡ªå·±çš„ Help å‘½ä»¤ å¦‚æœä½ å¯¹ Cobra è‡ªåŠ¨ç”Ÿæˆçš„å¸®åŠ©å‘½ä»¤ä¸æ»¡æ„ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰å¸®åŠ©å‘½ä»¤æˆ–æ¨¡æ¿ã€‚\n1 2 3 cmd.SetHelpCommand(cmd *Command) cmd.SetHelpFunc(f func(*Command, []string)) cmd.SetHelpTemplate(s string) Cobra æä¾›äº†ä¸‰ä¸ªæ–¹æ³•æ¥å®ç°è‡ªå®šä¹‰å¸®åŠ©å‘½ä»¤ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ hugo help command è¯­æ³•æŸ¥çœ‹å­å‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ hugo command -h/--help æŸ¥çœ‹ã€‚\nä½¿ç”¨ help å‘½ä»¤æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 $ ./hugo help version hugo PersistentPreRunE All software has versions. This is Hugo\u0026#39;s Usage: hugo version [flags] Flags: -h, --help help for version Global Flags: --author string Author name for copyright attribution (default \u0026#34;YOUR NAME\u0026#34;) -v, --verbose verbose output hugo PersistentPostRun ä½¿ç”¨ -h/--help æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 $ ./hugo version -h All software has versions. This is Hugo\u0026#39;s Usage: hugo version [flags] Flags: -h, --help help for version Global Flags: --author string Author name for copyright attribution (default \u0026#34;YOUR NAME\u0026#34;) -v, --verbose verbose output äºŒè€…å”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼Œä½¿ç”¨ help å‘½ä»¤æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯æ—¶ä¼šæ‰§è¡Œåˆå§‹åŒ–å‡½æ•°ï¼ˆè¿™é‡Œæ²¡æœ‰æ¼”ç¤ºï¼Œå‚è€ƒï¼‰å’Œé’©å­å‡½æ•°ã€‚\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨ rootCmd.SetHelpCommand æ¥æ§åˆ¶ help å‘½ä»¤è¾“å‡ºï¼Œä½¿ç”¨ rootCmd.SetHelpFunc æ¥æ§åˆ¶ -h/--help è¾“å‡ºã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 func init() { rootCmd.PersistentFlags().BoolVarP(\u0026amp;Verbose, \u0026#34;verbose\u0026#34;, \u0026#34;v\u0026#34;, false, \u0026#34;Verbose output\u0026#34;) rootCmd.Flags().StringVarP(\u0026amp;Source, \u0026#34;source\u0026#34;, \u0026#34;s\u0026#34;, \u0026#34;\u0026#34;, \u0026#34;Source directory to read from\u0026#34;) rootCmd.Flags().StringVarP(\u0026amp;Region, \u0026#34;region\u0026#34;, \u0026#34;r\u0026#34;, \u0026#34;\u0026#34;, \u0026#34;AWS region (required)\u0026#34;) _ = rootCmd.MarkFlagRequired(\u0026#34;region\u0026#34;) rootCmd.PersistentFlags().StringVar(\u0026amp;Author, \u0026#34;author\u0026#34;, \u0026#34;YOUR NAME\u0026#34;, \u0026#34;Author name for copyright attribution\u0026#34;) _ = viper.BindPFlag(\u0026#34;author\u0026#34;, rootCmd.PersistentFlags().Lookup(\u0026#34;author\u0026#34;)) cobra.OnInitialize(initConfig) rootCmd.Flags().StringVarP(\u0026amp;cfgFile, \u0026#34;config\u0026#34;, \u0026#34;c\u0026#34;, \u0026#34;\u0026#34;, \u0026#34;config file\u0026#34;) rootCmd.SetHelpCommand(\u0026amp;cobra.Command{ Use: \u0026#34;help\u0026#34;, Short: \u0026#34;Custom help command\u0026#34;, Hidden: true, Run: func(cmd *cobra.Command, args []string) { fmt.Println(\u0026#34;Custom help command\u0026#34;) }, }) rootCmd.SetHelpFunc(func(command *cobra.Command, strings []string) { fmt.Println(strings) }) } é‡æ–°ç¼–è¯‘å¹¶è¿è¡Œ hugo å‘½ä»¤ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 # ç¼–è¯‘ $ go build -o hugo # ä½¿ç”¨ `help` å‘½ä»¤æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯ $ ./hugo help version hugo PersistentPreRunE Custom help command hugo PersistentPostRun # ä½¿ç”¨ `-h` æŸ¥çœ‹æ ¹å‘½ä»¤å¸®åŠ©ä¿¡æ¯ $ ./hugo -h [-h] # ä½¿ç”¨ `-h` æŸ¥çœ‹ version å‘½ä»¤å¸®åŠ©ä¿¡æ¯ $ ./hugo version -h [version -h] å¯ä»¥å‘ç°ï¼Œä½¿ç”¨ help å‘½ä»¤æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯è¾“å‡ºç»“æœæ˜¯ rootCmd.SetHelpCommand ä¸­ Run å‡½æ•°çš„æ‰§è¡Œè¾“å‡ºã€‚ä½¿ç”¨ -h æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯è¾“å‡ºç»“æœæ˜¯ rootCmd.SetHelpFunc å‡½æ•°çš„æ‰§è¡Œè¾“å‡ºï¼Œstrings ä»£è¡¨çš„æ˜¯å‘½ä»¤è¡Œæ ‡å¿—å’Œå‚æ•°åˆ—è¡¨ã€‚\nç°åœ¨æˆ‘ä»¬å†æ¥æµ‹è¯•ä¸‹ rootCmd.SetHelpTemplate çš„ä½œç”¨ï¼Œå®ƒç”¨æ¥è®¾ç½®å¸®åŠ©ä¿¡æ¯æ¨¡æ¿ï¼Œæ”¯æŒæ ‡å‡†çš„ Go Template è¯­æ³•ï¼Œè‡ªå®šä¹‰æ¨¡æ¿å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 rootCmd.SetHelpTemplate(`Custom Help Template: Usage: {{.UseLine}} Description: {{.Short}} Commands: {{- range .Commands}} {{.Name}}: {{.Short}} {{- end}} `) æ³¨æ„ï¼šä¸ºäº†å•ç‹¬æµ‹è¯• cmd.SetHelpTemplate(s string)ï¼Œæˆ‘å·²å°†ä¸Šé¢ rootCmd.SetHelpCommand å’Œ rootCmd.SetHelpFunc éƒ¨åˆ†ä»£ç æ³¨é‡Šæ‰äº†ã€‚\né‡æ–°ç¼–è¯‘å¹¶è¿è¡Œ hugo å‘½ä»¤ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 # ç¼–è¯‘ $ go build -o hugo # æŸ¥çœ‹å¸®åŠ© $ ./hugo -h Custom Help Template: Usage: hugo [flags] Description: Hugo is a very fast static site generator Commands: completion: Generate the autocompletion script for the specified shell help: Help about any command print: version: Print the version number of Hugo # æŸ¥çœ‹å­å‘½ä»¤å¸®åŠ© $ ./hugo help version hugo PersistentPreRunE Custom Help Template: Usage: hugo version [flags] Description: Print the version number of Hugo Commands: hugo PersistentPostRun å¯ä»¥å‘ç°ï¼Œæ— è®ºä½¿ç”¨ help å‘½ä»¤æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯ï¼Œè¿˜æ˜¯ä½¿ç”¨ -h æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯ï¼Œå…¶è¾“å‡ºå†…å®¹éƒ½éµå¾ªæˆ‘ä»¬è‡ªå®šä¹‰çš„æ¨¡ç‰ˆæ ¼å¼ã€‚\n# å®šä¹‰è‡ªå·±çš„ Usage Message å½“ç”¨æˆ·æä¾›æ— æ•ˆæ ‡å¿—æˆ–æ— æ•ˆå‘½ä»¤æ—¶ï¼ŒCobra é€šè¿‡å‘ç”¨æˆ·æ˜¾ç¤º Usage æ¥æç¤ºç”¨æˆ·å¦‚ä½•æ­£ç¡®çš„ä½¿ç”¨å‘½ä»¤ã€‚\nä¾‹å¦‚ï¼Œå½“ç”¨æˆ·è¾“å…¥æ— æ•ˆçš„æ ‡å¿— --demo æ—¶ï¼Œå°†å¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 $ ./hugo --demo Error: unknown flag: --demo Usage: hugo [flags] hugo [command] Available Commands: completion Generate the autocompletion script for the specified shell help Help about any command print version Print the version number of Hugo Flags: --author string Author name for copyright attribution (default \u0026#34;YOUR NAME\u0026#34;) -c, --config string config file -h, --help help for hugo -s, --source string Source directory to read from -v, --verbose verbose output Use \u0026#34;hugo [command] --help\u0026#34; for more information about a command. unknown flag: --demo é¦–å…ˆç¨‹åºä¼šæŠ¥é”™ Error: unknown flag: --demoï¼ŒæŠ¥é”™åä¼šæ˜¾ç¤º Usage ä¿¡æ¯ã€‚\nè¿™ä¸ªè¾“å‡ºæ ¼å¼é»˜è®¤ä¸ help ä¿¡æ¯ä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è¿›è¡Œè‡ªå®šä¹‰ã€‚Cobra æä¾›äº†å¦‚ä¸‹ä¸¤ä¸ªæ–¹æ³•ï¼Œæ¥æ§åˆ¶è¾“å‡ºï¼Œå…·ä½“æ•ˆæœæˆ‘å°±ä¸æ¼”ç¤ºäº†ï¼Œç•™ç»™è¯»è€…è‡ªè¡Œæ¢ç´¢ã€‚\n1 2 cmd.SetUsageFunc(f func(*Command) error) cmd.SetUsageTemplate(s string) # æœªçŸ¥å‘½ä»¤å»ºè®® åœ¨æˆ‘ä»¬ä½¿ç”¨ git å‘½ä»¤æ—¶ï¼Œæœ‰ä¸€ä¸ªéå¸¸å¥½ç”¨çš„åŠŸèƒ½ï¼Œèƒ½å¤Ÿå¯¹ç”¨æˆ·è¾“é”™çš„æœªçŸ¥å‘½ä»¤æ™ºèƒ½æç¤ºã€‚\nç¤ºä¾‹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 $ git statu git: \u0026#39;statu\u0026#39; is not a git command. See \u0026#39;git --help\u0026#39;. The most similar commands are status stage stash å½“æˆ‘ä»¬è¾“å…¥ä¸€ä¸ªä¸å­˜åœ¨çš„å‘½ä»¤ statu æ—¶ï¼Œgit ä¼šæç¤ºå‘½ä»¤ä¸å­˜åœ¨ï¼Œå¹¶ä¸”ç»™å‡ºå‡ ä¸ªæœ€ç›¸ä¼¼å‘½ä»¤çš„å»ºè®®ã€‚\nè¿™ä¸ªåŠŸèƒ½éå¸¸å®ç”¨ï¼Œå¹¸è¿çš„æ˜¯ï¼ŒCobra è‡ªå¸¦äº†æ­¤åŠŸèƒ½ã€‚\nå¦‚ä¸‹ï¼Œå½“æˆ‘ä»¬è¾“å…¥ä¸€ä¸ªä¸å­˜åœ¨çš„å‘½ä»¤ vers æ—¶ï¼Œhugo ä¼šè‡ªåŠ¨ç»™å‡ºå»ºè®®å‘½ä»¤ versionï¼š\n1 2 3 4 5 6 7 8 9 10 11 $ ./hugo vers Error: unknown command \u0026#34;vers\u0026#34; for \u0026#34;hugo\u0026#34; Did you mean this? version Run \u0026#39;hugo --help\u0026#39; for usage. unknown command \u0026#34;vers\u0026#34; for \u0026#34;hugo\u0026#34; Did you mean this? version æ³¨æ„âš ï¸ï¼šæ ¹æ®æˆ‘çš„å®æµ‹ï¼Œè¦æƒ³è®©æ­¤åŠŸèƒ½ç”Ÿæ•ˆï¼ŒCommand.TraverseChildren å±æ€§è¦ç½®ä¸º falseã€‚\nå¦‚æœä½ æƒ³å½»åº•å…³é—­æ­¤åŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹è®¾ç½®ï¼š\n1 cmd.DisableSuggestions = true æˆ–è€…ä½¿ç”¨å¦‚ä¸‹è®¾ç½®è°ƒæ•´å­—ç¬¦ä¸²åŒ¹é…çš„æœ€å°è·ç¦»ï¼š\n1 cmd.SuggestionsMinimumDistance = 1 SuggestionsMinimumDistance æ˜¯ä¸€ä¸ªæ­£æ•´æ•°ï¼Œè¡¨ç¤ºè¾“é”™çš„å‘½ä»¤ä¸æ­£ç¡®çš„å‘½ä»¤æœ€å¤šæœ‰å‡ ä¸ªä¸åŒ¹é…çš„å­—ç¬¦ï¼ˆæœ€å°è·ç¦»ï¼‰ï¼Œæ‰ä¼šç»™å‡ºå»ºè®®ã€‚å¦‚å½“å€¼ä¸º 1 æ—¶ï¼Œç”¨æˆ·è¾“å…¥ hugo versiox ä¼šç»™å‡ºå»ºè®®ï¼Œè€Œå¦‚æœç”¨æˆ·è¾“å…¥ hugo versixx æ—¶ï¼Œåˆ™ä¸ä¼šç»™å‡ºå»ºè®®ï¼Œå› ä¸ºå·²ç»æœ‰ä¸¤ä¸ªå­—æ¯ä¸åŒ¹é… version äº†ã€‚\n# Shell è¡¥å…¨ æœ¬æ–‡åœ¨è®²æ·»åŠ å­å‘½ä»¤å°èŠ‚æ—¶ï¼Œæˆ‘ä»¬è§åˆ°è¿‡ completion å­å‘½ä»¤ï¼Œå¯ä»¥ä¸ºæŒ‡å®šçš„ Shell ç”Ÿæˆè‡ªåŠ¨è¡¥å…¨è„šæœ¬ï¼Œç°åœ¨æˆ‘ä»¬å°±æ¥è®²è§£å®ƒçš„ç”¨æ³•ã€‚\nç›´æ¥æ‰§è¡Œ hugo completion -h å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹å®ƒæ”¯æŒçš„å‡ ç§ Shell ç±»å‹ bashã€fishã€powershellã€zshã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 $ go run main.go completion -h Generate the autocompletion script for tools for the specified shell. See each sub-command\u0026#39;s help for details on how to use the generated script. Usage: tools completion [command] Available Commands: bash Generate the autocompletion script for bash fish Generate the autocompletion script for fish powershell Generate the autocompletion script for powershell zsh Generate the autocompletion script for zsh Flags: -h, --help help for completion Global Flags: --author string Author name for copyright attribution (default \u0026#34;YOUR NAME\u0026#34;) -v, --verbose Verbose output Use \u0026#34;tools completion [command] --help\u0026#34; for more information about a command. è¦æƒ³çŸ¥é“è‡ªå·±æ­£åœ¨ä½¿ç”¨çš„ Shell ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š\n1 2 3 4 $ echo $0 /bin/zsh $ echo $SHELL /bin/zsh å¯ä»¥å‘ç°ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ zshï¼Œæ‰€ä»¥æˆ‘å°±ä»¥ zsh ä¸ºä¾‹ï¼Œæ¥æ¼”ç¤ºä¸‹ completion å‘½ä»¤è¡¥å…¨ç”¨æ³•ã€‚\nä½¿ç”¨ -h/--help æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ä½¿ç”¨è¯´æ˜ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 $ ./hugo completion zsh -h Generate the autocompletion script for the zsh shell. If shell completion is not already enabled in your environment you will need to enable it. You can execute the following once: echo \u0026#34;autoload -U compinit; compinit\u0026#34; \u0026gt;\u0026gt; ~/.zshrc To load completions in your current shell session: source \u0026lt;(hugo completion zsh) To load completions for every new session, execute once: #### Linux: hugo completion zsh \u0026gt; \u0026#34;${fpath[1]}/_hugo\u0026#34; #### macOS: hugo completion zsh \u0026gt; $(brew --prefix)/share/zsh/site-functions/_hugo You will need to start a new shell for this setup to take effect. Usage: hugo completion zsh [flags] Flags: -h, --help help for zsh --no-descriptions disable completion descriptions Global Flags: --author string Author name for copyright attribution (default \u0026#34;YOUR NAME\u0026#34;) -v, --verbose verbose output æ ¹æ®å¸®åŠ©ä¿¡æ¯ï¼Œå¦‚æœä¸ºå½“å‰ä¼šè¯æä¾›å‘½ä»¤è¡Œè¡¥å…¨åŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨ source \u0026lt;(hugo completion zsh) å‘½ä»¤æ¥å®ç°ã€‚\nå¦‚æœè¦è®©å‘½ä»¤è¡Œè¡¥å…¨åŠŸèƒ½æ°¸ä¹…ç”Ÿæ•ˆï¼ŒCobra åˆ™éå¸¸è´´å¿ƒçš„ä¸º Linux å’Œ macOS æä¾›äº†ä¸åŒå‘½ä»¤ã€‚\nä½ å¯ä»¥æ ¹æ®æç¤ºé€‰æ‹©è‡ªå·±å–œæ¬¢çš„æ–¹å¼æ¥å®ç°å‘½ä»¤è¡Œè¡¥å…¨åŠŸèƒ½ã€‚\næˆ‘è¿™é‡Œåªå®ç°ä¸ºå½“å‰ä¼šè¯æä¾›å‘½ä»¤è¡Œè¡¥å…¨åŠŸèƒ½ä¸ºä¾‹è¿›è¡Œæ¼”ç¤ºï¼š\n1 2 3 4 5 6 7 8 9 10 11 # é¦–å…ˆåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œå®‰è£… hugo å‘½ä»¤è¡Œç¨‹åºï¼Œå®‰è£…åè½¯ä»¶å­˜æ”¾åœ¨ $GOPATH/bin ç›®å½•ä¸‹ $ go install . # æ·»åŠ å‘½ä»¤è¡Œè¡¥å…¨åŠŸèƒ½ $ source \u0026lt;(hugo completion zsh) # ç°åœ¨å‘½ä»¤è¡Œè¡¥å…¨å·²ç»ç”Ÿæ•ˆï¼Œåªéœ€è¦è¾“å…¥ä¸€ä¸ª `v`ï¼Œç„¶åæŒ‰ä¸‹é”®ç›˜ä¸Šçš„ `Tab` é”®ï¼Œå‘½ä»¤å°†è‡ªåŠ¨è¡¥å…¨ä¸º `version` $ hugo v # å‘½ä»¤å·²è¢«è‡ªåŠ¨è¡¥å…¨ $ hugo version version PersistentPreRun version PreRun Hugo Static Site Generator v0.9 -- HEAD å…¶å®å°†å‘½ä»¤ source \u0026lt;(hugo completion zsh) æ·»åŠ åˆ° ~/.zshrc æ–‡ä»¶ä¸­ï¼Œä¹Ÿèƒ½å®ç°æ¯æ¬¡è¿›å…¥ zsh åè‡ªåŠ¨åŠ è½½ hugo çš„å‘½ä»¤è¡Œè¡¥å…¨åŠŸèƒ½ã€‚\næ³¨æ„ï¼šåœ¨æ‰§è¡Œ source \u0026lt;(hugo completion zsh) å‰éœ€è¦å°† rootCmd ä¸­çš„é’©å­å‡½æ•°å†…éƒ¨çš„ fmt.Println ä»£ç å…¨éƒ¨æ³¨é‡Šæ‰ï¼Œä¸ç„¶æ‰“å°å†…å®¹ä¼šè¢«å½“ä½œå‘½ä»¤æ¥æ‰§è¡Œï¼Œå°†ä¼šå¾—åˆ° Error: unknown command \u0026quot;PersistentPreRunE\u0026quot; for \u0026quot;hugo\u0026quot; ç±»ä¼¼æŠ¥é”™ä¿¡æ¯ï¼Œè™½ç„¶å‘½ä»¤è¡Œè¡¥å…¨åŠŸèƒ½ä¾ç„¶èƒ½å¤Ÿç”Ÿæ•ˆï¼Œä½†ã€Œæ²¡æœ‰æ¶ˆæ¯æ‰æ˜¯æœ€å¥½çš„æ¶ˆæ¯ã€ã€‚\nè¿˜æœ‰è¦æ³¨æ„ï¼šä¸»å‘½ä»¤è¦ä¸é¡¹ç›®åï¼ˆæ„å»ºä¹‹åçš„å‘½ä»¤ï¼‰ä¸€ç›´ï¼Œä¸ç„¶ä¹Ÿä¸ä¼šè‡ªåŠ¨è¡¥å…¨ã€‚\n# ç”Ÿæˆæ–‡æ¡£ Cobra æ”¯æŒç”Ÿæˆ Markdownã€ReStructured Textã€Man Page ä¸‰ç§æ ¼å¼æ–‡æ¡£ã€‚\nè¿™é‡Œä»¥ç”Ÿæˆ Markdown æ ¼å¼æ–‡æ¡£ä¸ºä¾‹ï¼Œæ¥æ¼”ç¤ºä¸‹ Cobra è¿™ä¸€å¼ºå¤§åŠŸèƒ½ã€‚\næˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªæ ‡å¿— md-docs æ¥å†³å®šæ˜¯å¦ç”Ÿæˆæ–‡æ¡£ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // hugo/cmd/root.go ... import \u0026#34;github.com/spf13/cobra/doc\u0026#34; ... var MarkdownDocs bool func init() { rootCmd.Flags().BoolVarP(\u0026amp;MarkdownDocs, \u0026#34;md-docs\u0026#34;, \u0026#34;m\u0026#34;, false, \u0026#34;gen Markdown docs\u0026#34;) ... } func GenDocs() { if MarkdownDocs { if err := doc.GenMarkdownTree(rootCmd, \u0026#34;./docs/md\u0026#34;); err != nil { fmt.Println(err) os.Exit(1) } } } åœ¨ main.go ä¸­è°ƒç”¨ GenDocs() å‡½æ•°ã€‚æ³¨æ„./docs/mdè·¯å¾„å¿…é¡»å­˜åœ¨ã€‚\n1 2 3 4 func main() { cmd.Execute() cmd.GenDocs() } ç°åœ¨ï¼Œé‡æ–°ç¼–è¯‘å¹¶è¿è¡Œ hugo å³å¯ç”Ÿæˆæ–‡æ¡£ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # ç¼–è¯‘ $ go build -o hugo # ç”Ÿæˆæ–‡æ¡£ $ ./hugo --md-docs ... ... # ä¼šæ‰§è¡Œrootå‘½ä»¤çš„Runå‡½æ•° # æŸ¥çœ‹ç”Ÿæˆçš„æ–‡æ¡£ $ tree docs/md docs/md â”œâ”€â”€ hugo.md â”œâ”€â”€ hugo_completion.md â”œâ”€â”€ hugo_completion_bash.md â”œâ”€â”€ hugo_completion_fish.md â”œâ”€â”€ hugo_completion_powershell.md â”œâ”€â”€ hugo_completion_zsh.md â”œâ”€â”€ hugo_print.md â””â”€â”€ hugo_version.md å¯ä»¥å‘ç°ï¼ŒCobra ä¸ä»…ä¸º hugo å‘½ä»¤ç”Ÿæˆäº†æ–‡æ¡£ï¼Œå¹¶ä¸”è¿˜ç”Ÿæˆäº†å­å‘½ä»¤çš„æ–‡æ¡£ä»¥åŠå‘½ä»¤è¡Œè¡¥å…¨çš„æ–‡æ¡£ã€‚\n# ä½¿ç”¨ Cobra å‘½ä»¤åˆ›å»ºé¡¹ç›® æ–‡ç« è¯»åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå…¶å® Cobra é¡¹ç›®æ˜¯éµå¾ªä¸€å®šå¥—è·¯çš„ï¼Œç›®å½•ç»“æ„ã€æ–‡ä»¶ã€æ¨¡æ¿ä»£ç éƒ½æ¯”è¾ƒå›ºå®šã€‚\næ­¤æ—¶ï¼Œè„šæ‰‹æ¶å·¥å…·å°±æ´¾ä¸Šç”¨åœºäº†ã€‚Cobra æä¾›äº† cobra-cli å‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤çš„æ–¹å¼å¿«é€Ÿåˆ›å»ºä¸€ä¸ªå‘½ä»¤è¡Œé¡¹ç›®ã€‚\nå®‰è£…ï¼š\n1 $ go install github.com/spf13/cobra-cli@latest æŸ¥çœ‹ä½¿ç”¨å¸®åŠ©ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 $ cobra-cli -h Cobra is a CLI library for Go that empowers applications. This application is a tool to generate the needed files to quickly create a Cobra application. Usage: cobra-cli [command] Available Commands: add Add a command to a Cobra Application completion Generate the autocompletion script for the specified shell help Help about any command init Initialize a Cobra Application Flags: -a, --author string author name for copyright attribution (default \u0026#34;YOUR NAME\u0026#34;) --config string config file (default is $HOME/.cobra.yaml) -h, --help help for cobra-cli -l, --license string name of license for the project --viper use Viper for configuration Use \u0026#34;cobra-cli [command] --help\u0026#34; for more information about a command. å¯ä»¥å‘ç°ï¼Œcobra-cli è„šæ‰‹æ¶å·¥å…·ä»…æä¾›äº†å°‘é‡å‘½ä»¤å’Œæ ‡å¿—ï¼Œæ‰€ä»¥ä¸Šæ‰‹éš¾åº¦ä¸å¤§ã€‚\n# åˆå§‹åŒ–æ¨¡å— è¦ä½¿ç”¨ cobra-cli ç”Ÿæˆä¸€ä¸ªé¡¹ç›®ï¼Œé¦–å…ˆè¦æ‰‹åŠ¨åˆ›å»ºé¡¹ç›®æ ¹ç›®å½•å¹¶ä½¿ç”¨ go mod å‘½ä»¤è¿›è¡Œåˆå§‹åŒ–ã€‚\nå‡è®¾æˆ‘ä»¬è¦ç¼–å†™çš„å‘½ä»¤è¡Œç¨‹åºå«ä½œ cobï¼Œæ¨¡å—åˆå§‹åŒ–è¿‡ç¨‹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 # åˆ›å»ºé¡¹ç›®ç›®å½• $ mkdir cob # è¿›å…¥é¡¹ç›®ç›®å½• $ cd cob # åˆå§‹åŒ–æ¨¡å— $ go mod init github.com/arlettebrook/cob # åˆå§‹åŒ–å‘½ä»¤è¡Œç¨‹åº æœ‰äº†åˆå§‹åŒ–å¥½çš„ Go é¡¹ç›®ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆå§‹åŒ–å‘½ä»¤è¡Œç¨‹åºäº†ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # åˆå§‹åŒ–ç¨‹åº $ cobra-cli init Your Cobra application is ready at ... # æŸ¥çœ‹ç”Ÿæˆçš„é¡¹ç›®ç›®å½•ç»“æ„ $ tree . . â”œâ”€â”€ LICENSE â”œâ”€â”€ cmd â”‚ â””â”€â”€ root.go â”œâ”€â”€ go.mod â”œâ”€â”€ go.sum â””â”€â”€ main.go 2 directories, 5 files # æ‰§è¡Œå‘½ä»¤è¡Œç¨‹åº $ go run main.go A longer description that spans multiple lines and likely contains examples and usage of using your application. For example: Cobra is a CLI library for Go that empowers applications. This application is a tool to generate the needed files to quickly create a Cobra application. ä½¿ç”¨ cobra-cli åˆå§‹åŒ–ç¨‹åºéå¸¸æ–¹ä¾¿ï¼Œåªéœ€è¦ä¸€ä¸ªç®€å•çš„ init å‘½ä»¤å³å¯å®Œæˆã€‚\nç›®å½•ç»“æ„è·Ÿæˆ‘ä»¬æ‰‹åŠ¨ç¼–å†™çš„ç¨‹åºç›¸åŒï¼Œåªä¸è¿‡å¤šäº†ä¸€ä¸ª LICENSE æ–‡ä»¶ï¼Œç”¨æ¥å­˜æ”¾é¡¹ç›®çš„å¼€æºè®¸å¯è¯ã€‚\né€šè¿‡ go run main.go æ‰§è¡Œè¿™ä¸ªå‘½ä»¤è¡Œç¨‹åºï¼Œå³å¯æ‰“å° rootCmd.Run çš„è¾“å‡ºç»“æœã€‚\nä½¿ç”¨è„šæ‰‹æ¶è‡ªåŠ¨ç”Ÿæˆçš„ cob/main.go æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 /* Copyright Â© 2024 NAME HERE \u0026lt;EMAIL ADDRESS\u0026gt; */ package main import \u0026#34;github.com/arlettebrook/cob/cmd\u0026#34; func main() { cmd.Execute() } è‡ªåŠ¨ç”Ÿæˆçš„ cog/cmd/root.go æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 /* Copyright Â© 2023 NAME HERE \u0026lt;EMAIL ADDRESS\u0026gt; */ package cmd import ( \u0026#34;os\u0026#34; \u0026#34;github.com/spf13/cobra\u0026#34; ) // rootCmd represents the base command when called without any subcommands var rootCmd = \u0026amp;cobra.Command{ Use: \u0026#34;cog\u0026#34;, Short: \u0026#34;A brief description of your application\u0026#34;, Long: `A longer description that spans multiple lines and likely contains examples and usage of using your application. For example: Cobra is a CLI library for Go that empowers applications. This application is a tool to generate the needed files to quickly create a Cobra application.`, // Uncomment the following line if your bare application // has an action associated with it: // Run: func(cmd *cobra.Command, args []string) { }, } // Execute adds all child commands to the root command and sets flags appropriately. // This is called by main.main(). It only needs to happen once to the rootCmd. func Execute() { err := rootCmd.Execute() if err != nil { os.Exit(1) } } func init() { // Here you will define your flags and configuration settings. // Cobra supports persistent flags, which, if defined here, // will be global for your application. // rootCmd.PersistentFlags().StringVar(\u0026amp;cfgFile, \u0026#34;config\u0026#34;, \u0026#34;\u0026#34;, \u0026#34;config file (default is $HOME/.cog.yaml)\u0026#34;) // Cobra also supports local flags, which will only run // when this action is called directly. rootCmd.Flags().BoolP(\u0026#34;toggle\u0026#34;, \u0026#34;t\u0026#34;, false, \u0026#34;Help message for toggle\u0026#34;) } ä»¥ä¸Šä¸¤ä¸ªæ–‡ä»¶è·Ÿæˆ‘ä»¬æ‰‹åŠ¨ç¼–å†™çš„ä»£ç æ²¡ä»€ä¹ˆä¸¤æ ·ï¼Œå¥—è·¯å®Œå…¨ç›¸åŒï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯æ¯ä¸ªæ–‡ä»¶å¤´éƒ¨éƒ½ä¼šå¤šå‡ºæ¥ä¸€ä¸ª Copyright å¤´ä¿¡æ¯ï¼Œç”¨æ¥æ ‡è®°ä»£ç çš„ LICENSEã€‚\n# å¯é€‰æ ‡å¿— cobra-cli æä¾›äº†å¦‚ä¸‹ä¸‰ä¸ªæ ‡å¿—åˆ†åˆ«ç”¨æ¥è®¾ç½®é¡¹ç›®çš„ä½œè€…ã€è®¸å¯è¯ç±»å‹ã€æ˜¯å¦ä½¿ç”¨ Viper ç®¡ç†é…ç½®ã€‚\n1 2 3 $ cobra-cli init --author arlettebrook --license mit --viper Your Cobra application is ready at ... ä»¥ä¸Šå‘½ä»¤æˆ‘ä»¬æŒ‡å®šå¯é€‰æ ‡å¿—åå¯¹é¡¹ç›®è¿›è¡Œäº†é‡æ–°åˆå§‹åŒ–ã€‚\nç°åœ¨ LICENSE æ–‡ä»¶å†…å®¹ä¸å†ä¸ºç©ºï¼Œè€Œæ˜¯ MIT åè®®ã€‚\n1 2 3 4 5 The MIT License (MIT) Copyright Â© 2024 arlettebrook Permission is hereby granted... å¹¶ä¸” Go æ–‡ä»¶ Copyright å¤´ä¿¡æ¯ä¸­ä½œè€…ä¿¡æ¯ä¹Ÿä¼šè¢«è¡¥å…¨ã€‚\n1 2 3 4 5 /* Copyright Â© 2024 arlettebrook ... */ ç¬”è®°ï¼šcobra-cli å‘½ä»¤å†…ç½®å¼€æºè®¸å¯è¯æ”¯æŒ GPLv2ã€GPLv3ã€LGPLã€AGPLã€MITã€2-Clause BSD æˆ– 3-Clause BSDã€‚ä¹Ÿå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£æ¥æŒ‡å®šè‡ªå®šä¹‰è®¸å¯è¯ã€‚\næç¤ºï¼šå¦‚æœä½ å¯¹å¼€æºè®¸å¯è¯ä¸ç†Ÿæ‚‰ï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« ã€ŠOpen Source License Introductionã€‹ã€‚\n# æ·»åŠ å‘½ä»¤ 1 2 3 $ cobra-cli add serve $ cobra-cli add config $ cobra-cli add create -p configCmd --author arlettebrook --license mit --viper è¿™é‡Œåˆ†åˆ«æ·»åŠ äº†ä¸‰ä¸ªå‘½ä»¤ serveã€configã€createï¼Œå‰ä¸¤è€…éƒ½æ˜¯ rootCmd çš„å­å‘½ä»¤ï¼Œcreate å‘½ä»¤åˆ™é€šè¿‡ -p 'configCmd' å‚æ•°æŒ‡å®šä¸º config çš„å­å‘½ä»¤ã€‚\næ³¨æ„âš ï¸ï¼šä½¿ç”¨ -p 'configCmd' æ ‡å¿—æŒ‡å®šå½“å‰å‘½ä»¤çš„çˆ¶å‘½ä»¤æ—¶ï¼ŒconfigCmd å¿…é¡»æ˜¯å°é©¼å³°å‘½åæ³•ï¼Œå› ä¸º cobra-cli ä¸º config ç”Ÿæˆçš„å‘½ä»¤ä»£ç è‡ªåŠ¨å‘½åä¸º configCmdï¼Œè€Œä¸æ˜¯ config_cmd æˆ–å…¶ä»–å½¢å¼ï¼Œè¿™ç¬¦åˆ Go è¯­è¨€å˜é‡å‘½åè§„èŒƒã€‚\nç°åœ¨å‘½ä»¤è¡Œç¨‹åºç›®å½•ç»“æ„å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 $ tree . . â”œâ”€â”€ LICENSE â”œâ”€â”€ cmd â”‚ â”œâ”€â”€ config.go â”‚ â”œâ”€â”€ create.go â”‚ â”œâ”€â”€ root.go â”‚ â””â”€â”€ serve.go â”œâ”€â”€ go.mod â”œâ”€â”€ go.sum â””â”€â”€ main.go 2 directories, 8 files å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ‰§è¡Œå­å‘½ä»¤ï¼š\n1 2 $ go run main.go config create create called å…¶ä»–æ–°æ·»åŠ çš„å‘½ä»¤åŒç†ã€‚\n# ä½¿ç”¨é…ç½®å–ä»£æ ‡å¿— å¦‚æœä½ ä¸æƒ³æ¯æ¬¡ç”Ÿæˆæˆ–æ·»åŠ å‘½ä»¤æ—¶éƒ½æŒ‡å®šé€‰é¡¹å‚æ•°ï¼Œåˆ™å¯ä»¥å®šä¹‰ ~/.cobra.yaml æ–‡ä»¶æ¥ä¿å­˜é…ç½®ä¿¡æ¯ï¼š\n1 2 3 4 author: arlettebrook \u0026lt;arlettebrook@proton.me\u0026gt; year: 2024 license: MIT useViper: true å†æ¬¡ä½¿ç”¨ init å‘½ä»¤åˆå§‹åŒ–ç¨‹åºï¼š\n1 2 $ cobra-cli init Using config file: C:\\Users\\Lenovo\\.cobra.yaml ä¼šæç¤ºä½¿ç”¨äº† ~/.cobra.yaml é…ç½®æ–‡ä»¶ã€‚\nç°åœ¨ LICENSE æ–‡ä»¶å†…å®¹æ ¼å¼å¦‚ä¸‹ï¼š\n1 2 3 4 5 The MIT License (MIT) Copyright Â© 2024 arlettebrook \u0026lt;arlettebrook@proton.me\u0026gt; ... Go æ–‡ä»¶ Copyright å¤´ä¿¡æ¯ä¹Ÿä¼šåŒ…å«æ—¥æœŸã€ç”¨æˆ·åã€ç”¨æˆ·é‚®ç®±ã€‚\n1 2 3 4 5 /* Copyright Â© 2024 arlettebrook \u0026lt;arlettebrook@proton.me\u0026gt; ... */ å¦‚æœä½ ä¸æƒ³æŠŠé…ç½®ä¿å­˜åœ¨ ~/.cobra.yaml ä¸­ï¼Œcobra-cli è¿˜æä¾›äº† --config æ ‡å¿—æ¥æŒ‡å®šä»»æ„ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶ã€‚\nè‡³æ­¤ï¼Œcobra-cli çš„åŠŸèƒ½æˆ‘ä»¬å°±éƒ½è®²è§£å®Œæˆäº†ï¼Œè¿˜æ˜¯éå¸¸æ–¹ä¾¿å®ç”¨çš„ã€‚\n# æ€»ç»“ åœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­ï¼Œç¼–å†™å‘½ä»¤è¡Œç¨‹åºæ˜¯å¿…ä¸å¯å°‘ï¼Œå¾ˆå¤šå¼€æºè½¯ä»¶éƒ½å…·å¤‡å¼ºå¤§çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå¦‚ K8sã€Dockerã€Git ç­‰ã€‚\nä¸€æ¬¾å¤æ‚çš„å‘½ä»¤è¡Œç¨‹åºé€šå¸¸æœ‰ä¸Šç™¾ç§ä½¿ç”¨ç»„åˆï¼Œæ‰€ä»¥å¦‚ä½•ç»„ç»‡å’Œç¼–å†™å‡ºå¥½ç”¨çš„å‘½ä»¤è¡Œç¨‹åºæ˜¯å¾ˆè€ƒéªŒå¼€å‘è€…åŠŸåº•çš„ï¼Œè€Œ Cobra åˆ™ä¸ºæˆ‘ä»¬å¼€å‘å‘½ä»¤è¡Œç¨‹åºæä¾›äº†è¶³å¤Ÿçš„ä¾¿åˆ©ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘å°†å…¶ç§°ä¸ºå‘½ä»¤è¡Œæ¡†æ¶ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸€ä¸ª Go ç¬¬ä¸‰æ–¹åº“ã€‚\nCobra åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œè¦ä½¿ç”¨å®ƒæ¥ç¼–å†™å‘½ä»¤è¡Œç¨‹åºé¦–å…ˆè¦æ˜ç™½ä¸‰ä¸ªæ¦‚å¿µï¼šå‘½ä»¤ã€å‚æ•°å’Œæ ‡å¿—ã€‚\nCobra ä¸ä»…æ”¯æŒå­å‘½ä»¤ï¼Œè¿˜èƒ½å¤Ÿå®Œç¾å…¼å®¹ pflag å’Œ Viper åŒ…ï¼Œå› ä¸ºè¿™ä¸‰ä¸ªåŒ…éƒ½æ˜¯åŒä¸€ä¸ªä½œè€…å¼€å‘çš„ã€‚å…³äºæ ‡å¿—ï¼ŒCobra æ”¯æŒæŒä¹…æ ‡å¿—ã€æœ¬åœ°æ ‡å¿—ä»¥åŠå°†æ ‡å¿—æ ‡è®°ä¸ºå¿…é€‰ã€‚Cobra å¯ä»¥å°†æ ‡å¿—ç»‘å®šåˆ° Viperï¼Œæ–¹ä¾¿ä½¿ç”¨ viper.Get() æ¥è·å–æ ‡å¿—çš„å€¼ã€‚å¯¹äºå‘½ä»¤è¡Œå‚æ•°ï¼ŒCobra æä¾›äº†ä¸å°‘éªŒè¯å‡½æ•°ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰éªŒè¯å‡½æ•°ã€‚\nCobra è¿˜æä¾›äº†å‡ ä¸ª Hooks å‡½æ•° PersistentPreRunã€PreRunã€PostRunã€PersistentPostRunï¼Œå¯ä»¥åˆ†åˆ«åœ¨æ‰§è¡Œ Run å‰åæ¥å¤„ç†ä¸€æ®µé€»è¾‘ã€‚\nå¦‚æœè§‰å¾— Cobra æä¾›çš„é»˜è®¤å¸®åŠ©ä¿¡æ¯ä¸èƒ½æ»¡è¶³éœ€æ±‚ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å®šä¹‰è‡ªå·±çš„ Help å‘½ä»¤å’Œ Usage Messageï¼Œéå¸¸çµæ´»ã€‚\nCobra è¿˜æ”¯æŒæœªçŸ¥å‘½ä»¤çš„æ™ºèƒ½æç¤ºåŠŸèƒ½ä»¥åŠ Shell è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ï¼Œæ­¤å¤–ï¼Œå®ƒè¿˜æ”¯æŒè‡ªåŠ¨ç”Ÿæˆ Markdownã€ReStructured Textã€Man Page ä¸‰ç§æ ¼å¼çš„æ–‡æ¡£ã€‚è¿™å¯¹å‘½ä»¤è¡Œå·¥å…·çš„ä½¿ç”¨è€…æ¥è¯´éå¸¸å‹å¥½ï¼Œè¿˜èƒ½æå¤§å‡å°‘å¼€å‘è€…çš„å·¥ä½œé‡ã€‚\næœ€åï¼ŒCobra çš„å‘½ä»¤è¡Œå·¥å…· cobra-cli è¿›ä¸€æ­¥æé«˜äº†ç¼–å†™å‘½ä»¤è¡Œç¨‹åºçš„æ•ˆç‡ï¼Œéå¸¸æ¨èä½¿ç”¨ã€‚\næœ¬æ–‡å®Œæ•´ ä»£ç  (å‚è€ƒ@jianghushinianï¼‰ï¼Œæ¬¢è¿ç‚¹å‡»æŸ¥çœ‹ã€‚\n# å‚è€ƒ Cobra å®˜ç½‘ï¼šhttps://cobra.dev/ Cobra æºç ï¼šhttps://github.com/spf13/cobra Cobra æ–‡æ¡£ï¼šhttps://pkg.go.dev/github.com/spf13/cobra Cobra-CLI æ–‡æ¡£ï¼šhttps://github.com/spf13/cobra-cli/blob/main/README.md åŸæ–‡åœ°å€ï¼šGo è¯­è¨€ç°ä»£å‘½ä»¤è¡Œæ¡†æ¶ Cobra è¯¦è§£ ","date":"2024-05-02T23:33:49+08:00","permalink":"https://arlettebrook.github.io/p/go%E6%9E%84%E5%BB%BA%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%A8%8B%E5%BA%8F%E4%B9%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93cobra/","title":"Goæ„å»ºå‘½ä»¤è¡Œç¨‹åºä¹‹ç¬¬ä¸‰æ–¹åº“cobra"},{"content":" åœ¨ä½¿ç”¨ Go è¿›è¡Œå¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œå‘½ä»¤è¡Œå‚æ•°è§£ææ˜¯æˆ‘ä»¬ç»å¸¸é‡åˆ°çš„éœ€æ±‚ã€‚å°½ç®¡ Go æ ‡å‡†åº“æä¾›äº† flag åŒ…ç”¨äºå®ç°å‘½ä»¤è¡Œå‚æ•°è§£æï¼Œä½†åªèƒ½æ»¡è¶³åŸºæœ¬éœ€è¦ï¼Œä¸æ”¯æŒé«˜çº§ç‰¹æ€§ã€‚äºæ˜¯ Go ç¤¾åŒºä¸­å‡ºç°äº†ä¸€ä¸ªå« pflag çš„ç¬¬ä¸‰æ–¹åŒ…ï¼ŒåŠŸèƒ½æ›´åŠ å…¨é¢ä¸”è¶³å¤Ÿå¼ºå¤§ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¹¶æŒæ¡å¦‚ä½•ä½¿ç”¨ pflagã€‚\n# ç‰¹ç‚¹ pflag ä½œä¸º Go å†…ç½® flag åŒ…çš„æ›¿ä»£å“ï¼Œå…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š\nå®ç°äº† POSIX/GNU é£æ ¼çš„ â€“flagsã€‚ pflag ä¸ã€ŠThe GNU C Libraryã€‹ ä¸­ã€Œ25.1.1 ç¨‹åºå‚æ•°è¯­æ³•çº¦å®šã€ç« èŠ‚ä¸­ POSIX å»ºè®®è¯­æ³•å…¼å®¹ã€‚ å…¼å®¹ Go æ ‡å‡†åº“ä¸­çš„ flag åŒ…ã€‚å¦‚æœç›´æ¥ä½¿ç”¨ flag åŒ…å®šä¹‰çš„å…¨å±€ FlagSet å¯¹è±¡ CommandLineï¼Œåˆ™å®Œå…¨å…¼å®¹ï¼›å¦åˆ™å½“ä½ æ‰‹åŠ¨å®ä¾‹åŒ–äº† FlagSet å¯¹è±¡ï¼Œè¿™æ—¶å°±éœ€è¦ä¸ºæ¯ä¸ªæ ‡å¿—è®¾ç½®ä¸€ä¸ªç®€çŸ­æ ‡å¿—ï¼ˆShorthandï¼‰ã€‚ # ä½¿ç”¨ # åŸºæœ¬ç”¨æ³• å®‰è£…\n1 go get -u github.com/spf13/pflag å¯¼å…¥\n1 import \u0026#34;github.com/spf13/pflag\u0026#34; ä½¿ç”¨\næˆ‘ä»¬å¯ä»¥åƒä½¿ç”¨ Go æ ‡å‡†åº“ä¸­çš„ flag åŒ…ä¸€æ ·ä½¿ç”¨ pflagã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/spf13/pflag\u0026#34; ) type host struct { value string } func (h *host) String() string { return h.value } func (h *host) Set(v string) error { h.value = v return nil } func (h *host) Type() string { return \u0026#34;host\u0026#34; } func main() { var ip *int = pflag.Int(\u0026#34;ip\u0026#34;, 1234, \u0026#34;help message for ip\u0026#34;) var port int pflag.IntVar(\u0026amp;port, \u0026#34;port\u0026#34;, 8080, \u0026#34;help message for port\u0026#34;) var h host pflag.Var(\u0026amp;h, \u0026#34;host\u0026#34;, \u0026#34;help message for host\u0026#34;) // è§£æå‘½ä»¤è¡Œå‚æ•° pflag.Parse() fmt.Printf(\u0026#34;ip: %d\\n\u0026#34;, *ip) fmt.Printf(\u0026#34;port: %d\\n\u0026#34;, port) fmt.Printf(\u0026#34;host: %+v\\n\u0026#34;, h) fmt.Printf(\u0026#34;NFlag: %v\\n\u0026#34;, pflag.NFlag()) // è¿”å›å·²è®¾ç½®çš„å‘½ä»¤è¡Œæ ‡å¿—ä¸ªæ•° fmt.Printf(\u0026#34;NArg: %v\\n\u0026#34;, pflag.NArg()) // è¿”å›å¤„ç†å®Œæ ‡å¿—åå‰©ä½™çš„å‚æ•°ä¸ªæ•° fmt.Printf(\u0026#34;Args: %v\\n\u0026#34;, pflag.Args()) // è¿”å›å¤„ç†å®Œæ ‡å¿—åå‰©ä½™çš„å‚æ•°åˆ—è¡¨ fmt.Printf(\u0026#34;Arg(1): %v\\n\u0026#34;, pflag.Arg(1)) // è¿”å›å¤„ç†å®Œæ ‡å¿—åå‰©ä½™çš„å‚æ•°åˆ—è¡¨ä¸­ç¬¬ i é¡¹ } ä»¥ä¸Šç¤ºä¾‹æ¼”ç¤ºçš„ pflag ç”¨æ³•è·Ÿ flag åŒ…ç”¨æ³•ä¸€è‡´ï¼Œå¯ä»¥åšåˆ°äºŒè€…æ— ç¼æ›¿æ¢ã€‚\nç¤ºä¾‹åˆ†åˆ«ä½¿ç”¨ pflag.Int()ã€pflag.IntVar()ã€pflag.Var() ä¸‰ç§ä¸åŒæ–¹å¼æ¥å£°æ˜æ ‡å¿—ã€‚å…¶ä¸­ ip å’Œ port éƒ½æ˜¯ int ç±»å‹æ ‡å¿—ï¼Œhost æ ‡å¿—åˆ™ä¸ºè‡ªå®šä¹‰çš„ host ç±»å‹ï¼Œå®ƒå®ç°äº† pflag.Value æ¥å£ï¼Œé€šè¿‡å®ç°æ¥å£ç±»å‹ï¼Œæ ‡å¿—èƒ½å¤Ÿæ”¯æŒä»»æ„ç±»å‹ï¼Œå¢åŠ çµæ´»æ€§ã€‚\né€šè¿‡ --help/-h å‚æ•°æŸ¥çœ‹å‘½ä»¤è¡Œç¨‹åºä½¿ç”¨å¸®åŠ©ï¼š\n1 2 3 4 5 6 7 $ go run main.go --help Usage of ./main: --host host help message for host --ip int help message for ip (default 1234) --port int help message for port (default 8080) pflag: help requested exit status 2 å¯ä»¥å‘ç°ï¼Œå¸®åŠ©ä¿¡æ¯ä¸­çš„æ ‡å¿—ä½ç½®æ˜¯ç»è¿‡é‡æ–°æ’åºçš„ï¼Œå¹¶ä¸æ˜¯æ ‡å¿—å®šä¹‰çš„é¡ºåºã€‚\nä¸ flag åŒ…ä¸åŒçš„æ˜¯ï¼Œpflag åŒ…å‚æ•°å®šç•Œç¬¦æ˜¯ä¸¤ä¸ª -ï¼Œè€Œä¸æ˜¯ä¸€ä¸ª -ï¼Œåœ¨ pflag ä¸­ -- å’Œ - å…·æœ‰ä¸åŒå«ä¹‰ï¼Œè¿™ç‚¹ç¨åä¼šè¿›è¡Œä»‹ç»ã€‚\nip æ ‡å¿—çš„é»˜è®¤å‚æ•°ä¸º 1234ï¼Œport æ ‡å¿—çš„é»˜è®¤å‚æ•°ä¸º 8080ã€‚\næ³¨æ„ï¼šåœ¨æœ‰äº›ç»ˆç«¯ä¸‹æ‰§è¡Œç¨‹åºé€€å‡ºåï¼Œè¿˜ä¼šå¤šæ‰“å°ä¸€è¡Œ exit status 2ï¼Œè¿™å¹¶ä¸æ„å‘³ç€ç¨‹åºæ²¡æœ‰æ­£å¸¸é€€å‡ºï¼Œè€Œæ˜¯å› ä¸º --help æ„å›¾å°±æ˜¯ç”¨æ¥æŸ¥çœ‹ä½¿ç”¨å¸®åŠ©ï¼Œæ‰€ä»¥ç¨‹åºåœ¨æ‰“å°ä½¿ç”¨å¸®åŠ©ä¿¡æ¯åï¼Œä¸»åŠ¨è°ƒç”¨ os.Exit(2) é€€å‡ºäº†ã€‚\né€šè¿‡å¦‚ä¸‹æ–¹å¼ä½¿ç”¨å‘½ä»¤è¡Œç¨‹åºï¼š\n1 2 3 4 5 6 7 8 $ go run main.go --ip 1 x y --host localhost a b ip: 1 port: 8080 host: {value:localhost} NFlag: 2 NArg: 4 Args: [x y a b] Arg(1): y ip æ ‡å¿—çš„é»˜è®¤å€¼å·²è¢«å‘½ä»¤è¡Œå‚æ•° 1 æ‰€è¦†ç›–ï¼Œç”±äºæ²¡æœ‰ä¼ é€’ port æ ‡å¿—ï¼Œæ‰€ä»¥æ‰“å°ç»“æœä¸ºé»˜è®¤å€¼ 8080ï¼Œhost æ ‡å¿—çš„å€¼ä¹Ÿèƒ½å¤Ÿè¢«æ­£å¸¸æ‰“å°ã€‚\nè¿˜æœ‰ 4 ä¸ªéé€‰é¡¹å‚æ•°æ•° xã€yã€aã€b ä¹Ÿéƒ½è¢« pflag è¯†åˆ«å¹¶è®°å½•äº†ä¸‹æ¥ã€‚è¿™ç‚¹æ¯” flag è¦å¼ºå¤§ï¼Œåœ¨ flag åŒ…ä¸­ï¼Œéé€‰é¡¹å‚æ•°æ•°åªèƒ½å†™åœ¨æ‰€æœ‰å‘½ä»¤è¡Œå‚æ•°æœ€åï¼Œxã€y å‡ºç°åœ¨è¿™é‡Œç¨‹åºæ˜¯ä¼šæŠ¥é”™çš„ã€‚\n# è¿›é˜¶ç”¨æ³• é™¤äº†åƒ flag åŒ…ä¸€æ ·çš„ç”¨æ³•ï¼Œpflag è¿˜æ”¯æŒä¸€äº›ç‹¬æœ‰çš„ç”¨æ³•ï¼Œä»¥ä¸‹æ˜¯ç”¨æ³•ç¤ºä¾‹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;os\u0026#34; \u0026#34;github.com/spf13/pflag\u0026#34; ) type host struct { value string } func (h *host) String() string { return h.value } func (h *host) Set(v string) error { h.value = v return nil } func (h *host) Type() string { return \u0026#34;host\u0026#34; } func main() { flagSet := pflag.NewFlagSet(\u0026#34;test\u0026#34;, pflag.ExitOnError) var ip = flagSet.IntP(\u0026#34;ip\u0026#34;, \u0026#34;i\u0026#34;, 1234, \u0026#34;help message for ip\u0026#34;) var boolVar bool flagSet.BoolVarP(\u0026amp;boolVar, \u0026#34;boolVar\u0026#34;, \u0026#34;b\u0026#34;, true, \u0026#34;help message for boolVar\u0026#34;) var h host flagSet.VarP(\u0026amp;h, \u0026#34;host\u0026#34;, \u0026#34;H\u0026#34;, \u0026#34;help message for host\u0026#34;) flagSet.SortFlags = false parseErr := flagSet.Parse(os.Args[1:]) if parseErr != nil { log.Fatal(\u0026#34;è§£æå‘½ä»¤è¡Œå‚æ•°å‡ºé”™ï¼š\u0026#34;, parseErr) } fmt.Printf(\u0026#34;ip: %d\\n\u0026#34;, *ip) fmt.Printf(\u0026#34;boolVar: %t\\n\u0026#34;, boolVar) fmt.Printf(\u0026#34;host: %#v\\n\u0026#34;, h) i, err := flagSet.GetInt(\u0026#34;ip\u0026#34;) fmt.Printf(\u0026#34;i: %d, err: %v\\n\u0026#34;, i, err) } é¦–å…ˆæˆ‘ä»¬é€šè¿‡ pflag.NewFlagSet è‡ªå®šä¹‰äº† FlagSet å¯¹è±¡ flagsetï¼Œä¹‹åçš„æ ‡å¿—å®šä¹‰å’Œè§£æéƒ½é€šè¿‡ flagset æ¥å®Œæˆã€‚\nå‰æ–‡ç¤ºä¾‹ä¸­ pflag.Int() è¿™ç§ç”¨æ³•ï¼Œå®é™…ä¸Šä½¿ç”¨çš„æ˜¯å…¨å±€ FlagSet å¯¹è±¡ CommandLineï¼ŒCommandLine å®šä¹‰å¦‚ä¸‹ï¼š\n1 var CommandLine = NewFlagSet(os.Args[0], ExitOnError) ç°åœ¨åŒæ ·ä½¿ç”¨ä¸‰ç§ä¸åŒæ–¹å¼æ¥å£°æ˜æ ‡å¿—ï¼Œåˆ†åˆ«ä¸º flagset.IntP()ã€flagset.BoolVarP()ã€flagset.VarP()ã€‚ä¸éš¾å‘ç°ï¼Œè¿™ä¸‰ä¸ªæ–¹æ³•çš„å‘½åç»“å°¾éƒ½å¤šäº†ä¸€ä¸ª Pï¼Œå®ƒä»¬çš„èƒ½åŠ›ä¹Ÿå¾—ä»¥å‡çº§ï¼Œä¸‰ä¸ªæ–¹æ³•éƒ½å¤šäº†ä¸€ä¸ª shorthand string å‚æ•°ï¼ˆflagset.IntP çš„ç¬¬ 2 ä¸ªå‚æ•°ï¼Œflagset.BoolVarP å’Œ flagset.VarP çš„ç¬¬ 3 ä¸ªå‚æ•°ï¼‰ç”¨æ¥è®¾ç½®ç®€çŸ­æ ‡å¿—ã€‚\nä»å£°æ˜æ ‡å¿—çš„æ–¹æ³•åä¸­æˆ‘ä»¬èƒ½å¤Ÿæ€»ç»“å‡ºä¸€äº›è§„å¾‹ï¼š\npflag.\u0026lt;Type\u0026gt; ç±»æ–¹æ³•åä¼šå°†æ ‡å¿—å‚æ•°å€¼å­˜å‚¨åœ¨æŒ‡é’ˆä¸­å¹¶è¿”å›ã€‚ pflag.\u0026lt;Type\u0026gt;Var ç±»æ–¹æ³•åä¸­åŒ…å« Var å…³é”®å­—çš„ï¼Œä¼šå°†æ ‡å¿—å‚æ•°å€¼ç»‘å®šåˆ°ç¬¬ä¸€ä¸ªæŒ‡é’ˆç±»å‹çš„å‚æ•°ã€‚ pflag.\u0026lt;Type\u0026gt;Pã€pflag.\u0026lt;Type\u0026gt;VarP ç±»æ–¹æ³•åä»¥ P ç»“å°¾çš„ï¼Œæ”¯æŒç®€çŸ­æ ‡å¿—ã€‚ ä¸€ä¸ªå®Œæ•´æ ‡å¿—åœ¨å‘½ä»¤è¡Œä¼ å‚æ—¶ä½¿ç”¨çš„åˆ†ç•Œç¬¦ä¸º --ï¼Œè€Œä¸€ä¸ªç®€çŸ­æ ‡å¿—çš„åˆ†ç•Œç¬¦åˆ™ä¸º -ã€‚\nflagset.SortFlags = false ä½œç”¨æ˜¯ç¦æ­¢æ‰“å°å¸®åŠ©ä¿¡æ¯æ—¶å¯¹æ ‡å¿—è¿›è¡Œé‡æ’åºã€‚\nç¤ºä¾‹æœ€åï¼Œä½¿ç”¨ flagset.GetInt() è·å–å‚æ•°çš„å€¼ã€‚\né€šè¿‡ --help/-h å‚æ•°æŸ¥çœ‹å‘½ä»¤è¡Œç¨‹åºä½¿ç”¨å¸®åŠ©ï¼š\n1 2 3 4 5 6 7 $ go run main.go --help Usage of test: -i, --ip int help message for ip (default 1234) -b, --boolVar help message for boolVar (default true) -H, --host host help message for host pflag: help requested exit status 2 è¿™æ¬¡çš„å¸®åŠ©ä¿¡æ¯ä¸­ï¼Œæ ‡å¿—é¡ºåºæ²¡æœ‰è¢«æ”¹å˜ï¼Œå°±æ˜¯å£°æ˜çš„é¡ºåºã€‚\næ¯ä¸€ä¸ªæ ‡å¿—éƒ½ä¼šå¯¹åº”ä¸€ä¸ªç®€çŸ­æ ‡å¿—ï¼Œå¦‚ -b å’Œ --boolVar æ˜¯ç­‰ä»·çš„ï¼Œå¯ä»¥æ›´åŠ æ–¹ä¾¿çš„è®¾ç½®å‚æ•°ã€‚\næŒ‡å®šå¦‚ä¸‹å‘½ä»¤è¡Œå‚æ•°è¿è¡Œç¤ºä¾‹ï¼š\n1 2 3 4 5 $ go run main.go --ip 1 -H localhost --boolVar=false ip: 1 boolVar: false host: main.host{value:\u0026#34;localhost\u0026#34;} i: 1, err: \u0026lt;nil\u0026gt; é€šè¿‡ --ip 1 ä½¿ç”¨å®Œæ•´æ ‡å¿—æŒ‡å®š ip å‚æ•°å€¼ã€‚\né€šè¿‡ -H localhost ä½¿ç”¨ç®€çŸ­æ ‡å¿—æŒ‡å®š host å‚æ•°å€¼ã€‚\nå¸ƒå°”ç±»å‹çš„æ ‡å¿—æŒ‡å®šå‚æ•° --boolVar=false éœ€è¦ä½¿ç”¨ç­‰å· = è€Œéç©ºæ ¼ã€‚\n# å‘½ä»¤è¡Œæ ‡å¿—è¯­æ³• å‘½ä»¤è¡Œæ ‡å¿—éµå¾ªå¦‚ä¸‹è¯­æ³•ï¼š\nè¯­æ³• è¯´æ˜ --flag é€‚ç”¨äº bool ç±»å‹æ ‡å¿—ï¼Œæˆ–å…·æœ‰ NoOptDefVal å±æ€§çš„æ ‡å¿—ã€‚ --flag x é€‚ç”¨äºé bool ç±»å‹æ ‡å¿—ï¼Œæˆ–æ²¡æœ‰ NoOptDefVal å±æ€§çš„æ ‡å¿—ã€‚ --flag=x é€‚ç”¨äº bool ç±»å‹æ ‡å¿—ã€‚ -n 1234/-n=1234/-n1234 ç®€çŸ­æ ‡å¿—ï¼Œé bool ç±»å‹ä¸”æ²¡æœ‰ NoOptDefVal å±æ€§ï¼Œä¸‰è€…ç­‰ä»·ã€‚ æ ‡å¿—è§£æåœ¨ç»ˆæ­¢ç¬¦ -- ä¹‹ååœæ­¢ã€‚\næ•´æ•°æ ‡å¿—æ¥å— 1234ã€0664ã€0x1234ï¼Œå¹¶ä¸”å¯èƒ½ä¸ºè´Ÿæ•°ã€‚\nå¸ƒå°”æ ‡å¿—æ¥å— 1, 0, t, f, true, false, TRUE, FALSE, True, Falseã€‚\nDuration æ ‡å¿—æ¥å—ä»»ä½•å¯¹ time.ParseDuration æœ‰æ•ˆçš„è¾“å…¥ã€‚\n# æ ‡å¿—å Normalize æ ‡å‡†åŒ–Normalize\nå€ŸåŠ© pflag.NormalizedName æˆ‘ä»¬èƒ½å¤Ÿç»™æ ‡å¿—èµ·ä¸€ä¸ªæˆ–å¤šä¸ªåˆ«åã€è§„èŒƒåŒ–æ ‡å¿—åç­‰ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;os\u0026#34; \u0026#34;strings\u0026#34; \u0026#34;github.com/spf13/pflag\u0026#34; ) func normalizeFunc(f *pflag.FlagSet, name string) pflag.NormalizedName { // alias switch name { case \u0026#34;old-flag-name\u0026#34;: name = \u0026#34;new-flag-name\u0026#34; break } // --my-flag == --my_flag == --my.flag from := []string{\u0026#34;-\u0026#34;, \u0026#34;_\u0026#34;} to := \u0026#34;.\u0026#34; for _, sep := range from { name = strings.Replace(name, sep, to, -1) } return pflag.NormalizedName(name) } func main() { flagSet := pflag.NewFlagSet(\u0026#34;test\u0026#34;, pflag.ExitOnError) var ip = flagSet.IntP(\u0026#34;new-flag-name\u0026#34;, \u0026#34;i\u0026#34;, 1234, \u0026#34;help message for new-flag-name\u0026#34;) var myFlag = flagSet.IntP(\u0026#34;my-flag\u0026#34;, \u0026#34;m\u0026#34;, 1234, \u0026#34;help message for my-flag\u0026#34;) flagSet.SetNormalizeFunc(normalizeFunc) err := flagSet.Parse(os.Args[1:]) if err != nil { log.Fatal(\u0026#34;å‘½ä»¤è¡Œå‚æ•°è§£æå¤±è´¥ï¼š\u0026#34;, err) } fmt.Printf(\u0026#34;ip: %d\\n\u0026#34;, *ip) fmt.Printf(\u0026#34;myFlag: %d\\n\u0026#34;, *myFlag) } è¦ä½¿ç”¨ pflag.NormalizedNameï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå‡½æ•° normalizeFuncï¼Œç„¶åå°†å…¶é€šè¿‡ flagset.SetNormalizeFunc(normalizeFunc) æ³¨å…¥åˆ° flagset ä½¿å…¶ç”Ÿæ•ˆã€‚\nåœ¨ normalizeFunc å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ç»™ new-flag-name æ ‡å¿—èµ·äº†ä¸€ä¸ªåˆ«å old-flag-nameã€‚\nå¦å¤–ï¼Œè¿˜å¯¹æ ‡å¿—åè¿›è¡Œäº†è§„èŒƒåŒ–å¤„ç†ï¼Œå¸¦æœ‰ - å’Œ _ åˆ†å‰²ç¬¦çš„æ ‡å¿—åï¼Œä¼šç»Ÿä¸€è§„èŒƒåŒ–æˆä»¥ . ä½œä¸ºåˆ†éš”ç¬¦çš„æ ‡å¿—åã€‚\nä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 $ go run pflag.go --old-flag-name 2 --my-flag 200 ip: 2 myFlag: 200 $ go run pflag.go --new-flag-name 3 --my_flag 300 ip: 3 myFlag: 300 $ go run pflag.go --new-flag_name 2 --my.flag 200 ip: 2 myFlag: 200 # NoOptDefVal NoOptDefVal æ˜¯ no option default values çš„ç®€å†™ã€‚\nåˆ›å»ºæ ‡å¿—åï¼Œå¯ä»¥ä¸ºæ ‡å¿—è®¾ç½® NoOptDefVal å±æ€§ï¼Œå¦‚æœæ ‡å¿—å…·æœ‰ NoOptDefVal å±æ€§å¹¶ä¸”åœ¨å‘½ä»¤è¡Œä¸Šè®¾ç½®äº†æ ‡å¿—è€Œæ²¡æœ‰å‚æ•°é€‰é¡¹ï¼Œåˆ™æ ‡å¿—å°†è®¾ç½®ä¸º NoOptDefVal æŒ‡å®šçš„å€¼ã€‚\nå¦‚ä¸‹ç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/spf13/pflag\u0026#34; ) func main() { var ip = pflag.IntP(\u0026#34;flagName\u0026#34;, \u0026#34;f\u0026#34;, 1234, \u0026#34;help message\u0026#34;) pflag.Lookup(\u0026#34;flagName\u0026#34;).NoOptDefVal = \u0026#34;4321\u0026#34; pflag.Parse() fmt.Println(*ip) } ä¸åŒå‚æ•°ç»“æœå¦‚ä¸‹ï¼š\nå‘½ä»¤è¡Œå‚æ•° ç»“æœå€¼ â€“flagname=1357 ip=1357 â€“flagname ip=4321 [nothing] ip=1234 1 2 3 4 5 var ip = pflag.BoolP(\u0026#34;flagName\u0026#34;, \u0026#34;f\u0026#34;, false, \u0026#34;help message\u0026#34;) //pflag.Lookup(\u0026#34;flagName\u0026#34;).NoOptDefVal = \u0026#34;false\u0026#34; pflag.Parse() fmt.Println(*ip) boolç±»å‹çš„NoOptDefValueé»˜è®¤å€¼æ˜¯trueï¼Œå¯ä»¥ä¿®æ”¹ä¸ºfalse\n1 2 $ go run main.go -f true # å¼ƒç”¨/éšè—æ ‡å¿— ä½¿ç”¨ flags.MarkDeprecated å¯ä»¥å¼ƒç”¨ä¸€ä¸ªæ ‡å¿—ï¼Œä½¿ç”¨ flags.MarkShorthandDeprecated å¯ä»¥å¼ƒç”¨ä¸€ä¸ªç®€çŸ­æ ‡å¿—ï¼Œä½¿ç”¨ flags.MarkHidden å¯ä»¥éšè—ä¸€ä¸ªæ ‡å¿—ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;os\u0026#34; \u0026#34;github.com/spf13/pflag\u0026#34; ) func main() { flags := pflag.NewFlagSet(\u0026#34;test\u0026#34;, pflag.ExitOnError) var ip = flags.IntP(\u0026#34;ip\u0026#34;, \u0026#34;i\u0026#34;, 1234, \u0026#34;help message for ip\u0026#34;) var boolVar bool flags.BoolVarP(\u0026amp;boolVar, \u0026#34;boolVar\u0026#34;, \u0026#34;b\u0026#34;, true, \u0026#34;help message for boolVar\u0026#34;) var h string flags.StringVarP(\u0026amp;h, \u0026#34;host\u0026#34;, \u0026#34;H\u0026#34;, \u0026#34;127.0.0.1\u0026#34;, \u0026#34;help message for host\u0026#34;) // å¼ƒç”¨æ ‡å¿— _ = flags.MarkDeprecated(\u0026#34;ip\u0026#34;, \u0026#34;deprecated\u0026#34;) _ = flags.MarkShorthandDeprecated(\u0026#34;boolVar\u0026#34;, \u0026#34;please use --boolVar only\u0026#34;) // éšè—æ ‡å¿— _ = flags.MarkHidden(\u0026#34;host\u0026#34;) err := flags.Parse(os.Args[1:]) if err != nil { log.Fatalln(\u0026#34;è§£æå‘½ä»¤è¡Œå‡ºé”™äº†ï¼š\u0026#34;, err) } fmt.Printf(\u0026#34;ip: %d\\n\u0026#34;, *ip) fmt.Printf(\u0026#34;boolVar: %t\\n\u0026#34;, boolVar) fmt.Printf(\u0026#34;host: %+v\\n\u0026#34;, h) } æŸ¥çœ‹ä½¿ç”¨å¸®åŠ©ï¼š\n1 2 3 4 5 $ go run main.go -h Usage of test: --boolVar help message for boolVar (default true) pflag: help requested exit status 2 ä»æ‰“å°ç»“æœå¯ä»¥å‘ç°ï¼Œå¼ƒç”¨æ ‡å¿— ip æ—¶ï¼Œå…¶å¯¹åº”çš„ç®€çŸ­æ ‡å¿— i ä¹Ÿä¼šè·Ÿç€è¢«å¼ƒç”¨ï¼›å¼ƒç”¨ boolVar æ‰€å¯¹åº”çš„ç®€çŸ­æ ‡å¿— b æ—¶ï¼ŒboolVar æ ‡å¿—ä¼šè¢«ä¿ç•™ï¼›host æ ‡å¿—åˆ™å®Œå…¨è¢«éšè—ã€‚\næŒ‡å®šå¦‚ä¸‹å‘½ä»¤è¡Œå‚æ•°è¿è¡Œç¤ºä¾‹ï¼š\n1 2 3 4 5 $ go run main.go --ip 1 --boolVar=false -H localhost Flag --ip has been deprecated, deprecated ip: 1 boolVar: false host: localhost æ‰“å°ä¿¡æ¯ä¸­ä¼šæç¤ºç”¨æˆ· ip æ ‡å¿—å·²ç»å¼ƒç”¨ï¼Œä¸è¿‡ä½¿ç”¨ --ip 1 æŒ‡å®šçš„å‚æ•°å€¼ä¾ç„¶èƒ½å¤Ÿç”Ÿæ•ˆã€‚\néšè—çš„ host æ ‡å¿—ä½¿ç”¨ -H localhost æŒ‡å®šå‚æ•°å€¼åŒæ ·èƒ½å¤Ÿç”Ÿæ•ˆã€‚\næŒ‡å®šå¦‚ä¸‹å‘½ä»¤è¡Œå‚æ•°è¿è¡Œç¤ºä¾‹ï¼š\n1 2 3 4 5 6 $ go run main.go -i 1 -b=false --host localhost Flag --ip has been deprecated, deprecated Flag shorthand -b has been deprecated, please use --boolVar only ip: 1 boolVar: false host: localhost æ‰“å°ä¿¡æ¯ä¸­å¢åŠ äº†ä¸€æ¡ç®€çŸ­æ ‡å¿— -b å·²è¢«å¼ƒç”¨çš„æç¤ºï¼ŒæŒ‡å®šå‚æ•°å€¼ä¾ç„¶ç”Ÿæ•ˆã€‚\nå¯¹äºå¼ƒç”¨çš„ ip æ ‡å¿—ï¼Œä½¿ç”¨ç®€çŸ­æ ‡å¿—å½¢å¼ä¼ æƒ¨ -i 1 åŒæ ·ç”Ÿæ•ˆã€‚\n# æ”¯æŒ flag ç±»å‹ ç”±äº pflag å¯¹ flag åŒ…å…¼å®¹ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ä¸€ä¸ªç¨‹åºä¸­æ··ç”¨äºŒè€…ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 package main import ( \u0026#34;flag\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;github.com/spf13/pflag\u0026#34; ) func main() { var ip *int = pflag.Int(\u0026#34;ip\u0026#34;, 1234, \u0026#34;help message for ip\u0026#34;) var port *int = flag.Int(\u0026#34;port\u0026#34;, 80, \u0026#34;help message for port\u0026#34;) pflag.CommandLine.AddGoFlagSet(flag.CommandLine) pflag.Parse() fmt.Printf(\u0026#34;ip: %d\\n\u0026#34;, *ip) fmt.Printf(\u0026#34;port: %d\\n\u0026#34;, *port) } å…¶ä¸­ï¼Œip æ ‡å¿—æ˜¯ä½¿ç”¨ pflag.Int() å£°æ˜çš„ï¼Œport æ ‡å¿—åˆ™æ˜¯ä½¿ç”¨ flag.Int() å£°æ˜çš„ã€‚åªéœ€è¦é€šè¿‡ AddGoFlagSet æ–¹æ³•å°† flag.CommandLine æ³¨å†Œåˆ° pflag ä¸­ï¼Œé‚£ä¹ˆ pflag å°±å¯ä»¥ä½¿ç”¨ flag ä¸­å£°æ˜çš„æ ‡å¿—é›†åˆäº†ã€‚\nè¿è¡Œç¤ºä¾‹ç»“æœå¦‚ä¸‹ï¼š\n1 2 3 $ go run main.go --ip 10 --port 8000 ip: 10 port: 8000 # æ€»ç»“ æœ¬æ–‡ä¸»è¦ä»‹ç»äº† Goç¬¬ä¸‰æ–¹æ ‡å¿—åŒ… pflag çš„ç‰¹ç‚¹åŠç”¨æ³•ã€‚\né¦–å…ˆä»‹ç»äº† pflag çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•ï¼ŒåŒ…æ‹¬å£°æ˜æ ‡å¿—ã€è§£æå‘½ä»¤è¡Œå‚æ•°ã€è·å–æ ‡å¿—å€¼ç­‰ã€‚æ¥ç€ä»‹ç»äº† pflag çš„è¿›é˜¶ç”¨æ³•ï¼Œä¾‹å¦‚è‡ªå®šä¹‰ FlagSetã€ä½¿ç”¨ pflag.\u0026lt;Type\u0026gt;P æ–¹æ³•æ¥æ”¯æŒç®€çŸ­æ ‡å¿—ã€‚ä¹‹ååˆå¯¹å‘½ä»¤è¡Œæ ‡å¿—è¯­æ³•è¿›è¡Œäº†è®²è§£ï¼Œå¯¹äºå¸ƒå°”å€¼ã€éå¸ƒå°”å€¼å’Œç®€çŸ­æ ‡å¿—ï¼Œéƒ½æœ‰å„è‡ªä¸åŒçš„è¯­æ³•ã€‚æˆ‘ä»¬è¿˜è®²è§£äº†å¦‚ä½•å€ŸåŠ© pflag.NormalizedName ç»™æ ‡å¿—èµ·ä¸€ä¸ªæˆ–å¤šä¸ªåˆ«åã€è§„èŒƒåŒ–æ ‡å¿—åã€‚ç„¶åä»‹ç»äº† NoOptDefVal çš„ä½œç”¨å’Œå¦‚ä½•å¼ƒç”¨/éšè—æ ‡å¿—ã€‚æœ€åé€šè¿‡ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•åœ¨ä¸€ä¸ªç¨‹åºä¸­æ··ç”¨ flag å’Œ pflagã€‚\nå½©è›‹ï¼šä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰å‘ç°ï¼Œç¤ºä¾‹ä¸­çš„ ip æ ‡å¿—çš„åç§°å…¶å®ä»£è¡¨çš„æ˜¯ int pointer è€Œé Internet Protocol Addressã€‚ip æ ‡å¿—æºè‡ªå®˜æ–¹ç¤ºä¾‹ï¼Œä¸è¿‡æˆ‘é¡ºåŠ¿è€Œä¸ºåˆå£°æ˜äº† portã€host æ ‡å¿—ï¼Œç®—æ˜¯ä¸€ä¸ªç¨‹åºä¸­çš„è°éŸ³æ¢— :)ã€‚\n# å‚è€ƒ pflag æºç : https://github.com/spf13/pflag pflag æ–‡æ¡£: https://pkg.go.dev/github.com/spf13/pflag ç¨‹åºå‚æ•°è¯­æ³•çº¦å®š: https://www.gnu.org/software/libc/manual/html_node/Argument-Syntax.html Go å‘½ä»¤è¡Œå‚æ•°è§£æå·¥å…· pflag ä½¿ç”¨ ","date":"2024-05-02T15:21:19+08:00","permalink":"https://arlettebrook.github.io/p/go%E8%A7%A3%E6%9E%90%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0%E4%B9%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93pflag/","title":"Goè§£æå‘½ä»¤è¡Œå‚æ•°ä¹‹ç¬¬ä¸‰æ–¹åº“pflag"},{"content":" # ç®€ä»‹ åœ¨Go flagåº“ä»‹ç»ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†flagåº“ã€‚flagåº“æ˜¯ç”¨äºè§£æå‘½ä»¤è¡Œé€‰é¡¹çš„æ ‡å‡†åº“ã€‚ä½†æ˜¯flagæœ‰å‡ ä¸ªç¼ºç‚¹ï¼š\nä¸æ˜¾ç¤ºæ”¯æŒçŸ­é€‰é¡¹ã€‚å½“ç„¶åœ¨Go flagåº“ä»‹ç»æ–‡ç« ä¸­ä¹Ÿæåˆ°è¿‡å¯ä»¥é€šè¿‡å°†ä¸¤ä¸ªé€‰é¡¹å…±äº«åŒä¸€ä¸ªå˜é‡è¿‚å›å®ç°ï¼Œä½†å†™èµ·æ¥æ¯”è¾ƒç¹çï¼› é€‰é¡¹å˜é‡çš„å®šä¹‰æ¯”è¾ƒç¹çï¼Œæ¯ä¸ªé€‰é¡¹éƒ½éœ€è¦æ ¹æ®ç±»å‹è°ƒç”¨å¯¹åº”çš„Typeæˆ–TypeVarå‡½æ•°ï¼› é»˜è®¤åªæ”¯æŒæœ‰é™çš„æ•°æ®ç±»å‹ï¼Œå½“å‰åªæœ‰åŸºæœ¬ç±»å‹bool/int/uint/stringå’Œtime.Durationï¼› ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œå‡ºç°äº†ä¸å°‘ç¬¬ä¸‰æ–¹è§£æå‘½ä»¤è¡Œé€‰é¡¹çš„åº“ï¼Œä»Šå¤©çš„ä¸»è§’go-flagså°±æ˜¯å…¶ä¸­ä¸€ä¸ªã€‚ç¬¬ä¸€æ¬¡çœ‹åˆ°go-flagsåº“æ˜¯åœ¨é˜…è¯»pgwebæºç çš„æ—¶å€™ã€‚\ngo-flagsæä¾›äº†æ¯”æ ‡å‡†åº“flagæ›´å¤šçš„é€‰é¡¹ã€‚å®ƒåˆ©ç”¨ç»“æ„æ ‡ç­¾ï¼ˆstruct tagï¼‰å’Œåå°„æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿ã€ç®€æ´çš„æ¥å£ã€‚å®ƒé™¤äº†åŸºæœ¬çš„åŠŸèƒ½ï¼Œè¿˜æä¾›äº†ä¸°å¯Œçš„ç‰¹æ€§ï¼š\næ”¯æŒçŸ­é€‰é¡¹ï¼ˆ-vï¼‰å’Œé•¿é€‰é¡¹ï¼ˆâ€“verboseï¼‰ï¼› æ”¯æŒçŸ­é€‰é¡¹åˆå†™ï¼Œå¦‚-auxï¼› åŒä¸€ä¸ªé€‰é¡¹å¯ä»¥è®¾ç½®å¤šä¸ªå€¼ï¼› æ”¯æŒæ‰€æœ‰çš„åŸºç¡€ç±»å‹å’Œ map ç±»å‹ï¼Œç”šè‡³æ˜¯å‡½æ•°ï¼› æ”¯æŒå‘½åç©ºé—´å’Œé€‰é¡¹ç»„ï¼› ç­‰ç­‰ã€‚ ä¸Šé¢åªæ˜¯ç²—ç•¥ä»‹ç»äº†go-flagsçš„ç‰¹æ€§ï¼Œä¸‹é¢æˆ‘ä»¬ä¾æ¬¡æ¥ä»‹ç»ã€‚\n# å¿«é€Ÿå¼€å§‹ å­¦ä¹ ä»ä½¿ç”¨å¼€å§‹ï¼æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹go-flagsçš„åŸºæœ¬ä½¿ç”¨ã€‚\nç”±äºæ˜¯ç¬¬ä¸‰æ–¹åº“ï¼Œä½¿ç”¨å‰éœ€è¦å®‰è£…ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å®‰è£…ï¼š\n1 $ go get -u github.com/jessevdk/go-flags ä»£ç ä¸­ä½¿ç”¨importå¯¼å…¥è¯¥åº“ï¼š\n1 import \u0026#34;github.com/jessevdk/go-flags\u0026#34; å®Œæ•´ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 package main import ( \u0026#34;errors\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;github.com/jessevdk/go-flags\u0026#34; ) type Option struct { Verbose []bool `short:\u0026#34;v\u0026#34; long:\u0026#34;verbose\u0026#34; description:\u0026#34;Show verbose debug message\u0026#34;` } func main() { var opt Option _, parseErr := flags.Parse(\u0026amp;opt) if parseErr != nil { var errPtr *flags.Error // æŒ‡é’ˆç±»å‹å®ç°Erroræ¥å£ if errors.As(parseErr, \u0026amp;errPtr) { // æ–­è¨€çš„ç±»å‹è¦æ˜¯æŒ‡é’ˆ if errors.Is(errPtr.Type, flags.ErrHelp) { return } return } panic(parseErr) return } fmt.Println(opt.Verbose) } ä½¿ç”¨go-flagsçš„ä¸€èˆ¬æ­¥éª¤ï¼š\nå®šä¹‰é€‰é¡¹ç»“æ„ï¼Œåœ¨ç»“æ„æ ‡ç­¾ä¸­è®¾ç½®é€‰é¡¹ä¿¡æ¯ã€‚é€šè¿‡shortå’Œlongè®¾ç½®çŸ­ã€é•¿é€‰é¡¹åå­—ï¼Œdescriptionè®¾ç½®å¸®åŠ©ä¿¡æ¯ã€‚å‘½ä»¤è¡Œä¼ å‚æ—¶ï¼ŒçŸ­é€‰é¡¹å‰åŠ -ï¼Œé•¿é€‰é¡¹å‰åŠ --ï¼› å£°æ˜é€‰é¡¹å˜é‡ï¼› è°ƒç”¨go-flagsçš„è§£ææ–¹æ³•è§£æã€‚ è§£æä¹‹åä¼šè¿”å›ä¸¤ä¸ªå‚æ•°ï¼š ç¬¬ä¸€ä¸ªï¼šå‰©ä½™æœªè§£æé€‰é¡¹ï¼Œæ˜¯stringç±»å‹çš„åˆ‡ç‰‡ï¼Œä¸€èˆ¬å¿½ç•¥ã€‚ ç¬¬äºŒä¸ªï¼šerrorå¯¹è±¡ å¯¹äºå¸®åŠ©ä¿¡æ¯çš„errorå¯¹è±¡æˆ‘ä»¬åº”è¯¥å¿½ç•¥ã€‚å†…éƒ¨ä¼šæ‰“å°è¿™ä¸ªé”™è¯¯ï¼Œé€ æˆé‡å¤ã€‚å…¶ä»–é”™è¯¯æŠ›å‡ºpanicï¼Œå¹¶é€€å‡º flags.Parse()æ–¹æ³•é»˜è®¤é€‰é¡¹æ˜¯Default = HelpFlag | PrintErrors | PassDoubleDash:æ‰“å°å¸®åŠ©ä¿¡æ¯ã€æ‰“å°é”™è¯¯ä¿¡æ¯ã€\u0026ndash;åé¢çš„å‚æ•°ä¸è§£æã€‚ é”™è¯¯ä¿¡æ¯æ˜¯å°è£…åˆ°flags.Errorç»“æ„ä½“é‡Œé¢çš„ErrorTypeç±»å‹lå­—æ®µé‡Œé¢çš„ã€‚æ‰€ä»¥éœ€è¦æ–­è¨€ä¹‹åå†åˆ¤æ–­ã€‚ ç¼–è¯‘ã€è¿è¡Œä»£ç ï¼ˆæˆ‘çš„ç¯å¢ƒæ˜¯ Win10 + Git Bashï¼‰ï¼š\n1 $ go build -o main.exe main.go çŸ­é€‰é¡¹ï¼š\n1 2 $ ./main.exe -v [true] é•¿é€‰é¡¹ï¼š\n1 2 $ ./main.exe --verbose [true] ç”±äºVerboseå­—æ®µæ˜¯åˆ‡ç‰‡ç±»å‹ï¼Œæ¯æ¬¡é‡åˆ°-væˆ–--verboseéƒ½ä¼šè¿½åŠ ä¸€ä¸ªtrueåˆ°åˆ‡ç‰‡ä¸­ã€‚\nå¤šä¸ªçŸ­é€‰é¡¹ï¼š\n1 2 $ ./main.exe -v -v [true true] å¤šä¸ªé•¿é€‰é¡¹ï¼š\n1 2 $ ./main.exe --verbose --verbose [true true] çŸ­é€‰é¡¹ + é•¿é€‰é¡¹ï¼š\n1 2 $ ./main.exe -v --verbose -v [true true true] çŸ­é€‰é¡¹åˆå†™ï¼š\n1 2 $ ./main.exe -vvv [true true true] # åŸºæœ¬ç‰¹æ€§ # æ”¯æŒä¸°å¯Œçš„æ•°æ®ç±»å‹ go-flagsç›¸æ¯”æ ‡å‡†åº“flagæ”¯æŒæ›´ä¸°å¯Œçš„æ•°æ®ç±»å‹ï¼š\næ‰€æœ‰çš„åŸºæœ¬ç±»å‹ï¼ˆåŒ…æ‹¬æœ‰ç¬¦å·æ•´æ•°int/int8/int16/int32/int64ï¼Œæ— ç¬¦å·æ•´æ•°uint/uint8/uint16/uint32/uint64ï¼Œæµ®ç‚¹æ•°float32/float64ï¼Œå¸ƒå°”ç±»å‹boolå’Œå­—ç¬¦ä¸²stringï¼‰å’Œå®ƒä»¬çš„åˆ‡ç‰‡ï¼› map ç±»å‹ã€‚åªæ”¯æŒé”®ä¸ºstringï¼Œå€¼ä¸ºåŸºç¡€ç±»å‹çš„ mapï¼› å‡½æ•°ç±»å‹ã€‚ å¦‚æœå­—æ®µæ˜¯åŸºæœ¬ç±»å‹çš„åˆ‡ç‰‡ï¼ŒåŸºæœ¬è§£ææµç¨‹ä¸å¯¹åº”çš„åŸºæœ¬ç±»å‹æ˜¯ä¸€æ ·çš„ã€‚åˆ‡ç‰‡ç±»å‹é€‰é¡¹çš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œé‡åˆ°ç›¸åŒçš„é€‰é¡¹æ—¶ï¼Œå€¼ä¼šè¢«è¿½åŠ åˆ°åˆ‡ç‰‡ä¸­ã€‚è€Œéåˆ‡ç‰‡ç±»å‹çš„é€‰é¡¹ï¼Œåå‡ºç°çš„å€¼ä¼šè¦†ç›–å…ˆå‡ºç°çš„å€¼ã€‚\nä¸‹é¢æ¥çœ‹ä¸€ä¸ªç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 package main import ( \u0026#34;errors\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;github.com/jessevdk/go-flags\u0026#34; ) type Option struct { IntFlag int `short:\u0026#34;i\u0026#34; long:\u0026#34;int\u0026#34; description:\u0026#34;int flag value\u0026#34;` IntSlice []int `long:\u0026#34;intslice\u0026#34; description:\u0026#34;int slice flag value\u0026#34;` BoolFlag bool `long:\u0026#34;bool\u0026#34; description:\u0026#34;bool flag value\u0026#34;` BoolSlice []bool `long:\u0026#34;boolslice\u0026#34; description:\u0026#34;bool slice flag value\u0026#34;` FloatFlag float64 `long:\u0026#34;float\u0026#34; description:\u0026#34;float64 flag value\u0026#34;` FloatSlice []float64 `long:\u0026#34;floatslice\u0026#34; description:\u0026#34;float64 slice flag value\u0026#34;` StringFlag string `short:\u0026#34;s\u0026#34; long:\u0026#34;string\u0026#34; description:\u0026#34;string flag value\u0026#34;` StringSlice []string `long:\u0026#34;strslice\u0026#34; description:\u0026#34;string slice flag value\u0026#34;` PtrStringSlice []*string `long:\u0026#34;pstrslice\u0026#34; description:\u0026#34;slice of pointer of string flag value\u0026#34;` Call func(string) `long:\u0026#34;call\u0026#34; description:\u0026#34;callback\u0026#34;` IntMap map[string]int `long:\u0026#34;intmap\u0026#34; description:\u0026#34;A map from string to int\u0026#34;` } func main() { var opt Option opt.Call = func(value string) { fmt.Println(\u0026#34;in callback: \u0026#34;, value) } _, parseErr := flags.Parse(\u0026amp;opt) if parseErr != nil { var errPtr *flags.Error if errors.As(parseErr, \u0026amp;errPtr) { return } panic(parseErr) return } fmt.Printf(\u0026#34;int flag: %v\\n\u0026#34;, opt.IntFlag) fmt.Printf(\u0026#34;int slice flag: %v\\n\u0026#34;, opt.IntSlice) fmt.Printf(\u0026#34;bool flag: %v\\n\u0026#34;, opt.BoolFlag) fmt.Printf(\u0026#34;bool slice flag: %v\\n\u0026#34;, opt.BoolSlice) fmt.Printf(\u0026#34;float flag: %v\\n\u0026#34;, opt.FloatFlag) fmt.Printf(\u0026#34;float slice flag: %v\\n\u0026#34;, opt.FloatSlice) fmt.Printf(\u0026#34;string flag: %v\\n\u0026#34;, opt.StringFlag) fmt.Printf(\u0026#34;string slice flag: %v\\n\u0026#34;, opt.StringSlice) fmt.Println(\u0026#34;slice of pointer of string flag: \u0026#34;) for i := 0; i \u0026lt; len(opt.PtrStringSlice); i++ { fmt.Printf(\u0026#34;\\t%d: %v\\n\u0026#34;, i, *opt.PtrStringSlice[i]) } fmt.Printf(\u0026#34;int map: %v\\n\u0026#34;, opt.IntMap) } åŸºæœ¬ç±»å‹å’Œå…¶åˆ‡ç‰‡æ¯”è¾ƒç®€å•ï¼Œå°±ä¸è¿‡å¤šä»‹ç»äº†ã€‚å€¼å¾—ç•™æ„çš„æ˜¯åŸºæœ¬ç±»å‹æŒ‡é’ˆçš„åˆ‡ç‰‡ï¼Œå³ä¸Šé¢çš„PtrStringSliceå­—æ®µï¼Œç±»å‹ä¸º[]*stringã€‚ ç”±äºç»“æ„ä¸­å­˜å‚¨çš„æ˜¯å­—ç¬¦ä¸²æŒ‡é’ˆï¼Œgo-flagsåœ¨è§£æè¿‡ç¨‹ä¸­é‡åˆ°è¯¥é€‰é¡¹ä¼šè‡ªåŠ¨åˆ›å»ºå­—ç¬¦ä¸²ï¼Œå°†æŒ‡é’ˆè¿½åŠ åˆ°åˆ‡ç‰‡ä¸­ã€‚\nè¿è¡Œç¨‹åºï¼Œä¼ å…¥--pstrsliceé€‰é¡¹ï¼š\n1 2 3 4 $ ./main.exe --pstrslice test1 --pstrslice test2 slice of pointer of string flag: 0: test1 1: test2 å¦å¤–ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é€‰é¡¹ä¸­å®šä¹‰å‡½æ•°ç±»å‹ã€‚è¯¥å‡½æ•°çš„å”¯ä¸€è¦æ±‚æ˜¯æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å‚æ•°ã€‚è§£æä¸­æ¯æ¬¡é‡åˆ°è¯¥é€‰é¡¹å°±ä¼šä»¥é€‰é¡¹å€¼ä¸ºå‚æ•°è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚ ä¸Šé¢ä»£ç ä¸­ï¼ŒCallå‡½æ•°åªæ˜¯ç®€å•çš„æ‰“å°ä¼ å…¥çš„é€‰é¡¹å€¼ã€‚è¿è¡Œä»£ç ï¼Œä¼ å…¥--callé€‰é¡¹ï¼š\n1 2 3 $ ./main.exe --call test1 --call test2 in callback: test1 in callback: test2 æœ€åï¼Œgo-flagsè¿˜æ”¯æŒ map ç±»å‹ã€‚è™½ç„¶é™åˆ¶é”®å¿…é¡»æ˜¯stringç±»å‹ï¼Œå€¼å¿…é¡»æ˜¯åŸºæœ¬ç±»å‹ï¼Œä¹Ÿèƒ½å®ç°æ¯”è¾ƒçµæ´»çš„é…ç½®ã€‚ mapç±»å‹çš„é€‰é¡¹å€¼ä¸­é”®-å€¼é€šè¿‡:åˆ†éš”ï¼Œå¦‚key:valueï¼Œå¯è®¾ç½®å¤šä¸ªã€‚è¿è¡Œä»£ç ï¼Œä¼ å…¥--intmapé€‰é¡¹ï¼š\n1 2 $ ./main.exe --intmap key1:12 --intmap key2:58 int map: map[key1:12 key2:58] # å¸¸ç”¨è®¾ç½® go-flagsæä¾›äº†éå¸¸å¤šçš„è®¾ç½®é€‰é¡¹ï¼Œå…·ä½“å¯å‚è§æ–‡æ¡£ã€‚è¿™é‡Œé‡ç‚¹ä»‹ç»ä¸¤ä¸ªrequiredå’Œdefaultã€‚\nrequiredéç©ºæ—¶ï¼Œè¡¨ç¤ºå¯¹åº”çš„é€‰é¡¹å¿…é¡»è®¾ç½®å€¼ï¼Œå¦åˆ™è§£ææ—¶è¿”å›ErrRequiredé”™è¯¯ã€‚\ndefaultç”¨äºè®¾ç½®é€‰é¡¹çš„é»˜è®¤å€¼ã€‚å¦‚æœå·²ç»è®¾ç½®äº†é»˜è®¤å€¼ï¼Œé‚£ä¹ˆrequiredæ˜¯å¦è®¾ç½®å¹¶ä¸å½±å“ï¼Œä¹Ÿå°±æ˜¯è¯´å‘½ä»¤è¡Œå‚æ•°ä¸­è¯¥é€‰é¡¹å¯ä»¥æ²¡æœ‰ã€‚\nçœ‹ä¸‹é¢ç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;github.com/jessevdk/go-flags\u0026#34; ) type Option struct { Required string `short:\u0026#34;r\u0026#34; long:\u0026#34;required\u0026#34; required:\u0026#34;true\u0026#34;` Default string `short:\u0026#34;d\u0026#34; long:\u0026#34;default\u0026#34; default:\u0026#34;default\u0026#34;` } func main() { var opt Option _, err := flags.Parse(\u0026amp;opt) if err != nil { log.Fatal(\u0026#34;Parse error:\u0026#34;, err) } fmt.Println(\u0026#34;required: \u0026#34;, opt.Required) fmt.Println(\u0026#34;default: \u0026#34;, opt.Default) } è¿è¡Œç¨‹åºï¼Œä¸ä¼ å…¥defaulté€‰é¡¹ï¼ŒDefaultå­—æ®µå–é»˜è®¤å€¼ï¼Œä¸ä¼ å…¥requiredé€‰é¡¹ï¼Œæ‰§è¡ŒæŠ¥é”™ï¼š\n1 2 3 4 5 6 7 8 9 10 11 $ ./main.exe -r required-data required: required-data default: default $ ./main.exe -d default-data -r required-data required: required-data default: default-data $ ./main.exe the required flag `/r, /required\u0026#39; was not specified 2020/01/09 18:07:39 Parse error:the required flag `/r, /required\u0026#39; was not specified # é«˜çº§ç‰¹æ€§ # é€‰é¡¹åˆ†ç»„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 package main import ( \u0026#34;errors\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;github.com/jessevdk/go-flags\u0026#34; ) type Option struct { GroupBasicOption `group:\u0026#34;basic\u0026#34;` GroupSliceOption `group:\u0026#34;slice\u0026#34;` } type GroupBasicOption struct { IntFlag int `short:\u0026#34;i\u0026#34; long:\u0026#34;intflag\u0026#34; description:\u0026#34;int flag\u0026#34;` BoolFlag bool `short:\u0026#34;b\u0026#34; long:\u0026#34;boolflag\u0026#34; description:\u0026#34;bool flag\u0026#34;` FloatFlag float64 `short:\u0026#34;f\u0026#34; long:\u0026#34;floatflag\u0026#34; description:\u0026#34;float flag\u0026#34;` StringFlag string `short:\u0026#34;s\u0026#34; long:\u0026#34;stringflag\u0026#34; description:\u0026#34;string flag\u0026#34;` } type GroupSliceOption struct { IntSlice int `long:\u0026#34;intslice\u0026#34; description:\u0026#34;int slice\u0026#34;` BoolSlice bool `long:\u0026#34;boolslice\u0026#34; description:\u0026#34;bool slice\u0026#34;` FloatSlice float64 `long:\u0026#34;floatslice\u0026#34; description:\u0026#34;float slice\u0026#34;` StringSlice string `long:\u0026#34;stringslice\u0026#34; description:\u0026#34;string slice\u0026#34;` } func main() { var opt Option p := flags.NewParser(\u0026amp;opt, flags.Default) _, err := p.Parse() if err != nil { var errPtr *flags.Error if errors.As(err, \u0026amp;errPtr) { return } log.Fatal(err) } fmt.Println(opt) } ä¸Šé¢ä»£ç ä¸­æˆ‘ä»¬å°†åŸºæœ¬ç±»å‹å’Œå®ƒä»¬çš„åˆ‡ç‰‡ç±»å‹é€‰é¡¹æ‹†åˆ†åˆ°ä¸¤ä¸ªç»“æ„ä½“ä¸­ï¼Œè¿™æ ·å¯ä»¥ä½¿ä»£ç çœ‹èµ·æ¥æ›´æ¸…æ™°è‡ªç„¶ï¼Œç‰¹åˆ«æ˜¯åœ¨ä»£ç é‡å¾ˆå¤§çš„æƒ…å†µä¸‹ã€‚ è¿™æ ·åšè¿˜æœ‰ä¸€ä¸ªå¥½å¤„ï¼Œæˆ‘ä»¬è¯•è¯•ç”¨--helpè¿è¡Œè¯¥ç¨‹åºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 $ go run main.go --help Usage: C:\\Users\\Lenovo\\AppData\\Local\\Temp\\go-build4141518920\\b001\\exe\\main.exe [OPTIONS] basic: /i, /intflag: int flag /b, /boolflag bool flag /f, /floatflag: float flag /s, /stringflag: string flag slice: /intslice: int slice /boolslice bool slice /floatslice: float slice /stringslice: string slice Help Options: /? Show this help message /h, /help Show this help message è¾“å‡ºçš„å¸®åŠ©ä¿¡æ¯ä¸­ï¼Œä¹Ÿæ˜¯æŒ‰ç…§æˆ‘ä»¬è®¾å®šçš„åˆ†ç»„æ˜¾ç¤ºäº†ï¼Œä¾¿äºæŸ¥çœ‹ã€‚\ngroupæ ‡ç­¾å­—æ®µç”¨äºåˆ†ç»„å¹¶å‘½åã€‚å½“åœ¨ç»“æ„ä½“å­—æ®µä¸ŠæŒ‡å®šæ—¶ï¼Œä½¿è¯¥ç»“æ„ä½“å­—æ®µå…·æœ‰ç»™å®šåç§°çš„å•ç‹¬ç»„ï¼ˆå¯é€‰ï¼‰\n# å­å‘½ä»¤ go-flagsæ”¯æŒå­å‘½ä»¤ã€‚æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„ Go å’Œ Git å‘½ä»¤è¡Œç¨‹åºå°±æœ‰å¤§é‡çš„å­å‘½ä»¤ã€‚ä¾‹å¦‚go versionã€go buildã€go runã€git statusã€git commitè¿™äº›å‘½ä»¤ä¸­version/build/run/status/commitå°±æ˜¯å­å‘½ä»¤ã€‚ ä½¿ç”¨go-flagså®šä¹‰å­å‘½ä»¤æ¯”è¾ƒç®€å•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 package main import ( \u0026#34;errors\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;os\u0026#34; \u0026#34;strconv\u0026#34; \u0026#34;strings\u0026#34; \u0026#34;github.com/jessevdk/go-flags\u0026#34; ) type Option struct { GroupBasicOption `group:\u0026#34;Basic\u0026#34;` GroupSliceOption `group:\u0026#34;Slice\u0026#34;` MathCommand `command:\u0026#34;math\u0026#34;` Call func(int) `long:\u0026#34;call\u0026#34; description:\u0026#34;callback\u0026#34;` } type GroupBasicOption struct { IntFlag int `short:\u0026#34;i\u0026#34; long:\u0026#34;intflag\u0026#34; description:\u0026#34;int flag\u0026#34;` BoolFlag bool `short:\u0026#34;b\u0026#34; long:\u0026#34;boolflag\u0026#34; description:\u0026#34;bool flag\u0026#34;` FloatFlag float64 `short:\u0026#34;f\u0026#34; long:\u0026#34;floatflag\u0026#34; description:\u0026#34;float flag\u0026#34;` StringFlag string `short:\u0026#34;s\u0026#34; long:\u0026#34;stringflag\u0026#34; description:\u0026#34;string flag\u0026#34;` } type GroupSliceOption struct { IntSlice int `long:\u0026#34;intslice\u0026#34; description:\u0026#34;int slice\u0026#34;` BoolSlice bool `long:\u0026#34;boolslice\u0026#34; description:\u0026#34;bool slice\u0026#34;` FloatSlice float64 `long:\u0026#34;floatslice\u0026#34; description:\u0026#34;float slice\u0026#34;` StringSlice string `long:\u0026#34;stringslice\u0026#34; description:\u0026#34;string slice\u0026#34;` } type MathCommand struct { Op string `long:\u0026#34;op\u0026#34; description:\u0026#34;operation to execute\u0026#34;` Args []string Result int64 } func (m *MathCommand) Execute(args []string) error { // æ³¨æ„ï¼Œä¸èƒ½ä½¿ç”¨ä¹˜æ³•ç¬¦å·*å’Œé™¤æ³•ç¬¦å·/ï¼Œå®ƒä»¬éƒ½ä¸å¯è¯†åˆ«ã€‚ if m.Op != \u0026#34;+\u0026#34; \u0026amp;\u0026amp; m.Op != \u0026#34;-\u0026#34; \u0026amp;\u0026amp; m.Op != \u0026#34;*\u0026#34; \u0026amp;\u0026amp; m.Op != \u0026#34;/\u0026#34; { return errors.New(\u0026#34;invalid op\u0026#34;) } for _, arg := range args { num, err := strconv.ParseInt(arg, 10, 64) if err != nil { return err } // åªå®ç°äº†åŠ çš„åŠŸèƒ½ m.Result += num } m.Args = args return nil } func main() { var opt Option opt.Call = func(i int) { fmt.Println(i) } //_, errParse := flags.Parse(\u0026amp;opt) _, errParse := flags.NewParser(\u0026amp;opt, flags.HelpFlag|flags.PassDoubleDash).Parse() if errParse != nil { var p *flags.Error if errors.As(errParse, \u0026amp;p) { /*if errors.Is(p.Type, flags.ErrHelp) { os.Exit(0) }*/ switch { case errors.Is(p.Type, flags.ErrHelp): fmt.Println(p.Message) os.Exit(0) case errors.Is(p.Type, flags.ErrCommandRequired): default: log.Fatal(p.Message) } } else { log.Fatal(errParse) } } fmt.Println(opt) fmt.Printf(\u0026#34;The result of %s is %d\u0026#34;, strings.Join(opt.MathCommand.Args, opt.MathCommand.Op), opt.MathCommand.Result) } å­å‘½ä»¤å¿…é¡»å®ç°go-flagså®šä¹‰çš„Commanderæ¥å£ï¼š\n1 2 3 type Commander interface { Execute(args []string) error } commandç»“æ„ä½“æ ‡ç­¾å­—æ®µï¼šå½“åœ¨ç»“æ„ä½“å­—æ®µä¸ŠæŒ‡å®šæ—¶ï¼Œä½¿è¯¥ç»“æ„ä½“å­—æ®µå…·æœ‰ç»™å®šåç§°çš„ï¼ˆå­ï¼‰å‘½ä»¤\nè§£æå‘½ä»¤è¡Œæ—¶ï¼Œå¦‚æœé‡åˆ°ä¸æ˜¯ä»¥-æˆ–--å¼€å¤´çš„å‚æ•°ï¼Œgo-flagsä¼šå°è¯•å°†å…¶è§£é‡Šä¸ºå­å‘½ä»¤åã€‚å­å‘½ä»¤çš„åå­—é€šè¿‡åœ¨ç»“æ„æ ‡ç­¾ä¸­ä½¿ç”¨commandæŒ‡å®šã€‚ å­å‘½ä»¤åé¢çš„å‚æ•°éƒ½å°†ä½œä¸ºå­å‘½ä»¤çš„å‚æ•°ï¼Œå­å‘½ä»¤ä¹Ÿå¯ä»¥æœ‰é€‰é¡¹ã€‚\nä¸Šé¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªå¯ä»¥è®¡ç®—ä»»æ„ä¸ªæ•´æ•°çš„åŠ ã€å‡ã€ä¹˜ã€é™¤å­å‘½ä»¤mathã€‚\næ¥ä¸‹æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ï¼š\n1 2 3 $ go run main.go math --op + 1 2 3 {{0 false 0 } {0 false 0 } {+ [1 2 3] 6} 0x6809a0} The result of 1+2+3 is 6 æ³¨æ„ï¼Œä¸èƒ½ä½¿ç”¨ä¹˜æ³•ç¬¦å·*å’Œé™¤æ³•ç¬¦å·/ï¼Œå®ƒä»¬éƒ½ä¸å¯è¯†åˆ«ã€‚\n# å…¶ä»– go-flagsåº“è¿˜æœ‰å¾ˆå¤šæœ‰æ„æ€çš„ç‰¹æ€§ï¼Œä¾‹å¦‚æ”¯æŒ Windows é€‰é¡¹æ ¼å¼ï¼ˆ/vå’Œ/verboseï¼‰ã€ä»ç¯å¢ƒå˜é‡ä¸­è¯»å–é»˜è®¤å€¼ã€ä» ini æ–‡ä»¶ä¸­è¯»å–é»˜è®¤è®¾ç½®ç­‰ç­‰ã€‚å¤§å®¶æœ‰å…´è¶£å¯ä»¥è‡ªè¡Œå»ç ”ç©¶~\n# å‚è€ƒ go-flagsGoDoc æ–‡æ¡£ Go æ¯æ—¥ä¸€åº“ä¹‹ go-flags ","date":"2024-05-01T21:50:22+08:00","permalink":"https://arlettebrook.github.io/p/go%E8%A7%A3%E6%9E%90%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0%E4%B9%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93go-flags/","title":"Goè§£æå‘½ä»¤è¡Œå‚æ•°ä¹‹ç¬¬ä¸‰æ–¹åº“go-flags"},{"content":" zap æ˜¯ç”± Uber å…¬å¸å¼€æºçš„ä¸€æ¬¾ Go æ—¥å¿—åº“ï¼Œå°±åƒå®ƒçš„å‘½åä¸€æ ·ï¼Œzap ä»¥å¿«è‘—ç§°ã€‚å®˜æ–¹ GitHub ä»“åº“ä¸­åªç”¨ä¸€å¥è¯æ¥æ¦‚æ‹¬ zapï¼šã€Œåœ¨ Go ä¸­è¿›è¡Œå¿«é€Ÿã€ç»“æ„åŒ–ã€åˆ†çº§çš„æ—¥å¿—è®°å½•ã€ã€‚è¿™å¥è¯ç®€å•æ˜äº†çš„æ¦‚æ‹¬äº† zap çš„æ ¸å¿ƒç‰¹æ€§ï¼Œä»Šå¤©æˆ‘ä»¬å°±æ¥ä»‹ç»ä¸‹ zap æ—¥å¿—åº“çš„åŸºæœ¬ä½¿ç”¨å’Œé«˜çº§ç‰¹æ€§ï¼Œä»¥åŠå¦‚ä½•åœ¨å®é™…åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ï¼Œæ¥æé«˜åº”ç”¨ç¨‹åºçš„å¯é æ€§ã€‚\n# ç‰¹ç‚¹ zap å…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š\nå¿«ï¼Œéå¸¸å¿«ï¼Œè¿™ä¹Ÿæ˜¯ zap æœ€æ˜¾è‘—çš„ç‰¹ç‚¹ã€‚é€Ÿåº¦å¿«çš„åŸå› æ˜¯ zap é¿å…ä½¿ç”¨ interface{} å’Œåå°„ï¼Œå¹¶ä¸”ä½¿ç”¨ sync.Pool å‡å°‘å †å†…å­˜åˆ†é…ã€‚åœ¨ zap é¢å‰ Logrus çš„æ‰§è¡Œé€Ÿåº¦åªæœ‰è¢«åŠæ‰“çš„ä»½ï¼Œä½ å¯ä»¥åœ¨å®˜æ–¹ GitHub ä»“åº“ä¸­çœ‹åˆ° zap ä¸ä¸åŒæ—¥å¿—åº“çš„é€Ÿåº¦å¯¹æ¯”ã€‚ æ”¯æŒç»“æ„åŒ–æ—¥å¿—è®°å½•ã€‚è¿™æ˜¯ä¸€ä¸ªä¼˜ç§€çš„æ—¥å¿—åº“å¿…å¤‡åŠŸèƒ½ã€‚ æ”¯æŒä¸ƒç§æ—¥å¿—çº§åˆ«ï¼šDebugã€Infoã€Warnã€Errorã€DPanicã€Panicã€Fatalï¼Œå…¶ä¸­ DPanic æ˜¯æŒ‡åœ¨å¼€å‘ç¯å¢ƒä¸‹ï¼ˆdevelopmentï¼‰è®°å½•æ—¥å¿—åä¼šè¿›è¡Œ panicã€‚ æ”¯æŒè¾“å‡ºè°ƒç”¨å †æ ˆã€‚ æ”¯æŒ Hooks æœºåˆ¶ã€‚ # ä½¿ç”¨ # åŸºæœ¬ä½¿ç”¨ å…ˆå®‰è£…go get -u go.uber.org/zap\nåŸºæœ¬ä½¿ç”¨å¦‚ä¸‹ï¼š\nzapåº“çš„ä½¿ç”¨ä¸å…¶ä»–çš„æ—¥å¿—åº“éå¸¸ç›¸ä¼¼ã€‚å…ˆåˆ›å»ºä¸€ä¸ªloggerï¼Œç„¶åè°ƒç”¨å„ä¸ªçº§åˆ«çš„æ–¹æ³•è®°å½•æ—¥å¿—ï¼ˆDebug/Info/Warn/Error/ï¼‰ã€‚zapæä¾›äº†å‡ ä¸ªå¿«é€Ÿåˆ›å»ºloggerçš„æ–¹æ³•ï¼Œzap.NewExample()ã€zap.NewDevelopment()ã€zap.NewProduction()ï¼Œè¿˜æœ‰é«˜åº¦å®šåˆ¶åŒ–çš„åˆ›å»ºæ–¹æ³•zap.New()ã€‚åˆ›å»ºå‰ 3 ä¸ªloggeræ—¶ï¼Œzapä¼šä½¿ç”¨ä¸€äº›é¢„å®šä¹‰çš„è®¾ç½®ï¼Œå®ƒä»¬çš„ä½¿ç”¨åœºæ™¯ä¹Ÿæœ‰æ‰€ä¸åŒã€‚Exampleé€‚åˆç”¨åœ¨æµ‹è¯•ä»£ç ä¸­ï¼ŒDevelopmentåœ¨å¼€å‘ç¯å¢ƒä¸­ä½¿ç”¨ï¼ŒProductionç”¨åœ¨ç”Ÿæˆç¯å¢ƒã€‚\nzapåº•å±‚ API å¯ä»¥è®¾ç½®ç¼“å­˜ï¼Œæ‰€ä»¥ä¸€èˆ¬ä½¿ç”¨defer logger.Sync()å°†ç¼“å­˜åŒæ­¥åˆ°æ–‡ä»¶ä¸­ã€‚åˆ·æ–°ç¼“å­˜ï¼Œç¡®ä¿æ—¥å¿—è¾“å‡ºã€‚\nç”±äºfmt.Printfä¹‹ç±»çš„æ–¹æ³•å¤§é‡ä½¿ç”¨interface{}å’Œåå°„ï¼Œä¼šæœ‰ä¸å°‘æ€§èƒ½æŸå¤±ï¼Œå¹¶ä¸”å¢åŠ äº†å†…å­˜åˆ†é…çš„é¢‘æ¬¡ã€‚zapä¸ºäº†æé«˜æ€§èƒ½ã€å‡å°‘å†…å­˜åˆ†é…æ¬¡æ•°ï¼Œæ²¡æœ‰ä½¿ç”¨åå°„ï¼Œè€Œä¸”é»˜è®¤çš„Loggeråªæ”¯æŒå¼ºç±»å‹çš„ã€ç»“æ„åŒ–çš„æ—¥å¿—ã€‚å¿…é¡»ä½¿ç”¨zapæä¾›çš„æ–¹æ³•è®°å½•å­—æ®µã€‚zapä¸º Go è¯­è¨€ä¸­æ‰€æœ‰çš„åŸºæœ¬ç±»å‹å’Œå…¶ä»–å¸¸è§ç±»å‹éƒ½æä¾›äº†æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•çš„åç§°ä¹Ÿæ¯”è¾ƒå¥½è®°å¿†ï¼Œzap.Typeï¼ˆTypeä¸ºbool/int/uint/float64/complex64/time.Time/time.Duration/errorç­‰ï¼‰å°±è¡¨ç¤ºè¯¥ç±»å‹çš„å­—æ®µï¼Œzap.Typepä»¥pç»“å°¾è¡¨ç¤ºè¯¥ç±»å‹æŒ‡é’ˆçš„å­—æ®µï¼Œzap.Typesä»¥sç»“å°¾è¡¨ç¤ºè¯¥ç±»å‹åˆ‡ç‰‡çš„å­—æ®µã€‚å¦‚ï¼š\nzap.Bool(key string, val bool) Fieldï¼šboolå­—æ®µ zap.Boolp(key string, val *bool) Fieldï¼šboolæŒ‡é’ˆå­—æ®µï¼› zap.Bools(key string, val []bool) Fieldï¼šboolåˆ‡ç‰‡å­—æ®µã€‚ å½“ç„¶ä¹Ÿæœ‰ä¸€äº›ç‰¹æ®Šç±»å‹çš„å­—æ®µï¼š\nzap.Any(key string, value interface{}) Fieldï¼šä»»æ„ç±»å‹çš„å­—æ®µï¼› zap.Binary(key string, val []byte) Fieldï¼šäºŒè¿›åˆ¶ä¸²çš„å­—æ®µã€‚ å½“ç„¶ï¼Œæ¯ä¸ªå­—æ®µéƒ½ç”¨æ–¹æ³•åŒ…ä¸€å±‚ç”¨èµ·æ¥æ¯”è¾ƒç¹çã€‚zapä¹Ÿæä¾›äº†ä¾¿æ·çš„æ–¹æ³•SugarLoggerï¼Œå¯ä»¥ä½¿ç”¨printfæ ¼å¼ç¬¦çš„æ–¹å¼ã€‚è°ƒç”¨logger.Sugar()å³å¯åˆ›å»ºSugaredLoggerã€‚SugaredLoggerçš„ä½¿ç”¨æ¯”Loggerç®€å•ï¼Œåªæ˜¯æ€§èƒ½æ¯”Loggerä½ 50% å·¦å³ï¼Œå¯ä»¥ç”¨åœ¨éçƒ­ç‚¹å‡½æ•°ä¸­ã€‚è°ƒç”¨SugarLoggerä»¥fç»“å°¾çš„æ–¹æ³•ä¸fmt.Printfæ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œå¦‚ä¾‹å­ä¸­çš„Infofã€‚åŒæ—¶SugarLoggerè¿˜æ”¯æŒä»¥wç»“å°¾çš„æ–¹æ³•ï¼Œè¿™ç§æ–¹å¼ä¸éœ€è¦å…ˆåˆ›å»ºå­—æ®µå¯¹è±¡ï¼Œç›´æ¥å°†å­—æ®µåå’Œå€¼ä¾æ¬¡æ”¾åœ¨å‚æ•°ä¸­å³å¯ï¼Œå¦‚ä¾‹å­ä¸­çš„Infowã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;time\u0026#34; \u0026#34;go.uber.org/zap\u0026#34; ) func main() { // ç”Ÿäº§ç¯å¢ƒ fmt.Println(\u0026#34;------ç”Ÿäº§ç¯å¢ƒ------\u0026#34;) { logger, _ := zap.NewProduction() defer logger.Sync() // åˆ·æ–° bufferï¼Œä¿è¯æ—¥å¿—æœ€ç»ˆä¼šè¢«è¾“å‡º url := \u0026#34;https://arlettebrook.github.io/\u0026#34; logger.Info(\u0026#34;production failed to fetch URL\u0026#34;, zap.String(\u0026#34;url\u0026#34;, url), // å› ä¸ºæ²¡æœ‰ä½¿ç”¨ interface{} å’Œåå°„æœºåˆ¶ï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®šå…·ä½“ç±»å‹ zap.Int(\u0026#34;attempt\u0026#34;, 3), zap.Duration(\u0026#34;backoff\u0026#34;, time.Second), ) } // å¼€å‘ç¯å¢ƒ fmt.Println(\u0026#34;------å¼€å‘ç¯å¢ƒ------\u0026#34;) { logger, _ := zap.NewDevelopment() defer logger.Sync() url := \u0026#34;https://arlettebrook.github.io/\u0026#34; logger.Debug(\u0026#34;development failed to fetch URL\u0026#34;, zap.String(\u0026#34;url\u0026#34;, url), zap.Int(\u0026#34;attempt\u0026#34;, 3), zap.Duration(\u0026#34;backoff\u0026#34;, time.Second), ) } // æµ‹è¯•ç¯å¢ƒ fmt.Println(\u0026#34;------æµ‹è¯•ç¯å¢ƒ------\u0026#34;) { logger := zap.NewExample() defer logger.Sync() url := \u0026#34;https://arlettebrook.github.io/\u0026#34; logger.Info(\u0026#34;failed to fetch URL\u0026#34;, zap.String(\u0026#34;url\u0026#34;, url), zap.Int(\u0026#34;attempt\u0026#34;, 3), zap.Duration(\u0026#34;backoff\u0026#34;, time.Second), ) fmt.Println(\u0026#34;------sugaredLogger------\u0026#34;) sugar := logger.Sugar() sugar.Infow(\u0026#34;failed to fetch URL\u0026#34;, \u0026#34;url\u0026#34;, url, \u0026#34;attempt\u0026#34;, 3, \u0026#34;backoff\u0026#34;, time.Second, ) sugar.Infof(\u0026#34;Failed to fetch URL: %s\u0026#34;, url) } } zap é’ˆå¯¹ç”Ÿäº§ç¯å¢ƒã€å¼€å‘ç¯å¢ƒä»¥åŠæµ‹è¯•ç¯å¢ƒæä¾›äº†ä¸åŒçš„å‡½æ•°æ¥åˆ›å»º Logger å¯¹è±¡ã€‚\nå¦‚æœæƒ³åœ¨æ—¥å¿—åé¢è¿½åŠ  key-valueï¼Œåˆ™éœ€è¦æ ¹æ® value çš„æ•°æ®ç±»å‹ä½¿ç”¨ zap.Stringã€zap.Int ç­‰æ–¹æ³•å®ç°ã€‚è¿™ä¸€ç‚¹åœ¨ä½¿ç”¨ä¸Šæ˜¾ç„¶ä¸å¦‚ Logrus ç­‰å…¶ä»–æ—¥å¿—åº“æ¥çš„æ–¹ä¾¿ï¼Œä½†è¿™ä¹Ÿæ˜¯ zap é€Ÿåº¦å¿«çš„åŸå› ä¹‹ä¸€ï¼Œzap å†…éƒ¨å°½é‡é¿å…ä½¿ç”¨ interface{} å’Œåå°„æ¥æé«˜ä»£ç æ‰§è¡Œæ•ˆç‡ã€‚\nè®°å½•æ—¥å¿—çš„ logger.Xxx æ–¹æ³•ç­¾åå¦‚ä¸‹ï¼š\n1 func (log *Logger) Info(msg string, fields ...Field) å…¶ä¸­ fields æ˜¯ zapcore.Field ç±»å‹ï¼Œç”¨æ¥å­˜å‚¨ key-valueï¼Œå¹¶è®°å½• value ç±»å‹ï¼Œä¸ç®¡æ˜¯ zap.String è¿˜æ˜¯ zap.Int åº•å±‚éƒ½æ˜¯ zapcore.Field ç±»å‹æ¥è®°å½•çš„ã€‚zap ä¸ºæ¯ä¸€ç§ Go çš„å†…ç½®ç±»å‹éƒ½å®šä¹‰äº†å¯¹åº”çš„ zap.Xxx æ–¹æ³•ï¼Œç”šè‡³è¿˜å®ç° zap.Any() æ¥æ”¯æŒ interface{}ã€‚\næ‰§è¡Œä»¥ä¸Šä»£ç ï¼Œæ§åˆ¶å°å¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 ------ç”Ÿäº§ç¯å¢ƒ------ {\u0026#34;level\u0026#34;:\u0026#34;info\u0026#34;,\u0026#34;ts\u0026#34;:1714375211.8196504,\u0026#34;caller\u0026#34;:\u0026#34;learn/main.go:18\u0026#34;,\u0026#34;msg\u0026#34;:\u0026#34;production failed to fe tch URL\u0026#34;,\u0026#34;url\u0026#34;:\u0026#34;https://arlettebrook.github.io/\u0026#34;,\u0026#34;attempt\u0026#34;:3,\u0026#34;backoff\u0026#34;:1} ------å¼€å‘ç¯å¢ƒ------ 2024-04-29T15:20:11.820+0800 DEBUG learn/main.go:32 development failed to fetch URL {\u0026#34; url\u0026#34;: \u0026#34;https://arlettebrook.github.io/\u0026#34;, \u0026#34;attempt\u0026#34;: 3, \u0026#34;backoff\u0026#34;: \u0026#34;1s\u0026#34;} ------æµ‹è¯•ç¯å¢ƒ------ {\u0026#34;level\u0026#34;:\u0026#34;info\u0026#34;,\u0026#34;msg\u0026#34;:\u0026#34;failed to fetch URL\u0026#34;,\u0026#34;url\u0026#34;:\u0026#34;https://arlettebrook.github.io/\u0026#34;,\u0026#34;attempt\u0026#34;:3,\u0026#34;b ackoff\u0026#34;:\u0026#34;1s\u0026#34;} ------sugaredLogger------ {\u0026#34;level\u0026#34;:\u0026#34;info\u0026#34;,\u0026#34;msg\u0026#34;:\u0026#34;failed to fetch URL\u0026#34;,\u0026#34;url\u0026#34;:\u0026#34;https://arlettebrook.github.io/\u0026#34;,\u0026#34;attempt\u0026#34;:3,\u0026#34;b ackoff\u0026#34;:\u0026#34;1s\u0026#34;} {\u0026#34;level\u0026#34;:\u0026#34;info\u0026#34;,\u0026#34;msg\u0026#34;:\u0026#34;Failed to fetch URL: https://arlettebrook.github.io/\u0026#34;} å¯ä»¥å‘ç°ï¼Œé€šè¿‡ zap.NewProduction() åˆ›å»ºçš„æ—¥å¿—å¯¹è±¡è¾“å‡ºæ ¼å¼ä¸º JSONï¼Œè€Œé€šè¿‡ zap.NewDevelopment() åˆ›å»ºçš„æ—¥å¿—å¯¹è±¡è¾“å‡ºæ ¼å¼ä¸º Textï¼Œæ—¥å¿—åé¢è¿½åŠ çš„ key-value ä¼šè¢«è½¬æ¢æˆ JSONã€‚å¹¶ä¸”ï¼Œä¸¤è€…è¾“å‡ºçš„å­—æ®µå†…å®¹ä¹Ÿç•¥æœ‰å·®å¼‚ï¼Œå¦‚ç”Ÿäº§ç¯å¢ƒæ—¥å¿—è¾“å‡ºçš„æ—¶é—´æ ¼å¼ä¸º Unix epoch åˆ©äºç¨‹åºè§£æï¼Œè€Œå¼€å‘ç¯å¢ƒæ—¥å¿—è¾“å‡ºçš„æ—¶é—´æ ¼å¼ä¸º ISO8601 æ›´åˆ©äºäººç±»é˜…è¯»ã€‚æµ‹è¯•ç¯å¢ƒæ²¡æœ‰æ–‡ä»¶è¡Œå·ã€å †æ ˆè·Ÿè¸ªä¿¡æ¯ä»¥åŠæ—¶é—´ï¼Œæ ¼å¼ä¸ºJSONã€‚å¯¹åº”çš„sugaréƒ½æ˜¯æ˜¯ä¸€æ ·çš„ã€‚\nå¯¼è‡´ä»¥ä¸Šè¿™äº›å·®å¼‚çš„åŸå› æ˜¯é…ç½®ä¸åŒï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ zap.NewProduction å’Œ zap.NewDevelopment çš„ä»£ç å®ç°ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 func NewProduction(options ...Option) (*Logger, error) { return NewProductionConfig().Build(options...) } func NewProductionConfig() Config { return Config{ Level: NewAtomicLevelAt(InfoLevel), Development: false, Sampling: \u0026amp;SamplingConfig{ Initial: 100, Thereafter: 100, }, Encoding: \u0026#34;json\u0026#34;, EncoderConfig: NewProductionEncoderConfig(), OutputPaths: []string{\u0026#34;stderr\u0026#34;}, ErrorOutputPaths: []string{\u0026#34;stderr\u0026#34;}, } } func NewDevelopment(options ...Option) (*Logger, error) { return NewDevelopmentConfig().Build(options...) } func NewDevelopmentConfig() Config { return Config{ Level: NewAtomicLevelAt(DebugLevel), Development: true, Encoding: \u0026#34;console\u0026#34;, EncoderConfig: NewDevelopmentEncoderConfig(), OutputPaths: []string{\u0026#34;stderr\u0026#34;}, ErrorOutputPaths: []string{\u0026#34;stderr\u0026#34;}, } } å¯ä»¥çœ‹åˆ°ï¼Œä¸¤è€…åœ¨å®ç°æ€è·¯ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯å…ˆåˆ›å»ºä¸€ä¸ªé…ç½®å¯¹è±¡ zap.Configï¼Œç„¶åå†è°ƒç”¨é…ç½®å¯¹è±¡çš„ Build æ–¹æ³•æ¥æ„å»º Loggerã€‚\nzap.Config å®šä¹‰å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 type Config struct { Level AtomicLevel `json:\u0026#34;level\u0026#34; yaml:\u0026#34;level\u0026#34;` Development bool `json:\u0026#34;development\u0026#34; yaml:\u0026#34;development\u0026#34;` DisableCaller bool `json:\u0026#34;disableCaller\u0026#34; yaml:\u0026#34;disableCaller\u0026#34;` DisableStacktrace bool `json:\u0026#34;disableStacktrace\u0026#34; yaml:\u0026#34;disableStacktrace\u0026#34;` Sampling *SamplingConfig `json:\u0026#34;sampling\u0026#34; yaml:\u0026#34;sampling\u0026#34;` Encoding string `json:\u0026#34;encoding\u0026#34; yaml:\u0026#34;encoding\u0026#34;` EncoderConfig zapcore.EncoderConfig `json:\u0026#34;encoderConfig\u0026#34; yaml:\u0026#34;encoderConfig\u0026#34;` OutputPaths []string `json:\u0026#34;outputPaths\u0026#34; yaml:\u0026#34;outputPaths\u0026#34;` ErrorOutputPaths []string `json:\u0026#34;errorOutputPaths\u0026#34; yaml:\u0026#34;errorOutputPaths\u0026#34;` InitialFields map[string]interface{} `json:\u0026#34;initialFields\u0026#34; yaml:\u0026#34;initialFields\u0026#34;` } æ¯ä¸ªé…ç½®é¡¹è¯´æ˜å¦‚ä¸‹ï¼š\nLevel: æ—¥å¿—çº§åˆ«ã€‚ Development: æ˜¯å¦ä¸ºå¼€å‘æ¨¡å¼ã€‚ DisableCaller: ç¦ç”¨è°ƒç”¨ä¿¡æ¯ï¼Œå€¼ä¸º true æ—¶ï¼Œæ—¥å¿—ä¸­å°†ä¸å†æ˜¾ç¤ºè®°å½•æ—¥å¿—æ—¶æ‰€åœ¨çš„å‡½æ•°è°ƒç”¨æ–‡ä»¶åå’Œè¡Œå·ã€‚ DisableStacktrace: ç¦ç”¨å †æ ˆè·Ÿè¸ªæ•è·ã€‚ Sampling: é‡‡æ ·ç­–ç•¥é…ç½®ï¼Œå•ä½ä¸ºæ¯ç§’ï¼Œä½œç”¨æ˜¯é™åˆ¶æ—¥å¿—åœ¨æ¯ç§’å†…çš„è¾“å‡ºæ•°é‡ï¼Œä»¥æ­¤æ¥é˜²æ­¢å…¨å±€çš„ CPU å’Œ I/O è´Ÿè½½è¿‡é«˜ã€‚ Encoding: æŒ‡å®šæ—¥å¿—ç¼–ç å™¨ï¼Œç›®å‰æ”¯æŒ json å’Œ consoleã€‚ EncoderConfig: ç¼–ç é…ç½®ï¼Œå†³å®šäº†æ—¥å¿—å­—æ®µæ ¼å¼ã€‚ OutputPaths: é…ç½®æ—¥å¿—è¾“å‡ºä½ç½®ï¼ŒURLs æˆ–æ–‡ä»¶è·¯å¾„ï¼Œå¯é…ç½®å¤šä¸ªã€‚ ErrorOutputPaths: zap åŒ…å†…éƒ¨å‡ºç°é”™è¯¯çš„æ—¥å¿—è¾“å‡ºä½ç½®ï¼ŒURLs æˆ–æ–‡ä»¶è·¯å¾„ï¼Œå¯é…ç½®å¤šä¸ªï¼Œé»˜è®¤ os.Stderrã€‚ InitialFields: åˆå§‹åŒ–å­—æ®µé…ç½®ï¼Œè¯¥é…ç½®çš„å­—æ®µä¼šä»¥ç»“æ„åŒ–çš„å½¢å¼æ‰“å°åœ¨æ¯æ¡æ—¥å¿—è¾“å‡ºä¸­ã€‚ æˆ‘ä»¬å†æ¥å¯¹æ¯”ä¸‹ NewProductionEncoderConfig() å’Œ NewDevelopmentEncoderConfig() è¿™ä¸¤ä¸ªé…ç½®çš„ä¸åŒï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 func NewProductionEncoderConfig() zapcore.EncoderConfig { return zapcore.EncoderConfig{ TimeKey: \u0026#34;ts\u0026#34;, LevelKey: \u0026#34;level\u0026#34;, NameKey: \u0026#34;logger\u0026#34;, CallerKey: \u0026#34;caller\u0026#34;, FunctionKey: zapcore.OmitKey, MessageKey: \u0026#34;msg\u0026#34;, StacktraceKey: \u0026#34;stacktrace\u0026#34;, LineEnding: zapcore.DefaultLineEnding, EncodeLevel: zapcore.LowercaseLevelEncoder, EncodeTime: zapcore.EpochTimeEncoder, EncodeDuration: zapcore.SecondsDurationEncoder, EncodeCaller: zapcore.ShortCallerEncoder, } } func NewDevelopmentEncoderConfig() zapcore.EncoderConfig { return zapcore.EncoderConfig{ // Keys can be anything except the empty string. TimeKey: \u0026#34;T\u0026#34;, LevelKey: \u0026#34;L\u0026#34;, NameKey: \u0026#34;N\u0026#34;, CallerKey: \u0026#34;C\u0026#34;, FunctionKey: zapcore.OmitKey, MessageKey: \u0026#34;M\u0026#34;, StacktraceKey: \u0026#34;S\u0026#34;, LineEnding: zapcore.DefaultLineEnding, EncodeLevel: zapcore.CapitalLevelEncoder, EncodeTime: zapcore.ISO8601TimeEncoder, EncodeDuration: zapcore.StringDurationEncoder, EncodeCaller: zapcore.ShortCallerEncoder, } } å¯¹æ¯”æ¥çœ‹ï¼Œä¸¤è€…æœ‰å¾ˆå¤šä¸åŒçš„é…ç½®ï¼Œæ¯”å¦‚ç”Ÿäº§ç¯å¢ƒä¸‹ EncodeTime å€¼ä¸º zapcore.EpochTimeEncoderï¼Œå¼€å‘ç¯å¢ƒä¸‹ EncodeTime å€¼ä¸º zapcore.ISO8601TimeEncoderã€‚è¿™å°±æ˜¯ç”Ÿäº§ç¯å¢ƒæ—¥å¿—è¾“å‡ºçš„æ—¶é—´æ ¼å¼ä¸º Unix epoch è€Œå¼€å‘ç¯å¢ƒæ—¥å¿—è¾“å‡ºçš„æ—¶é—´æ ¼å¼ä¸º ISO8601 çš„åŸå› ã€‚\nzapcore.EncoderConfig å…¶ä»–å‡ ä¸ªå¸¸ç”¨çš„é…ç½®é¡¹è¯´æ˜å¦‚ä¸‹ï¼š\nMessageKey: æ—¥å¿—ä¿¡æ¯çš„é”®åï¼Œé»˜è®¤ msgã€‚ LevelKey: æ—¥å¿—çº§åˆ«çš„é”®åï¼Œé»˜è®¤ levelã€‚ TimeKey: æ—¥å¿—æ—¶é—´çš„é”®åã€‚ EncodeLevel: æ—¥å¿—çº§åˆ«çš„æ ¼å¼ï¼Œé»˜è®¤ä¸ºå°å†™ï¼Œå¦‚ infoã€‚ é™¤äº†æä¾› zap.NewProduction() å’Œ zap.NewDevelopment() ä¸¤ä¸ªæ„é€ å‡½æ•°å¤–ï¼Œzap è¿˜æä¾›äº† zap.NewExample() æ¥åˆ›å»ºä¸€ä¸ª Logger å¯¹è±¡ï¼Œè¿™ä¸ªæ–¹æ³•ä¸»è¦ç”¨äºæµ‹è¯•ï¼Œè¿™é‡Œå°±ä¸å¤šä»‹ç»äº†ã€‚\n# è®°å½•å±‚çº§å…³ç³» å‰é¢æˆ‘ä»¬è®°å½•çš„æ—¥å¿—éƒ½æ˜¯ä¸€å±‚ç»“æ„ï¼Œæ²¡æœ‰åµŒå¥—çš„å±‚çº§ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨zap.Namespace(key string) Fieldæ„å»ºä¸€ä¸ªå‘½åç©ºé—´ï¼Œåç»­çš„Fieldéƒ½è®°å½•åœ¨æ­¤å‘½åç©ºé—´ä¸­ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 func main() { logger := zap.NewExample() defer logger.Sync() logger.Info(\u0026#34;tracked some metrics\u0026#34;, zap.Namespace(\u0026#34;metrics\u0026#34;), zap.Int(\u0026#34;counter\u0026#34;, 1), ) logger2 := logger.With( zap.Namespace(\u0026#34;metrics\u0026#34;), zap.Int(\u0026#34;counter\u0026#34;, 1), ) logger2.Info(\u0026#34;tracked some metrics\u0026#34;) } è¾“å‡ºï¼š\n1 2 {\u0026#34;level\u0026#34;:\u0026#34;info\u0026#34;,\u0026#34;msg\u0026#34;:\u0026#34;tracked some metrics\u0026#34;,\u0026#34;metrics\u0026#34;:{\u0026#34;counter\u0026#34;:1}} {\u0026#34;level\u0026#34;:\u0026#34;info\u0026#34;,\u0026#34;msg\u0026#34;:\u0026#34;tracked some metrices\u0026#34;,\u0026#34;metrics\u0026#34;:{\u0026#34;counter\u0026#34;:1}} ä¸Šé¢æˆ‘ä»¬æ¼”ç¤ºäº†ä¸¤ç§Namespaceçš„ç”¨æ³•ï¼Œä¸€ç§æ˜¯ç›´æ¥ä½œä¸ºå­—æ®µä¼ å…¥Debug/Infoç­‰æ–¹æ³•ï¼Œä¸€ç§æ˜¯è°ƒç”¨With()åˆ›å»ºä¸€ä¸ªæ–°çš„Loggerï¼Œæ–°çš„Loggerè®°å½•æ—¥å¿—æ—¶æ€»æ˜¯å¸¦ä¸Šé¢„è®¾çš„å­—æ®µã€‚With()æ–¹æ³•å®é™…ä¸Šæ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„Loggerï¼š\n1 2 3 4 5 6 7 8 9 // src/go.uber.org/zap/logger.go func (log *Logger) With(fields ...Field) *Logger { if len(fields) == 0 { return log } l := log.clone() l.core = l.core.With(fields) return l } # é¢„è®¾æ—¥å¿—å­—æ®µ å¦‚æœæ¯æ¡æ—¥å¿—éƒ½è¦è®°å½•ä¸€äº›å…±ç”¨çš„å­—æ®µï¼Œé‚£ä¹ˆä½¿ç”¨zap.Fields(fs ...Field)åˆ›å»ºçš„é€‰é¡¹ã€‚ä¾‹å¦‚åœ¨æœåŠ¡å™¨æ—¥å¿—ä¸­è®°å½•å¯èƒ½éƒ½éœ€è¦è®°å½•serverIdå’ŒserverNameï¼š\n1 2 3 4 5 6 7 8 func main() { logger := zap.NewExample(zap.Fields( zap.Int(\u0026#34;serverId\u0026#34;, 90), zap.String(\u0026#34;serverName\u0026#34;, \u0026#34;awesome web\u0026#34;), )) logger.Info(\u0026#34;hello world\u0026#34;) } è¾“å‡ºï¼š\n1 {\u0026#34;level\u0026#34;:\u0026#34;info\u0026#34;,\u0026#34;msg\u0026#34;:\u0026#34;hello world\u0026#34;,\u0026#34;serverId\u0026#34;:90,\u0026#34;serverName\u0026#34;:\u0026#34;awesome web\u0026#34;} ä¸logger.with()å·®ä¸å¤š\n# ç»™è¯­æ³•åŠ ç‚¹ç³– zap è™½ç„¶é€Ÿåº¦è¶³å¤Ÿå¿«ï¼Œä½†æ˜¯å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦æè‡´çš„æ€§èƒ½ï¼Œè€Œæ˜¯æƒ³è®©ä»£ç å†™èµ·æ¥æ›´çˆ½ä¸€äº›ã€‚zap ä¸ºæˆ‘ä»¬æä¾›äº†è§£å†³æ–¹æ¡ˆ â€”â€” SugaredLoggerã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 package main import ( \u0026#34;time\u0026#34; \u0026#34;go.uber.org/zap\u0026#34; ) func main() { logger, _ := zap.NewProduction() defer logger.Sync() url := \u0026#34;https://arlettebrook.github.io/\u0026#34; sugar := logger.Sugar() sugar.Infow(\u0026#34;production failed to fetch URL\u0026#34;, \u0026#34;url\u0026#34;, url, \u0026#34;attempt\u0026#34;, 3, \u0026#34;backoff\u0026#34;, time.Second, ) sugar.Info(\u0026#34;Info\u0026#34;) sugar.Infoln(\u0026#34;Infoln\u0026#34;) sugar.Infof(\u0026#34;Infof: %s\u0026#34;, url) } é€šè¿‡ logger.Sugar() æ–¹æ³•å¯ä»¥å°†ä¸€ä¸ª Logger å¯¹è±¡è½¬æ¢æˆä¸€ä¸ª SugaredLogger å¯¹è±¡ã€‚\nSugaredLogger æä¾›äº†æ›´äººæ€§åŒ–çš„æ¥å£ï¼Œæ—¥å¿—ä¸­è¿½åŠ  key-value æ—¶ä¸åœ¨éœ€è¦ zap.String(\u0026quot;url\u0026quot;, url) è¿™ç§æ˜¾å¼æŒ‡æ˜ç±»å‹çš„å†™æ³•ï¼Œåªéœ€è¦ä¿è¯ key ä¸º string ç±»å‹ï¼Œvalue åˆ™å¯ä»¥ä¸ºä»»æ„ç±»å‹ï¼Œèƒ½å¤Ÿå‡å°‘æˆ‘ä»¬ç¼–å†™çš„ä»£ç é‡ã€‚\næ­¤å¤–ï¼Œä¸ºäº†æ»¡è¶³ä¸åŒéœ€æ±‚ï¼ŒSugaredLogger æä¾›äº†å››ç§æ–¹å¼è¾“å‡ºæ—¥å¿—ï¼šsugar.Xxxã€sugar.Xxxwã€sugar.Xxxfã€sugar.Xxxlnã€‚\næ‰§è¡Œä»¥ä¸Šä»£ç ï¼Œæ§åˆ¶å°å¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š\n1 2 3 4 5 6 {\u0026#34;level\u0026#34;:\u0026#34;info\u0026#34;,\u0026#34;ts\u0026#34;:1714398451.8505704,\u0026#34;caller\u0026#34;:\u0026#34;learn/main.go:15\u0026#34;,\u0026#34;msg\u0026#34;:\u0026#34;production failed to fe tch URL\u0026#34;,\u0026#34;url\u0026#34;:\u0026#34;https://arlettebrook.github.io/\u0026#34;,\u0026#34;attempt\u0026#34;:3,\u0026#34;backoff\u0026#34;:1} {\u0026#34;level\u0026#34;:\u0026#34;info\u0026#34;,\u0026#34;ts\u0026#34;:1714398451.8511178,\u0026#34;caller\u0026#34;:\u0026#34;learn/main.go:20\u0026#34;,\u0026#34;msg\u0026#34;:\u0026#34;Info\u0026#34;} {\u0026#34;level\u0026#34;:\u0026#34;info\u0026#34;,\u0026#34;ts\u0026#34;:1714398451.851623,\u0026#34;caller\u0026#34;:\u0026#34;learn/main.go:21\u0026#34;,\u0026#34;msg\u0026#34;:\u0026#34;Infoln\u0026#34;} {\u0026#34;level\u0026#34;:\u0026#34;info\u0026#34;,\u0026#34;ts\u0026#34;:1714398451.8516397,\u0026#34;caller\u0026#34;:\u0026#34;learn/main.go:22\u0026#34;,\u0026#34;msg\u0026#34;:\u0026#34;Infof: https://arletteb rook.github.io/\u0026#34;} æˆ‘ä»¬çŸ¥é“ï¼Œè¿™ç§æ–¹ä¾¿çš„å†™æ³•æ˜¯æœ‰ä¸€å®šä»£ä»·çš„ï¼Œæ‰€ä»¥å¼€å‘ä¸­æ˜¯å¦éœ€è¦ä½¿ç”¨ SugaredLogger æ¥è®°å½•æ—¥å¿—ï¼Œéœ€è¦æ ¹æ®ç¨‹åºçš„ç‰¹ç‚¹æ¥å†³å®šã€‚SugaredLogger ä¸ Logger çš„æ€§èƒ½å¯¹æ¯”åŒæ ·å¯ä»¥åœ¨å®˜æ–¹ GitHub ä»“åº“ä¸­çœ‹åˆ°ã€‚\n# å®šåˆ¶ Logger é€šè¿‡æŸ¥çœ‹ zap.NewProduction() å’Œ zap.NewDevelopment() ä¸¤ä¸ªæ„é€ å‡½æ•°æºç ï¼Œæˆ‘ä»¬çŸ¥é“å¯ä»¥ä½¿ç”¨ zap.Config å¯¹è±¡çš„ Build æ–¹æ³•åˆ›å»º Logger å¯¹è±¡ã€‚é‚£ä¹ˆæˆ‘ä»¬å¾ˆå®¹æ˜“èƒ½å¤Ÿæƒ³åˆ°ï¼Œå¦‚æœè¦å®šåˆ¶ Loggerï¼Œåªéœ€è¦åˆ›å»ºä¸€ä¸ªå®šåˆ¶çš„ zap.Config å³å¯ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 package main import ( \u0026#34;go.uber.org/zap\u0026#34; \u0026#34;go.uber.org/zap/zapcore\u0026#34; ) func newCustomLogger() (*zap.Logger, error) { cfg := zap.Config{ Level: zap.NewAtomicLevelAt(zap.DebugLevel), Development: false, Encoding: \u0026#34;json\u0026#34;, EncoderConfig: zapcore.EncoderConfig{ TimeKey: \u0026#34;time\u0026#34;, LevelKey: \u0026#34;level\u0026#34;, NameKey: \u0026#34;logger\u0026#34;, CallerKey: \u0026#34;\u0026#34;, // ä¸è®°å½•æ—¥å¿—è°ƒç”¨ä½ç½® FunctionKey: zapcore.OmitKey, MessageKey: \u0026#34;message\u0026#34;, LineEnding: zapcore.DefaultLineEnding, EncodeLevel: zapcore.LowercaseLevelEncoder, EncodeTime: zapcore.RFC3339TimeEncoder, EncodeDuration: zapcore.SecondsDurationEncoder, EncodeCaller: zapcore.ShortCallerEncoder, }, OutputPaths: []string{\u0026#34;stdout\u0026#34;, \u0026#34;test.log\u0026#34;}, ErrorOutputPaths: []string{\u0026#34;error.log\u0026#34;}, } return cfg.Build() } func main() { logger, _ := newCustomLogger() defer logger.Sync() // å¢åŠ ä¸€ä¸ª skip é€‰é¡¹ï¼Œè§¦å‘ zap å†…éƒ¨ errorï¼Œå°†é”™è¯¯è¾“å‡ºåˆ° error.log logger = logger.WithOptions(zap.AddCallerSkip(100)) logger.Info(\u0026#34;Info msg\u0026#34;) logger.Error(\u0026#34;Error msg\u0026#34;) } ä»¥ä¸Šä»£ç é€šè¿‡ newCustomLogger å‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªè‡ªå®šä¹‰çš„ Loggerï¼ŒåŒæ ·é€šè¿‡å…ˆå®šä¹‰ä¸€ä¸ª zap.Config ç„¶åå†è°ƒç”¨å…¶ Build æ–¹æ³•æ¥å®ç°ã€‚\né…ç½®æ—¥å¿—åˆ†åˆ«è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºå’Œ test.log æ–‡ä»¶ï¼Œæ‰§è¡Œä»¥ä¸Šä»£ç ï¼Œæ§åˆ¶å°å’Œ test.log éƒ½ä¼šå¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š\n1 2 {\u0026#34;level\u0026#34;:\u0026#34;info\u0026#34;,\u0026#34;time\u0026#34;:\u0026#34;2023-03-19T19:19:18+08:00\u0026#34;,\u0026#34;message\u0026#34;:\u0026#34;Info msg\u0026#34;} {\u0026#34;level\u0026#34;:\u0026#34;error\u0026#34;,\u0026#34;time\u0026#34;:\u0026#34;2023-03-19T19:19:18+08:00\u0026#34;,\u0026#34;message\u0026#34;:\u0026#34;Error msg\u0026#34;} å¦å¤–ï¼Œæˆ‘ä»¬è¿˜é€šè¿‡ logger.WithOptions() ä¸º Logger å¯¹è±¡å¢åŠ äº†ä¸€ä¸ªé€‰é¡¹ zap.AddCallerSkip(100)ï¼Œè¿™ä¸ªé€‰é¡¹çš„ä½œç”¨æ˜¯æŒ‡å®šåœ¨é€šè¿‡è°ƒç”¨æ ˆè·å¾—è¡Œå·æ—¶è·³è¿‡çš„è°ƒç”¨æ·±åº¦ï¼Œå› ä¸ºæˆ‘ä»¬çš„å‡½æ•°è°ƒç”¨æ ˆå¹¶ä¸æ˜¯ 100 å±‚ï¼Œæ‰€ä»¥ä¼šè§¦å‘ zap å†…éƒ¨é”™è¯¯ï¼Œzap ä¼šå°†é”™è¯¯æ—¥å¿—è¾“å‡ºåˆ° ErrorOutputPaths é…ç½®æŒ‡å®šçš„ä½ç½®ä¸­ï¼Œå³ error.logã€‚\nerror.log å¾—åˆ°çš„é”™è¯¯æ—¥å¿—å¦‚ä¸‹ï¼š\n1 2 2023-03-19 11:19:18.438824 +0000 UTC Logger.check error: failed to get caller 2023-03-19 11:19:18.44921 +0000 UTC Logger.check error: failed to get caller # é€‰é¡¹ logger.WithOptions() æ”¯æŒçš„é€‰é¡¹å¦‚ä¸‹ï¼š\nWrapCore(f func(zapcore.Core) zapcore.Core): ä½¿ç”¨ä¸€ä¸ªæ–°çš„ zapcore.Core æ›¿æ¢æ‰ Logger å†…éƒ¨åŸæœ‰çš„çš„ zapcore.Core å±æ€§ã€‚ Hooks(hooks ...func(zapcore.Entry) error): æ³¨å†Œé’©å­å‡½æ•°ï¼Œç”¨æ¥åœ¨æ—¥å¿—æ‰“å°æ—¶åŒæ—¶è°ƒç”¨æ³¨å†Œçš„é’©å­å‡½æ•°ã€‚ Fields(fs ...Field): æ·»åŠ å…¬å…±å­—æ®µã€‚ ErrorOutput(w zapcore.WriteSyncer): æŒ‡å®šæ—¥å¿—ç»„ä»¶å†…éƒ¨å‡ºç°å¼‚å¸¸æ—¶çš„è¾“å‡ºä½ç½®ã€‚ Development(): å°†æ—¥å¿—è®°å½•å™¨è®¾ä¸ºå¼€å‘æ¨¡å¼ï¼Œè¿™å°†ä½¿ DPanic çº§åˆ«æ—¥å¿—è®°å½•é”™è¯¯åæ‰§è¡Œ panic()ã€‚ AddCaller(): ä¸ WithCaller(true) ç­‰ä»·ã€‚ WithCaller(enabled bool): æŒ‡å®šæ˜¯å¦åœ¨æ—¥å¿—è¾“å‡ºå†…å®¹ä¸­å¢åŠ è°ƒç”¨ä¿¡æ¯ï¼Œå³æ–‡ä»¶åå’Œè¡Œå·ã€‚ AddCallerSkip(skip int): æŒ‡å®šåœ¨é€šè¿‡è°ƒç”¨æ ˆè·å–æ–‡ä»¶åå’Œè¡Œå·æ—¶è·³è¿‡çš„è°ƒç”¨æ·±åº¦ã€‚ AddStacktrace(lvl zapcore.LevelEnabler): ç”¨æ¥æŒ‡å®šæŸä¸ªæ—¥å¿—çº§åˆ«åŠä»¥ä¸Šçº§åˆ«è¾“å‡ºè°ƒç”¨å †æ ˆã€‚ IncreaseLevel(lvl zapcore.LevelEnabler): æé«˜æ—¥å¿—çº§åˆ«ï¼Œå¦‚æœä¼ å…¥çš„ lvl æ¯”ç°æœ‰çº§åˆ«ä½ï¼Œåˆ™ä¸ä¼šæ”¹å˜æ—¥å¿—çº§åˆ«ã€‚ WithFatalHook(hook zapcore.CheckWriteHook): å½“å‡ºç° Fatal çº§åˆ«æ—¥å¿—æ—¶è°ƒç”¨çš„é’©å­å‡½æ•°ã€‚ WithClock(clock zapcore.Clock): æŒ‡å®šæ—¥å¿—è®°å½•å™¨ç”¨æ¥ç¡®å®šå½“å‰æ—¶é—´çš„ zapcore.Clock å¯¹è±¡ï¼Œé»˜è®¤ä¸º time.Now çš„ç³»ç»Ÿæ—¶é’Ÿã€‚ NewExample()/NewDevelopment()/NewProduction()è¿™ 3 ä¸ªå‡½æ•°å¯ä»¥ä¼ å…¥è‹¥å¹²ç±»å‹ä¸ºzap.Optionçš„é€‰é¡¹ï¼Œä»è€Œå®šåˆ¶Loggerçš„è¡Œä¸ºã€‚åˆä¸€æ¬¡è§åˆ°äº†é€‰é¡¹æ¨¡å¼ï¼ï¼\nzapæä¾›äº†ä¸°å¯Œçš„é€‰é¡¹ä¾›æˆ‘ä»¬é€‰æ‹©ã€‚\nè¾“å‡ºæ–‡ä»¶åå’Œè¡Œå·\nè°ƒç”¨zap.AddCaller()è¿”å›çš„é€‰é¡¹è®¾ç½®è¾“å‡ºæ–‡ä»¶åå’Œè¡Œå·ã€‚ä½†æ˜¯æœ‰ä¸€ä¸ªå‰æï¼Œå¿…é¡»è®¾ç½®é…ç½®å¯¹è±¡Configä¸­çš„CallerKeyå­—æ®µã€‚ä¹Ÿå› æ­¤NewExample()ä¸èƒ½è¾“å‡ºè¿™ä¸ªä¿¡æ¯ï¼ˆå®ƒçš„Configæ²¡æœ‰è®¾ç½®CallerKeyï¼‰ã€‚\nAddCaller()ä¸zap.WithCaller(true)ç­‰ä»·ã€‚ä¸€èˆ¬ä¸ç”¨\næœ‰æ—¶æˆ‘ä»¬ç¨å¾®å°è£…äº†ä¸€ä¸‹è®°å½•æ—¥å¿—çš„æ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬å¸Œæœ›è¾“å‡ºçš„æ–‡ä»¶åå’Œè¡Œå·æ˜¯è°ƒç”¨å°è£…å‡½æ•°çš„ä½ç½®ã€‚è¿™æ—¶å¯ä»¥ä½¿ç”¨zap.AddCallerSkip(skip int)å‘ä¸Šè·³ 1 å±‚ã€‚å¯èƒ½ä¼šç”¨åˆ°ã€‚\nè¾“å‡ºè°ƒç”¨å †æ ˆ\næœ‰æ—¶å€™åœ¨æŸä¸ªå‡½æ•°å¤„ç†ä¸­é‡åˆ°äº†å¼‚å¸¸æƒ…å†µï¼Œå› ä¸ºè¿™ä¸ªå‡½æ•°å¯èƒ½åœ¨å¾ˆå¤šåœ°æ–¹è¢«è°ƒç”¨ã€‚å¦‚æœæˆ‘ä»¬èƒ½è¾“å‡ºæ­¤æ¬¡è°ƒç”¨çš„å †æ ˆï¼Œé‚£ä¹ˆåˆ†æèµ·æ¥å°±ä¼šå¾ˆæ–¹ä¾¿ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨zap.AddStackTrace(lvl zapcore.LevelEnabler)è¾¾æˆè¿™ä¸ªç›®çš„ã€‚è¯¥å‡½æ•°æŒ‡å®šlvlå’Œä¹‹ä¸Šçš„çº§åˆ«éƒ½éœ€è¦è¾“å‡ºè°ƒç”¨å †æ ˆï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 package main import ( \u0026#34;go.uber.org/zap\u0026#34; \u0026#34;go.uber.org/zap/zapcore\u0026#34; ) func f1() { f2(\u0026#34;hello world\u0026#34;) } func f2(msg string, fields ...zap.Field) { zap.L().Warn(msg, fields...) // zap.L()è·å–å…¨å±€logger } func main() { logger, _ := zap.NewDevelopment(zap.AddStacktrace(zapcore.WarnLevel)) defer logger.Sync() zap.ReplaceGlobals(logger) // æ›¿æ¢å…¨å±€logger f1() } å°†zapcore.WarnLevelä¼ å…¥AddStacktrace()ï¼Œä¹‹åWarn()/Error()ç­‰çº§åˆ«çš„æ—¥å¿—ä¼šè¾“å‡ºå †æ ˆï¼ŒDebug()/Info()è¿™äº›çº§åˆ«ä¸ä¼šã€‚è¿è¡Œç»“æœï¼š\n1 2 3 4 5 6 7 8 9 2024-04-30T10:32:49.798+0800 WARN learn/main.go:13 hello world main.f2 F:/GoProject/learn/main.go:13 main.f1 F:/GoProject/learn/main.go:9 main.main F:/GoProject/learn/main.go:22 runtime.main D:/Go/src/runtime/proc.go:271 å¾ˆæ¸…æ¥šåœ°çœ‹åˆ°è°ƒç”¨è·¯å¾„ã€‚\nåˆ›å»ºè‡ªå®šä¹‰çš„é…ç½®å¯¹è±¡ï¼Œé™¤äº†åœ¨ä»£ç ä¸­æŒ‡å®šé…ç½®å‚æ•°ï¼Œä¹Ÿå¯ä»¥å°†è¿™äº›é…ç½®é¡¹å†™å…¥åˆ° JSON æ–‡ä»¶ä¸­ï¼Œç„¶åé€šè¿‡ json.Unmarshal çš„æ–¹å¼å°†é…ç½®ç»‘å®šåˆ° zap.Configï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹ç¤ºä¾‹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 func main() { rawJSON := []byte(`{ \u0026#34;level\u0026#34;:\u0026#34;debug\u0026#34;, \u0026#34;encoding\u0026#34;:\u0026#34;json\u0026#34;, \u0026#34;outputPaths\u0026#34;: [\u0026#34;stdout\u0026#34;, \u0026#34;server.log\u0026#34;], \u0026#34;errorOutputPaths\u0026#34;: [\u0026#34;stderr\u0026#34;], \u0026#34;initialFields\u0026#34;:{\u0026#34;name\u0026#34;:\u0026#34;dj\u0026#34;}, \u0026#34;encoderConfig\u0026#34;: { \u0026#34;messageKey\u0026#34;: \u0026#34;message\u0026#34;, \u0026#34;levelKey\u0026#34;: \u0026#34;level\u0026#34;, \u0026#34;levelEncoder\u0026#34;: \u0026#34;lowercase\u0026#34; } }`) var cfg zap.Config if err := json.Unmarshal(rawJSON, \u0026amp;cfg); err != nil { panic(err) } logger, err := cfg.Build() if err != nil { panic(err) } defer logger.Sync() logger.Info(\u0026#34;server start work successfully!\u0026#34;) } ä¸Šé¢åˆ›å»ºä¸€ä¸ªè¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºstdoutå’Œæ–‡ä»¶server.logçš„Loggerã€‚è§‚å¯Ÿè¾“å‡ºï¼š\n1 {\u0026#34;level\u0026#34;:\u0026#34;info\u0026#34;,\u0026#34;message\u0026#34;:\u0026#34;server start work successfully!\u0026#34;,\u0026#34;name\u0026#34;:\u0026#34;dj\u0026#34;} # å…¨å±€Logger ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œzapæä¾›äº†ä¸¤ä¸ªå…¨å±€çš„Loggerï¼Œä¸€ä¸ªæ˜¯*zap.Loggerï¼Œå¯è°ƒç”¨zap.L()è·å¾—ï¼›å¦ä¸€ä¸ªæ˜¯*zap.SugaredLoggerï¼Œå¯è°ƒç”¨zap.S()è·å¾—ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå…¨å±€çš„Loggeré»˜è®¤å¹¶ä¸ä¼šè®°å½•æ—¥å¿—ï¼å®ƒæ˜¯ä¸€ä¸ªæ— å®é™…æ•ˆæœçš„Loggerã€‚çœ‹æºç :\n1 2 3 4 5 6 // go.uber.org/zap/global.go var ( _globalMu sync.RWMutex _globalL = NewNop() _globalS = _globalL.Sugar() ) æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ReplaceGlobals(logger *Logger) func()å°†loggerè®¾ç½®ä¸ºå…¨å±€çš„Loggerï¼Œè¯¥å‡½æ•°è¿”å›ä¸€ä¸ªæ— å‚å‡½æ•°ï¼Œç”¨äºæ¢å¤å…¨å±€Loggerè®¾ç½®ï¼š\n1 2 3 4 5 6 7 8 9 10 11 func main() { zap.L().Info(\u0026#34;global Logger before\u0026#34;) zap.S().Info(\u0026#34;global SugaredLogger before\u0026#34;) logger := zap.NewExample() defer logger.Sync() zap.ReplaceGlobals(logger) zap.L().Info(\u0026#34;global Logger after\u0026#34;) zap.S().Info(\u0026#34;global SugaredLogger after\u0026#34;) } è¾“å‡ºï¼š\n1 2 {\u0026#34;level\u0026#34;:\u0026#34;info\u0026#34;,\u0026#34;msg\u0026#34;:\u0026#34;global Logger after\u0026#34;} {\u0026#34;level\u0026#34;:\u0026#34;info\u0026#34;,\u0026#34;msg\u0026#34;:\u0026#34;global SugaredLogger after\u0026#34;} å¯ä»¥çœ‹åˆ°åœ¨è°ƒç”¨ReplaceGlobalsä¹‹å‰è®°å½•çš„æ—¥å¿—å¹¶æ²¡æœ‰è¾“å‡ºã€‚\n# ä¸æ ‡å‡†æ—¥å¿—åº“æ­é…ä½¿ç”¨ å¦‚æœé¡¹ç›®ä¸€å¼€å§‹ä½¿ç”¨çš„æ˜¯æ ‡å‡†æ—¥å¿—åº“logï¼Œåé¢æƒ³è½¬ä¸ºzapã€‚è¿™æ—¶ä¸å¿…ä¿®æ”¹æ¯ä¸€ä¸ªæ–‡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥è°ƒç”¨zap.NewStdLog(l *Logger) *log.Loggerè¿”å›ä¸€ä¸ªæ ‡å‡†çš„log.Loggerï¼Œå†…éƒ¨å®é™…ä¸Šå†™å…¥çš„è¿˜æ˜¯æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„zap.Loggerï¼š\n1 2 3 4 5 6 7 func main() { logger := zap.NewExample() defer logger.Sync() std := zap.NewStdLog(logger) std.Print(\u0026#34;standard logger wrapper\u0026#34;) } è¾“å‡ºï¼š\n1 {\u0026#34;level\u0026#34;:\u0026#34;info\u0026#34;,\u0026#34;msg\u0026#34;:\u0026#34;standard logger wrapper\u0026#34;} å¾ˆæ–¹ä¾¿ä¸æ˜¯å—ï¼Ÿæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨NewStdLogAt(l *logger, level zapcore.Level) (*log.Logger, error)è®©æ ‡å‡†æ¥å£ä»¥levelçº§åˆ«å†™å…¥å†…éƒ¨çš„*zap.Loggerã€‚\nå¦‚æœæˆ‘ä»¬åªæ˜¯æƒ³åœ¨ä¸€æ®µä»£ç å†…ä½¿ç”¨æ ‡å‡†æ—¥å¿—åº“logï¼Œå…¶å®ƒåœ°æ–¹è¿˜æ˜¯ä½¿ç”¨zap.Loggerã€‚å¯ä»¥è°ƒç”¨RedirectStdLog(l *Logger) func()ã€‚å®ƒä¼šè¿”å›ä¸€ä¸ªæ— å‚å‡½æ•°æ¢å¤è®¾ç½®ï¼š\n1 2 3 4 5 6 7 8 9 10 func main() { logger := zap.NewExample() defer logger.Sync() undo := zap.RedirectStdLog(logger) log.Print(\u0026#34;redirected standard library\u0026#34;) undo() log.Print(\u0026#34;restored standard library\u0026#34;) } çœ‹å‰åè¾“å‡ºå˜åŒ–ï¼š\n1 2 {\u0026#34;level\u0026#34;:\u0026#34;info\u0026#34;,\u0026#34;msg\u0026#34;:\u0026#34;redirected standard library\u0026#34;} 2020/04/24 22:13:58 restored standard library å½“ç„¶RedirectStdLogä¹Ÿæœ‰ä¸€ä¸ªå¯¹åº”çš„RedirectStdLogAtä»¥ç‰¹å®šçš„çº§åˆ«è°ƒç”¨å†…éƒ¨çš„*zap.Loggeræ–¹æ³•ã€‚\n# å‚è€ƒ Go æ¯æ—¥ä¸€åº“ä¹‹ zap zap æºç : https://github.com/uber-go/zap zap æ–‡æ¡£: https://pkg.go.dev/go.uber.org/zap Go ç¬¬ä¸‰æ–¹ log åº“ä¹‹ zap ä½¿ç”¨ å¦‚ä½•åŸºäº zap å°è£…ä¸€ä¸ªæ›´å¥½ç”¨çš„æ—¥å¿—åº“ ","date":"2024-04-29T12:12:52+08:00","permalink":"https://arlettebrook.github.io/p/go%E7%AC%AC%E4%B8%89%E6%96%B9log%E5%BA%93%E4%B9%8Bzap/","title":"Goç¬¬ä¸‰æ–¹logåº“ä¹‹zap"},{"content":" # æ¦‚è¿° å¤§å¤šæ•°è¯­è¨€éƒ½æœ‰â€œä¾èµ–â€ã€â€œåŒ…â€ç­‰æ¦‚å¿µï¼ŒGoè¯­è¨€çš„ä¾èµ–å¤„ç†ç»å†äº†å‡ æ¬¡å˜é©ã€‚\næœ€æ—©çš„æ—¶å€™ï¼ŒGoæ‰€ä¾èµ–çš„æ‰€æœ‰çš„ç¬¬ä¸‰æ–¹åº“éƒ½æ”¾åœ¨GOPATHè¿™ä¸ªç›®å½•ä¸‹é¢ã€‚ä»v1.5å¼€å§‹å¼•å…¥vendoræ¨¡å¼ï¼Œå¦‚æœé¡¹ç›®ç›®å½•ä¸‹æœ‰vendorç›®å½•ï¼Œé‚£ä¹ˆgoå·¥å…·é“¾ä¼šä¼˜å…ˆä½¿ç”¨vendorå†…çš„åŒ…è¿›è¡Œç¼–è¯‘ã€æµ‹è¯•ç­‰ã€‚\nä»v1.11å¼€å§‹ï¼Œå¼•å…¥äº†Go Modules ä½œä¸ºä¾èµ–è§£å†³æ–¹æ¡ˆï¼Œåˆ°v1.14å®£å¸ƒGo Moduleså·²ç»å¯ä»¥ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œåˆ°v1.16ç‰ˆæœ¬å¼€å§‹Go Moduleé»˜è®¤å¼€å¯ã€‚\n# ä»€ä¹ˆæ˜¯ Go Modules Go modules æ˜¯ Go è¯­è¨€çš„ä¾èµ–è§£å†³æ–¹æ¡ˆï¼Œå‘å¸ƒäº Go1.11ï¼Œæˆé•¿äº Go1.12ï¼Œä¸°å¯Œäº Go1.13ï¼Œæ­£å¼äº Go1.14 æ¨èåœ¨ç”Ÿäº§ä¸Šä½¿ç”¨ã€‚\nGo Modulesä½¿å¾—Goè¯­è¨€å¼€å‘è€…èƒ½å¤Ÿæ›´æ–¹ä¾¿åœ°ç®¡ç†ä»£ç åŒ…åŠå…¶ç‰ˆæœ¬ï¼Œå¹¶èƒ½å¤Ÿä¸ç°æœ‰çš„ç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼ˆå¦‚Gitã€SVNç­‰ï¼‰é›†æˆä½¿ç”¨ã€‚\nåœ¨ä¼ ç»Ÿçš„GOPATHæ¨¡å¼ä¸­ï¼Œæ‰€æœ‰Goä»£ç éƒ½å¿…é¡»ä½äºä¸€ä¸ªå…¨å±€çš„GOPATHè·¯å¾„ä¹‹ä¸‹ï¼Œè¿™ä½¿å¾—åœ¨ä¸åŒé¡¹ç›®ä¸­ä½¿ç”¨ä¸åŒç‰ˆæœ¬çš„ä¾èµ–åŒ…å˜å¾—éå¸¸å›°éš¾ã€‚ç„¶è€Œï¼Œåœ¨Go Modulesæ¨¡å¼ä¸‹ï¼Œæ¯ä¸ªé¡¹ç›®éƒ½å¯ä»¥ç‹¬ç«‹ç®¡ç†è‡ªå·±çš„ä¾èµ–å…³ç³»ï¼Œå…·æœ‰æ›´å¥½çš„å…¼å®¹æ€§ã€‚å½“ä½¿ç”¨Go Modulesæ¨¡å¼åï¼Œé¡¹ç›®ä¸­ä¼šè‡ªåŠ¨åˆ›å»ºgo.modæ–‡ä»¶ï¼Œå…¶ä¸­è®°å½•äº†é¡¹ç›®æ‰€ä¾èµ–çš„æ¨¡å—åŠå…¶ç‰ˆæœ¬ä¿¡æ¯ã€‚go.modæ˜¯Goè¯­è¨€é¡¹ç›®ä¸­çš„æ¨¡å—æ–‡ä»¶ï¼Œç”¨äºç®¡ç†é¡¹ç›®çš„ä¾èµ–å…³ç³»å’Œç‰ˆæœ¬ä¿¡æ¯ã€‚\nGo Modulesä¹Ÿæ”¯æŒè¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶ï¼Œè¿™æ„å‘³ç€å¼€å‘è€…å¯ä»¥æŒ‡å®šä¾èµ–åŒ…çš„ç‰ˆæœ¬èŒƒå›´ï¼Œè€Œä¸æ˜¯ä»…ä»…ä¾èµ–æœ€æ–°çš„ç‰ˆæœ¬ã€‚è¿™ç§çµæ´»æ€§æœ‰åŠ©äºç¡®ä¿é¡¹ç›®çš„ç¨³å®šæ€§å’Œå¯ç»´æŠ¤æ€§ã€‚\nGo moudles ç›®å‰é›†æˆåœ¨ Go çš„å·¥å…·é“¾ä¸­ï¼Œåªè¦å®‰è£…äº† Goï¼Œè‡ªç„¶è€Œç„¶ä¹Ÿå°±å¯ä»¥ä½¿ç”¨ Go moudles äº†ï¼Œè€Œ Go modules çš„å‡ºç°ä¹Ÿè§£å†³äº†åœ¨ Go1.11 å‰çš„å‡ ä¸ªå¸¸è§äº‰è®®é—®é¢˜ï¼š\nGo è¯­è¨€é•¿ä¹…ä»¥æ¥çš„ä¾èµ–ç®¡ç†é—®é¢˜ã€‚ â€œæ·˜æ±°â€ç°æœ‰çš„ GOPATH çš„ä½¿ç”¨æ¨¡å¼ã€‚ ç»Ÿä¸€ç¤¾åŒºä¸­çš„å…¶å®ƒçš„ä¾èµ–ç®¡ç†å·¥å…·ï¼ˆæä¾›è¿ç§»åŠŸèƒ½ï¼‰ã€‚ ä¼˜åŠ¿\né¦–å…ˆï¼Œç ”å‘è€…èƒ½å¤Ÿåœ¨ä»»ä½•ç›®å½•ä¸‹å·¥ä½œï¼Œè€Œä¸ä»…ä»…æ˜¯åœ¨GOPATHæŒ‡å®šçš„ç›®å½•ã€‚ å¯ä»¥å®‰è£…ä¾èµ–åŒ…çš„æŒ‡å®šç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯åªèƒ½ä»masteråˆ†æ”¯å®‰è£…æœ€æ–°çš„ç‰ˆæœ¬ã€‚ å¯ä»¥å¯¼å…¥åŒä¸€ä¸ªä¾èµ–åŒ…çš„å¤šä¸ªç‰ˆæœ¬ã€‚å½“æˆ‘ä»¬è€é¡¹ç›®ä½¿ç”¨è€ç‰ˆæœ¬ï¼Œæ–°é¡¹ç›®ä½¿ç”¨æ–°ç‰ˆæœ¬æ—¶ä¼šéå¸¸æœ‰ç”¨ã€‚ è¦æœ‰ä¸€ä¸ªèƒ½å¤Ÿç½—åˆ—å½“å‰é¡¹ç›®æ‰€ä¾èµ–åŒ…çš„åˆ—è¡¨ã€‚è¿™ä¸ªçš„å¥½å¤„æ˜¯å½“æˆ‘ä»¬å‘å¸ƒé¡¹ç›®æ—¶ä¸ç”¨åŒæ—¶å‘å¸ƒæ‰€ä¾èµ–çš„åŒ…ã€‚Goèƒ½å¤Ÿæ ¹æ®è¯¥æ–‡ä»¶è‡ªåŠ¨ä¸‹è½½å¯¹åº”çš„åŒ…ã€‚ # GO PATHä»‹ç» å®‰è£…å¥½goå¼€å‘ç¯å¢ƒä¹‹åï¼Œå¯ä»¥è¿è¡Œgo envæŸ¥çœ‹goè¿è¡Œæ—¶çš„ç¯å¢ƒå˜é‡ã€‚è¦ä¿®æ”¹è¿™äº›ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥é€šè¿‡é…ç½®ç¯å¢ƒå˜é‡æ¥è¦†ç›–é»˜è®¤å€¼(è¦†ç›–äº†å°±ä¸èƒ½é€šè¿‡å‘½ä»¤è®¾ç½®)ï¼Œå¦‚ä¸´æ—¶è®¾ç½®export GO111MODULE=onã€‚æˆ–è€…é€šè¿‡å‘½ä»¤go env -w key=valueï¼Œå¦‚go env -w GO111MODULE=onã€‚é€šè¿‡å‘½ä»¤ä¿®æ”¹çš„ç¯å¢ƒå˜é‡ä¿å­˜åœ¨GOENVè¿™ä¸ªç¯å¢ƒå˜é‡æŒ‡å‘çš„æ–‡ä»¶ã€‚\næœ‰ä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„ç¯å¢ƒå˜é‡ï¼š\nGOROOTï¼šGolang å®‰è£…ç›®å½•çš„è·¯å¾„ï¼ŒåŒ…å«ç¼–è¯‘å™¨ç¨‹åºå’Œç³»ç»ŸåŒ…ï¼Œä¹Ÿå¯ä»¥æ”¾ç½®ä¸‰æ–¹åŒ…ï¼ˆä¸æ¨èï¼‰ã€‚æ–°ç‰ˆæœ¬å·²ç»ä¸éœ€è¦é…ç½®è¿™ä¸ªç¯å¢ƒå˜é‡äº†ï¼Œå®‰è£…äº†goä¼šè‡ªåŠ¨æ¨æ–­å‡ºè¯¥å˜é‡çš„å€¼ã€‚å¦‚æœå®‰è£…ä¹‹åç¯å¢ƒå˜é‡ä¸­æ²¡æœ‰$GORROOT/bin,éœ€è¦æ‰‹åŠ¨æ·»åŠ ï¼Œè¿™æ ·æ‰èƒ½ç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œgoç¼–è¯‘ç¨‹åºã€‚ GOPATHï¼šè¯¥å·¥ä½œç›®å½•ï¼Œæ”¾ç½®ç¼–è¯‘åäºŒè¿›åˆ¶å’Œ import åŒ…æ—¶çš„æœç´¢è·¯å¾„ï¼Œä¸€èˆ¬æœ‰ä¸‰ä¸ªç›®å½•: binã€pkgã€srcã€‚å¹¶ä¸”è¯¥ç¯å¢ƒå˜é‡å¿…é¡»æ‰‹åŠ¨è®¾ç½®ã€‚ binï¼šç”¨æ¥å­˜æ”¾ç¼–è¯‘åçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚å¼•å…¥Go modulesä¹‹åç”¨äºå­˜æ”¾get installå®‰è£…çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚ pkgï¼šå­˜å‚¨é¢„ç¼–è¯‘çš„ç›®æ ‡æ–‡ä»¶ï¼Œä»¥åŠ å¿«ç¨‹åºçš„åç»­ç¼–è¯‘é€Ÿåº¦ã€‚å¼•å…¥Go modulesä¹‹åç”¨äºå­˜æ”¾ç¬¬ä¸‰æ–¹åŒ…ã€‚ srcï¼šå­˜å‚¨æ‰€æœ‰.goæ–‡ä»¶æˆ–æºä»£ç ã€‚åœ¨ç¼–å†™ Go åº”ç”¨ç¨‹åºï¼Œç¨‹åºåŒ…å’Œåº“æ—¶ï¼Œä¸€èˆ¬ä¼šä»¥$GOPATH/src/github.com/foo/barçš„è·¯å¾„è¿›è¡Œå­˜æ”¾ã€‚å¼•å…¥Go modulesä¹‹åç”¨ä¸€èˆ¬ä¸ç”¨ï¼Œgoé¡¹ç›®å¯ä»¥æ”¾åœ¨ä»»æ„ç›®å½•ä¸­ï¼Œä¸åœ¨æ˜¯$GOPATH/src å› æ­¤åœ¨ä½¿ç”¨ GOPATH æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å°†åº”ç”¨ä»£ç å­˜æ”¾åœ¨å›ºå®šçš„$GOPATH/srcç›®å½•ä¸‹ï¼Œå¹¶ä¸”å¦‚æœæ‰§è¡Œgo getæ¥æ‹‰å–å¤–éƒ¨ä¾èµ–ä¼šè‡ªåŠ¨ä¸‹è½½å¹¶å®‰è£…åˆ°$GOPATHç›®å½•ä¸‹ã€‚\n# GOPATHæ¨¡å¼çš„å¼Šç«¯ åœ¨ GOPATH çš„ $GOPATH/src ä¸‹è¿›è¡Œ .go æ–‡ä»¶æˆ–æºä»£ç çš„å­˜å‚¨ï¼Œæˆ‘ä»¬å¯ä»¥ç§°å…¶ä¸º GOPATH çš„æ¨¡å¼ï¼Œè¿™ä¸ªæ¨¡å¼æ‹¥æœ‰ä¸€äº›å¼Šç«¯ã€‚\nA. æ— ç‰ˆæœ¬æ§åˆ¶æ¦‚å¿µ. åœ¨æ‰§è¡Œgo getçš„æ—¶å€™ï¼Œä½ æ— æ³•ä¼ è¾¾ä»»ä½•çš„ç‰ˆæœ¬ä¿¡æ¯çš„æœŸæœ›ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ ä¹Ÿæ— æ³•çŸ¥é“è‡ªå·±å½“å‰æ›´æ–°çš„æ˜¯å“ªä¸€ä¸ªç‰ˆæœ¬ï¼Œä¹Ÿæ— æ³•é€šè¿‡æŒ‡å®šæ¥æ‹‰å–è‡ªå·±æ‰€æœŸæœ›çš„å…·ä½“ç‰ˆæœ¬ã€‚ B.æ— æ³•åŒæ­¥ä¸€è‡´ç¬¬ä¸‰æ–¹ç‰ˆæœ¬å·. åœ¨è¿è¡Œ Go åº”ç”¨ç¨‹åºçš„æ—¶å€™ï¼Œä½ æ— æ³•ä¿è¯å…¶å®ƒäººä¸ä½ æ‰€æœŸæœ›ä¾èµ–çš„ç¬¬ä¸‰æ–¹åº“æ˜¯ç›¸åŒçš„ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨é¡¹ç›®ä¾èµ–åº“çš„ç®¡ç†ä¸Šï¼Œä½ æ— æ³•ä¿è¯æ‰€æœ‰äººçš„ä¾èµ–ç‰ˆæœ¬éƒ½ä¸€è‡´ã€‚ C.æ— æ³•æŒ‡å®šå½“å‰é¡¹ç›®å¼•ç”¨çš„ç¬¬ä¸‰æ–¹ç‰ˆæœ¬å·. ä½ æ²¡åŠæ³•å¤„ç† v1ã€v2ã€v3 ç­‰ç­‰ä¸åŒç‰ˆæœ¬çš„å¼•ç”¨é—®é¢˜ï¼Œå› ä¸º GOPATH æ¨¡å¼ä¸‹çš„å¯¼å…¥è·¯å¾„éƒ½æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯github.com/foo/barã€‚ Go è¯­è¨€å®˜æ–¹ä» Go1.11 èµ·å¼€å§‹æ¨è¿› Go modulesï¼ˆå‰èº«vgoï¼ŒçŸ¥é“å³å¯ï¼Œä¸éœ€è¦æ·±å…¥äº†è§£ï¼‰ï¼ŒGo1.13 èµ·ä¸å†æ¨èä½¿ç”¨ GOPATH çš„ä½¿ç”¨æ¨¡å¼ï¼ŒGo modules ä¹Ÿæ¸è¶‹ç¨³å®šï¼Œå› æ­¤æ–°é¡¹ç›®ä¹Ÿæ²¡æœ‰å¿…è¦ç»§ç»­ä½¿ç”¨GOPATHæ¨¡å¼ã€‚\n# Go Module è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒ Go Module çš„è®¾è®¡é‡‡ç”¨äº†è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒï¼Œè¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒéå¸¸æµè¡Œä¸”å…·æœ‰æŒ‡å¯¼æ„ä¹‰ï¼Œæœ¬æ–‡å°±æ¥èŠèŠè¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒçš„è®¾è®¡å’Œåœ¨ Go ä¸­çš„åº”ç”¨ã€‚\n# è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒ è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒï¼ˆSemVerï¼‰æ˜¯ç”± Gravatars åˆ›åŠè€…å…¼ GitHub å…±åŒåˆ›åŠè€… Tom Preston-Werner æ‰€å»ºç«‹ï¼Œæ—¨åœ¨è§£å†³ ä¾èµ–åœ°ç‹± é—®é¢˜ã€‚\nå®ƒæ¸…æ¥šæ˜äº†çš„è§„å®šäº†ç‰ˆæœ¬æ ¼å¼ã€ç‰ˆæœ¬å·é€’å¢è§„ï¼š\nç‰ˆæœ¬æ ¼å¼ï¼šé‡‡ç”¨ X.Y.Z çš„æ ¼å¼ï¼ŒX æ˜¯ä¸»ç‰ˆæœ¬å·ã€Y æ˜¯æ¬¡ç‰ˆæœ¬å·ã€è€Œ Z ä¸ºä¿®è®¢å·ï¼ˆå³ï¼šä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·ï¼‰ï¼Œå…¶ä¸­ Xã€Y å’Œ Z ä¸ºéè´Ÿçš„æ•´æ•°ï¼Œä¸”ç¦æ­¢åœ¨æ•°å­—å‰æ–¹è¡¥é›¶ã€‚\nç‰ˆæœ¬å·é€’å¢è§„åˆ™ï¼š\nä¸»ç‰ˆæœ¬å·ï¼šå½“åšäº†ä¸å…¼å®¹çš„ API ä¿®æ”¹ã€‚\næ¬¡ç‰ˆæœ¬å·ï¼šå½“åšäº†å‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ€§æ–°å¢åŠä¿®æ”¹ã€‚\nä¿®è®¢å·ï¼šå½“åšäº†å‘ä¸‹å…¼å®¹çš„é—®é¢˜ä¿®æ­£ã€‚\nå¦å¤–ï¼Œå…ˆè¡Œç‰ˆæœ¬å· åŠ ç‰ˆæœ¬ç¼–è¯‘ä¿¡æ¯ å¯ä»¥åŠ åˆ° ä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å· çš„åé¢ï¼Œä½œä¸ºå»¶ä¼¸ã€‚\nå®Œæ•´ç‰ˆæœ¬æ ¼å¼å¦‚ä¸‹ï¼š\nå…ˆè¡Œç‰ˆæœ¬å·å¯ä»¥æœ‰å¤šä¸ªï¼Œå¦‚ç¬¬ä¸€ä¸ªä¸ºUTCæ—¶é—´ï¼Œç¬¬äºŒä¸ªä¸ºæäº¤çš„å“ˆå¸Œå€¼ï¼š\n1 2 v4.0.1-0.20210109023952-943e75fe5223+incompatible v0.0.0-20240416160154-fe59bbe5cc7f å…¶ä¸­ç‰ˆæœ¬å·æ ¸å¿ƒéƒ¨åˆ† X.Y.Z æ˜¯å¿…é¡»çš„ï¼Œä½¿ç”¨ . è¿æ¥ï¼Œå…ˆè¡Œç‰ˆæœ¬å·å’Œç‰ˆæœ¬ç¼–è¯‘ä¿¡æ¯æ˜¯å¯é€‰çš„ï¼Œå…ˆè¡Œç‰ˆæœ¬å·é€šè¿‡ - ä¸æ ¸å¿ƒéƒ¨åˆ†è¿æ¥ï¼Œç‰ˆæœ¬ç¼–è¯‘ä¿¡æ¯é€šè¿‡ + ä¸æ ¸å¿ƒéƒ¨åˆ†æˆ–å…ˆè¡Œç‰ˆæœ¬å·è¿æ¥ã€‚\nåˆæ³•çš„å‡ ç§ç‰ˆæœ¬å·æ ¼å¼å¦‚ä¸‹ï¼š\nä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å· ä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·-å…ˆè¡Œç‰ˆæœ¬å· ä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·+ç‰ˆæœ¬ç¼–è¯‘ä¿¡æ¯ ä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·-å…ˆè¡Œç‰ˆæœ¬å·+ç‰ˆæœ¬ç¼–è¯‘ä¿¡æ¯ ä¸»ç‰ˆæœ¬å·å¿…é¡»åœ¨æœ‰ä»»ä½•ä¸å…¼å®¹çš„ä¿®æ”¹è¢«åŠ å…¥å…¬å…± API æ—¶é€’å¢ã€‚æ¯å½“ä¸»ç‰ˆæœ¬å·é€’å¢æ—¶ï¼Œæ¬¡ç‰ˆæœ¬å·å’Œä¿®è®¢å·å¿…é¡»å½’é›¶ã€‚\næ¬¡ç‰ˆæœ¬å·å¿…é¡»åœ¨æœ‰å‘ä¸‹å…¼å®¹çš„æ–°åŠŸèƒ½å‡ºç°æˆ–æœ‰æ”¹è¿›æ—¶é€’å¢ï¼Œæˆ–åœ¨ä»»ä½•å…¬å…± API çš„åŠŸèƒ½è¢«æ ‡è®°ä¸ºå¼ƒç”¨æ—¶ä¹Ÿå¿…é¡»é€’å¢ã€‚æ¯å½“æ¬¡ç‰ˆæœ¬å·é€’å¢æ—¶ï¼Œä¿®è®¢å·å¿…é¡»å½’é›¶ã€‚\nä¿®è®¢å·å¿…é¡»åœ¨åªåšäº†å‘ä¸‹å…¼å®¹çš„ä¿®æ­£æ—¶æ‰é€’å¢ã€‚è¿™é‡Œçš„ä¿®æ­£æŒ‡çš„æ˜¯é’ˆå¯¹ä¸æ­£ç¡®ç»“æœè€Œè¿›è¡Œçš„å†…éƒ¨ä¿®æ”¹ã€‚\nå­˜åœ¨å…ˆè¡Œç‰ˆæœ¬å·ï¼Œæ„å‘³ç€å½“å‰ç‰ˆæœ¬ä¸å¤Ÿç¨³å®šï¼Œä¸”å¯èƒ½å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ã€‚å…ˆè¡Œç‰ˆæœ¬å·æ˜¯ä¸€è¿ä¸²ä»¥ . åˆ†éš”çš„æ ‡è¯†ç¬¦ï¼Œç”± ASCII å­—æ¯æ•°å­—å’Œè¿æ¥å· [0-9A-Za-z-] ç»„æˆï¼Œç¦æ­¢å‡ºç°ç©ºç™½ç¬¦ï¼Œæ•°å­—ç±»å‹åˆ™ç¦æ­¢åœ¨å‰æ–¹è¡¥é›¶ã€‚åˆæ³•ç¤ºä¾‹ï¼š1.0.0-alphaã€1.0.0-alpha.1ã€1.0.0-0.3.7ã€1.0.0-x.7.z.92ã€‚\nç‰ˆæœ¬ç¼–è¯‘ä¿¡æ¯æ ‡å¿—ç¬¦è§„æ ¼ä¸å…ˆè¡Œç‰ˆæœ¬å·åŸºæœ¬ç›¸åŒï¼Œç•¥æœ‰å·®å¼‚çš„æ˜¯æ•°å­—ç±»å‹å‰æ–¹å…è®¸è¡¥é›¶ã€‚åˆæ³•ç¤ºä¾‹ï¼š1.0.0-alpha+001ã€1.0.0+20130313144700ã€1.0.0-beta+exp.sha.5114f85ã€‚\né™¤äº†ä¸Šé¢å‡ ç‚¹è¯´æ˜ï¼Œè¿˜éœ€è¦é¢å¤–å…³æ³¨ä»¥ä¸‹å‡ ç‚¹ï¼š\næ ‡è®°ç‰ˆæœ¬å·çš„è½¯ä»¶å‘è¡Œåï¼Œç¦æ­¢æ”¹å˜è¯¥ç‰ˆæœ¬è½¯ä»¶çš„å†…å®¹ã€‚ä»»ä½•ä¿®æ”¹éƒ½å¿…é¡»ä»¥æ–°ç‰ˆæœ¬å‘è¡Œã€‚ ä¸»ç‰ˆæœ¬å·ä¸ºé›¶ï¼ˆ0.y.zï¼‰çš„è½¯ä»¶å¤„äºå¼€å‘åˆå§‹é˜¶æ®µï¼Œä¸€åˆ‡éƒ½å¯èƒ½éšæ—¶è¢«æ”¹å˜ã€‚è¿™æ ·çš„å…¬å…± API ä¸åº”è¯¥è¢«è§†ä¸ºç¨³å®šç‰ˆã€‚ 1.0.0 çš„ç‰ˆæœ¬å·ç”¨äºç•Œå®šå…¬å…± API çš„å½¢æˆã€‚è¿™ä¸€ç‰ˆæœ¬ä¹‹åæ‰€æœ‰çš„ç‰ˆæœ¬å·æ›´æ–°éƒ½åŸºäºå…¬å…± API åŠå…¶ä¿®æ”¹å†…å®¹ã€‚ ç¤¾åŒºä¸­è¿˜å­˜åœ¨ä¸€ä¸ªä¸æˆæ–‡çš„è§„å®šï¼Œå¯¹äºæ¬¡ç‰ˆæœ¬å·ï¼Œå¶æ•°ä¸ºç¨³å®šç‰ˆæœ¬ï¼Œå¥‡æ•°ä¸ºå¼€å‘ç‰ˆæœ¬ã€‚å½“ç„¶ä¸æ˜¯æ‰€æœ‰é¡¹ç›®éƒ½è¿™æ ·è®¾è®¡ã€‚ # ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒå¯èƒ½é‡åˆ°çš„é—®é¢˜ åœ¨ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½äººä¸ºæˆ–ç¨‹åºç¼–å†™é”™è¯¯å¯¼è‡´å‡ºç°å¦‚ä¸‹å‡ ç§å¯é¢„è§çš„é—®é¢˜ï¼š\nä¸‡ä¸€ä¸å°å¿ƒæŠŠä¸€ä¸ªä¸å…¼å®¹çš„æ”¹ç‰ˆå½“æˆäº†æ¬¡ç‰ˆæœ¬å·å‘è¡Œäº†è¯¥æ€ä¹ˆåŠï¼Ÿ\nä¸€æ—¦å‘ç°è‡ªå·±ç ´åäº†è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶çš„è§„èŒƒï¼Œå°±è¦ä¿®æ­£è¿™ä¸ªé—®é¢˜ï¼Œå¹¶å‘è¡Œä¸€ä¸ªæ–°çš„æ¬¡ç‰ˆæœ¬å·æ¥æ›´æ­£è¿™ä¸ªé—®é¢˜å¹¶ä¸”æ¢å¤å‘ä¸‹å…¼å®¹ã€‚å³ä½¿æ˜¯è¿™ç§æƒ…å†µï¼Œä¹Ÿä¸èƒ½å»ä¿®æ”¹å·²å‘è¡Œçš„ç‰ˆæœ¬ã€‚å¯ä»¥çš„è¯ï¼Œå°†æœ‰é—®é¢˜çš„ç‰ˆæœ¬å·è®°å½•åˆ°æ–‡æ¡£ä¸­ï¼Œå‘Šè¯‰ä½¿ç”¨è€…é—®é¢˜æ‰€åœ¨ï¼Œè®©ä»–ä»¬èƒ½å¤Ÿæ„è¯†åˆ°è¿™æ˜¯æœ‰é—®é¢˜çš„ç‰ˆæœ¬ã€‚\næ³¨æ„ï¼šä¸åˆ°ä¸‡ä¸å¾—å·²ï¼Œä¸è¦ä¹Ÿä¸èƒ½å»ä¿®æ”¹å·²å‘è¡Œçš„ç‰ˆæœ¬ã€‚\nå¦‚æœæˆ‘å˜æ›´äº†å…¬å…± API ä½†æ— æ„ä¸­æœªéµå¾ªç‰ˆæœ¬å·çš„æ”¹åŠ¨æ€ä¹ˆåŠå‘¢ï¼Ÿï¼ˆæ„å³åœ¨ä¿®è®¢ç­‰çº§çš„å‘å¸ƒä¸­ï¼Œè¯¯å°†é‡å¤§ä¸”ä¸å…¼å®¹çš„æ”¹å˜åŠ åˆ°ä»£ç ä¹‹ä¸­ï¼‰\nè‡ªè¡Œåšæœ€ä½³çš„åˆ¤æ–­ã€‚å¦‚æœä½ æœ‰åºå¤§çš„ä½¿ç”¨è€…ç¾¤åœ¨ä¾ç…§å…¬å…± API çš„æ„å›¾è€Œå˜æ›´è¡Œä¸ºåä¼šå¤§å—å½±å“ï¼Œé‚£ä¹ˆæœ€å¥½åšä¸€æ¬¡ä¸»ç‰ˆæœ¬çš„å‘å¸ƒï¼Œå³ä½¿ä¸¥æ ¼æ¥è¯´è¿™ä¸ªä¿®å¤ä»…æ˜¯ä¿®è®¢ç­‰çº§çš„å‘å¸ƒã€‚è®°ä½ï¼Œè¯­ä¹‰åŒ–çš„ç‰ˆæœ¬æ§åˆ¶å°±æ˜¯é€è¿‡ç‰ˆæœ¬å·çš„æ”¹å˜æ¥ä¼ è¾¾æ„ä¹‰ã€‚è‹¥è¿™äº›æ”¹å˜å¯¹ä½ çš„ä½¿ç”¨è€…æ˜¯é‡è¦çš„ï¼Œé‚£å°±é€è¿‡ç‰ˆæœ¬å·æ¥å‘ä»–ä»¬è¯´æ˜ã€‚\nv1.2.3 æ˜¯ä¸€ä¸ªè¯­ä¹‰åŒ–ç‰ˆæœ¬å·å—ï¼Ÿ\nv1.2.3 å¹¶ä¸æ˜¯çš„ä¸€ä¸ªè¯­ä¹‰åŒ–çš„ç‰ˆæœ¬å·ã€‚ä½†æ˜¯ï¼Œåœ¨è¯­ä¹‰åŒ–ç‰ˆæœ¬å·ä¹‹å‰å¢åŠ å‰ç¼€ v æ˜¯ç”¨æ¥è¡¨ç¤ºç‰ˆæœ¬å·çš„å¸¸ç”¨åšæ³•ã€‚åœ¨ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸­ï¼Œå°† version ç¼©å†™ä¸º v æ˜¯å¾ˆå¸¸è§çš„ã€‚æ¯”å¦‚ï¼šgit tag v1.2.3 -m \u0026quot;Release version 1.2.3\u0026quot; ä¸­ï¼Œv1.2.3 è¡¨ç¤ºæ ‡ç­¾åç§°ï¼Œè€Œ 1.2.3 æ˜¯è¯­ä¹‰åŒ–ç‰ˆæœ¬å·ã€‚go modulesçš„æ¨¡å—ç‰ˆæœ¬ä¹Ÿæ˜¯åœ¨å‰é¢åŠ v\n# å¦‚ä½•éªŒè¯è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒæ­£ç¡®æ€§ å®˜æ–¹æä¾›äº†ä¸¤ä¸ªæ­£åˆ™å¯ä»¥æ£€æŸ¥è¯­ä¹‰åŒ–ç‰ˆæœ¬å·çš„æ­£ç¡®æ€§ã€‚\næ”¯æŒæŒ‰ç»„åç§°æå–åŒ¹é…ç»“æœ\n1 ^(?P\u0026lt;major\u0026gt;0|[1-9]\\d*)\\.(?P\u0026lt;minor\u0026gt;0|[1-9]\\d*)\\.(?P\u0026lt;patch\u0026gt;0|[1-9]\\d*)(?:-(?P\u0026lt;prerelease\u0026gt;(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+(?P\u0026lt;buildmetadata\u0026gt;[0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$ Go è¯­è¨€ç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 package main import ( \u0026#34;encoding/json\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;regexp\u0026#34; ) func main() { version := \u0026#34;0.1.2-alpha+001\u0026#34; pattern := regexp.MustCompile(`^(?P\u0026lt;major\u0026gt;0|[1-9]\\d*)\\.(?P\u0026lt;minor\u0026gt;0|[1-9]\\d*)\\.(?P\u0026lt;patch\u0026gt;0|[1-9]\\d*)(?:-(?P\u0026lt;prerelease\u0026gt;(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+(?P\u0026lt;buildmetadata\u0026gt;[0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$`) r := pattern.FindStringSubmatch(version) m := make(map[string]string) for i, name := range pattern.SubexpNames() { if i == 0 { m[\u0026#34;version\u0026#34;] = r[i] } else { m[name] = r[i] } } result, _ := json.MarshalIndent(m, \u0026#34;\u0026#34;, \u0026#34; \u0026#34;) fmt.Printf(\u0026#34;%s\\n\u0026#34;, result) } /* { \u0026#34;buildmetadata\u0026#34;: \u0026#34;001\u0026#34;, \u0026#34;major\u0026#34;: \u0026#34;0\u0026#34;, \u0026#34;minor\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;patch\u0026#34;: \u0026#34;2\u0026#34;, \u0026#34;prerelease\u0026#34;: \u0026#34;alpha\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;0.1.2-alpha+001\u0026#34; } */ æ”¯æŒæŒ‰ç¼–å·æå–åŒ¹é…ç»“æœ\n1 ^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$ Go è¯­è¨€ç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;regexp\u0026#34; ) func main() { version := \u0026#34;0.1.2-alpha+001\u0026#34; pattern := regexp.MustCompile(`^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$`) r := pattern.FindStringSubmatch(version) for i, s := range r { fmt.Printf(\u0026#34;%d -\u0026gt; %s\\n\u0026#34;, i, s) } } /* 0 -\u0026gt; 0.1.2-alpha+001 1 -\u0026gt; 0 2 -\u0026gt; 1 3 -\u0026gt; 2 4 -\u0026gt; alpha 5 -\u0026gt; 001 */ # Go Modulesç‰ˆæœ¬è®¾è®¡ # ä¾èµ–åœ°ç‹± æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹æ—©æœŸ Go ä¾èµ–åŒ…å­˜åœ¨çš„ä¾èµ–åœ°ç‹±é—®é¢˜ï¼š\né¦–å…ˆå­˜åœ¨ä¸¤ä¸ªåŒ… pkg1 å’Œ pkg2ï¼Œåˆ†åˆ«ä¾èµ– pkg3 çš„ v1.0.0 ç‰ˆæœ¬å’Œ v2.0.0 ç‰ˆæœ¬ï¼Œç°åœ¨æˆ‘ä»¬å¼€å‘ä¸€ä¸ª app åŒ…ï¼Œå®ƒä¾èµ– pkg1 å’Œ pkg2ï¼Œé‚£ä¹ˆæ­¤æ—¶ç”±äº app åŒ…åªå…è®¸åŒ…å«ä¸€ä¸ª pkg3 ä¾èµ–ï¼Œæ‰€ä»¥ Go æ„å»ºå·¥å…·æ— æ³•æŠ‰æ‹©åº”è¯¥ä½¿ç”¨å“ªä¸ªç‰ˆæœ¬çš„ pkg3ã€‚è¿™å°±æ˜¯æ‰€è°“çš„ä¾èµ–åœ°ç‹±é—®é¢˜ã€‚\n# è¯­ä¹‰å¯¼å…¥ç‰ˆæœ¬ ä¸ºäº†è§£å†³ä¾èµ–åœ°ç‹±é—®é¢˜ï¼ŒGo åœ¨ 1.11 ç‰ˆæœ¬æ—¶å¼•å…¥å’Œ Go Modulesï¼š\nGo Module è§£å†³é—®é¢˜çš„æ–¹å¼æ˜¯ï¼ŒæŠŠ pkg3 çš„ v1.0.0 ç‰ˆæœ¬å’Œ v2.0.0 ç‰ˆæœ¬å½“ä½œä¸¤ä¸ªä¸åŒçš„åŒ…ï¼Œè¿™æ ·ä¹Ÿå°±å…è®¸äº† app åŒ…èƒ½å¤ŸåŒæ—¶åŒ…å«å¤šä¸ªä¸åŒç‰ˆæœ¬çš„ pkg3ã€‚\nåœ¨ä½¿ç”¨æ—¶ï¼Œéœ€è¦åœ¨åŒ…çš„å¯¼å…¥è·¯å¾„ä¸ŠåŠ ä¸ŠåŒ…çš„ä¸»ç‰ˆæœ¬å·ã€‚è¿™é‡Œä»¥ go-micro åŒ…ä½¿ç”¨ä¸ºä¾‹ï¼Œå±•ç¤ºä¸‹ Go Module è¯­ä¹‰å¯¼å…¥ç‰ˆæœ¬çš„ç”¨æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 import \u0026#34;go-micro.dev/v4\u0026#34; // create a new service service := micro.NewService( micro.Name(\u0026#34;helloworld\u0026#34;), ) // initialise flags service.Init() // start the service service.Run() å¯ä»¥çœ‹åˆ°å¯¼å…¥è·¯å¾„ä¸º \u0026quot;go-micro.dev/v4\u0026quot;ï¼Œå…¶ä¸­ v4 å°±ä»£è¡¨äº†éœ€è¦å¼•å…¥ go-micro çš„ v4.y.z ç‰ˆæœ¬ã€‚\n# Go ModulesåŸºæœ¬ä½¿ç”¨ # go modulesç›¸å…³å‘½ä»¤ åœ¨ Go modules ä¸­ï¼Œæˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œæ“ä½œï¼š\nå‘½ä»¤ ä»‹ç» go mod init \u0026lt;project\u0026gt; åˆå§‹åŒ–é¡¹ç›®ä¾èµ–ï¼Œç”Ÿæˆgo.modæ¨¡å—æ–‡ä»¶ go mod download æ ¹æ®go.modæ–‡ä»¶ä¸‹è½½ä¾èµ– go mod tidy æ¯”å¯¹é¡¹ç›®æ–‡ä»¶ä¸­å¼•å…¥çš„ä¾èµ–ä¸go.modè¿›è¡Œæ¯”å¯¹,æ•´ç†æ¨¡å—æ–‡ä»¶ï¼Œå»é™¤æ²¡æœ‰ç”¨åˆ°çš„ä¾èµ– go mod graph è¾“å‡ºä¾èµ–å…³ç³»å›¾ã€æŸ¥çœ‹ç°æœ‰çš„ä¾èµ–ç»“æ„ go mod edit ç¼–è¾‘go.modæ–‡ä»¶ go mod vendor å°†é¡¹ç›®çš„æ‰€æœ‰ä¾èµ–å¯¼å‡ºè‡³vendorç›®å½• go mod verify æ£€éªŒä¸€ä¸ªä¾èµ–åŒ…æ˜¯å¦è¢«ç¯¡æ”¹è¿‡ go mod why è§£é‡Šä¸ºä»€ä¹ˆéœ€è¦æŸä¸ªä¾èµ– # go moduleså‚æ•°é…ç½® GO111MODULE\nGoè¯­è¨€æä¾›äº† GO111MODULE è¿™ä¸ªç¯å¢ƒå˜é‡æ¥ä½œä¸º Go modules çš„å¼€å…³ï¼Œå…¶å…è®¸è®¾ç½®ä»¥ä¸‹å‚æ•°ï¼š\nå‚æ•° è¯´æ˜ auto åªè¦é¡¹ç›®åŒ…å«äº† go.mod æ–‡ä»¶çš„è¯å¯ç”¨ Go modulesï¼Œç›®å‰åœ¨ Go1.11 è‡³ Go1.14 ä¸­ä»ç„¶æ˜¯é»˜è®¤å€¼ã€‚ on å¯ç”¨ Go modulesï¼Œæ¨èè®¾ç½®ï¼Œå°†ä¼šæ˜¯Go1.16ç‰ˆæœ¬ä¹‹åçš„é»˜è®¤å€¼ã€‚ off ç¦ç”¨ Go modulesï¼Œä¸æ¨èè®¾ç½®ã€‚ ä½ å¯èƒ½ä¼šç•™æ„åˆ° GO111MODULE è¿™ä¸ªåå­—æ¯”è¾ƒâ€œå¥‡ç‰¹â€ï¼Œå®é™…ä¸Šåœ¨ Go è¯­è¨€ä¸­ç»å¸¸ä¼šæœ‰è¿™ç±»é˜¶æ®µæ€§çš„å˜é‡ï¼Œ GO111MODULE è¿™ä¸ªå‘½åä»£è¡¨ç€Goè¯­è¨€åœ¨ 1.11 ç‰ˆæœ¬æ·»åŠ çš„ã€‚åç»­ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šå»æ‰ã€‚\nGOPROXY\nè¿™ä¸ªç¯å¢ƒå˜é‡ä¸»è¦æ˜¯ç”¨äºè®¾ç½® Go æ¨¡å—ä»£ç†ï¼ˆGo module proxyï¼‰ï¼Œå…¶ä½œç”¨æ˜¯ç”¨äºä½¿ Go åœ¨åç»­æ‹‰å–æ¨¡å—ç‰ˆæœ¬æ—¶èƒ½å¤Ÿè„±ç¦»ä¼ ç»Ÿçš„ VCSï¼ˆç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œå¦‚githubï¼Œå°±æ˜¯æºåœ°å€ä¸‹è½½ï¼‰ æ–¹å¼ï¼Œç›´æ¥é€šè¿‡é•œåƒç«™ç‚¹æ¥å¿«é€Ÿæ‹‰å–ã€‚å€¼ä¸ºoffè¡¨ç¤ºç¦æ­¢æ¨¡å—ä»£ç†ã€‚\nè®¾ç½®GOPROXYå¯ä»¥åŠ é€Ÿæ¨¡å—ä¸‹è½½ï¼Œç¡®ä¿æ„å»ºç¡®å®šæ€§ï¼ˆæä¾›ç¨³å®šçš„æ„å»ºç‰ˆæœ¬ï¼‰ï¼Œæé«˜å®‰å…¨æ€§ï¼Œç¡®ä¿æ¨¡å—å§‹ç»ˆå¯ç”¨ã€‚\nGOPROXY çš„é»˜è®¤å€¼æ˜¯ï¼šhttps://proxy.golang.org,directï¼Œç”±äºæŸäº›åŸå› å›½å†…æ— æ³•æ­£å¸¸è®¿é—®è¯¥åœ°å€ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šå¸¸éœ€è¦é…ç½®ä¸€ä¸ªå¯è®¿é—®çš„åœ°å€ã€‚ç›®å‰å›½å†…ç¤¾åŒºä½¿ç”¨æ¯”è¾ƒå¤šçš„æœ‰ä¸¤ä¸ª https://goproxy.cnå’Œ https://goproxy.ioï¼Œå½“ç„¶å¦‚æœä½ çš„å…¬å¸æœ‰æä¾›GOPROXYåœ°å€é‚£ä¹ˆå°±ç›´æ¥ä½¿ç”¨ã€‚å¹¶ä¸”ä¿®æ”¹çš„ä»£ç†ï¼Œé€šè¿‡go getå‘½ä»¤ä¸‹è½½è‡ªå·±çš„å…¬å…±æ¨¡å—ï¼Œä¹Ÿä¼šåŒæ­¥åˆ° https://pkg.go.dev/ã€‚\nè®¾ç½®GOPAROXYçš„å‘½ä»¤å¦‚ä¸‹ï¼š\n1 go env -w GOPROXY=https://goproxy.cn,direct GOPROXY å…è®¸è®¾ç½®å¤šä¸ªä»£ç†åœ°å€ï¼Œå¤šä¸ªåœ°å€ä¹‹é—´éœ€ä½¿ç”¨è‹±æ–‡é€—å· â€œ,â€ åˆ†éš”ã€‚æœ€åçš„ â€œdirectâ€ æ˜¯ä¸€ä¸ªç‰¹æ®ŠæŒ‡ç¤ºç¬¦ï¼Œç”¨äºæŒ‡ç¤º Go å›æºåˆ°æºåœ°å€å»æŠ“å–ï¼ˆæ¯”å¦‚ GitHub ç­‰ï¼‰ã€‚å½“é…ç½®æœ‰å¤šä¸ªä»£ç†åœ°å€æ—¶ï¼Œå¦‚æœç¬¬ä¸€ä¸ªä»£ç†åœ°å€è¿”å› 404 æˆ– 410 é”™è¯¯æ—¶ï¼ŒGo ä¼šè‡ªåŠ¨å°è¯•ä¸‹ä¸€ä¸ªä»£ç†åœ°å€ï¼Œå½“é‡è§ â€œdirectâ€ æ—¶è§¦å‘å›æºï¼Œä¹Ÿå°±æ˜¯å›åˆ°æºåœ°å€å»æŠ“å–ã€‚å°±æ˜¯ä»£ç†å¤±è´¥ä¹‹åç”¨ä¼ ç»Ÿæ–¹å¼ï¼ˆæºåœ°å€ä¸‹è½½æ¨¡å—ï¼‰ã€‚\nGOPRIVATE\nGONOPROXY/GONOSUMDB/GOPRIVATE\nè¿™ä¸‰ä¸ªç¯å¢ƒå˜é‡éƒ½æ˜¯ç”¨åœ¨å½“å‰é¡¹ç›®ä¾èµ–äº†ç§æœ‰æ¨¡å—ï¼Œä¾‹å¦‚åƒæ˜¯ä½ å…¬å¸çš„ç§æœ‰ git ä»“åº“ï¼Œåˆæˆ–æ˜¯ github ä¸­çš„ç§æœ‰åº“ï¼Œéƒ½æ˜¯å±äºç§æœ‰æ¨¡å—ï¼Œéƒ½æ˜¯è¦è¿›è¡Œè®¾ç½®çš„ï¼Œå¦åˆ™ä¼šæ‹‰å–å¤±è´¥ã€‚\næ›´ç»†è‡´æ¥è®²ï¼Œå°±æ˜¯ä¾èµ–äº†ç”± GOPROXY æŒ‡å®šçš„ Go æ¨¡å—ä»£ç†æˆ–ç”± GOSUMDB æŒ‡å®š Go checksum database éƒ½æ— æ³•è®¿é—®åˆ°çš„æ¨¡å—æ—¶çš„åœºæ™¯ã€‚\nè€Œä¸€èˆ¬å»ºè®®ç›´æ¥è®¾ç½® GOPRIVATEï¼Œå®ƒçš„å€¼å°†ä½œä¸º GONOPROXY å’Œ GONOSUMDB çš„é»˜è®¤å€¼ï¼Œæ‰€ä»¥å»ºè®®çš„æœ€ä½³å§¿åŠ¿æ˜¯ç›´æ¥ä½¿ç”¨ GOPRIVATEã€‚\nè®¾ç½®äº†GOPROXY ä¹‹åï¼Œgo å‘½ä»¤å°±ä¼šä»é…ç½®çš„ä»£ç†åœ°å€æ‹‰å–å’Œæ ¡éªŒä¾èµ–åŒ…ã€‚å½“æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­å¼•å…¥äº†éå…¬å¼€çš„åŒ…ï¼ˆå…¬å¸å†…éƒ¨gitä»“åº“æˆ– github ç§æœ‰ä»“åº“ç­‰ï¼‰ï¼Œæ­¤æ—¶ä¾¿æ— æ³•æ­£å¸¸ä»ä»£ç†æ‹‰å–åˆ°è¿™äº›éå…¬å¼€çš„ä¾èµ–åŒ…ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦é…ç½® GOPRIVATE ç¯å¢ƒå˜é‡ã€‚GOPRIVATEç”¨æ¥å‘Šè¯‰ go å‘½ä»¤å“ªäº›ä»“åº“å±äºç§æœ‰ä»“åº“ï¼Œä¸å¿…é€šè¿‡ä»£ç†æœåŠ¡å™¨æ‹‰å–å’Œæ ¡éªŒã€‚\nGOPRIVATE çš„å€¼ä¹Ÿå¯ä»¥è®¾ç½®å¤šä¸ªï¼Œå¤šä¸ªåœ°å€ä¹‹é—´ä½¿ç”¨è‹±æ–‡é€—å· â€œ,â€ åˆ†éš”ã€‚æˆ‘ä»¬é€šå¸¸ä¼šæŠŠè‡ªå·±å…¬å¸å†…éƒ¨çš„ä»£ç ä»“åº“è®¾ç½®åˆ° GOPRIVATE ä¸­ï¼Œä¾‹å¦‚ï¼š\n1 $ go env -w GOPRIVATE=\u0026#34;git.example.com,github.com/arlettebrook/demo\u0026#34; è®¾ç½®åï¼Œå‰ç¼€ä¸º git.xxx.com å’Œ github.com/arlettebrook/demoçš„æ¨¡å—éƒ½ä¼šè¢«è®¤ä¸ºæ˜¯ç§æœ‰æ¨¡å—ã€‚\nå¦‚æœä¸æƒ³æ¯æ¬¡éƒ½é‡æ–°è®¾ç½®ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ©ç”¨é€šé…ç¬¦ï¼Œä¾‹å¦‚ï¼š\n1 $ go env -w GOPRIVATE=\u0026#34;*.example.com\u0026#34; è¿™æ ·å­è®¾ç½®çš„è¯ï¼Œæ‰€æœ‰æ¨¡å—è·¯å¾„ä¸º example.com çš„å­åŸŸåï¼ˆä¾‹å¦‚ï¼šgit.example.comï¼‰éƒ½å°†ä¸ç»è¿‡ Go module proxy å’Œ Go checksum databaseï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ä¸åŒ…æ‹¬ example.com æœ¬èº«ã€‚\næ­¤å¤–ï¼Œå¦‚æœå…¬å¸å†…éƒ¨è‡ªå»ºäº† GOPROXY æœåŠ¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½® GONOPROXY=noneï¼Œå…è®¸é€šå†…éƒ¨ä»£ç†æ‹‰å–ç§æœ‰ä»“åº“çš„åŒ…ã€‚\n# go modulesæ¨¡å—æ–‡ä»¶ åˆè¯†åŒ–é¡¹ç›®\nåœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹è¿è¡Œgo mod init \u0026lt;project\u0026gt;ï¼Œå¦‚go mod init github.com/arlettebrook/demoï¼Œdemoæ˜¯é¡¹ç›®åï¼Œgithub.com/arlettebrook/demoæ˜¯æ¨¡å—å¯¼å…¥è·¯å¾„ï¼Œå½“å¯¼å…¥çš„æ—¶å€™ï¼Œå¦‚æœæœ¬åœ°æ²¡æœ‰ï¼Œä¼šå»è¯¥è·¯å¾„ä¸‹è½½ã€‚\ngo.mod æ–‡ä»¶\nåœ¨åˆå§‹åŒ–é¡¹ç›®æ—¶ï¼Œä¼šç”Ÿæˆä¸€ä¸ª go.mod æ–‡ä»¶ï¼Œæ˜¯å¯ç”¨äº† Go modules é¡¹ç›®æ‰€å¿…é¡»çš„æœ€é‡è¦çš„æ ‡è¯†ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ GO111MODULE å€¼ä¸º auto æ—¶çš„è¯†åˆ«æ ‡è¯†ï¼Œå®ƒæè¿°äº†å½“å‰é¡¹ç›®ï¼ˆä¹Ÿå°±æ˜¯å½“å‰æ¨¡å—ï¼‰çš„å…ƒä¿¡æ¯ï¼Œæ¯ä¸€è¡Œéƒ½ä»¥ä¸€ä¸ªåŠ¨è¯å¼€å¤´ã€‚\nç¤ºä¾‹æ–‡ä»¶\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 module github.com/arlettebrook/demo go 1.22.1 require ( example.com/apple v0.1.2 example.com/banana v1.2.3 example.com/banana/v2 v2.3.4 example.com/pear // indirect example.com/strawberry // incompatible ) exclude example.com/banana v1.2.4 replace example.com/apple v0.1.2 =\u0026gt; example.com/fried v0.1.0 replace example.com/banana =\u0026gt; example.com/fish è¯´æ˜\nmoduleï¼šç”¨äºå®šä¹‰å½“å‰é¡¹ç›®çš„æ¨¡å—è·¯å¾„ã€‚ goï¼šç”¨äºæ ‡è¯†å½“å‰æ¨¡å—çš„ Go è¯­è¨€ç‰ˆæœ¬ï¼Œå€¼ä¸ºåˆå§‹åŒ–æ¨¡å—æ—¶çš„ç‰ˆæœ¬ï¼Œç›®å‰æ¥çœ‹è¿˜åªæ˜¯ä¸ªæ ‡è¯†ä½œç”¨ã€‚ requireï¼šç”¨äºè®¾ç½®ä¸€ä¸ªç‰¹å®šçš„æ¨¡å—ç‰ˆæœ¬ã€‚ excludeï¼šç”¨äºä»ä½¿ç”¨ä¸­æ’é™¤ä¸€ä¸ªç‰¹å®šçš„æ¨¡å—ç‰ˆæœ¬ã€‚ replaceï¼šç”¨äºå°†ä¸€ä¸ªæ¨¡å—ç‰ˆæœ¬æ›¿æ¢ä¸ºå¦å¤–ä¸€ä¸ªæ¨¡å—ç‰ˆæœ¬ã€‚ å¦å¤–ä½ ä¼šå‘ç° example.com/pear çš„åé¢ä¼šæœ‰ä¸€ä¸ª indirect æ ‡è¯†ï¼Œindirect æ ‡è¯†è¡¨ç¤ºè¯¥æ¨¡å—ä¸ºé—´æ¥ä¾èµ–ï¼Œä¹Ÿå°±æ˜¯åœ¨å½“å‰åº”ç”¨ç¨‹åºä¸­çš„ import è¯­å¥ä¸­ï¼Œå¹¶æ²¡æœ‰å‘ç°è¿™ä¸ªæ¨¡å—çš„æ˜ç¡®å¼•ç”¨ï¼Œæœ‰å¯èƒ½æ˜¯ä½ å…ˆæ‰‹åŠ¨ go get æ‹‰å–ä¸‹æ¥çš„ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ä½ æ‰€ä¾èµ–çš„æ¨¡å—æ‰€ä¾èµ–çš„ï¼Œæƒ…å†µæœ‰å¥½å‡ ç§ã€‚incompatibleï¼šä¸å…¼å®¹çš„\ngo.sum æ–‡ä»¶\nåœ¨ç¬¬ä¸€æ¬¡æ‹‰å–æ¨¡å—ä¾èµ–åï¼Œä¼šå‘ç°å¤šå‡ºäº†ä¸€ä¸ª go.sum æ–‡ä»¶ï¼Œå…¶è¯¦ç»†ç½—åˆ—äº†å½“å‰é¡¹ç›®ç›´æ¥æˆ–é—´æ¥ä¾èµ–çš„æ‰€æœ‰æ¨¡å—ç‰ˆæœ¬ï¼Œå¹¶å†™æ˜äº†é‚£äº›æ¨¡å—ç‰ˆæœ¬çš„ SHA-256 å“ˆå¸Œå€¼ä»¥å¤‡ Go åœ¨ä»Šåçš„æ“ä½œä¸­ä¿è¯é¡¹ç›®æ‰€ä¾èµ–çš„é‚£äº›æ¨¡å—ç‰ˆæœ¬ä¸ä¼šè¢«ç¯¡æ”¹ã€‚\n1 2 3 4 github.com/spf13/cobra v1.8.0 h1:7aJaZx1B85qltLMc546zn58BxxfZdR/W22ej9CFoEf0= github.com/spf13/cobra v1.8.0/go.mod h1:WXLWApfZ71AjXPya3WOlMsY9yMs7YeiHhFVlvLyhcho= github.com/spf13/pflag v1.0.5 h1:iy+VFUOCP1a+8yFto/drg2CJ5u0yRoB7fZw3DKv/JXA= github.com/spf13/pflag v1.0.5/go.mod h1:McXfInJRrz4CZXVZOBLb0bTZqETkiAhM9Iw0y3An2Bg= å¯ä»¥çœ‹åˆ°ä¸€ä¸ªæ¨¡å—è·¯å¾„å¯èƒ½æœ‰å¦‚ä¸‹ä¸¤ç§ï¼š\n1 2 github.com/spf13/cobra v1.8.0 h1:7aJaZx1B85qltLMc546zn58BxxfZdR/W22ej9CFoEf0= github.com/spf13/cobra v1.8.0/go.mod h1:WXLWApfZ71AjXPya3WOlMsY9yMs7YeiHhFVlvLyhcho= h1 hash æ˜¯ Go modules å°†ç›®æ ‡æ¨¡å—ç‰ˆæœ¬çš„ zip æ–‡ä»¶å¼€åŒ…åï¼Œé’ˆå¯¹æ‰€æœ‰åŒ…å†…æ–‡ä»¶ä¾æ¬¡è¿›è¡Œ hashï¼Œç„¶åå†æŠŠå®ƒä»¬çš„ hash ç»“æœæŒ‰ç…§å›ºå®šæ ¼å¼å’Œç®—æ³•ç»„æˆæ€»çš„ hash å€¼ã€‚\nè€Œ h1 hash å’Œ go.mod hash ä¸¤è€…ï¼Œè¦ä¸å°±æ˜¯åŒæ—¶å­˜åœ¨ï¼Œè¦ä¸å°±æ˜¯åªå­˜åœ¨ go.mod hashã€‚é‚£ä»€ä¹ˆæƒ…å†µä¸‹ä¼šä¸å­˜åœ¨ h1 hash å‘¢ï¼Œå°±æ˜¯å½“ Go è®¤ä¸ºè‚¯å®šç”¨ä¸åˆ°æŸä¸ªæ¨¡å—ç‰ˆæœ¬çš„æ—¶å€™å°±ä¼šçœç•¥å®ƒçš„ h1 hashï¼Œå°±ä¼šå‡ºç°ä¸å­˜åœ¨ h1 hashï¼Œåªå­˜åœ¨ go.mod hash çš„æƒ…å†µã€‚\ngo.modå’Œgo.suméƒ½åº”è¯¥è¢«æäº¤åˆ°gitä»“åº“ä¸­å»ã€‚å½“åˆ«äººä½¿ç”¨ä½ çš„é¡¹ç›®æ—¶ï¼Œmodä¿è¯ä¾èµ–ç‰ˆæœ¬ä¸€ç›´ï¼Œsumä¿è¯ä¾èµ–ä¸è¢«ç¯¡æ”¹ã€‚\n# go modulesæ¨¡å—ä¸‹è½½ æˆ‘ä»¬ä¸‹è½½ã€æ·»åŠ æ¨¡å—ä½¿ç”¨go get -u \u0026lt;module path\u0026gt;ã€‚\né»˜è®¤ä¸‹è½½ã€æ·»åŠ æœ€æ–°ç‰ˆæœ¬ï¼Œé¦–å…ˆä¼šæ£€æŸ¥æœ¬åœ°ï¼ˆpkgï¼šå…¨å±€æ¨¡å—ç¼“å­˜ï¼‰æ˜¯å¦å­˜åœ¨ï¼Œæ²¡æœ‰ï¼Œåœ¨å»ä¸‹è½½ã€‚\nåœ¨é¡¹ç›®ä¸­ä¸‹è½½ä¼šè‡ªåŠ¨æ·»åŠ åˆ°go.modæ–‡ä»¶ä¸­ã€‚\n-ué€‰é¡¹ä¼šæ›´æ–°æ¨¡å—çš„ä¾èµ–åŒ…åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œæ¨èåŠ ä¸Šã€‚\nè¿˜å¯ä»¥æŒ‡å®šä¸‹è½½ç‰ˆæœ¬\nå‘½ä»¤ ä½œç”¨ go get golang.org/x/text@latest æ‹‰å–æœ€æ–°çš„ç‰ˆæœ¬ï¼Œè‹¥å­˜åœ¨tagï¼Œåˆ™ä¼˜å…ˆä½¿ç”¨ã€‚å¯ä»¥çœç•¥ã€‚ go get golang.org/x/text@master æ‹‰å– master åˆ†æ”¯çš„æœ€æ–° commitã€‚@branch go get golang.org/x/text@v0.3.2 æ‹‰å– tag ä¸º v0.3.2 çš„ commitã€‚@versionï¼Œversionå¿…é¡»æ»¡è¶³è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒä¸”å‰é¢åŠ vã€‚ go get golang.org/x/text@342b2e æ‹‰å– hash ä¸º 342b231 çš„ commitï¼Œæœ€ç»ˆä¼šè¢«è½¬æ¢ä¸º v0.3.2ã€‚@commit go get golang.org/x/text/v2 ä¸‹è½½ä¸»ç‰ˆæœ¬å·ä¸º2çš„æœ€æ–°ç‰ˆ æœ€æ–°ç‰ˆæœ¬çš„é€‰æ‹©\nåˆ†ä¸¤ç§æƒ…å†µ\næœ€æ–°ç‰ˆæœ¬æœ‰å‘å¸ƒtagsï¼šå°±ä»¥å‘å¸ƒçš„ç‰ˆæœ¬ï¼Œversionä¸€èˆ¬ä¸ºæ ‡ç­¾åï¼Œå¦‚v2.1.2 æœ€æ–°ç‰ˆæœ¬æ²¡æœ‰å‘å¸ƒtags:å°±ä»¥æäº¤çš„æœ€æ–°ç‰ˆæœ¬ï¼Œversionä¸€èˆ¬ä¸ºå·²å‘å¸ƒæ ‡ç­¾-æœ€æ–°æäº¤æ—¥æœŸ-æœ€æ–°æäº¤å“ˆå¸Œ+ç‰ˆæœ¬ç¼–è¯‘ä¿¡æ¯ï¼Œç‰ˆæœ¬ç¼–è¯‘ä¿¡æ¯ä¸€èˆ¬æ²¡æœ‰ã€‚å¦‚v2.1.2-20240416160154-fe59bbe5cc7fï¼Œå¦‚æœä¸€æ¬¡tagsä¹Ÿæ²¡æœ‰å‘å¸ƒï¼Œç‰ˆæœ¬å·åˆ™ä¸ºv0.0.0ï¼Œå¦‚v0.0.0-20240416160154-fe59bbe5cc7f å­æ¨¡å—åŒç† # go moduleså…¨å±€ç¼“å­˜ Go module ä¼šæŠŠä¸‹è½½åˆ°æœ¬åœ°çš„ä¾èµ–åŒ…ä¼šä»¥ç±»ä¼¼ä¸‹é¢çš„å½¢å¼ä¿å­˜åœ¨ $GOPATH/pkg/modç›®å½•ä¸‹ï¼Œæ¯ä¸ªä¾èµ–åŒ…éƒ½ä¼šå¸¦æœ‰ç‰ˆæœ¬å·è¿›è¡ŒåŒºåˆ†ï¼Œè¿™æ ·å°±å…è®¸åœ¨æœ¬åœ°å­˜åœ¨åŒä¸€ä¸ªåŒ…çš„å¤šä¸ªä¸åŒç‰ˆæœ¬ã€‚\n1 2 3 4 5 6 7 mod â”œâ”€â”€ cache â”œâ”€â”€ github.com â”œâ”€â”€ golang.org â”œâ”€â”€ google.golang.org â”œâ”€â”€ gopkg.in ... å¦‚æœæƒ³æ¸…é™¤æ‰€æœ‰æœ¬åœ°å·²ç¼“å­˜çš„ä¾èµ–åŒ…æ•°æ®ï¼Œå¯ä»¥æ‰§è¡Œ go clean -modcache å‘½ä»¤ã€‚\n# go modulesæ¨¡å—å¯¼å…¥ goæ¨¡å—å¯¼å…¥ç”¨import \u0026quot;æ¨¡å—è·¯å¾„\u0026quot;\nå½“å¯¼å…¥å¤šä¸ªæ¨¡å—çš„æ—¶å€™ç”¨\n1 2 3 4 5 import ( \u0026#34;fmt\u0026#34; \u0026#34;os\u0026#34; \u0026#34;path/filepath\u0026#34; ) åˆ«åå¯¼å…¥ç”¨import åˆ«å \u0026quot;æ¨¡å—è·¯å¾„\u0026quot;\n1 import f \u0026#34;fmt\u0026#34; ç‚¹å¯¼å…¥ç”¨import . \u0026quot;æ¨¡å—è·¯å¾„\u0026quot;\nç‚¹å¯¼å…¥æ˜¯ä¸€ç§ç‰¹æ®Šçš„å¯¼å…¥æ–¹å¼ï¼Œå®ƒå°†åŒ…ä¸­çš„æ‰€æœ‰å…¬å…±æ ‡è¯†ç¬¦ï¼ˆå‡½æ•°ã€å˜é‡ã€ç±»å‹ç­‰ï¼‰æå‡åˆ°å½“å‰æ–‡ä»¶çš„å‘½åç©ºé—´ä¸­ï¼Œè¿™æ ·åœ¨ä»£ç ä¸­å°±å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™äº›æ ‡è¯†ç¬¦ï¼Œè€Œä¸éœ€è¦åŠ ä¸ŠåŒ…åå‰ç¼€ã€‚ä½†æ˜¯ï¼Œè¿™ç§æ–¹å¼å¯èƒ½ä¼šå¯¼è‡´å‘½åå†²çªå’Œä»£ç å¯è¯»æ€§ä¸‹é™ï¼Œå› æ­¤ä¸€èˆ¬ä¸å»ºè®®ä½¿ç”¨ã€‚\nç©ºå¯¼å…¥ç”¨import _ \u0026quot;æ¨¡å—è·¯å¾„\u0026quot;\nç©ºå¯¼å…¥é€šå¸¸ç”¨äºåˆå§‹åŒ–åŒ…ä¸­çš„å˜é‡æˆ–è€…æ‰§è¡ŒåŒ…ä¸­çš„åˆå§‹åŒ–å‡½æ•°ï¼Œè€Œä¸ç›´æ¥ä½¿ç”¨è¯¥åŒ…ä¸­çš„å…¶ä»–æ ‡è¯†ç¬¦ã€‚\næ³¨æ„äº‹é¡¹\nå½“æ¨¡å—çš„ä¸»ç‰ˆæœ¬å·ä¸º0æˆ–1çš„æ—¶å€™çœç•¥äº†ä¸»ç‰ˆæœ¬æ ‡è¯†ã€‚\nå½“ä¸»ç‰ˆæœ¬å·ä¸º2åŠä»¥ä¸Šæ—¶ï¼Œä¸èƒ½çœç•¥ä¸»ç‰ˆæœ¬æ ‡è¯†ã€‚å¦åˆ™ä¼šå‡ºç°å†²çªã€‚\nä¸»ç‰ˆæœ¬æ ‡è¯†åªèƒ½ä¸º/vä¸»ç‰ˆæœ¬å·ï¼Œä¸èƒ½ç”¨@versionï¼Œä¸€èˆ¬ä½¿ç”¨ä¸»ç‰ˆæœ¬çš„æœ€æ–°ç‰ˆï¼Œè¿™ä¸è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒæœ‰å…³ã€‚\nå¦‚ï¼š\n1 2 import \u0026#34;github.com/jordan-wright/email\u0026#34; import \u0026#34;github.com/jordan-wright/email/v4\u0026#34; ä¸ºä»€ä¹ˆå¿½ç•¥ v0 å’Œ v1 çš„ä¸»ç‰ˆæœ¬å·\nè¿˜æ˜¯ä¸è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒæœ‰å…³ï¼Œv0å±äºå¼€å‘åˆå§‹é˜¶æ®µï¼Œå…¶å…¬å…±apiä¸è¢«è§†ä¸ºç¨³å®šç‰ˆï¼Œå½“ç‰ˆæœ¬åˆ°è¾¾v1ï¼Œå…¶å…¬å…±apiåŸºæœ¬ç¡®å®šï¼Œåœ¨æ­¤ä¹‹åå¦‚æœä¸å‡ºç°ä¸å…¼å®¹apiçš„ä¿®æ”¹ï¼Œæ˜¯ä¸ä¼šä¿®æ”¹ä¸»ç‰ˆæœ¬å·çš„ã€‚åç»­çš„æ¬¡ç‰ˆæœ¬ã€ä¿®è®¢å·ä¼šå‘ä¸‹å…¼å®¹ã€‚è¿™æ˜¯å®˜æ–¹æ‰€é¼“åŠ±çš„ã€‚å½“apiåšäº†ä¸å…¼å®¹çš„ä¿®æ”¹ï¼Œä¸»ç‰ˆæœ¬å·å°±ä¼šä¿®æ”¹ã€‚ä¸ºäº†ä¸å‡ºç°å†²çªå°±ä¼šåŠ ä¸Šä¸»ç‰ˆæœ¬æ ‡è¯†ã€‚\n# gopkg.inä»‹ç» gopkg.inæ˜¯æ—§goåŒ…ç®¡ç†å·¥å…·ä¸­çš„ä¸€ä¸ªï¼Œå¹¶ä¸æ˜¯å®˜æ–¹åŒ…ç®¡ç†å·¥å…·ã€‚ä½œç”¨æ˜¯ä¸‹è½½æ—¶é‡å®šå‘åˆ°ç›¸åº”githubä»“åº“ã€‚ä¼˜ç‚¹æ˜¯ï¼š URL æ›´å¹²å‡€ã€æ›´çŸ­ã€å¯¼å…¥è·¯å¾„ç¨³å®šã€æ˜“äºä½¿ç”¨ã€æ”¯æŒç‰ˆæœ¬æ§åˆ¶ã€‚\næµè§ˆå™¨æ‰“å¼€é“¾æ¥ï¼Œä¼šæä¾›å¯¹åº”åŒ…çš„godocåœ¨çº¿é“¾æ¥ä»¥åŠgithubä»“åº“é“¾æ¥ã€‚\ngopkg.in/ini.v1å¯¹åº”githubä»“åº“ä¸ºgithu.com/go-ini/iniï¼Œå½“æ²¡æœ‰æŒ‡å®šç”¨æˆ·åæ—¶ï¼Œç”¨æˆ·åé»˜è®¤ä¸ºgo-åŒ…åã€‚\n1 2 gopkg.in/pkg.v3 â†’ github.com/go-pkg/pkg (branch/tag v3, v3.N, or v3.N.M) gopkg.in/user/pkg.v3 â†’ github.com/user/pkg (branch/tag v3, v3.N, or v3.N.M) ç‰ˆæœ¬æ§åˆ¶ç”¨.vNumberè¡¨ç¤º.ã€‚\nä¸go modulesçš„åŒºåˆ«ï¼š\nv1gopkg.inå¿…é¡»æŒ‡å®šã€‚go modä¸ç”¨ã€‚ gopkg.inåˆ†éš”ç¬¦æ˜¯.ï¼ˆgo modæ˜¯/ï¼‰ã€‚ v0ä¸ºå¼€å‘ç‰ˆã€ä¸ç¨³å®šç‰ˆï¼Œä¸æŒ‡å®šé»˜è®¤ä¸ºå¼€å‘ç‰ˆï¼Œgo modä¸æŒ‡å®šé»˜è®¤ä¸ºv0æˆ–v1ã€‚ gopkg.inä¸»ç‰ˆæœ¬ä¸º1å°±è¦æŒ‡å®šä¸»ç‰ˆæœ¬æ ‡è¯†ã€‚go modä¸»ç‰ˆæœ¬ä¸º2æ‰éœ€è¦æŒ‡å®šã€‚ å¦‚ä½•è®©gopkg.inæ”¶å½•è‡ªå·±çš„æ¨¡å—ï¼š\nä¸go modä¸€æ ·ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨go getä¸‹è½½å·²ç»å­˜åœ¨çš„ç‰ˆæœ¬ä»“åº“æ—¶ï¼Œä¼šè‡ªåŠ¨åŒæ­¥åˆ°åœ¨çº¿çš„godocä¸­ã€‚ å»ºè®®ä»“åº“åä¸ç”¨æˆ·åå…³ç³»æ˜¯pkgä¸go-pkgï¼Œæ¨ègopkg.inã€‚å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨githubä»“åº“è·¯å¾„ã€‚ å…¶ä»–æƒ…å†µå¯ä»¥ä½¿ç”¨go modã€‚å¹¶é€šè¿‡åƒ proxy.golang.org è¿™æ ·çš„ä»£ç†æœåŠ¡å™¨æ¥åˆ†å‘ä½ çš„æ¨¡å—ã€‚ gopkg.inç‰ˆæœ¬æ§åˆ¶åŒæ ·éµå¾ª[è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶](#Go Module è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒ)ã€‚\n# æ€»ç»“ è‡³æ­¤æˆ‘ä»¬å¤§è‡´ä»‹ç»äº† Go modules çš„å‰ä¸–ä»Šç”Ÿã€è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒä»¥åŠåŸºæœ¬ä½¿ç”¨ã€‚\nGo modules çš„æˆé•¿å’Œå‘å±•ç»å†äº†ä¸€å®šçš„è¿‡ç¨‹ï¼Œå¦‚æœä½ æ˜¯åˆšæ¥è§¦çš„è¯»è€…ï¼Œç›´æ¥åŸºäº Go modules çš„é¡¹ç›®å¼€å§‹å³å¯ï¼Œå¦‚æœæ—¢æœ‰è€é¡¹ç›®ï¼Œé‚£ä¹ˆæ˜¯æ—¶å€™è€ƒè™‘åˆ‡æ¢è¿‡æ¥äº†ï¼ŒGo1.14èµ·å·²ç»å‡†å¤‡å°±ç»ªï¼Œå¹¶æ¨èä½ ä½¿ç”¨ã€‚\n# å‚è€ƒ https://semver.org/lang/zh-CN/ Go Module è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒ Go Modulesè¯¦è§£ Go moduleè¯¦ç»†ä»‹ç» ","date":"2024-04-28T10:57:17+08:00","permalink":"https://arlettebrook.github.io/p/go-modules%E8%AF%A6%E8%A7%A3/","title":"Go modulesè¯¦è§£"},{"content":" Go è¯­è¨€æ ‡å‡†åº“ä¸­çš„ log åŒ…è®¾è®¡ç®€æ´æ˜äº†ï¼Œæ˜“äºä¸Šæ‰‹ï¼Œå¯ä»¥è½»æ¾è®°å½•ç¨‹åºè¿è¡Œæ—¶çš„ä¿¡æ¯ã€è°ƒè¯•é”™è¯¯ä»¥åŠè·Ÿè¸ªä»£ç æ‰§è¡Œè¿‡ç¨‹ä¸­çš„é—®é¢˜ç­‰ã€‚ä½¿ç”¨ log åŒ…æ— éœ€ç¹ççš„é…ç½®å³å¯ç›´æ¥ä½¿ç”¨ã€‚æœ¬æ–‡æ—¨åœ¨æ·±å…¥æ¢ç©¶ log åŒ…çš„ä½¿ç”¨å’ŒåŸç†ï¼Œå¸®åŠ©è¯»è€…æ›´å¥½åœ°äº†è§£å’ŒæŒæ¡å®ƒã€‚\n# ä½¿ç”¨ å…ˆæ¥çœ‹ä¸€ä¸ª log åŒ…çš„ä½¿ç”¨ç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 package main import \u0026#34;log\u0026#34; func main() { log.Print(\u0026#34;Print\u0026#34;) log.Printf(\u0026#34;Printf: %s\u0026#34;, \u0026#34;print\u0026#34;) log.Println(\u0026#34;Println\u0026#34;) log.Fatal(\u0026#34;Fatal\u0026#34;) log.Fatalf(\u0026#34;Fatalf: %s\u0026#34;, \u0026#34;fatal\u0026#34;) log.Fatalln(\u0026#34;Fatalln\u0026#34;) log.Panic(\u0026#34;Panic\u0026#34;) log.Panicf(\u0026#34;Panicf: %s\u0026#34;, \u0026#34;panic\u0026#34;) log.Panicln(\u0026#34;Panicln\u0026#34;) } å‡è®¾ä»¥ä¸Šä»£ç å­˜æ”¾åœ¨ main.go ä¸­ï¼Œé€šè¿‡ go run main.go æ‰§è¡Œä»£ç å°†ä¼šå¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š\n1 2 3 4 5 6 $ go run main.go 2023/03/08 22:33:22 Print 2023/03/08 22:33:22 Printf: print 2023/03/08 22:33:22 Println 2023/03/08 22:33:22 Fatal exit status 1 ä»¥ä¸Šç¤ºä¾‹ä»£ç ä¸­ä½¿ç”¨ log åŒ…æä¾›çš„ 9 ä¸ªå‡½æ•°åˆ†åˆ«å¯¹æ—¥å¿—è¿›è¡Œè¾“å‡ºï¼Œæœ€ç»ˆå¾—åˆ° 4 æ¡æ‰“å°æ—¥å¿—ã€‚æˆ‘ä»¬æ¥åˆ†æä¸‹æ¯ä¸ªæ—¥å¿—å‡½æ•°çš„ä½œç”¨ï¼Œæ¥çœ‹çœ‹ä¸ºä»€ä¹ˆå‡ºç°è¿™æ ·çš„ç»“æœã€‚\nlog åŒ…æä¾›äº† 3 ç±»å…±è®¡ 9 ç§æ–¹æ³•æ¥è¾“å‡ºæ—¥å¿—å†…å®¹ã€‚\nå‡½æ•°å ä½œç”¨ ä½¿ç”¨ç¤ºä¾‹ Print æ‰“å°æ—¥å¿— log.Print(â€œPrintâ€) Printf æ‰“å°æ ¼å¼åŒ–æ—¥å¿— log.Printf(â€œPrintf: %sâ€, â€œprintâ€) Println æ‰“å°æ—¥å¿—å¹¶æ¢è¡Œ log.Println(â€œPrintlnâ€) Panic æ‰“å°æ—¥å¿—åæ‰§è¡Œ panic(s)ï¼ˆs ä¸ºæ—¥å¿—å†…å®¹ï¼‰ log.Panic(â€œPanicâ€) Panicf æ‰“å°æ ¼å¼åŒ–æ—¥å¿—åæ‰§è¡Œ panic(s) log.Panicf(â€œPanicf: %sâ€, â€œpanicâ€) Panicln æ‰“å°æ—¥å¿—å¹¶æ¢è¡Œåæ‰§è¡Œ panic(s) log.Panicln(â€œPaniclnâ€) Fatal æ‰“å°æ—¥å¿—åæ‰§è¡Œ os.Exit(1) log.Fatal(â€œFatalâ€) Fatalf æ‰“å°æ ¼å¼åŒ–æ—¥å¿—åæ‰§è¡Œ os.Exit(1) log.Fatalf(â€œFatalf: %sâ€, â€œfatalâ€) Fatalln æ‰“å°æ—¥å¿—å¹¶æ¢è¡Œåæ‰§è¡Œ os.Exit(1) log.Panicln(â€œPaniclnâ€) å®é™…ä¸ŠlogåŒ…æ¯æ‰“å°ä¸€å¥æ—¥å¿—ï¼Œéƒ½ä¼šæ¢è¡Œï¼Œæ— è®ºæœ‰æ²¡æœ‰lnæˆ–è€…\\nã€‚\næ ¹æ®ä»¥ä¸Šè¡¨æ ¼è¯´æ˜ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œlog åŒ…åœ¨æ‰§è¡Œ log.Fatal(\u0026quot;Fatal\u0026quot;) æ—¶ï¼Œç¨‹åºæ‰“å°å®Œæ—¥å¿—å°±é€šè¿‡ os.Exit(1) é€€å‡ºäº†ã€‚è¿™ä¹Ÿå°±å¯ä»¥è§£é‡Šä¸Šé¢çš„ç¤ºä¾‹ç¨‹åºï¼Œä¸ºä»€ä¹ˆæ‰“å°äº† 9 æ¬¡æ—¥å¿—ï¼Œå´åªè¾“å‡ºäº† 4 æ¡æ—¥å¿—ï¼Œå¹¶ä¸”æœ€åç¨‹åºé€€å‡ºç ä¸º 1 äº†ã€‚\nä»¥ä¸Šæ˜¯ log åŒ…æœ€åŸºæœ¬çš„ä½¿ç”¨æ–¹å¼ï¼Œå¦‚æœæˆ‘ä»¬æƒ³å¯¹æ—¥å¿—è¾“å‡ºåšä¸€äº›å®šåˆ¶ï¼Œå¯ä»¥ä½¿ç”¨ log.New åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰ loggerï¼š\n1 logger := log.New(os.Stdout, \u0026#34;[Debug] - \u0026#34;, log.Lshortfile) log.New å‡½æ•°æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«ç”¨æ¥æŒ‡å®šï¼šæ—¥å¿—è¾“å‡ºä½ç½®ï¼ˆä¸€ä¸ª io.Writer å¯¹è±¡ï¼‰ã€æ—¥å¿—å‰ç¼€ï¼ˆå­—ç¬¦ä¸²ï¼Œæ¯æ¬¡æ‰“å°æ—¥å¿—éƒ½ä¼šè·Ÿéšè¾“å‡ºï¼‰ã€æ—¥å¿—å±æ€§ï¼ˆå®šä¹‰å¥½çš„å¸¸é‡ï¼Œç¨åä¼šè¯¦ç»†è®²è§£ï¼‰ã€‚\nä½¿ç”¨ç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 package main import ( \u0026#34;log\u0026#34; \u0026#34;os\u0026#34; ) func main() { logger := log.New(os.Stdout, \u0026#34;[Debug] - \u0026#34;, log.Lshortfile) logger.Println(\u0026#34;custom logger\u0026#34;) } ç¤ºä¾‹è¾“å‡ºï¼š\n1 [Debug] - main.go:10: custom logger ä»¥ä¸Šç¤ºä¾‹ä¸­ï¼ŒæŒ‡å®šæ—¥å¿—è¾“å‡ºåˆ° os.Stdoutï¼Œå³æ ‡å‡†è¾“å‡ºï¼›æ—¥å¿—å‰ç¼€ [Debug] - ä¼šè‡ªåŠ¨è¢«åŠ å…¥åˆ°æ¯è¡Œæ—¥å¿—çš„è¡Œé¦–ï¼›è¿™æ¡æ—¥å¿—æ²¡æœ‰æ‰“å°å½“å‰æ—¶é—´ï¼Œè€Œæ˜¯æ‰“å°äº†æ–‡ä»¶åå’Œè¡Œå·ï¼Œè¿™æ˜¯ log.Lshortfile æ—¥å¿—å±æ€§çš„ä½œç”¨ã€‚\næ—¥å¿—å±æ€§å¯é€‰é¡¹å¦‚ä¸‹ï¼š\nå±æ€§ è¯´æ˜ Ldate å½“å‰æ—¶åŒºçš„æ—¥æœŸï¼Œæ ¼å¼ï¼š2009/01/23 Ltime å½“å‰æ—¶åŒºçš„æ—¶é—´ï¼Œæ ¼å¼ï¼š01:23:23 Lmicroseconds å½“å‰æ—¶åŒºçš„æ—¶é—´ï¼Œæ ¼å¼ï¼š01:23:23.123123ï¼Œç²¾ç¡®åˆ°å¾®å¦™ Llongfile å…¨æ–‡ä»¶åå’Œè¡Œå·ï¼Œæ ¼å¼ï¼š/a/b/c/d.go:23 Lshortfile å½“å‰æ–‡ä»¶åå’Œè¡Œå·ï¼Œæ ¼å¼ï¼šd.go:23ï¼Œä¼šè¦†ç›– Llongfile LUTC ä½¿ç”¨ UTC è€Œéæœ¬åœ°æ—¶åŒºï¼Œæ¨èæ—¥å¿—å…¨éƒ¨ä½¿ç”¨ UTC æ—¶é—´ Lmsgprefix å°† prefix å†…å®¹ä»è¡Œé¦–ç§»åŠ¨åˆ°æ—¥å¿—å†…å®¹å‰é¢ LstdFlags æ ‡å‡† logger å¯¹è±¡çš„åˆå§‹å€¼ï¼ˆç­‰äºï¼š`Ldate è¿™äº›å±æ€§éƒ½æ˜¯é¢„å®šä¹‰å¥½çš„å¸¸é‡ï¼Œä¸èƒ½ä¿®æ”¹ï¼Œå¯ä»¥é€šè¿‡ | è¿ç®—ç¬¦ç»„åˆä½¿ç”¨ï¼ˆå¦‚ï¼šlog.Ldate|log.Ltime|log.Lshortfileï¼‰ã€‚\nä½¿ç”¨ log.New å‡½æ•°åˆ›å»º logger å¯¹è±¡ä»¥åï¼Œä¾ç„¶å¯ä»¥é€šè¿‡ logger å¯¹è±¡çš„æ–¹æ³•ä¿®æ”¹å…¶å±æ€§å€¼ï¼ˆé»˜è®¤çš„logä¹ŸåŒæ ·æœ‰ä¸‹åˆ—åŒåå‡½æ•°ï¼‰ï¼š\næ–¹æ³• ä½œç”¨ SetOutput è®¾ç½®æ—¥å¿—è¾“å‡ºä½ç½® SetPrefix è®¾ç½®æ—¥å¿—è¾“å‡ºå‰ç¼€ SetFlags è®¾ç½®æ—¥å¿—å±æ€§ ç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªæ›´åŠ å®Œæ•´çš„ä½¿ç”¨ç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 package main import ( \u0026#34;log\u0026#34; \u0026#34;os\u0026#34; ) func main() { // å‡†å¤‡æ—¥å¿—æ–‡ä»¶ logFile, _ := os.Create(\u0026#34;demo.log\u0026#34;) defer func() { _ = logFile.Close() }() // åˆå§‹åŒ–æ—¥å¿—å¯¹è±¡ logger := log.New(logFile, \u0026#34;[Debug] - \u0026#34;, log.Lshortfile|log.Lmsgprefix) logger.Print(\u0026#34;Print\u0026#34;) logger.Println(\u0026#34;Println\u0026#34;) // ä¿®æ”¹æ—¥å¿—é…ç½® logger.SetOutput(os.Stdout) logger.SetPrefix(\u0026#34;[Info] - \u0026#34;) logger.SetFlags(log.Ldate|log.Ltime|log.LUTC) logger.Print(\u0026#34;Print\u0026#34;) logger.Println(\u0026#34;Println\u0026#34;) } æ‰§è¡Œä»¥ä¸Šä»£ç ï¼Œå¾—åˆ° demo.log æ—¥å¿—å†…å®¹å¦‚ä¸‹ï¼š\n1 2 main.go:15: [Debug] - Print main.go:16: [Debug] - Println æ§åˆ¶å°è¾“å‡ºå†…å®¹å¦‚ä¸‹ï¼š\n1 2 [Info] - 2023/03/11 01:24:56 Print [Info] - 2023/03/11 01:24:56 Println å¯ä»¥å‘ç°ï¼Œåœ¨ demo.log æ—¥å¿—å†…å®¹ä¸­ï¼Œå› ä¸ºæŒ‡å®šäº† log.Lmsgprefix å±æ€§ï¼Œæ‰€ä»¥æ—¥å¿—å‰ç¼€ [Debug] - è¢«ç§»åŠ¨åˆ°äº†æ—¥å¿—å†…å®¹å‰é¢ï¼Œè€Œéè¡Œé¦–ã€‚\nå› ä¸ºåç»­é€šè¿‡ logger.SetXXX å¯¹ logger å¯¹è±¡çš„å±æ€§è¿›è¡Œäº†åŠ¨æ€ä¿®æ”¹ï¼Œæ‰€ä»¥æœ€åä¸¤æ¡æ—¥å¿—è¾“å‡ºåˆ°ç³»ç»Ÿçš„æ ‡å‡†è¾“å‡ºã€‚\nä»¥ä¸Šï¼ŒåŸºæœ¬æ¶µç›–äº† log åŒ…çš„æ‰€æœ‰å¸¸ç”¨åŠŸèƒ½ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±é€šè¿‡èµ°è¯»æºç çš„æ–¹å¼æ¥æ›´æ·±å…¥çš„äº†è§£ log åŒ…äº†ã€‚\n# æºç  æ³¨æ„ï¼šæœ¬æ–‡ä»¥ Go 1.19.4 æºç ä¸ºä¾‹ï¼Œå…¶ä»–ç‰ˆæœ¬å¯èƒ½å­˜åœ¨å·®å¼‚ã€‚\nGo æ ‡å‡†åº“çš„ log åŒ…ä»£ç é‡éå¸¸å°‘ï¼Œç®—ä¸Šæ³¨é‡Šä¹Ÿæ‰ 400+ è¡Œï¼Œéå¸¸é€‚åˆåˆå­¦è€…é˜…è¯»å­¦ä¹ ã€‚\nåœ¨ä¸Šé¢ä»‹ç»çš„ç¬¬ä¸€ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ log åŒ…æä¾›çš„ 9 ä¸ªå…¬å¼€å‡½æ•°å¯¹æ—¥å¿—è¿›è¡Œè¾“å‡ºï¼Œå¹¶é€šè¿‡è¡¨æ ¼çš„å½¢å¼åˆ†åˆ«ä»‹ç»äº†å‡½æ•°çš„ä½œç”¨å’Œä½¿ç”¨ç¤ºä¾‹ï¼Œé‚£ä¹ˆç°åœ¨æˆ‘ä»¬å°±æ¥çœ‹çœ‹è¿™å‡ ä¸ªå‡½æ•°æ˜¯å¦‚ä½•å®šä¹‰çš„ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 func Print(v ...any) { if atomic.LoadInt32(\u0026amp;std.isDiscard) != 0 { return } std.Output(2, fmt.Sprint(v...)) } func Printf(format string, v ...any) { if atomic.LoadInt32(\u0026amp;std.isDiscard) != 0 { return } std.Output(2, fmt.Sprintf(format, v...)) } func Println(v ...any) { if atomic.LoadInt32(\u0026amp;std.isDiscard) != 0 { return } std.Output(2, fmt.Sprintln(v...)) } func Fatal(v ...any) { std.Output(2, fmt.Sprint(v...)) os.Exit(1) } func Fatalf(format string, v ...any) { std.Output(2, fmt.Sprintf(format, v...)) os.Exit(1) } func Fatalln(v ...any) { std.Output(2, fmt.Sprintln(v...)) os.Exit(1) } func Panic(v ...any) { s := fmt.Sprint(v...) std.Output(2, s) panic(s) } func Panicf(format string, v ...any) { s := fmt.Sprintf(format, v...) std.Output(2, s) panic(s) } func Panicln(v ...any) { s := fmt.Sprintln(v...) std.Output(2, s) panic(s) } å¯ä»¥å‘ç°ï¼Œè¿™äº›å‡½æ•°ä»£ç ä¸»é€»è¾‘åŸºæœ¬ä¸€è‡´ï¼Œéƒ½æ˜¯é€šè¿‡ std.Output è¾“å‡ºæ—¥å¿—ã€‚ä¸åŒçš„æ˜¯ï¼ŒPrintX è¾“å‡ºæ—¥å¿—åç¨‹åºå°±æ‰§è¡Œç»“æŸäº†ï¼›Fatal è¾“å‡ºæ—¥å¿—åä¼šæ‰§è¡Œ os.Exit(1)ï¼›è€Œ Panic è¾“å‡ºæ—¥å¿—åä¼šæ‰§è¡Œ panic(s)ã€‚\né‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯è¦ææ¸…æ¥šè¿™ä¸ª std å¯¹è±¡æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå®ƒçš„ Output æ–¹æ³•æ˜¯å¦‚ä½•å®šä¹‰çš„ã€‚\næˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ std æ˜¯ä»€ä¹ˆï¼š\n1 2 3 4 5 6 7 8 9 var std = New(os.Stderr, \u0026#34;\u0026#34;, LstdFlags) func New(out io.Writer, prefix string, flag int) *Logger { l := \u0026amp;Logger{out: out, prefix: prefix, flag: flag} if out == io.Discard { l.isDiscard = 1 } return l } å¯ä»¥çœ‹åˆ°ï¼Œstd å…¶å®å°±æ˜¯ä½¿ç”¨ New åˆ›å»ºçš„ä¸€ä¸ª Logger å¯¹è±¡ï¼Œæ—¥å¿—è¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯è¾“å‡ºï¼Œæ—¥å¿—å‰ç¼€ä¸ºç©ºï¼Œæ—¥å¿—å±æ€§ä¸º LstdFlagsã€‚\nè¿™è·Ÿæˆ‘ä»¬ä¸Šé¢è®²çš„è‡ªå®šä¹‰æ—¥å¿—å¯¹è±¡ logger := log.New(os.Stdout, \u0026quot;[Debug] - \u0026quot;, log.Lshortfile) æ–¹å¼å¦‚å‡ºä¸€è¾™ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æˆ‘ä»¬é€šè¿‡ log.Print(\u0026quot;Print\u0026quot;) æ‰“å°æ—¥å¿—æ—¶ï¼Œå…¶å®ä½¿ç”¨çš„æ˜¯ log åŒ…å†…éƒ¨å·²ç»å®šä¹‰å¥½çš„ Logger å¯¹è±¡ã€‚\nLogger å®šä¹‰å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 type Logger struct { mu sync.Mutex // é”ï¼Œä¿è¯å¹¶å‘æƒ…å†µä¸‹å¯¹å…¶å±æ€§æ“ä½œæ˜¯åŸå­æ€§çš„ prefix string // æ—¥å¿—å‰ç¼€ï¼Œå³ Lmsgprefix å‚æ•°å€¼ flag int // æ—¥å¿—å±æ€§ï¼Œç”¨æ¥æ§åˆ¶æ—¥å¿—è¾“å‡ºæ ¼å¼ out io.Writer // æ—¥å¿—è¾“å‡ºä½ç½®ï¼Œå®ç°äº† io.Writer æ¥å£å³å¯ï¼Œå¦‚ æ–‡ä»¶ã€os.Stderr buf []byte // å­˜å‚¨æ—¥å¿—è¾“å‡ºå†…å®¹ isDiscard int32 // å½“ out = io.Discard æ˜¯ï¼Œæ­¤å€¼ä¸º 1 } å…¶ä¸­ï¼Œflag å’Œ isDiscard è¿™ä¸¤ä¸ªå±æ€§æœ‰å¿…è¦è¿›ä¸€æ­¥è§£é‡Šä¸‹ã€‚\né¦–å…ˆæ˜¯ flag ç”¨æ¥è®°å½•æ—¥å¿—å±æ€§ï¼Œå…¶åˆæ³•å€¼å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 const ( Ldate = 1 \u0026lt;\u0026lt; iota // the date in the local time zone: 2009/01/23 Ltime // the time in the local time zone: 01:23:23 Lmicroseconds // microsecond resolution: 01:23:23.123123. assumes Ltime. Llongfile // full file name and line number: /a/b/c/d.go:23 Lshortfile // final file name element and line number: d.go:23. overrides Llongfile LUTC // if Ldate or Ltime is set, use UTC rather than the local time zone Lmsgprefix // move the \u0026#34;prefix\u0026#34; from the beginning of the line to before the message LstdFlags = Ldate | Ltime // initial values for the standard logger ) å…·ä½“å«ä¹‰æˆ‘å°±ä¸å†ä¸€ä¸€è§£é‡Šäº†ï¼Œå‰æ–‡çš„è¡¨æ ¼å·²ç»å†™çš„å¾ˆè¯¦ç»†äº†ã€‚\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œåœ¨å®šä¹‰å¸¸é‡æ—¶ï¼Œå·§å¦™çš„ä½¿ç”¨äº†å·¦ç§»è¿ç®—ç¬¦ 1 \u0026lt;\u0026lt; iotaï¼Œä½¿å¾—å¸¸é‡çš„å€¼å‘ˆç° 1ã€2ã€4ã€8â€¦ è¿™æ ·çš„é€’å¢æ•ˆæœã€‚å…¶å®æ˜¯ä¸ºäº†ä½è¿ç®—æ–¹ä¾¿ï¼Œé€šè¿‡å¯¹å±æ€§è¿›è¡Œä½è¿ç®—ï¼Œæ¥å†³å®šè¾“å‡ºå†…å®¹ï¼Œå…¶æœ¬è´¨ä¸Šè·ŸåŸºäºä½è¿ç®—çš„æƒé™ç®¡ç†æ˜¯ä¸€æ ·çš„ã€‚æ‰€ä»¥åœ¨ä½¿ç”¨ log.New æ–°å»º Logger å¯¹è±¡æ—¶å¯ä»¥æ”¯æŒ log.Ldate|log.Ltime|log.Lshortfile è¿™ç§å½¢å¼è®¾ç½®å¤šä¸ªå±æ€§ã€‚\nstd å¯¹è±¡çš„å±æ€§åˆå§‹å€¼ LstdFlags ä¹Ÿæ˜¯åœ¨è¿™é‡Œå®šä¹‰çš„ã€‚\nå…¶æ¬¡è¿˜æœ‰ä¸€ä¸ªå±æ€§ isDiscardï¼Œæ˜¯ç”¨æ¥ä¸¢å¼ƒæ—¥å¿—çš„ã€‚åœ¨ä¸Šé¢ä»‹ç» PrintX å‡½æ•°å®šä¹‰æ—¶ï¼Œåœ¨è¾“å‡ºæ—¥å¿—å‰æœ‰ä¸€ä¸ª if atomic.LoadInt32(\u0026amp;std.isDiscard) != 0 çš„åˆ¤æ–­ï¼Œå¦‚æœç»“æœä¸ºçœŸï¼Œåˆ™ç›´æ¥ return ä¸è®°å½•æ—¥å¿—ã€‚\nåœ¨ Go æ ‡å‡†åº“çš„ io åŒ…é‡Œï¼Œæœ‰ä¸€ä¸ª io.Discard å¯¹è±¡ï¼Œio.Discard å®ç°äº† io.Writerï¼Œå®ƒæ‰§è¡Œ Write æ“ä½œåä¸ä¼šäº§ç”Ÿä»»ä½•å®é™…çš„æ•ˆæœï¼Œæ˜¯ä¸€ä¸ªç”¨äºä¸¢å¼ƒæ•°æ®çš„å¯¹è±¡ã€‚æ¯”å¦‚æœ‰æ—¶å€™æˆ‘ä»¬ä¸åœ¨æ„æ•°æ®å†…å®¹ï¼Œä½†å¯èƒ½å­˜åœ¨æ•°æ®ä¸è¯»å‡ºæ¥å°±æ— æ³•å…³é—­è¿æ¥çš„æƒ…å†µï¼Œè¿™æ—¶å€™å°±å¯ä»¥ä½¿ç”¨ io.Copy(io.Discard, io.Reader) å°†æ•°æ®å†™å…¥ io.Discard å®ç°ä¸¢å¼ƒæ•°æ®çš„æ•ˆæœã€‚\nä½¿ç”¨ New åˆ›å»º Logger å¯¹è±¡æ—¶ï¼Œå¦‚æœ out == io.Discard åˆ™ l.isDiscard çš„å€¼ä¼šè¢«ç½®ä¸º 1ï¼Œæ‰€ä»¥ä½¿ç”¨ PrintX å‡½æ•°è®°å½•çš„æ—¥å¿—å°†ä¼šè¢«ä¸¢å¼ƒï¼Œè€Œ isDiscard å±æ€§ä¹‹æ‰€ä»¥æ˜¯ int32 ç±»å‹è€Œä¸æ˜¯ boolï¼Œæ˜¯å› ä¸ºæ–¹ä¾¿åŸå­æ“ä½œã€‚\nç°åœ¨ï¼Œæˆ‘ä»¬ç»ˆäºå¯ä»¥æ¥çœ‹ std.Output çš„å®ç°äº†ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 func (l *Logger) Output(calldepth int, s string) error { now := time.Now() // è·å–å½“å‰æ—¶é—´ var file string var line int // åŠ é”ï¼Œä¿è¯å¹¶å‘å®‰å…¨ l.mu.Lock() defer l.mu.Unlock() // é€šè¿‡ä½è¿ç®—æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦è·å–æ–‡ä»¶åå’Œè¡Œå· if l.flag\u0026amp;(Lshortfile|Llongfile) != 0 { // è¿è¡Œ runtime.Caller è·å–æ–‡ä»¶åå’Œè¡Œå·æ¯”è¾ƒè€—æ—¶ï¼Œæ‰€ä»¥å…ˆé‡Šæ”¾é” l.mu.Unlock() var ok bool _, file, line, ok = runtime.Caller(calldepth) if !ok { file = \u0026#34;???\u0026#34; line = 0 } // è·å–åˆ°æ–‡ä»¶è¡Œå·åå†æ¬¡åŠ é”ï¼Œä¿è¯ä¸‹é¢ä»£ç å¹¶å‘å®‰å…¨ l.mu.Lock() } // æ¸…ç©ºä¸Šæ¬¡ç¼“å­˜çš„å†…å®¹ l.buf = l.buf[:0] // æ ¼å¼åŒ–æ—¥å¿—å¤´ä¿¡æ¯ï¼ˆå¦‚ï¼šæ—¥æœŸæ—¶é—´ã€æ–‡ä»¶åå’Œè¡Œå·ã€å‰ç¼€ï¼‰å¹¶å†™å…¥ buf l.formatHeader(\u0026amp;l.buf, now, file, line) // è¿½åŠ æ—¥å¿—å†…å®¹åˆ° buf l.buf = append(l.buf, s...) // ä¿è¯è¾“å‡ºæ—¥å¿—ä»¥ \\n ç»“å°¾ if len(s) == 0 || s[len(s)-1] != \u0026#39;\\n\u0026#39; { l.buf = append(l.buf, \u0026#39;\\n\u0026#39;) } // è°ƒç”¨ Logger å¯¹è±¡çš„ out å±æ€§çš„ Write æ–¹æ³•è¾“å‡ºæ—¥å¿— _, err := l.out.Write(l.buf) return err } Output æ–¹æ³•ä»£ç å¹¶ä¸å¤šï¼ŒåŸºæœ¬é€»è¾‘ä¹Ÿæ¯”è¾ƒæ¸…æ™°ï¼Œé¦–å…ˆæ ¹æ®æ—¥å¿—å±æ€§æ¥å†³å®šæ˜¯å¦éœ€è¦è·å–æ–‡ä»¶åå’Œè¡Œå·ï¼Œå› ä¸ºè°ƒç”¨ runtime.Caller æ˜¯ä¸€ä¸ªè€—æ—¶æ“ä½œï¼Œå¼€é”€æ¯”è¾ƒå¤§ï¼Œä¸ºäº†å¢åŠ å¹¶å‘æ€§ï¼Œæš‚æ—¶å°†é”é‡Šæ”¾ï¼Œè·å–åˆ°æ–‡ä»¶åå’Œè¡Œå·åå†é‡æ–°åŠ é”ã€‚\næ¥ä¸‹æ¥å°±æ˜¯å‡†å¤‡æ—¥å¿—è¾“å‡ºå†…å®¹äº†ï¼Œé¦–å…ˆæ¸…ç©º buf ä¸­ä¿ç•™çš„ä¸Šæ¬¡æ—¥å¿—ä¿¡æ¯ï¼Œç„¶åé€šè¿‡ formatHeader æ–¹æ³•æ ¼å¼åŒ–æ—¥å¿—å¤´ä¿¡æ¯ï¼Œæ¥ç€æŠŠæ—¥å¿—å†…å®¹ä¹Ÿè¿½åŠ åˆ° buf ä¸­ï¼Œåœ¨è¿™ä¹‹åæœ‰ä¸€ä¸ªä¿è¯è¾“å‡ºæ—¥å¿—ä»¥ \\n ç»“å°¾çš„é€»è¾‘ï¼Œæ¥ä¿è¯è¾“å‡ºçš„æ—¥å¿—éƒ½æ˜¯å•ç‹¬ä¸€è¡Œçš„ã€‚ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰æ³¨æ„åˆ°ï¼Œåœ¨å‰æ–‡çš„ log åŒ…ä½¿ç”¨ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Print å’Œ Println ä¸¤ä¸ªæ–¹æ³•æ—¶ï¼Œæœ€ç»ˆæ—¥å¿—è¾“å‡ºæ•ˆæœå¹¶æ— å·®åˆ«ï¼Œä½¿ç”¨ Print æ‰“å°æ—¥å¿—ä¹Ÿä¼šæ¢è¡Œï¼Œå…¶å®å°±æ˜¯è¿™é‡Œçš„é€»è¾‘å†³å®šçš„ã€‚\næœ€åï¼Œé€šè¿‡è°ƒç”¨ l.out.Write æ–¹æ³•ï¼Œå°† buf å†…å®¹è¾“å‡ºã€‚\nfunc Caller(skip int) (pc uintptr, file string, line int, ok bool)\nå½“skipä¸º0æ—¶ï¼Œè·å–è°ƒç”¨è¯¥å‡½æ•°çš„å‡½æ•°ä¿¡æ¯ï¼Œè¿”å›å€¼åŒ…æ‹¬ç¨‹åºè®¡æ•°å™¨ï¼ˆpcï¼šprogram counteræ ˆå¸§çš„å…¥å£åœ°å€ï¼‰ã€fileè°ƒç”¨å‡½æ•°æ‰€åœ¨æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ã€lineè°ƒç”¨è¡Œå·ï¼Œokæ˜¯å¦è·å–æˆåŠŸ å½“skipä¸º1æ—¶ï¼Œè·å–è°ƒç”¨è¯¥å‡½æ•°çš„è°ƒç”¨å‡½æ•°çš„ä¿¡æ¯ï¼Œè¿”å›å€¼åŒ…æ‹¬ç¨‹åºè®¡æ•°å™¨ï¼ˆpcï¼šprogram counteræ ˆå¸§çš„å…¥å£åœ°å€ï¼‰ã€è°ƒç”¨å‡½æ•°æ‰€åœ¨æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ã€è°ƒç”¨è¡Œå·ï¼Œæ˜¯å¦è·å–æˆåŠŸ ä»¥æ­¤ç±»æ¨ func FuncForPC(pc uintptr) *Func\næ ¹æ®pcè·å–è°ƒç”¨å‡½æ•°å¯¹è±¡ï¼Œnameå±æ€§å¯ä»¥è·å–è°ƒç”¨å‡½æ•°å. func CallersFrames(callers []uintptr) *Frames\næ ¹æ®pcå­—èŠ‚åˆ‡ç‰‡è·å–è°ƒç”¨æ ˆå¸§ã€‚next()æ–¹æ³•è·å–æ ˆå¸§ã€‚ç„¶åé€šè¿‡æ ˆå¸§å¯ä»¥è·å–å‡½æ•°åï¼Œå‡½æ•°æ‰€åœ¨æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ã€‚è°ƒç”¨è¡Œå·ã€‚ 1 2 3 4 5 6 7 8 9 frames := runtime.CallersFrames([]uintptr{pc}) // éå†æ ˆå¸§ for { frame, more := frames.Next() if !more { break } fmt.Printf(\u0026#34;å‡½æ•°å: %s, æ–‡ä»¶: %s, è¡Œå·: %d\\n\u0026#34;, frame.Function, frame.File, frame.Line) } æˆ‘ä»¬æ¥çœ‹ä¸‹ç”¨æ¥æ ¼å¼åŒ–æ—¥å¿—å¤´ä¿¡æ¯çš„ formatHeader æ–¹æ³•æ˜¯å¦‚ä½•å®šä¹‰ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 func (l *Logger) formatHeader(buf *[]byte, t time.Time, file string, line int) { // å¦‚æœæ²¡æœ‰è®¾ç½® Lmsgprefix å±æ€§ï¼Œå°†æ—¥å¿—å‰ç¼€å†…å®¹è®¾ç½®åˆ°è¡Œé¦– if l.flag\u0026amp;Lmsgprefix == 0 { *buf = append(*buf, l.prefix...) } // åˆ¤æ–­æ˜¯å¦è®¾ç½®äº†æ—¥æœŸæ—¶é—´ç›¸å…³çš„å±æ€§ if l.flag\u0026amp;(Ldate|Ltime|Lmicroseconds) != 0 { // æ˜¯å¦è®¾ç½® UTC æ—¶é—´ if l.flag\u0026amp;LUTC != 0 { t = t.UTC() } // æ˜¯å¦è®¾ç½®æ—¥æœŸ if l.flag\u0026amp;Ldate != 0 { year, month, day := t.Date() itoa(buf, year, 4) *buf = append(*buf, \u0026#39;/\u0026#39;) itoa(buf, int(month), 2) *buf = append(*buf, \u0026#39;/\u0026#39;) itoa(buf, day, 2) *buf = append(*buf, \u0026#39; \u0026#39;) } // æ˜¯å¦è®¾ç½®æ—¶é—´ if l.flag\u0026amp;(Ltime|Lmicroseconds) != 0 { hour, min, sec := t.Clock() itoa(buf, hour, 2) *buf = append(*buf, \u0026#39;:\u0026#39;) itoa(buf, min, 2) *buf = append(*buf, \u0026#39;:\u0026#39;) itoa(buf, sec, 2) if l.flag\u0026amp;Lmicroseconds != 0 { *buf = append(*buf, \u0026#39;.\u0026#39;) itoa(buf, t.Nanosecond()/1e3, 6) } *buf = append(*buf, \u0026#39; \u0026#39;) } } // æ˜¯å¦è®¾ç½®æ–‡ä»¶åå’Œè¡Œå· if l.flag\u0026amp;(Lshortfile|Llongfile) != 0 { if l.flag\u0026amp;Lshortfile != 0 { short := file for i := len(file) - 1; i \u0026gt; 0; i-- { if file[i] == \u0026#39;/\u0026#39; { short = file[i+1:] break } } file = short } *buf = append(*buf, file...) *buf = append(*buf, \u0026#39;:\u0026#39;) itoa(buf, line, -1) *buf = append(*buf, \u0026#34;: \u0026#34;...) } // å¦‚æœè®¾ç½®äº† Lmsgprefix å±æ€§ï¼Œå°†æ—¥å¿—å‰ç¼€å†…å®¹æ”¾åˆ°æ—¥å¿—å¤´ä¿¡æ¯æœ€åï¼Œä¹Ÿå°±æ˜¯ç´§æŒ¨ç€æ—¥å¿—å†…å®¹å‰é¢ if l.flag\u0026amp;Lmsgprefix != 0 { *buf = append(*buf, l.prefix...) } } formatHeader æ–¹æ³•æ˜¯ log åŒ…é‡Œé¢ä»£ç é‡æœ€å¤šçš„ä¸€ä¸ªæ–¹æ³•ï¼Œä¸»è¦é€šè¿‡æŒ‰ä½ä¸ï¼ˆ\u0026amp;ï¼‰æ¥è®¡ç®—æ˜¯å¦è®¾ç½®äº†æŸä¸ªæ—¥å¿—å±æ€§ï¼Œç„¶åæ ¹æ®æ—¥å¿—å±æ€§æ¥æ ¼å¼åŒ–å¤´ä¿¡æ¯ã€‚\nå…¶ä¸­å¤šæ¬¡è°ƒç”¨ itoa å‡½æ•°ï¼Œitoa é¡¾åæ€ä¹‰ï¼Œå°† int è½¬æ¢æˆ ASCII ç ï¼Œitoa å®šä¹‰å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 func itoa(buf *[]byte, i int, wid int) { // Assemble decimal in reverse order. var b [20]byte bp := len(b) - 1 for i \u0026gt;= 10 || wid \u0026gt; 1 { wid-- q := i / 10 b[bp] = byte(\u0026#39;0\u0026#39; + i - q*10) bp-- i = q } // i \u0026lt; 10 b[bp] = byte(\u0026#39;0\u0026#39; + i) *buf = append(*buf, b[bp:]...) } è¿™ä¸ªå‡½æ•°çŸ­å°ç²¾æ‚ï¼Œå®ƒæ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œbuf ç”¨æ¥ä¿å­˜è½¬æ¢åçš„å†…å®¹ï¼Œi å°±æ˜¯å¸¦è½¬æ¢çš„å€¼ï¼Œæ¯”å¦‚ yearã€month ç­‰ï¼Œwid è¡¨ç¤ºè½¬æ¢å ASCII ç å­—ç¬¦ä¸²å®½åº¦ï¼Œå¦‚æœä¼ è¿›æ¥çš„ i å®½åº¦ä¸å¤Ÿï¼Œåˆ™å‰é¢è¡¥é›¶ã€‚æ¯”å¦‚ä¼ å…¥ itoa(\u0026amp;b, 12, 3)ï¼Œæœ€ç»ˆè¾“å‡ºå­—ç¬¦ä¸²ä¸º 012ã€‚\n'0'+iä¼šéšå¼è§¦å‘å­—ç¬¦å’ŒASCIIä¹‹é—´çš„è½¬æ¢ï¼Œ0çš„ASCIIç æ˜¯48ï¼ŒåŠ 0~9å°±æ˜¯å¯¹åº”0~9çš„ASCIIç ï¼Œè¶…è¿‡57å°±æ˜¯åˆ«çš„å­—ç¬¦ã€‚\nè‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»ç†æ¸…äº† log.Print(\u0026quot;Print\u0026quot;) æ˜¯å¦‚ä½•æ‰“å°ä¸€æ¡æ—¥å¿—çš„ï¼Œå…¶å‡½æ•°è°ƒç”¨æµç¨‹å¦‚ä¸‹ï¼š\nä¸Šé¢æˆ‘ä»¬è®²è§£äº†ä½¿ç”¨ log åŒ…ä¸­é»˜è®¤çš„ std è¿™ä¸ª Logger å¯¹è±¡æ‰“å°æ—¥å¿—çš„è°ƒç”¨æµç¨‹ã€‚å½“æˆ‘ä»¬ä½¿ç”¨è‡ªå®šä¹‰çš„ Logger å¯¹è±¡ï¼ˆlogger := log.New(os.Stdout, \u0026quot;[Debug] - \u0026quot;, log.Lshortfile)ï¼‰æ¥æ‰“å°æ—¥å¿—æ—¶ï¼Œè°ƒç”¨çš„ loggger.Print æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œè€Œä¸æ˜¯ log.Print è¿™ä¸ªåŒ…çº§åˆ«çš„å‡½æ•°ï¼Œæ‰€ä»¥å…¶å® Logger ç»“æ„ä½“ä¹Ÿå®ç°äº† 9 ç§è¾“å‡ºæ—¥å¿—æ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 func (l *Logger) Print(v ...any) { if atomic.LoadInt32(\u0026amp;l.isDiscard) != 0 { return } l.Output(2, fmt.Sprint(v...)) } func (l *Logger) Printf(format string, v ...any) { if atomic.LoadInt32(\u0026amp;l.isDiscard) != 0 { return } l.Output(2, fmt.Sprintf(format, v...)) } func (l *Logger) Println(v ...any) { if atomic.LoadInt32(\u0026amp;l.isDiscard) != 0 { return } l.Output(2, fmt.Sprintln(v...)) } func (l *Logger) Fatal(v ...any) { l.Output(2, fmt.Sprint(v...)) os.Exit(1) } func (l *Logger) Fatalf(format string, v ...any) { l.Output(2, fmt.Sprintf(format, v...)) os.Exit(1) } func (l *Logger) Fatalln(v ...any) { l.Output(2, fmt.Sprintln(v...)) os.Exit(1) } func (l *Logger) Panic(v ...any) { s := fmt.Sprint(v...) l.Output(2, s) panic(s) } func (l *Logger) Panicf(format string, v ...any) { s := fmt.Sprintf(format, v...) l.Output(2, s) panic(s) } func (l *Logger) Panicln(v ...any) { s := fmt.Sprintln(v...) l.Output(2, s) panic(s) } è¿™ 9 ä¸ªæ–¹æ³•è·Ÿ log åŒ…çº§åˆ«çš„å‡½æ•°ä¸€ä¸€å¯¹åº”ï¼Œç”¨äºè‡ªå®šä¹‰ Logger å¯¹è±¡ã€‚\næœ‰ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„ç‚¹ï¼Œåœ¨è¿™äº›æ–¹æ³•å†…éƒ¨ï¼Œè°ƒç”¨ l.Output(2, s) æ—¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•° calldepth ä¼ é€’çš„æ˜¯ 2ï¼Œè¿™è·Ÿ runtime.Caller(calldepth) å‡½æ•°å†…éƒ¨å®ç°æœ‰å…³ï¼Œruntime.Caller å‡½æ•°ç­¾åå¦‚ä¸‹ï¼š\n1 func Caller(skip int) (pc uintptr, file string, line int, ok bool) runtime.Caller è¿”å›å½“å‰ Goroutine çš„æ ˆä¸Šçš„å‡½æ•°è°ƒç”¨ä¿¡æ¯ï¼ˆç¨‹åºè®¡æ•°å™¨ã€æ–‡ä»¶ä¿¡æ¯ã€è¡Œå·ï¼‰ï¼Œå…¶å‚æ•° skip è¡¨ç¤ºå½“å‰å‘ä¸Šå±‚çš„æ ˆå¸§æ•°ï¼Œ0 ä»£è¡¨å½“å‰å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨ runtime.Caller çš„å‡½æ•°ï¼Œ1 ä»£è¡¨ä¸Šä¸€å±‚è°ƒç”¨è€…ï¼Œä»¥æ­¤ç±»æ¨ã€‚\nå› ä¸ºå‡½æ•°è°ƒç”¨é“¾ä¸º main.go -\u0026gt; log.Print -\u0026gt; std.Output -\u0026gt; runtime.Callerï¼Œæ‰€ä»¥ skip å€¼å³ä¸º 2ï¼š\n0: è¡¨ç¤º std.Output ä¸­è°ƒç”¨ runtime.Caller æ‰€åœ¨çš„æºç æ–‡ä»¶å’Œè¡Œå·ã€‚ 1: è¡¨ç¤º log.Print ä¸­è°ƒç”¨ std.Output æ‰€åœ¨çš„æºç æ–‡ä»¶å’Œè¡Œå·ã€‚ 2: è¡¨ç¤º main.go ä¸­è°ƒç”¨ log.Print æ‰€åœ¨çš„æºç æ–‡ä»¶å’Œè¡Œå·ã€‚ è¿™æ ·å½“ä»£ç å‡ºç°é—®é¢˜æ—¶ï¼Œå°±èƒ½æ ¹æ®æ—¥å¿—ä¸­è®°å½•çš„å‡½æ•°è°ƒç”¨æ ˆæ¥æ‰¾åˆ°æŠ¥é”™çš„æºç ä½ç½®äº†ã€‚\nå¦å¤–ï¼Œå‰æ–‡ä»‹ç»è¿‡ä¸‰ä¸ªè®¾ç½® Logger å¯¹è±¡å±æ€§çš„æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯ SetOutputã€SetPrefixã€SetFlagsï¼Œå…¶å®è¿™ä¸‰ä¸ªæ–¹æ³•å„è‡ªè¿˜æœ‰ä¸ä¹‹å¯¹åº”çš„è·å–ç›¸åº”å±æ€§çš„æ–¹æ³•ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 func (l *Logger) Flags() int { l.mu.Lock() defer l.mu.Unlock() return l.flag } func (l *Logger) SetFlags(flag int) { l.mu.Lock() defer l.mu.Unlock() l.flag = flag } func (l *Logger) Prefix() string { l.mu.Lock() defer l.mu.Unlock() return l.prefix } func (l *Logger) SetPrefix(prefix string) { l.mu.Lock() defer l.mu.Unlock() l.prefix = prefix } func (l *Logger) Writer() io.Writer { l.mu.Lock() defer l.mu.Unlock() return l.out } func (l *Logger) SetOutput(w io.Writer) { l.mu.Lock() defer l.mu.Unlock() l.out = w isDiscard := int32(0) if w == io.Discard { isDiscard = 1 } atomic.StoreInt32(\u0026amp;l.isDiscard, isDiscard) } å…¶å®å°±æ˜¯é’ˆå¯¹æ¯ä¸ªç§æœ‰å±æ€§ï¼Œå®šä¹‰äº† getterã€setter æ–¹æ³•ï¼Œå¹¶ä¸”æ¯ä¸ªæ–¹æ³•å†…éƒ¨ä¸ºäº†ä¿è¯å¹¶å‘å®‰å…¨ï¼Œéƒ½è¿›è¡Œäº†åŠ é”æ“ä½œã€‚\nå½“ç„¶ï¼Œlog åŒ…çº§åˆ«çš„å‡½æ•°ï¼Œä¹Ÿå°‘ä¸äº†è¿™å‡ ä¸ªåŠŸèƒ½ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 func Default() *Logger { return std } func SetOutput(w io.Writer) { std.SetOutput(w) } func Flags() int { return std.Flags() } func SetFlags(flag int) { std.SetFlags(flag) } func Prefix() string { return std.Prefix() } func SetPrefix(prefix string) { std.SetPrefix(prefix) } func Writer() io.Writer { return std.Writer() } func Output(calldepth int, s string) error { return std.Output(calldepth+1, s) // +1 for this frame. } è‡³æ­¤ï¼Œlog åŒ…çš„å…¨éƒ¨ä»£ç æˆ‘ä»¬å°±ä¸€èµ·èµ°è¯»å®Œæˆäº†ã€‚\næ€»ç»“ä¸€ä¸‹ï¼šlog åŒ…ä¸»è¦è®¾è®¡äº† Logger å¯¹è±¡å’Œå…¶æ–¹æ³•ï¼Œå¹¶ä¸”ä¸ºäº†å¼€ç®±å³ç”¨ï¼Œåœ¨åŒ…çº§åˆ«åˆå¯¹å¤–æä¾›äº†é»˜è®¤çš„ Logger å¯¹è±¡ std å’Œä¸€äº›åŒ…çº§åˆ«çš„å¯¹å¤–å‡½æ•°ã€‚Logger å¯¹è±¡çš„æ–¹æ³•ï¼Œå’ŒåŒ…çº§åˆ«çš„å‡½æ•°åŸºæœ¬ä¸Šæ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œç­¾åä¸€æ ·ï¼Œè¿™æ ·å°±å¤§å¤§é™ä½äº†ä½¿ç”¨éš¾åº¦ã€‚å¹¶ä¸”logåŒ…æ˜¯å¹¶å‘å®‰å…¨çš„ã€‚\n# ä½¿ç”¨å»ºè®® å…³äº log åŒ…çš„ä½¿ç”¨ï¼Œæˆ‘è¿˜æœ‰å‡ æ¡å»ºè®®åˆ†äº«ç»™ä½ ï¼š\nlog é»˜è®¤ä¸æ”¯æŒ Debugã€Infoã€Warn ç­‰æ›´ç»†ç²’åº¦çº§åˆ«çš„æ—¥å¿—è¾“å‡ºæ–¹æ³•ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ›å»ºå¤šä¸ª Logger å¯¹è±¡çš„æ–¹å¼æ¥å®ç°ï¼Œåªéœ€è¦ç»™æ¯ä¸ª Logger å¯¹è±¡æŒ‡å®šä¸åŒçš„æ—¥å¿—å‰ç¼€å³å¯ï¼š\n1 2 3 4 loggerDebug = log.New(os.Stdout, \u0026#34;[Debug]\u0026#34;, log.LstdFlags) loggerInfo = log.New(os.Stdout, \u0026#34;[Info]\u0026#34;, log.LstdFlags) loggerWarn = log.New(os.Stdout, \u0026#34;[Warn]\u0026#34;, log.LstdFlags) loggerError = log.New(os.Stdout, \u0026#34;[Error]\u0026#34;, log.LstdFlags) log åŒ…ä½œä¸º Go æ ‡å‡†åº“ï¼Œä»…æ”¯æŒæ—¥å¿—çš„åŸºæœ¬åŠŸèƒ½ï¼Œä¸æ”¯æŒè®°å½•ç»“æ„åŒ–æ—¥å¿—ã€æ—¥å¿—åˆ‡å‰²ã€Hook ç­‰é«˜çº§åŠŸèƒ½ï¼Œæ‰€ä»¥æ›´é€‚åˆå°å‹é¡¹ç›®ä½¿ç”¨ï¼Œæ¯”å¦‚ä¸€ä¸ªå•æ–‡ä»¶çš„è„šæœ¬ã€‚å¯¹äºä¸­å¤§å‹é¡¹ç›®ï¼Œåˆ™æ¨èä½¿ç”¨ä¸€äº›ä¸»æµçš„ç¬¬ä¸‰æ–¹æ—¥å¿—åº“ï¼Œå¦‚ logrusã€zapã€glog ç­‰ã€‚\nå¦å¤–ï¼Œå¦‚æœä½ å¯¹ Go æ ‡å‡†æ—¥å¿—åº“æœ‰æ‰€æœŸå¾…ï¼ŒGo å®˜æ–¹è¿˜æ‰“é€ äº†å¦ä¸€ä¸ªæ—¥å¿—åº“ slog ç°å·²è¿›å…¥å®éªŒé˜¶æ®µï¼Œå¦‚æœé¡¹ç›®å‘å±•é¡ºåˆ©ï¼Œå°†å¯èƒ½æˆä¸º log åŒ…çš„æ›¿ä»£å“ã€‚\n# æ€»ç»“ æœ¬æ–‡æˆ‘ä¸è¯»è€…ä¸€èµ·æ·±å…¥æ¢ç©¶äº† Go log æ ‡å‡†åº“ï¼Œé¦–å…ˆå‘å¤§å®¶ä»‹ç»äº† log åŒ…å¦‚ä½•ä½¿ç”¨ï¼Œæ¥ç€åˆå¸¦é¢†å¤§å®¶ä¸€èµ·èµ°è¯»äº† log åŒ…çš„æºç ï¼Œæœ€åæˆ‘ä¹Ÿç»™å‡ºäº†ä¸€äº›è‡ªå·±å¯¹ log åŒ…çš„ä½¿ç”¨å»ºè®®ã€‚\nå‚è€ƒï¼š\nGo log æºç  Go æ¯æ—¥ä¸€åº“ä¹‹ log æ¬è¿è‡ªæ·±å…¥æ¢ç©¶ Go log æ ‡å‡†åº“ ","date":"2024-04-27T16:54:38+08:00","permalink":"https://arlettebrook.github.io/p/%E6%B7%B1%E5%85%A5%E6%8E%A2%E7%A9%B6-go-log-%E6%A0%87%E5%87%86%E5%BA%93/","title":"æ·±å…¥æ¢ç©¶ Go log æ ‡å‡†åº“"},{"content":" åœ¨ç¨‹åºå¼€å‘ä¸­ï¼Œæœ‰äº›åœºæ™¯æ˜¯æˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°çš„ï¼Œè½¯ä»¶è¡Œä¸šçš„å…ˆè¡Œè€…ä»¬å¸®æˆ‘ä»¬æ€»ç»“äº†ä¸€äº›è§£å†³å¸¸è§åœºæ™¯ç¼–ç é—®é¢˜çš„æœ€ä½³å®è·µï¼Œäºæ˜¯å°±æœ‰äº†è®¾è®¡æ¨¡å¼ã€‚é€‰é¡¹æ¨¡å¼åœ¨ Go è¯­è¨€å¼€å‘ä¸­ä¼šç»å¸¸ç”¨åˆ°ï¼Œæ‰€ä»¥ä»Šå¤©æˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸‹é€‰é¡¹æ¨¡å¼çš„åº”ç”¨ã€‚\nç†Ÿæ‚‰ Python å¼€å‘çš„åŒå­¦éƒ½çŸ¥é“ï¼ŒPython æœ‰é»˜è®¤å‚æ•°çš„å­˜åœ¨ï¼Œä½¿å¾—æˆ‘ä»¬åœ¨å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œå¯ä»¥æ ¹æ®éœ€è¦æ¥é€‰æ‹©æ€§çš„è¦†ç›–æŸäº›é»˜è®¤å‚æ•°ï¼Œä»¥æ­¤æ¥å†³å®šå¦‚ä½•å®ä¾‹åŒ–å¯¹è±¡ã€‚å½“ä¸€ä¸ªå¯¹è±¡æœ‰å¤šä¸ªé»˜è®¤å‚æ•°æ—¶ï¼Œè¿™ä¸ªç‰¹æ€§éå¸¸å¥½ç”¨ï¼Œèƒ½å¤Ÿä¼˜é›…çš„ç®€åŒ–ä»£ç ã€‚\nè€Œ Go è¯­è¨€ä»è¯­æ³•ä¸Šæ˜¯ä¸æ”¯æŒé»˜è®¤å‚æ•°çš„ï¼Œæ‰€ä»¥ä¸ºäº†å®ç°æ—¢èƒ½é€šè¿‡é»˜è®¤å‚æ•°åˆ›å»ºå¯¹è±¡ï¼Œåˆèƒ½é€šè¿‡ä¼ é€’è‡ªå®šä¹‰å‚æ•°åˆ›å»ºå¯¹è±¡ï¼Œæˆ‘ä»¬å°±éœ€è¦é€šè¿‡ä¸€äº›ç¼–ç¨‹æŠ€å·§æ¥å®ç°ã€‚\n# é€šè¿‡å¤šæ„é€ å‡½æ•°å®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 package main import \u0026#34;fmt\u0026#34; const ( defaultAddr = \u0026#34;127.0.0.1\u0026#34; defaultPort = 8000 ) type Server struct { Addr string Port int } func NewServer() *Server { return \u0026amp;Server{ Addr: defaultAddr, Port: defaultPort, } } func NewServerWithOptions(addr string, port int) *Server { return \u0026amp;Server{ Addr: addr, Port: port, } } func main() { s1 := NewServer() s2 := NewServerWithOptions(\u0026#34;localhost\u0026#34;, 8001) fmt.Println(s1) // \u0026amp;{127.0.0.1 8000} fmt.Println(s2) // \u0026amp;{localhost 8001} } è¿™é‡Œæˆ‘ä»¬ä¸º Server ç»“æ„ä½“å®ç°äº†ä¸¤ä¸ªæ„é€ å‡½æ•°ï¼Œå…¶ä¸­ NewServer æ— éœ€ä¼ é€’å‚æ•°å³å¯ç›´æ¥è¿”å› Server å¯¹è±¡ï¼ŒNewServerWithOptions åˆ™éœ€è¦ä¼ é€’ addr å’Œ port ä¸¤ä¸ªå‚æ•°æ¥æ„é€  Server å¯¹è±¡ã€‚å½“æˆ‘ä»¬æ— éœ€å¯¹ Server è¿›è¡Œå®šåˆ¶ï¼Œé€šè¿‡é»˜è®¤å‚æ•°åˆ›å»ºçš„å¯¹è±¡å³å¯æ»¡è¶³éœ€æ±‚æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ NewServer æ¥ç”Ÿæˆå¯¹è±¡ï¼ˆs1ï¼‰ï¼Œè€Œå½“æˆ‘ä»¬éœ€è¦å¯¹å…¶è¿›è¡Œå®šåˆ¶æ—¶ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ NewServerWithOptions æ¥ç”Ÿæˆå¯¹è±¡ï¼ˆs2ï¼‰ã€‚\n# é€šè¿‡é»˜è®¤å‚æ•°é€‰é¡¹å®ç° å¦å¤–ä¸€ç§å®ç°é»˜è®¤å‚æ•°çš„æ–¹æ¡ˆæ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºè¦ç”Ÿæˆçš„ç»“æ„ä½“å¯¹è±¡å®šä¹‰ä¸€ä¸ªé€‰é¡¹ç»“æ„ä½“ï¼Œç”¨æ¥ç”Ÿæˆè¦åˆ›å»ºå¯¹è±¡çš„é»˜è®¤å‚æ•°ï¼Œä»£ç å®ç°å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 package main import \u0026#34;fmt\u0026#34; const ( defaultAddr = \u0026#34;127.0.0.1\u0026#34; defaultPort = 8000 ) type Server struct { Addr string Port int } type ServerOptions struct { Addr string Port int } func NewServerOptions() *ServerOptions { return \u0026amp;ServerOptions{ Addr: defaultAddr, Port: defaultPort, } } func NewServerWithOptions(opts *ServerOptions) *Server { return \u0026amp;Server{ Addr: opts.Addr, Port: opts.Port, } } func main() { s1 := NewServerWithOptions(NewServerOptions()) s2 := NewServerWithOptions(\u0026amp;ServerOptions{ Addr: \u0026#34;localhost\u0026#34;, Port: 8001, }) fmt.Println(s1) // \u0026amp;{127.0.0.1 8000} fmt.Println(s2) // \u0026amp;{localhost 8001} } æˆ‘ä»¬ä¸º Server ç»“æ„ä½“ä¸“é—¨å®ç°äº†ä¸€ä¸ª ServerOptions ç”¨æ¥ç”Ÿæˆé»˜è®¤å‚æ•°ï¼Œè°ƒç”¨ NewServerOptions å‡½æ•°å³å¯è·å¾—é»˜è®¤å‚æ•°é…ç½®ï¼Œæ„é€ å‡½æ•° NewServerWithOptions æ¥æ”¶ä¸€ä¸ª *ServerOptions ç±»å‹ä½œä¸ºå‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥å°†è°ƒç”¨ NewServerOptions å‡½æ•°çš„è¿”å›å€¼ä¼ é€’ç»™ NewServerWithOptions æ¥å®ç°é€šè¿‡é»˜è®¤å‚æ•°ç”Ÿæˆå¯¹è±¡ï¼ˆs1ï¼‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ‰‹åŠ¨æ„é€  ServerOptions é…ç½®æ¥ç”Ÿæˆå®šåˆ¶å¯¹è±¡ï¼ˆs2ï¼‰ã€‚\n# é€šè¿‡é€‰é¡¹æ¨¡å¼å®ç° ä»¥ä¸Šä¸¤ç§æ–¹å¼è™½ç„¶éƒ½èƒ½å¤Ÿå®ŒæˆåŠŸèƒ½ï¼Œä½†å®ç°ä¸Šå´éƒ½ä¸å¤Ÿä¼˜é›…ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸‹å¦‚ä½•é€šè¿‡é€‰é¡¹æ¨¡å¼æ›´ä¼˜é›…çš„è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä»£ç å®ç°å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 package main import \u0026#34;fmt\u0026#34; const ( defaultAddr = \u0026#34;127.0.0.1\u0026#34; defaultPort = 8000 ) type Server struct { Addr string Port int } type ServerOptions struct { Addr string Port int } type ServerOption interface { apply(*ServerOptions) } type FuncServerOption struct { f func(*ServerOptions) } func (fo FuncServerOption) apply(option *ServerOptions) { fo.f(option) } func WithAddr(addr string) ServerOption { return FuncServerOption{ f: func(options *ServerOptions) { options.Addr = addr }, } } func WithPort(port int) ServerOption { return FuncServerOption{ f: func(options *ServerOptions) { options.Port = port }, } } func NewServer(opts ...ServerOption) *Server { options := ServerOptions{ Addr: defaultAddr, Port: defaultPort, } for _, opt := range opts { opt.apply(\u0026amp;options) } return \u0026amp;Server{ Addr: options.Addr, Port: options.Port, } } func main() { s1 := NewServer() s2 := NewServer(WithAddr(\u0026#34;localhost\u0026#34;), WithPort(8001)) s3 := NewServer(WithPort(8001)) fmt.Println(s1) // \u0026amp;{127.0.0.1 8000} fmt.Println(s2) // \u0026amp;{localhost 8001} fmt.Println(s3) // \u0026amp;{127.0.0.1 8001} } ä¹ä¸€çœ‹ï¼Œæˆ‘ä»¬çš„ä»£ç å¤æ‚äº†å¾ˆå¤šï¼Œä½†å…¶å®éƒ½æ˜¯å®šä¹‰ä¸Šçš„å¤æ‚ï¼Œè°ƒç”¨æ„é€ å‡½æ•°ç”Ÿæˆå¯¹è±¡çš„ä»£ç å¤æ‚åº¦æ˜¯æ²¡æœ‰æ”¹å˜çš„ã€‚\nåœ¨è¿™é‡Œæˆ‘ä»¬å®šä¹‰äº† ServerOptions ç»“æ„ä½“ç”¨æ¥é…ç½®é»˜è®¤å‚æ•°ï¼Œå› ä¸ºè¿™é‡Œ Addr å’Œ Port éƒ½æœ‰é»˜è®¤å‚æ•°ï¼Œæ‰€ä»¥ ServerOptions çš„å®šä¹‰å’Œ Server å®šä¹‰æ˜¯ä¸€æ ·çš„ï¼Œä½†æœ‰ä¸€å®šå¤æ‚æ€§çš„ç»“æ„ä½“ä¸­å¯èƒ½ä¼šæœ‰äº›å‚æ•°æ²¡æœ‰é»˜è®¤å‚æ•°ï¼Œå¿…é¡»è®©ç”¨æˆ·æ¥é…ç½®ï¼Œè¿™æ—¶ ServerOptions çš„å­—æ®µå°±ä¼šå°‘ä¸€äº›ï¼Œå¤§å®¶å¯ä»¥æŒ‰éœ€å®šä¹‰ã€‚\nåŒæ—¶ï¼Œæˆ‘ä»¬è¿˜å®šä¹‰äº†ä¸€ä¸ª ServerOption æ¥å£å’Œå®ç°äº†æ­¤æ¥å£çš„ FuncServerOption ç»“æ„ä½“ï¼Œå®ƒä»¬çš„ä½œç”¨æ˜¯è®©æˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡ apply æ–¹æ³•ä¸º ServerOptions ç»“æ„ä½“å•ç‹¬é…ç½®æŸé¡¹å‚æ•°ã€‚\næˆ‘ä»¬å¯ä»¥åˆ†åˆ«ä¸ºæ¯ä¸ªé»˜è®¤å‚æ•°éƒ½å®šä¹‰ä¸€ä¸ª WithXXX å‡½æ•°ç”¨æ¥é…ç½®å‚æ•°ï¼Œå¦‚è¿™é‡Œå®šä¹‰çš„ WithAddr å’Œ WithPort ï¼Œè¿™æ ·ç”¨æˆ·å°±å¯ä»¥é€šè¿‡è°ƒç”¨ WithXXX å‡½æ•°æ¥å®šåˆ¶éœ€è¦è¦†ç›–çš„é»˜è®¤å‚æ•°ã€‚\næ­¤æ—¶é»˜è®¤å‚æ•°å®šä¹‰åœ¨æ„é€ å‡½æ•° NewServer ä¸­ï¼Œæ„é€ å‡½æ•°çš„æ¥æ”¶ä¸€ä¸ªä¸å®šé•¿å‚æ•°ï¼Œç±»å‹ä¸º ServerOptionï¼Œåœ¨æ„é€ å‡½æ•°å†…éƒ¨é€šè¿‡ä¸€ä¸ª for å¾ªç¯è°ƒç”¨æ¯ä¸ªä¼ è¿›æ¥çš„ ServerOption å¯¹è±¡çš„ apply æ–¹æ³•ï¼Œå°†ç”¨æˆ·é…ç½®çš„å‚æ•°ä¾æ¬¡èµ‹å€¼ç»™æ„é€ å‡½æ•°å†…éƒ¨çš„é»˜è®¤å‚æ•°å¯¹è±¡ options ä¸­ï¼Œä»¥æ­¤æ¥æ›¿æ¢é»˜è®¤å‚æ•°ï¼Œfor å¾ªç¯æ‰§è¡Œå®Œæˆåï¼Œå¾—åˆ°çš„ options å¯¹è±¡å°†æ˜¯æœ€ç»ˆé…ç½®ï¼Œå°†å…¶å±æ€§ä¾æ¬¡èµ‹å€¼ç»™ Server å³å¯ç”Ÿæˆæ–°çš„å¯¹è±¡ã€‚\n# æ€»ç»“ é€šè¿‡ s2 å’Œ s3 çš„æ‰“å°ç»“æœå¯ä»¥å‘ç°ï¼Œä½¿ç”¨é€‰é¡¹æ¨¡å¼å®ç°çš„æ„é€ å‡½æ•°æ›´åŠ çµæ´»ï¼Œç›¸è¾ƒäºå‰ä¸¤ç§å®ç°ï¼Œé€‰é¡¹æ¨¡å¼ä¸­æˆ‘ä»¬å¯ä»¥è‡ªç”±çš„æ›´æ”¹å…¶ä¸­ä»»æ„ä¸€é¡¹æˆ–å¤šé¡¹é»˜è®¤é…ç½®ã€‚\nè™½ç„¶é€‰é¡¹æ¨¡å¼ç¡®å®ä¼šå¤šå†™ä¸€äº›ä»£ç ï¼Œä½†å¤šæ•°æƒ…å†µä¸‹è¿™æ˜¯å€¼å¾—çš„ï¼ŒGoogle çš„ gRPC æ¡†æ¶ Go è¯­è¨€å®ç°ä¸­åˆ›å»º gRPC server çš„æ„é€ å‡½æ•° NewServer å°±ä½¿ç”¨äº†é€‰é¡¹æ¨¡å¼ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥çœ‹ä¸‹å…¶æºç çš„å®ç°æ€æƒ³å…¶å®å’Œè¿™é‡Œçš„ç¤ºä¾‹ç¨‹åºå¦‚å‡ºä¸€è¾™ã€‚\nå¸Œæœ›ä»Šå¤©çš„åˆ†äº«èƒ½å¤Ÿç»™ä½ å¸¦æ¥ä¸€ç‚¹å¸®åŠ©ã€‚\nåŸæ–‡åœ°å€ï¼šGo å¸¸è§è®¾è®¡æ¨¡å¼ä¹‹é€‰é¡¹æ¨¡å¼\n","date":"2024-04-25T23:22:54+08:00","permalink":"https://arlettebrook.github.io/p/go%E5%B8%B8%E8%A7%81%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E9%80%89%E9%A1%B9%E6%A8%A1%E5%BC%8F/","title":"Goå¸¸è§è®¾è®¡æ¨¡å¼ï¼šé€‰é¡¹æ¨¡å¼"},{"content":" å•ä¾‹æ¨¡å¼æ˜¯è®¾è®¡æ¨¡å¼ä¸­æœ€ç®€å•çš„ä¸€ç§æ¨¡å¼ï¼Œå•ä¾‹æ¨¡å¼èƒ½å¤Ÿç¡®ä¿æ— è®ºå¯¹è±¡è¢«å®ä¾‹åŒ–å¤šå°‘æ¬¡ï¼Œå…¨å±€éƒ½åªæœ‰ä¸€ä¸ªå®ä¾‹å­˜åœ¨ã€‚æ ¹æ®å•ä¾‹æ¨¡å¼çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶åº”ç”¨åˆ°å…¨å±€å”¯ä¸€æ€§é…ç½®ã€æ•°æ®åº“è¿æ¥å¯¹è±¡ã€æ–‡ä»¶è®¿é—®å¯¹è±¡ç­‰ã€‚Go è¯­è¨€æœ‰å¤šç§æ–¹å¼å¯ä»¥å®ç°å•ä¾‹æ¨¡å¼ï¼Œæˆ‘ä»¬ä»Šå¤©å°±æ¥ä¸€èµ·å­¦ä¹ ä¸‹ã€‚\n# é¥¿æ±‰å¼ é¥¿æ±‰å¼å®ç°å•ä¾‹æ¨¡å¼éå¸¸ç®€å•ï¼Œç›´æ¥çœ‹ä»£ç ï¼š\n1 2 3 4 5 6 7 8 9 package singleton type Singleton struct{} var instance = \u0026amp;Singleton{} func GetSingleton() *Singleton { return instance } singleton åŒ…åœ¨è¢«å¯¼å…¥æ—¶ä¼šè‡ªåŠ¨åˆå§‹åŒ– instance å®ä¾‹ï¼Œä½¿ç”¨æ—¶é€šè¿‡è°ƒç”¨ singleton.GetSingleton() å‡½æ•°å³å¯è·å¾— Singleton è¿™ä¸ªç»“æ„ä½“çš„å•ä¾‹å¯¹è±¡ã€‚\nç”±äºå•ä¾‹å¯¹è±¡æ˜¯åœ¨åŒ…åŠ è½½æ—¶ç«‹å³è¢«åˆ›å»ºå‡ºæ¥ï¼Œæ‰€ä»¥ä¹Ÿå°±æœ‰äº†è¿™ä¸ªå½¢è±¡çš„åç§°å«ä½œé¥¿æ±‰å¼ã€‚ä¸ä¹‹å¯¹åº”çš„å¦ä¸€ç§å®ç°æ–¹å¼å«ä½œæ‡’æ±‰å¼ï¼Œå½“å®ä¾‹è¢«ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶æ‰ä¼šè¢«åˆ›å»ºã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå°½ç®¡é¥¿æ±‰å¼å®ç°å•ä¾‹æ¨¡å¼å¦‚æ­¤ç®€å•ï¼Œä½†å¤§å¤šæ•°æƒ…å†µä¸‹ä»ä¸è¢«æ¨èä½¿ç”¨ï¼Œå› ä¸ºå¦‚æœå•ä¾‹å®ä¾‹åŒ–æ—¶åˆå§‹åŒ–å†…å®¹è¿‡å¤šï¼Œå¯èƒ½é€ æˆç¨‹åºåŠ è½½ç”¨æ—¶è¾ƒé•¿ã€‚\n# æ‡’æ±‰å¼ æ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥çœ‹ä¸‹å¦‚ä½•é€šè¿‡æ‡’æ±‰å¼å®ç°å•ä¾‹æ¨¡å¼ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 package singleton type Singleton struct{} var instance *Singleton func GetSingleton() *Singleton { if instance == nil { instance = \u0026amp;Singleton{} } return instance } ç›¸è¾ƒäºé¥¿æ±‰å¼çš„å®ç°ï¼Œæˆ‘ä»¬æŠŠå®ä¾‹åŒ– Singleton ç»“æ„ä½“éƒ¨åˆ†çš„ä»£ç ç§»åˆ°äº† GetSingleton() å‡½æ•°å†…éƒ¨ã€‚è¿™æ ·ä¸€æ¥ï¼Œå°±å°†å¯¹è±¡å®ä¾‹åŒ–çš„æ­¥éª¤å»¶è¿Ÿåˆ°äº† GetSingleton() è¢«ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶ã€‚\né€šè¿‡ instance == nil çš„åˆ¤æ–­æ¥å®ç°å•ä¾‹å¹¶ä¸ååˆ†å¯é ï¼Œå½“æœ‰å¤šä¸ª goroutine åŒæ—¶è°ƒç”¨ GetSingleton() æ—¶æ— æ³•ä¿è¯å¹¶å‘å®‰å…¨ã€‚\n# æ”¯æŒå¹¶å‘çš„å•ä¾‹ å¦‚æœä½ ç”¨ Go è¯­è¨€å†™è¿‡å¹¶å‘ç¼–ç¨‹ï¼Œé‚£ä¹ˆåº”è¯¥å¯ä»¥å¾ˆå¿«æƒ³åˆ°è§£å†³æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼å¹¶å‘å®‰å…¨é—®é¢˜çš„æ–¹æ¡ˆï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 package singleton import \u0026#34;sync\u0026#34; type Singleton struct{} var instance *Singleton var mu sync.Mutex func GetSingleton() *Singleton { mu.Lock() defer mu.Unlock() if instance == nil { instance = \u0026amp;Singleton{} } return instance } æˆ‘ä»¬å¯¹ä»£ç çš„ä¸»è¦ä¿®æ”¹å°±æ˜¯åœ¨ GetSingleton() å‡½æ•°æœ€å¼€å§‹åŠ äº†å¦‚ä¸‹ä¸¤è¡Œä»£ç ï¼š\n1 2 mu.Lock() defer mu.Unlock() é€šè¿‡åŠ é”çš„æœºåˆ¶ï¼Œå°±å¯ä»¥ä¿è¯è¿™ä¸ªå®ç°å•ä¾‹æ¨¡å¼çš„å‡½æ•°æ˜¯å¹¶å‘å®‰å…¨çš„ã€‚\nä¸è¿‡è¿™æ ·ä¹Ÿæœ‰äº›é—®é¢˜ï¼Œå› ä¸ºç”¨äº†é”æœºåˆ¶ï¼Œæ¯æ¬¡è°ƒç”¨ GetSingleton() æ—¶ç¨‹åºéƒ½ä¼šè¿›è¡ŒåŠ é”ã€è§£é”çš„æ­¥éª¤ï¼Œè¿™æ ·ä¼šå¯¼è‡´ç¨‹åºæ€§èƒ½çš„ä¸‹é™ã€‚\n# åŒé‡é”å®š åŠ é”å¯¼è‡´ç¨‹åºæ€§èƒ½ä¸‹é™ï¼Œä½†æˆ‘ä»¬åˆä¸å¾—ä¸ç”¨é”æ¥ä¿è¯ç¨‹åºçš„å¹¶å‘å®‰å…¨ï¼Œäºæ˜¯æœ‰äººæƒ³å‡ºäº†åŒé‡é”å®šï¼ˆDouble-Check Lockingï¼‰çš„æ–¹æ¡ˆï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 package singleton import \u0026#34;sync\u0026#34; type Singleton struct{} var instance *Singleton var mu sync.Mutex func GetSingleton() *Singleton { if instance == nil { mu.Lock() defer mu.Unlock() if instance == nil { instance = \u0026amp;Singleton{} } } return instance } å¯ä»¥çœ‹åˆ°ï¼Œæ‰€è°“çš„åŒé‡é”å®šå®é™…ä¸Šå°±æ˜¯åœ¨ç¨‹åºåŠ é”å‰åˆåŠ äº†ä¸€å±‚ instance == nil åˆ¤æ–­ï¼Œè¿™æ ·å°±å…¼é¡¾äº†æ€§èƒ½å’Œå®‰å…¨ä¸¤ä¸ªæ–¹é¢ã€‚\nä¸è¿‡è¿™æ®µä»£ç çœ‹èµ·æ¥æœ‰äº›å¥‡æ€ªï¼Œæ—¢ç„¶å¤–å±‚å·²ç»åˆ¤æ–­äº† instance == nilï¼ŒåŠ é”åå´åˆè¿›è¡Œäº†ç¬¬äºŒæ¬¡ instance == nil åˆ¤æ–­ã€‚å…¶å®å¤–å±‚çš„ instance == nil åˆ¤æ–­æ˜¯ä¸ºäº†æé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ï¼Œå› ä¸ºå¦‚æœ instance å·²ç»å­˜åœ¨ï¼Œåˆ™æ— éœ€è¿›å…¥ if é€»è¾‘ï¼Œç¨‹åºç›´æ¥è¿”å› instance å³å¯ã€‚è¿™æ ·å°±å…å»äº†åŸæ¥æ¯æ¬¡è°ƒç”¨ GetSingleton() éƒ½ä¸Šé”çš„æ“ä½œï¼Œå°†åŠ é”çš„ç²’åº¦æ›´åŠ ç²¾ç»†åŒ–ã€‚è€Œå†…å±‚çš„ instance == nil åˆ¤æ–­åˆ™æ˜¯è€ƒè™‘äº†å¹¶å‘å®‰å…¨ï¼Œåœ¨æç«¯æƒ…å†µä¸‹ï¼Œå¤šä¸ª goroutine åŒæ—¶èµ°åˆ°äº†åŠ é”è¿™ä¸€æ­¥ï¼Œå†…å±‚åˆ¤æ–­å°±èµ·åˆ°ä½œç”¨äº†ã€‚\n# Gopher æƒ¯ç”¨æ–¹æ¡ˆ gopheråŸæ„åœ°é¼ ï¼Œåœ¨golang çš„ä¸–ç•Œé‡Œè§£é‡Šä¸ºåœ°é“çš„goç¨‹åºå‘˜ã€‚åœ¨å…¶ä»–è¯­è¨€çš„ä¸–ç•Œé‡Œä¹Ÿæœ‰PHPerï¼ŒPythonicçš„è¯´æ³•ï¼Œåè€ŒJavaæ˜¯ä¸ªä¾‹å¤–ã€‚è™½ç„¶ä¹Ÿæœ‰Javaerä¹‹ç±»çš„è¯´æ³•ï¼Œä½†ä¼¼ä¹å¹¶ä¸è¢«è®¤å¯ã€‚è€Œåœ°é“æˆ–è€…è¯´é“åœ°ï¼Œè¯´çš„æ˜¯gopherå†™çš„ä»£ç æ— ä¸é€éœ²å‡ºgoçš„ç‹¬ç‰¹æ°”æ¯ï¼Œæ¯”å¦‚é¡¹ç›®ç»“æ„ã€å‘½åæ–¹å¼ã€ä»£ç æ ¼å¼ã€ç¼–ç é£æ ¼ã€æ„å»ºæ–¹å¼ç­‰ç­‰ã€‚ç”¨gopherçš„è¯è¯´ï¼Œç”¨goç¼–å†™ä»£ç å°±åƒæ˜¯åœ¨ç”»ä¸€å¹…ä¸­å›½å±±æ°´ç”»ï¼Œæˆå“ç¾ä¸èƒœæ”¶ï¼Œå¿ƒæ—·ç¥æ€¡ã€‚\nè™½ç„¶æˆ‘ä»¬é€šè¿‡åŒé‡é”å®šæœºåˆ¶å…¼é¡¾å’Œæ€§èƒ½å’Œå¹¶å‘å®‰å…¨ï¼Œä½†ä»£ç æœ‰äº›ä¸‘é™‹ï¼Œä¸ç¬¦åˆå¹¿å¤§ Gopher çš„æœŸå¾…ã€‚å¥½åœ¨ Go è¯­è¨€åœ¨ sync åŒ…ä¸­æä¾›äº† Once æœºåˆ¶èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬å†™å‡ºæ›´åŠ ä¼˜é›…çš„ä»£ç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 package singleton import \u0026#34;sync\u0026#34; type Singleton struct{} var instance *Singleton var once sync.Once func GetSingleton() *Singleton { once.Do(func() { instance = \u0026amp;Singleton{} }) return instance } Once æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œåœ¨æ‰§è¡Œ Do æ–¹æ³•çš„å†…éƒ¨é€šè¿‡ atomic æ“ä½œå’ŒåŠ é”æœºåˆ¶æ¥ä¿è¯å¹¶å‘å®‰å…¨ï¼Œä¸” once.Do èƒ½å¤Ÿä¿è¯å¤šä¸ª goroutine åŒæ—¶æ‰§è¡Œæ—¶ \u0026amp;singleton{} åªè¢«åˆ›å»ºä¸€æ¬¡ã€‚\nå…¶å® Once å¹¶ä¸ç¥ç§˜ï¼Œå…¶å†…éƒ¨å®ç°è·Ÿä¸Šé¢ä½¿ç”¨çš„åŒé‡é”å®šæœºåˆ¶éå¸¸ç±»ä¼¼ï¼Œåªä¸è¿‡æŠŠ instance == nil æ¢æˆäº† atomic æ“ä½œï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥æŸ¥çœ‹ä¸‹å…¶å¯¹åº”æºç ã€‚\n# æ€»ç»“ ä»¥ä¸Šå°±æ˜¯ Go è¯­è¨€ä¸­å®ç°å•ä¾‹æ¨¡å¼çš„å‡ ç§å¸¸ç”¨å¥—è·¯ï¼Œç»è¿‡å¯¹æ¯”å¯ä»¥å¾—å‡ºç»“è®ºï¼Œæœ€æ¨èçš„æ–¹å¼æ˜¯ä½¿ç”¨ once.Do æ¥å®ç°ï¼Œsync.Once åŒ…å¸®æˆ‘ä»¬éšè—äº†éƒ¨åˆ†ç»†èŠ‚ï¼Œå´å¯ä»¥è®©ä»£ç å¯è¯»æ€§å¾—åˆ°å¾ˆå¤§æå‡ã€‚\n# å‚è€ƒ ä¸ä¸€æ ·çš„goè¯­è¨€-gopher Go å¸¸è§è®¾è®¡æ¨¡å¼ä¹‹å•ä¾‹æ¨¡å¼ ","date":"2024-04-25T18:00:25+08:00","permalink":"https://arlettebrook.github.io/p/go%E5%B8%B8%E8%A7%81%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/","title":"Goå¸¸è§è®¾è®¡æ¨¡å¼ï¼šå•ä¾‹æ¨¡å¼"},{"content":" # å¼•å­ åœ¨å·¥ä½œä¸­ï¼Œæˆ‘æ—¶ä¸æ—¶åœ°ä¼šéœ€è¦åœ¨Goä¸­è°ƒç”¨å¤–éƒ¨å‘½ä»¤ã€‚å‰æ®µæ—¶é—´æˆ‘åšäº†ä¸€ä¸ªå·¥å…·ï¼Œåœ¨é’‰é’‰ç¾¤ä¸­æ·»åŠ äº†ä¸€ä¸ªæœºå™¨äººï¼Œ@è¿™ä¸ªæœºå™¨äººå¯ä»¥è®©å®ƒæ‰§è¡Œä¸€äº›å†™å¥½çš„è„šæœ¬ç¨‹åºå®ŒæˆæŒ‡å®šçš„ä»»åŠ¡ã€‚æœºå™¨äººå€’æ˜¯ä¸éš¾ï¼Œç…§ç€é’‰é’‰å¼€å‘è€…æ–‡æ¡£æ·»åŠ å¥½æœºå™¨äººï¼Œç„¶å@è¿™ä¸ªæœºå™¨äººå°±ä¼šå‘ä¸€ä¸ªä½ æŒ‡å®šçš„æœåŠ¡å™¨å‘é€ä¸€ä¸ªPOSTè¯·æ±‚ï¼Œè¯·æ±‚ä¸­ä¼šé™„å¸¦æ–‡æœ¬æ¶ˆæ¯ã€‚æ‰€ä»¥æˆ‘è¦åšçš„å°±æ˜¯æ­ä¸€ä¸ªWebæœåŠ¡å™¨ï¼Œå¯ä»¥ç”¨goåŸç”Ÿçš„net/httpåŒ…ï¼Œä¹Ÿå¯ä»¥ç”¨gin/fasthttp/fiberè¿™äº›Webæ¡†æ¶ã€‚æ”¶åˆ°è¯·æ±‚ä¹‹åï¼Œæ£€æŸ¥é™„å¸¦æ–‡æœ¬ä¸­çš„å…³é”®å­—å»è°ƒç”¨å¯¹åº”çš„ç¨‹åºï¼Œç„¶åè¿”å›ç»“æœã€‚\ngoæ ‡å‡†åº“ä¸­çš„os/execåŒ…å¯¹è°ƒç”¨å¤–éƒ¨ç¨‹åºæä¾›äº†æ”¯æŒï¼Œæœ¬æ–‡è¯¦ç»†ä»‹ç»os/execçš„ä½¿ç”¨å§¿åŠ¿ã€‚\n# è¿è¡Œå‘½ä»¤ Linuxä¸­æœ‰ä¸ªcalå‘½ä»¤ï¼Œå®ƒå¯ä»¥æ˜¾ç¤ºæŒ‡å®šå¹´ã€æœˆçš„æ—¥å†ï¼Œå¦‚æœä¸æŒ‡å®šå¹´ã€æœˆï¼Œé»˜è®¤ä¸ºå½“å‰æ—¶é—´å¯¹åº”çš„å¹´æœˆã€‚å¦‚æœä½¿ç”¨çš„æ˜¯Windowsï¼Œæ¨èå®‰è£…msys2ï¼Œè¿™ä¸ªè½¯ä»¶åŒ…å«äº†ç»å¤§å¤šæ•°çš„Linuxå¸¸ç”¨å‘½ä»¤ã€‚\né‚£ä¹ˆï¼Œåœ¨Goä»£ç ä¸­æ€ä¹ˆè°ƒç”¨è¿™ä¸ªå‘½ä»¤å‘¢ï¼Ÿå…¶å®ä¹Ÿå¾ˆç®€å•ï¼š\n1 2 3 4 5 6 7 func main() { cmd := exec.Command(\u0026#34;cal\u0026#34;) err := cmd.Run() if err != nil { log.Fatalf(\u0026#34;cmd.Run() failed: %v\\n\u0026#34;, err) } } é¦–å…ˆï¼Œæˆ‘ä»¬è°ƒç”¨exec.Commandä¼ å…¥å‘½ä»¤åï¼Œåˆ›å»ºä¸€ä¸ªå‘½ä»¤å¯¹è±¡exec.Cmdã€‚æ¥ç€è°ƒç”¨è¯¥å‘½ä»¤å¯¹è±¡çš„Run()æ–¹æ³•è¿è¡Œå®ƒã€‚\nå¦‚æœä½ å®é™…è¿è¡Œäº†ï¼Œä½ ä¼šå‘ç°ä»€ä¹ˆä¹Ÿæ²¡æœ‰å‘ç”Ÿï¼Œå“ˆå“ˆã€‚äº‹å®ä¸Šï¼Œä½¿ç”¨os/execæ‰§è¡Œå‘½ä»¤ï¼Œæ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯é»˜è®¤ä¼šè¢«ä¸¢å¼ƒã€‚\n# æ˜¾ç¤ºè¾“å‡º exec.Cmdå¯¹è±¡æœ‰ä¸¤ä¸ªå­—æ®µStdoutå’ŒStderrï¼Œç±»å‹çš†ä¸ºio.Writerã€‚æˆ‘ä»¬å¯ä»¥å°†ä»»æ„å®ç°äº†io.Writeræ¥å£çš„ç±»å‹å®ä¾‹èµ‹ç»™è¿™ä¸¤ä¸ªå­—æ®µï¼Œç»§è€Œå®ç°æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯çš„é‡å®šå‘ã€‚io.Writeræ¥å£åœ¨ Go æ ‡å‡†åº“å’Œç¬¬ä¸‰æ–¹åº“ä¸­éšå¤„å¯è§ï¼Œä¾‹å¦‚*os.Fileã€*bytes.Bufferã€net.Connã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†å‘½ä»¤çš„è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶ã€å†…å­˜ç¼“å­˜ç”šè‡³å‘é€åˆ°ç½‘ç»œä¸­ã€‚\n# æ˜¾ç¤ºåˆ°æ ‡å‡†è¾“å‡º å°†exec.Cmdå¯¹è±¡çš„Stdoutå’ŒStderrè¿™ä¸¤ä¸ªå­—æ®µéƒ½è®¾ç½®ä¸ºos.Stdoutï¼Œé‚£ä¹ˆè¾“å‡ºå†…å®¹éƒ½å°†æ˜¾ç¤ºåˆ°æ ‡å‡†è¾“å‡ºï¼š\n1 2 3 4 5 6 7 8 9 func main() { cmd := exec.Command(\u0026#34;cal\u0026#34;) cmd.Stdout = os.Stdout cmd.Stderr = os.Stderr err := cmd.Run() if err != nil { log.Fatalf(\u0026#34;cmd.Run() failed: %v\\n\u0026#34;, err) } } è¿è¡Œç¨‹åºã€‚æˆ‘åœ¨git bashè¿è¡Œï¼Œå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š\nè¾“å‡ºäº†ä¸­æ–‡ï¼Œæ£€æŸ¥ä¸€ä¸‹ç¯å¢ƒå˜é‡LANGçš„å€¼ï¼Œæœç„¶æ˜¯zh_CN.UTF-8ã€‚å¦‚æœæƒ³è¾“å‡ºè‹±æ–‡ï¼Œå¯ä»¥å°†ç¯å¢ƒå˜é‡LANGè®¾ç½®ä¸ºen_US.UTF-8ï¼š\n1 2 3 $ echo $LANG zh_CN.UTF-8 $ LANG=en_US.UTF-8 go run main.go å¾—åˆ°è¾“å‡ºï¼š\n# è¾“å‡ºåˆ°æ–‡ä»¶ æ‰“å¼€æˆ–åˆ›å»ºæ–‡ä»¶ï¼Œç„¶åå°†æ–‡ä»¶å¥æŸ„èµ‹ç»™exec.Cmdå¯¹è±¡çš„Stdoutå’ŒStderrè¿™ä¸¤ä¸ªå­—æ®µå³å¯å®ç°è¾“å‡ºåˆ°æ–‡ä»¶çš„åŠŸèƒ½ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 func main() { f, err := os.OpenFile(\u0026#34;out.txt\u0026#34;, os.O_WRONLY|os.O_CREATE, os.ModePerm) if err != nil { log.Fatalf(\u0026#34;os.OpenFile() failed: %v\\n\u0026#34;, err) } cmd := exec.Command(\u0026#34;cal\u0026#34;) cmd.Stdout = f cmd.Stderr = f err = cmd.Run() if err != nil { log.Fatalf(\u0026#34;cmd.Run() failed: %v\\n\u0026#34;, err) } } os.OpenFileæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼ŒæŒ‡å®šos.O_CREATEæ ‡å¿—è®©æ“ä½œç³»ç»Ÿåœ¨æ–‡ä»¶ä¸å­˜åœ¨æ—¶è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªï¼Œè¿”å›è¯¥æ–‡ä»¶å¯¹è±¡*os.Fileã€‚*os.Fileå®ç°äº†io.Writeræ¥å£ã€‚\nè¿è¡Œç¨‹åºï¼š\n1 2 3 4 5 6 7 8 9 $ go run main.go $ cat out.txt November 2022 Su Mo Tu We Th Fr Sa 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 # å‘é€åˆ°ç½‘ç»œ ç°åœ¨æˆ‘ä»¬æ¥ç¼–å†™ä¸€ä¸ªæ—¥å†æœåŠ¡ï¼Œæ¥æ”¶å¹´ã€æœˆä¿¡æ¯ï¼Œè¿”å›è¯¥æœˆçš„æ—¥å†ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 func cal(w http.ResponseWriter, r *http.Request) { year := r.URL.Query().Get(\u0026#34;year\u0026#34;) month := r.URL.Query().Get(\u0026#34;month\u0026#34;) cmd := exec.Command(\u0026#34;cal\u0026#34;, month, year) cmd.Stdout = w cmd.Stderr = w err := cmd.Run() if err != nil { log.Fatalf(\u0026#34;cmd.Run() failed: %v\\n\u0026#34;, err) } } func main() { http.HandleFunc(\u0026#34;/cal\u0026#34;, cal) http.ListenAndServe(\u0026#34;:8080\u0026#34;, nil) } è¿™é‡Œä¸ºäº†ç®€å•ï¼Œé”™è¯¯å¤„ç†éƒ½çœç•¥äº†ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œyearå’Œmonthå‚æ•°éƒ½éœ€è¦åšåˆæ³•æ€§æ ¡éªŒã€‚exec.Commandå‡½æ•°æ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å¯å˜å‚æ•°ä½œä¸ºå‘½ä»¤çš„å‚æ•°ï¼š\n1 func Command(name string, arg ...string) *Cmd # ä¿å­˜åˆ°å†…å­˜å¯¹è±¡ä¸­ *bytes.BufferåŒæ ·ä¹Ÿå®ç°äº†io.Writeræ¥å£ï¼Œæ•…å¦‚æœæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª*bytes.Bufferå¯¹è±¡ï¼Œå¹¶å°†å…¶èµ‹ç»™exec.Cmdçš„Stdoutå’ŒStderrè¿™ä¸¤ä¸ªå­—æ®µï¼Œé‚£ä¹ˆå‘½ä»¤æ‰§è¡Œä¹‹åï¼Œè¯¥*bytes.Bufferå¯¹è±¡ä¸­ä¿å­˜çš„å°±æ˜¯å‘½ä»¤çš„è¾“å‡ºã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 func main() { buf := bytes.NewBuffer(nil) cmd := exec.Command(\u0026#34;cal\u0026#34;) cmd.Stdout = buf cmd.Stderr = buf err := cmd.Run() if err != nil { log.Fatalf(\u0026#34;cmd.Run() failed: %v\\n\u0026#34;, err) } fmt.Println(buf.String()) } è¿è¡Œï¼š\n1 2 3 4 5 6 7 8 $ go run main.go November 2022 Su Mo Tu We Th Fr Sa 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 è¿è¡Œå‘½ä»¤ï¼Œç„¶åå¾—åˆ°è¾“å‡ºçš„å­—ç¬¦ä¸²æˆ–å­—èŠ‚åˆ‡ç‰‡è¿™ç§æ¨¡å¼æ˜¯å¦‚æ­¤çš„æ™®éï¼Œå¹¶ä¸”ä½¿ç”¨ä¾¿åˆ©ï¼Œos/execåŒ…æä¾›äº†ä¸€ä¸ªä¾¿æ·æ–¹æ³•ï¼šCombinedOutputã€‚\n# è¾“å‡ºåˆ°å¤šä¸ªç›®çš„åœ° æœ‰æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½è¾“å‡ºåˆ°æ–‡ä»¶å’Œç½‘ç»œï¼ŒåŒæ—¶ä¿å­˜åˆ°å†…å­˜å¯¹è±¡ã€‚ä½¿ç”¨goæä¾›çš„io.MultiWriterå¯ä»¥å¾ˆå®¹æ˜“å®ç°è¿™ä¸ªéœ€æ±‚ã€‚io.MultiWriterå¾ˆæ–¹ä¾¿åœ°å°†å¤šä¸ªio.Writerè½¬ä¸ºä¸€ä¸ªio.Writerã€‚\næˆ‘ä»¬ç¨å¾®ä¿®æ”¹ä¸Šé¢çš„webç¨‹åºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 func cal(w http.ResponseWriter, r *http.Request) { year := r.URL.Query().Get(\u0026#34;year\u0026#34;) month := r.URL.Query().Get(\u0026#34;month\u0026#34;) f, _ := os.OpenFile(\u0026#34;out.txt\u0026#34;, os.O_CREATE|os.O_WRONLY, os.ModePerm) buf := bytes.NewBuffer(nil) mw := io.MultiWriter(w, f, buf) cmd := exec.Command(\u0026#34;cal\u0026#34;, month, year) cmd.Stdout = mw cmd.Stderr = mw err := cmd.Run() if err != nil { log.Fatalf(\u0026#34;cmd.Run() failed: %v\\n\u0026#34;, err) } fmt.Println(buf.String()) } è°ƒç”¨io.MultiWriterå°†å¤šä¸ªio.Writeræ•´åˆæˆä¸€ä¸ªio.Writerï¼Œç„¶åå°†cmdå¯¹è±¡çš„Stdoutå’ŒStderréƒ½èµ‹å€¼ä¸ºè¿™ä¸ªio.Writerã€‚è¿™æ ·ï¼Œå‘½ä»¤è¿è¡Œæ—¶äº§å‡ºçš„è¾“å‡ºä¼šåˆ†åˆ«é€å¾€http.ResponseWriterã€*os.Fileä»¥åŠ*bytes.Bufferã€‚\n# è¿è¡Œå‘½ä»¤ï¼Œè·å–è¾“å‡º å‰é¢æåˆ°ï¼Œæˆ‘ä»¬å¸¸å¸¸éœ€è¦è¿è¡Œå‘½ä»¤ï¼Œè¿”å›è¾“å‡ºã€‚exec.Cmdå¯¹è±¡æä¾›äº†ä¸€ä¸ªä¾¿æ·æ–¹æ³•ï¼šCombinedOutput()ã€‚è¯¥æ–¹æ³•è¿è¡Œå‘½ä»¤ï¼Œå°†è¾“å‡ºå†…å®¹ä»¥ä¸€ä¸ªå­—èŠ‚åˆ‡ç‰‡è¿”å›ä¾¿äºåç»­å¤„ç†ã€‚æ‰€ä»¥ï¼Œä¸Šé¢è·å–è¾“å‡ºçš„ç¨‹åºå¯ä»¥ç®€åŒ–ä¸ºï¼š\n1 2 3 4 5 6 7 8 9 func main() { cmd := exec.Command(\u0026#34;cal\u0026#34;) output, err := cmd.CombinedOutput() if err != nil { log.Fatalf(\u0026#34;cmd.Run() failed: %v\\n\u0026#34;, err) } fmt.Println(string(output)) } So easy!\nCombinedOutput()æ–¹æ³•çš„å®ç°å¾ˆç®€å•ï¼Œå…ˆå°†æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯é‡å®šå‘åˆ°*bytes.Bufferå¯¹è±¡ï¼Œç„¶åè¿è¡Œç¨‹åºï¼Œæœ€åè¿”å›è¯¥å¯¹è±¡ä¸­çš„å­—èŠ‚åˆ‡ç‰‡ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 func (c *Cmd) CombinedOutput() ([]byte, error) { if c.Stdout != nil { return nil, errors.New(\u0026#34;exec: Stdout already set\u0026#34;) } if c.Stderr != nil { return nil, errors.New(\u0026#34;exec: Stderr already set\u0026#34;) } var b bytes.Buffer c.Stdout = \u0026amp;b c.Stderr = \u0026amp;b err := c.Run() return b.Bytes(), err } CombinedOutputæ–¹æ³•å‰å‡ è¡Œåˆ¤æ–­è¡¨æ˜ï¼ŒStdoutå’ŒStderrå¿…é¡»æ˜¯æœªè®¾ç½®çŠ¶æ€ã€‚è¿™å…¶å®å¾ˆå¥½ç†è§£ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¦‚æœå·²ç»æ‰“ç®—ä½¿ç”¨CombinedOutputæ–¹æ³•è·å–è¾“å‡ºå†…å®¹ï¼Œä¸ä¼šå†è‡ªæ‰¾éº»çƒ¦åœ°å†å»è®¾ç½®Stdoutå’ŒStderrå­—æ®µäº†ã€‚\nä¸CombinedOutputç±»ä¼¼çš„è¿˜æœ‰Outputæ–¹æ³•ï¼ŒåŒºåˆ«æ˜¯Outputåªä¼šè¿”å›è¿è¡Œå‘½ä»¤äº§å‡ºçš„æ ‡å‡†è¾“å‡ºå†…å®¹ã€‚\n# åˆ†åˆ«è·å–æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯ åˆ›å»ºä¸¤ä¸ª*bytes.Bufferå¯¹è±¡ï¼Œåˆ†åˆ«èµ‹ç»™exec.Cmdå¯¹è±¡çš„Stdoutå’ŒStderrè¿™ä¸¤ä¸ªå­—æ®µï¼Œç„¶åè¿è¡Œå‘½ä»¤å³å¯åˆ†åˆ«è·å–æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 func main() { cmd := exec.Command(\u0026#34;cal\u0026#34;, \u0026#34;15\u0026#34;, \u0026#34;2012\u0026#34;) var stdout, stderr bytes.Buffer cmd.Stdout = \u0026amp;stdout cmd.Stderr = \u0026amp;stderr err := cmd.Run() if err != nil { log.Fatalf(\u0026#34;cmd.Run() failed: %v\\n\u0026#34;, err) } fmt.Printf(\u0026#34;output:\\n%s\\nerror:\\n%s\\n\u0026#34;, stdout.String(), stderr.String()) } # æ ‡å‡†è¾“å…¥ exec.Cmdå¯¹è±¡æœ‰ä¸€ä¸ªç±»å‹ä¸ºio.Readerçš„å­—æ®µStdinã€‚å‘½ä»¤è¿è¡Œæ—¶ä¼šä»è¿™ä¸ªio.Readerè¯»å–è¾“å…¥ã€‚å…ˆæ¥çœ‹ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼š\n1 2 3 4 5 6 7 8 9 func main() { cmd := exec.Command(\u0026#34;cat\u0026#34;) cmd.Stdin = bytes.NewBufferString(\u0026#34;hello\\nworld\u0026#34;) cmd.Stdout = os.Stdout err := cmd.Run() if err != nil { log.Fatalf(\u0026#34;cmd.Run() failed: %v\\n\u0026#34;, err) } } å¦‚æœä¸å¸¦å‚æ•°è¿è¡Œcatå‘½ä»¤ï¼Œåˆ™è¿›å…¥äº¤äº’æ¨¡å¼ï¼ŒcatæŒ‰è¡Œè¯»å–è¾“å…¥ï¼Œå¹¶ä¸”åŸæ ·å‘é€åˆ°è¾“å‡ºã€‚\nå†æ¥çœ‹ä¸€ä¸ªå¤æ‚ç‚¹çš„ä¾‹å­ã€‚Goæ ‡å‡†åº“ä¸­compress/bzip2åŒ…åªæä¾›è§£å‹æ–¹æ³•ï¼Œå¹¶æ²¡æœ‰å‹ç¼©æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨Linuxå‘½ä»¤bzip2å®ç°å‹ç¼©ã€‚bzip2ä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–æ•°æ®ï¼Œå°†å…¶å‹ç¼©ï¼Œå¹¶å‘é€åˆ°æ ‡å‡†è¾“å‡ºã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 func bzipCompress(d []byte) ([]byte, error) { var out bytes.Buffer cmd := exec.Command(\u0026#34;bzip2\u0026#34;, \u0026#34;-c\u0026#34;, \u0026#34;-9\u0026#34;) cmd.Stdin = bytes.NewBuffer(d) cmd.Stdout = \u0026amp;out err := cmd.Run() if err != nil { log.Fatalf(\u0026#34;cmd.Run() failed: %v\\n\u0026#34;, err) } return out.Bytes(), nil } å‚æ•°-cè¡¨ç¤ºå‹ç¼©ï¼Œ-9è¡¨ç¤ºå‹ç¼©ç­‰çº§ï¼Œ9ä¸ºæœ€é«˜ã€‚ä¸ºäº†éªŒè¯å‡½æ•°çš„æ­£ç¡®æ€§ï¼Œå†™ä¸ªç®€å•çš„ç¨‹åºï¼Œå…ˆå‹ç¼©\u0026quot;hello world\u0026quot;å­—ç¬¦ä¸²ï¼Œç„¶åè§£å‹ï¼Œçœ‹çœ‹æ˜¯å¦èƒ½å¾—åˆ°åŸæ¥çš„å­—ç¬¦ä¸²ï¼š\n1 2 3 4 5 6 7 func main() { data := []byte(\u0026#34;hello world\u0026#34;) compressed, _ := bzipCompress(data) r := bzip2.NewReader(bytes.NewBuffer(compressed)) decompressed, _ := ioutil.ReadAll(r) fmt.Println(string(decompressed)) } è¿è¡Œç¨‹åºï¼Œè¾“å‡º\u0026quot;hello world\u0026quot;ã€‚\n# ç¯å¢ƒå˜é‡ ç¯å¢ƒå˜é‡å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¾®è°ƒç¨‹åºçš„è¡Œä¸ºï¼Œå½“ç„¶è¿™éœ€è¦ç¨‹åºçš„æ”¯æŒã€‚ä¾‹å¦‚ï¼Œè®¾ç½®ENV=productionä¼šæŠ‘åˆ¶è°ƒè¯•æ—¥å¿—çš„è¾“å‡ºã€‚æ¯ä¸ªç¯å¢ƒå˜é‡éƒ½æ˜¯ä¸€ä¸ªé”®å€¼å¯¹ã€‚exec.Cmdå¯¹è±¡ä¸­æœ‰ä¸€ä¸ªç±»å‹ä¸º[]stringçš„å­—æ®µEnvã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹å®ƒæ¥è¾¾åˆ°æ§åˆ¶å‘½ä»¤è¿è¡Œæ—¶çš„ç¯å¢ƒå˜é‡çš„ç›®çš„ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;os\u0026#34; \u0026#34;os/exec\u0026#34; ) func main() { cmd := exec.Command(\u0026#34;bash\u0026#34;, \u0026#34;-c\u0026#34;, \u0026#34;./test.sh\u0026#34;) nameEnv := \u0026#34;NAME=darjun\u0026#34; ageEnv := \u0026#34;AGE=18\u0026#34; newEnv := append(os.Environ(), nameEnv, ageEnv) cmd.Env = newEnv out, err := cmd.CombinedOutput() if err != nil { log.Fatalf(\u0026#34;cmd.Run() failed: %v\\n\u0026#34;, err) } fmt.Println(string(out)) } ä¸Šé¢ä»£ç è·å–ç³»ç»Ÿçš„ç¯å¢ƒå˜é‡ï¼Œç„¶ååˆæ·»åŠ äº†ä¸¤ä¸ªç¯å¢ƒå˜é‡NAMEå’ŒAGEã€‚æœ€åä½¿ç”¨bashè¿è¡Œè„šæœ¬test.shï¼š\n1 2 3 4 5 #!/bin/bash echo $NAME echo $AGE echo $GOPATH ç¨‹åºè¿è¡Œç»“æœï¼š\n1 2 3 4 $ go run main.go darjun 18 D:\\workspace\\code\\go # æ£€æŸ¥å‘½ä»¤æ˜¯å¦å­˜åœ¨ ä¸€èˆ¬åœ¨è¿è¡Œå‘½ä»¤ä¹‹å‰ï¼Œæˆ‘ä»¬é€šè¿‡å¸Œæœ›èƒ½æ£€æŸ¥è¦è¿è¡Œçš„å‘½ä»¤æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨åˆ™ç›´æ¥è¿è¡Œï¼Œå¦åˆ™æç¤ºç”¨æˆ·å®‰è£…æ­¤å‘½ä»¤ã€‚os/execåŒ…æä¾›äº†å‡½æ•°LookPathå¯ä»¥è·å–å‘½ä»¤æ‰€åœ¨ç›®å½•ï¼Œå¦‚æœå‘½ä»¤ä¸å­˜åœ¨ï¼Œåˆ™è¿”å›ä¸€ä¸ªerrorã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 func main() { path, err := exec.LookPath(\u0026#34;ls\u0026#34;) if err != nil { fmt.Printf(\u0026#34;no cmd ls: %v\\n\u0026#34;, err) } else { fmt.Printf(\u0026#34;find ls in path:%s\\n\u0026#34;, path) } path, err = exec.LookPath(\u0026#34;not-exist\u0026#34;) if err != nil { fmt.Printf(\u0026#34;no cmd not-exist: %v\\n\u0026#34;, err) } else { fmt.Printf(\u0026#34;find not-exist in path:%s\\n\u0026#34;, path) } } è¿è¡Œï¼š\n1 2 3 $ go run main.go find ls in path:C:\\Program Files\\Git\\usr\\bin\\ls.exe no cmd not-exist: exec: \u0026#34;not-exist\u0026#34;: executable file not found in %PATH% # å°è£… æ‰§è¡Œå¤–éƒ¨å‘½ä»¤çš„æµç¨‹æ¯”è¾ƒå›ºå®šï¼š\nè°ƒç”¨exec.Command()åˆ›å»ºå‘½ä»¤å¯¹è±¡ï¼› è°ƒç”¨Cmd.Run()æ‰§è¡Œå‘½ä»¤ å¯ä»¥è‡ªå·±å°è£…æˆä¸€ä¸ªå·¥å…·åŒ…ã€‚\n# æ€»ç»“ æœ¬æ–‡ä»‹ç»äº†ä½¿ç”¨os/execè¿™ä¸ªæ ‡å‡†åº“è°ƒç”¨å¤–éƒ¨å‘½ä»¤çš„å„ç§å§¿åŠ¿ã€‚\n# å‚è€ƒ Advanced command execution in go with os/exec: https://blog.kowalczyk.info/article/wOYk/advanced-command-execution-in-go-with-osexec.html Goä¸­è°ƒç”¨å¤–éƒ¨å‘½ä»¤çš„å‡ ç§å§¿åŠ¿æ¬è¿è‡ªè¯¥ç¯‡æ–‡ç« ã€‚ ","date":"2024-04-24T23:41:31+08:00","permalink":"https://arlettebrook.github.io/p/go%E8%B0%83%E7%94%A8%E5%A4%96%E9%83%A8%E5%91%BD%E4%BB%A4os/exec%E5%BA%93%E4%BB%8B%E7%BB%8D/","title":"Goè°ƒç”¨å¤–éƒ¨å‘½ä»¤os/execåº“ä»‹ç»"},{"content":" # ç®€ä»‹ ä»Šå¤©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå¾ˆå°ï¼Œå¾ˆå®ç”¨çš„åº“go-homedirã€‚é¡¾åæ€ä¹‰ï¼Œgo-homedirç”¨æ¥è·å–ç”¨æˆ·çš„ä¸»ç›®å½•ã€‚ å®é™…ä¸Šï¼Œä½¿ç”¨æ ‡å‡†åº“os/useræˆ–è€…os.UserHomeDir()æˆ‘ä»¬ä¹Ÿå¯ä»¥å¾—åˆ°è¿™ä¸ªä¿¡æ¯ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;os/user\u0026#34; ) func main() { u, err := user.Current() if err != nil { log.Fatal(err) } fmt.Println(\u0026#34;Home dir:\u0026#34;, u.HomeDir) } é‚£ä¹ˆä¸ºä»€ä¹ˆè¿˜è¦go-homediråº“ï¼Ÿ\nåœ¨ Darwin ç³»ç»Ÿä¸Šï¼Œæ ‡å‡†åº“os/userçš„ä½¿ç”¨éœ€è¦ cgoã€‚æ‰€ä»¥ï¼Œä»»ä½•ä½¿ç”¨os/userçš„ä»£ç éƒ½ä¸èƒ½äº¤å‰ç¼–è¯‘ã€‚ ä½†æ˜¯ï¼Œå¤§å¤šæ•°äººä½¿ç”¨os/userçš„ç›®çš„ä»…ä»…åªæ˜¯æƒ³è·å–ä¸»ç›®å½•ã€‚å› æ­¤ï¼Œgo-homediråº“å‡ºç°äº†ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 func UserHomeDir() (string, error) { env, enverr := \u0026#34;HOME\u0026#34;, \u0026#34;$HOME\u0026#34; switch runtime.GOOS { case \u0026#34;windows\u0026#34;: env, enverr = \u0026#34;USERPROFILE\u0026#34;, \u0026#34;%userprofile%\u0026#34; case \u0026#34;plan9\u0026#34;: env, enverr = \u0026#34;home\u0026#34;, \u0026#34;$home\u0026#34; } if v := Getenv(env); v != \u0026#34;\u0026#34; { return v, nil } // On some geese the home directory is not always defined. switch runtime.GOOS { case \u0026#34;android\u0026#34;: return \u0026#34;/sdcard\u0026#34;, nil case \u0026#34;ios\u0026#34;: return \u0026#34;/\u0026#34;, nil } return \u0026#34;\u0026#34;, errors.New(enverr + \u0026#34; is not defined\u0026#34;) } è¿˜æœ‰å°±æ˜¯å®˜æ–¹çš„åº“ä¹Ÿåªæ˜¯ä»ç¯å¢ƒå˜é‡ä¸­è·å–ç”¨æˆ·çš„å®¶ç›®å½•ï¼Œæ²¡æœ‰è€ƒè™‘$HOMEä¸å­˜åœ¨çš„æƒ…å†µã€‚\n# å¿«é€Ÿä½¿ç”¨ go-homediræ˜¯ç¬¬ä¸‰æ–¹åŒ…ï¼Œä½¿ç”¨å‰éœ€è¦å…ˆå®‰è£…ï¼š\n1 $ go get -u github.com/mitchellh/go-homedir ä½¿ç”¨éå¸¸ç®€å•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;github.com/mitchellh/go-homedir\u0026#34; ) func main() { dir, err := homedir.Dir() if err != nil { log.Fatal(err) } fmt.Println(\u0026#34;Home dir:\u0026#34;, dir) dir = \u0026#34;~/golang/src\u0026#34; expandedDir, err := homedir.Expand(dir) if err != nil { log.Fatal(err) } fmt.Printf(\u0026#34;Expand of %s is: %s\\n\u0026#34;, dir, expandedDir) } go-homediræœ‰ä¸¤ä¸ªåŠŸèƒ½ï¼š\nDirï¼šè·å–ç”¨æˆ·ä¸»ç›®å½•ï¼› Expandï¼šå°†è·¯å¾„ä¸­çš„ç¬¬ä¸€ä¸ª~æ‰©å±•æˆç”¨æˆ·ä¸»ç›®å½•ã€‚ # é«˜çº§ç”¨æ³• ç”±äºDirçš„è°ƒç”¨å¯èƒ½æ¶‰åŠä¸€äº›ç³»ç»Ÿè°ƒç”¨å’Œå¤–éƒ¨æ‰§è¡Œå‘½ä»¤ï¼Œå¤šæ¬¡è°ƒç”¨è´¹æ€§èƒ½ã€‚æ‰€ä»¥go-homediræä¾›äº†ç¼“å­˜çš„åŠŸèƒ½ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç¼“å­˜æ˜¯å¼€å¯çš„ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†DisableCacheè®¾ç½®ä¸ºtrueæ¥å…³é—­å®ƒã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;github.com/mitchellh/go-homedir\u0026#34; ) func main() { homedir.DisableCache = true # å…³é—­äº†ç¼“å­˜ dir, err := homedir.Dir() if err != nil { log.Fatal(err) } fmt.Println(\u0026#34;Home dir:\u0026#34;, dir) } ä½¿ç”¨ç¼“å­˜æ—¶ï¼Œå¦‚æœç¨‹åºè¿è¡Œä¸­ä¿®æ”¹äº†ä¸»ç›®å½•ï¼Œå†æ¬¡è°ƒç”¨Dirè¿˜æ˜¯è¿”å›ä¹‹å‰çš„ç›®å½•ã€‚å¦‚æœéœ€è¦è·å–æœ€æ–°çš„ä¸»ç›®å½•ï¼Œå¯ä»¥å…ˆè°ƒç”¨Resetæ¸…é™¤ç¼“å­˜ã€‚\n# å®ç° go-homediræºç åªæœ‰ä¸€ä¸ªæ–‡ä»¶homedir.goï¼Œä»Šå¤©æˆ‘ä»¬å¤§æ¦‚çœ‹ä¸€ä¸‹Dirçš„å®ç°ï¼Œå»æ‰ç¼“å­˜ç›¸å…³ä»£ç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 func Dir() (string, error) { var result string var err error if runtime.GOOS == \u0026#34;windows\u0026#34; { result, err = dirWindows() } else { // Unix-like system, so just assume Unix result, err = dirUnix() } if err != nil { return \u0026#34;\u0026#34;, err } return result, nil } åˆ¤æ–­å½“å‰çš„ç³»ç»Ÿæ˜¯windowsè¿˜æ˜¯ç±» Unixï¼Œåˆ†åˆ«è°ƒç”¨ä¸åŒçš„æ–¹æ³•ã€‚å…ˆçœ‹ windows çš„ï¼Œæ¯”è¾ƒç®€å•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 func dirWindows() (string, error) { // First prefer the HOME environmental variable if home := os.Getenv(\u0026#34;HOME\u0026#34;); home != \u0026#34;\u0026#34; { return home, nil } // Prefer standard environment variable USERPROFILE if home := os.Getenv(\u0026#34;USERPROFILE\u0026#34;); home != \u0026#34;\u0026#34; { return home, nil } drive := os.Getenv(\u0026#34;HOMEDRIVE\u0026#34;) path := os.Getenv(\u0026#34;HOMEPATH\u0026#34;) home := drive + path if drive == \u0026#34;\u0026#34; || path == \u0026#34;\u0026#34; { return \u0026#34;\u0026#34;, errors.New(\u0026#34;HOMEDRIVE, HOMEPATH, or USERPROFILE are blank\u0026#34;) } return home, nil } æµç¨‹å¦‚ä¸‹ï¼š\nè¯»å–ç¯å¢ƒå˜é‡HOMEï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œè¿”å›è¿™ä¸ªå€¼ï¼› è¯»å–ç¯å¢ƒå˜é‡USERPROFILEï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œè¿”å›è¿™ä¸ªå€¼ï¼› è¯»å–ç¯å¢ƒå˜é‡HOMEDRIVEå’ŒHOMEPATHï¼Œå¦‚æœä¸¤è€…éƒ½ä¸ä¸ºç©ºï¼Œæ‹¼æ¥è¿™ä¸¤ä¸ªå€¼è¿”å›ã€‚ ç±» Unix ç³»ç»Ÿçš„å®ç°ç¨å¾®å¤æ‚ä¸€ç‚¹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 func dirUnix() (string, error) { homeEnv := \u0026#34;HOME\u0026#34; if runtime.GOOS == \u0026#34;plan9\u0026#34; { // On plan9, env vars are lowercase. homeEnv = \u0026#34;home\u0026#34; } // First prefer the HOME environmental variable if home := os.Getenv(homeEnv); home != \u0026#34;\u0026#34; { return home, nil } var stdout bytes.Buffer // If that fails, try OS specific commands if runtime.GOOS == \u0026#34;darwin\u0026#34; { cmd := exec.Command(\u0026#34;sh\u0026#34;, \u0026#34;-c\u0026#34;, `dscl -q . -read /Users/\u0026#34;$(whoami)\u0026#34; NFSHomeDirectory | sed \u0026#39;s/^[^ ]*: //\u0026#39;`) cmd.Stdout = \u0026amp;stdout if err := cmd.Run(); err == nil { result := strings.TrimSpace(stdout.String()) if result != \u0026#34;\u0026#34; { return result, nil } } } else { cmd := exec.Command(\u0026#34;getent\u0026#34;, \u0026#34;passwd\u0026#34;, strconv.Itoa(os.Getuid())) cmd.Stdout = \u0026amp;stdout if err := cmd.Run(); err != nil { // If the error is ErrNotFound, we ignore it. Otherwise, return it. if err != exec.ErrNotFound { return \u0026#34;\u0026#34;, err } } else { if passwd := strings.TrimSpace(stdout.String()); passwd != \u0026#34;\u0026#34; { // username:password:uid:gid:gecos:home:shell passwdParts := strings.SplitN(passwd, \u0026#34;:\u0026#34;, 7) if len(passwdParts) \u0026gt; 5 { return passwdParts[5], nil } } } } // If all else fails, try the shell stdout.Reset() cmd := exec.Command(\u0026#34;sh\u0026#34;, \u0026#34;-c\u0026#34;, \u0026#34;cd \u0026amp;\u0026amp; pwd\u0026#34;) cmd.Stdout = \u0026amp;stdout if err := cmd.Run(); err != nil { return \u0026#34;\u0026#34;, err } result := strings.TrimSpace(stdout.String()) if result == \u0026#34;\u0026#34; { return \u0026#34;\u0026#34;, errors.New(\u0026#34;blank output when reading home directory\u0026#34;) } return result, nil } æµç¨‹å¦‚ä¸‹ï¼š\nå…ˆè¯»å–ç¯å¢ƒå˜é‡HOMEï¼ˆæ³¨æ„ plan9 ç³»ç»Ÿä¸Šä¸ºhomeï¼‰ï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œè¿”å›è¿™ä¸ªå€¼ï¼› ä½¿ç”¨getnetå‘½ä»¤æŸ¥çœ‹ç³»ç»Ÿçš„æ•°æ®åº“ä¸­çš„ç›¸å…³è®°å½•ï¼Œæˆ‘ä»¬çŸ¥é“passwdæ–‡ä»¶ä¸­å­˜å‚¨äº†ç”¨æˆ·ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”¨æˆ·çš„ä¸»ç›®å½•ã€‚ä½¿ç”¨getentå‘½ä»¤æŸ¥çœ‹passwdä¸­å½“å‰ç”¨æˆ·çš„é‚£æ¡è®°å½•ï¼Œç„¶åä»ä¸­æ‰¾åˆ°ä¸»ç›®å½•éƒ¨åˆ†è¿”å›ï¼› å¦‚æœä¸Šä¸€ä¸ªæ­¥éª¤å¤±è´¥äº†ï¼Œæˆ‘ä»¬çŸ¥é“cdåä¸åŠ å‚æ•°æ˜¯ç›´æ¥åˆ‡æ¢åˆ°ç”¨æˆ·ä¸»ç›®å½•çš„ï¼Œè€Œpwdå¯ä»¥æ˜¾ç¤ºå½“å‰ç›®å½•ã€‚é‚£ä¹ˆå°±å¯ä»¥ç»“åˆè¿™ä¸¤ä¸ªå‘½ä»¤è¿”å›ä¸»ç›®å½•ã€‚ è¿™é‡Œåˆ†ææºç å¹¶ä¸æ˜¯è¡¨ç¤ºä½¿ç”¨ä»»ä½•åº“éƒ½è¦ç†Ÿæ‚‰å®ƒçš„æºç ï¼Œæ¯•ç«Ÿä½¿ç”¨åº“å°±æ˜¯ä¸ºäº†æ–¹ä¾¿å¼€å‘ã€‚ ä½†æ˜¯æºç æ˜¯æˆ‘ä»¬å­¦ä¹ å’Œæé«˜çš„ä¸€ä¸ªéå¸¸é‡è¦çš„é€”å¾„ã€‚æˆ‘ä»¬åœ¨ä½¿ç”¨åº“é‡åˆ°é—®é¢˜çš„æ—¶å€™ä¹Ÿè¦æœ‰èƒ½åŠ›ä»æ–‡æ¡£æˆ–ç”šè‡³æºç ä¸­æŸ¥æ‰¾åŸå› ã€‚\n# å‚è€ƒ home-dir GitHub ä»“åº“ Go æ¯æ—¥ä¸€åº“ä¹‹ go-homedir ","date":"2024-04-24T22:47:45+08:00","permalink":"https://arlettebrook.github.io/p/go-homedir%E5%BA%93%E4%BB%8B%E7%BB%8D/","title":"Go-homediråº“ä»‹ç»"},{"content":" æ³¨æ„ï¼šè¦å­¦ä¼šä½¿ç”¨-h \u0026ndash;helpé€‰é¡¹ï¼ŒæŸ¥çœ‹å‘½ä»¤ï¼Œçœ‹ä¸æ‡‚åœ¨æŸ¥é˜…ã€‚git help \u0026lt;command\u0026gt;å¯è¿›å…¥å®˜æ–¹æ–‡æ¡£ã€‚Gitå…¥é—¨å‚è€ƒã€‚ä»¥ä¸‹å¸¸ç”¨å‘½ä»¤ä¸ªäººæ”¶é›†æ€»ç»“ã€‚\n# gitç®€å•å‘½ä»¤ # git init git init \u0026lt;directory\u0026gt;åœ¨æŒ‡å®šçš„â½¬å½•ä¸‹åˆ›å»ºâ¼€ä¸ªç©ºçš„git repoã€‚ä¸å¸¦å‚æ•°å°†åœ¨å½“å‰â½¬å½•ä¸‹åˆ›å»ºâ¼€ä¸ªgit repoã€‚ # git clone git clone \u0026lt;repo\u0026gt;å…‹éš†â¼€ä¸ªæŒ‡å®šrepoåˆ°æœ¬åœ°ã€‚æŒ‡å®šçš„repoå¯ä»¥æ˜¯æœ¬åœ°â½‚ä»¶ç³»ç»Ÿæˆ–è€…ç”±HTTPæˆ–SSHæŒ‡å®šçš„è¿œç¨‹è·¯å¾„ã€‚ git clone -b \u0026lt;branch\u0026gt; \u0026lt;repo\u0026gt;å…‹éš†æŒ‡å®šä»“åº“çš„åˆ†æ”¯ git clone --recursive \u0026lt;repo\u0026gt;é€’å½’åœ°å…‹éš†ï¼Œå…‹éš†å¸¦æœ‰å­æ¨¡å—çš„ä»“åº“ git clone --recurse-submodules \u0026lt;repository_url\u0026gt;åŒç† å¯ç»„åˆä½¿ç”¨ # git add git add \u0026lt;directory\u0026gt;å°†æŒ‡å®šâ½¬å½•çš„æ‰€æœ‰ä¿®æ”¹åŠ â¼Šåˆ°ä¸‹â¼€æ¬¡ commitä¸­ã€‚æŠŠ\u0026lt;directory\u0026gt;æ›¿æ¢æˆ\u0026lt;file\u0026gt;å°†æ·»åŠ æŒ‡å®šâ½‚ä»¶çš„ä¿®æ”¹ã€‚ git add *ã€git add .ã€git add -Aä¸‰æ¡å‘½ä»¤ä½†æ˜¯ä¸€æ ·çš„ï¼Œå°†æ‰€ä»¥ä¿®æ”¹æäº¤åˆ°æš‚å­˜åŒºã€‚ # git commit è¿™ä¸ªå‘½ä»¤é€šå¸¸å¸¦-mé€‰é¡¹git commit -m \u0026quot;\u0026lt;message\u0026gt;\u0026quot;æäº¤æš‚å­˜åŒºçš„ä¿®æ”¹ï¼Œä½¿â½¤æŒ‡å®šçš„ \u0026lt;message\u0026gt;ä½œä¸ºæäº¤ä¿¡æ¯ï¼Œâ½½ä¸æ˜¯æ‰“å¼€â½‚æœ¬ç¼–è¾‘å™¨è¾“â¼Šæäº¤ä¿¡æ¯ã€‚ git commit -m \u0026lt;message\u0026gt; --amendå°†å½“å‰stagedä¿®æ”¹åˆå¹¶åˆ°æœ€è¿‘â¼€æ¬¡çš„commitä¸­ã€‚ # git status git statusæ˜¾ç¤ºå“ªäº›â½‚ä»¶å·²è¢«stagedã€ä»¥åŠæœªè·Ÿè¸ª(untracked)ã€‚ # git reflog git reflogæ˜¾ç¤ºæœ¬åœ°repoçš„æ‰€æœ‰commitâ½‡å¿—ã€‚ ä¸git logçš„åŒºåˆ« logé¡¹ç›®çš„æäº¤å†å²ï¼Œreflogæœ¬åœ°ä»“åº“çš„å¼•ç”¨æäº¤æ—¥å¿—ã€‚ å¼•ç”¨ä¼šä¿ç•™æ‰€ä»¥çš„æäº¤å†å²ï¼Œå¦‚ä½•é‡ç½®çš„å†å²ã€‚ä¸»è¦ç›®çš„æ˜¯æä¾›ä¸€ä¸ªå®‰å…¨ç½‘ï¼Œä»¥ä¾¿åœ¨è¯¯æ“ä½œï¼ˆå¦‚é”™è¯¯çš„ git resetï¼‰åå¯ä»¥æ¢å¤ä¸¢å¤±çš„æäº¤æˆ–åˆ†æ”¯ã€‚ git log çš„è¾“å‡ºæ˜¯æ°¸ä¹…æ€§çš„ï¼Œè€Œ reflog ä¼šåœ¨ä¸€æ®µæ—¶é—´åè‡ªåŠ¨è¿‡æœŸï¼ˆé»˜è®¤æ˜¯ 30 å¤©ï¼‰ï¼Œä»¥èŠ‚çœç©ºé—´ã€‚ # git rm git rm fileNameåˆ é™¤æŒ‡å®šçš„æ–‡ä»¶ã€‚ ä¸rm fileNameçš„åŒºåˆ«ã€‚ git rmä¸èƒ½åˆ é™¤æœªè·Ÿè¸ªçš„æ–‡ä»¶ï¼Œ git rmåˆ é™¤ä¹‹åç›´æ¥åˆ°æš‚å­˜åŒºï¼Œè€Œrmæ˜¯åˆ°å·¥ä½œåŒº æ³¨æ„åˆ é™¤ä¹‹åéƒ½éœ€è¦æäº¤æ“ä½œã€‚ æ’¤é”€æ“ä½œä¸ç”¨è®°ï¼Œgitéƒ½ä¼šæœ‰æç¤º # git switch è¯¥å‘½ä»¤é€‚ç”¨äºç‰¹å®šgitç‰ˆæœ¬ã€‚\ngit switch \u0026lt;branch\u0026gt;åˆ‡æ¢åˆ°æŒ‡å®šåˆ†æ”¯ï¼Œ\ngit checkout \u0026lt;branch\u0026gt;åŒç†ï¼Œä½†è¿™ä¸ªéƒ½é€‚ç”¨ã€‚ git switch -c \u0026lt;branch\u0026gt;åˆ›å»ºå¹¶åˆ‡æ¢æŒ‡å®šåˆ†æ”¯\n# git branch git branchæ˜¾ç¤ºæœ¬åœ°repoçš„æ‰€æœ‰åˆ†â½€ã€‚\n-væ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ å¸¦*çš„ä¸ºå½“å‰åˆ†æ”¯ git branch -ræ˜¾ç¤ºè¿œç¨‹ä»“åº“çš„æ‰€ä»¥åˆ†æ”¯ã€‚\nå¯ä»¥ä½¿ç”¨git checkout \u0026lt;branch\u0026gt;æ£€å‡ºè¿œç¨‹åˆ†æ”¯ï¼Œå¯ä»¥çœç•¥origin/ã€‚ git branch -aæ˜¾ç¤ºæœ¬åœ°å’Œè¿œç¨‹çš„æ‰€æœ‰åˆ†æ”¯\ngit branch -m \u0026lt;old_branch_name\u0026gt; \u0026lt;new_branch_name\u0026gt;é‡å‘½ååˆ†æ”¯\næ–°åˆ†æ”¯åå·²ç»å­˜åœ¨ï¼Œ -M å¼ºåˆ¶é‡å‘½åã€‚ git branch \u0026lt;name\u0026gt;åˆ›å»ºæŒ‡å®šåˆ†æ”¯\ngit branch -D \u0026lt;branch\u0026gt;å¼ºåˆ¶åˆ é™¤æŒ‡å®šåˆ†æ”¯ï¼Œæ— è®ºæ˜¯å¦åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ã€‚\ngit branch -d \u0026lt;branch\u0026gt;åˆ é™¤æŒ‡å®šçš„åˆ†æ”¯ï¼Œå¦‚æœæ²¡æœ‰åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ï¼Œgitä¼šé˜»æ­¢æ“ä½œã€‚\n# git merge git merge \u0026lt;branch\u0026gt;åˆå¹¶æŒ‡å®šåˆ†æ”¯ã€‚å°†æŒ‡å®š\u0026lt;branch\u0026gt;åˆ†â½€åˆå¹¶åˆ°å½“å‰åˆ†â½€ã€‚ æ˜¯åœ¨å½“å‰åˆ†æ”¯åˆå¹¶æŒ‡å®šåˆ†æ”¯ã€‚ åˆå¹¶åˆ†æ”¯å¯èƒ½ä¼šå‡ºç°å†²çªã€‚è¦è§£å†³å†²çªä¹‹åæ‰èƒ½åˆå¹¶ã€‚ git merge --abortæ”¾å¼ƒæœ¬æ¬¡åˆå¹¶ # gitä¸€èˆ¬å‘½ä»¤ # git revert git revert \u0026lt;commit\u0026gt; å¯¹æŒ‡å®š\u0026lt;commit\u0026gt;åˆ›å»ºâ¼€ä¸ªundoçš„commitï¼Œå¹¶åº”â½¤åˆ°å½“å‰åˆ†â½€ã€‚å°±æ˜¯æ’¤é”€æŒ‡å®šçš„æäº¤å¹¶ä¿ç•™è®°å½• æ•ˆæœï¼šæ’¤é”€æŒ‡å®šçš„æäº¤ï¼Œå›åˆ°äº†æ’¤é”€æäº¤çš„æ˜¯ä¸Šä¸ªç‰ˆæœ¬ï¼Œä¿ç•™äº†æ’¤é”€å†å²ã€‚ä¼šæ‰“å¼€ç¼–è¾‘å™¨æ˜¾ç¤ºå…·ä½“æ•ˆæœ ä¸€èˆ¬ä¸ç”¨ # git reset git reset \u0026lt;commit\u0026gt;é‡ç½®åˆ°æŒ‡å®šçš„æäº¤ï¼Œä¸ä¼šä¿ç•™commitå†å²ã€‚å·¥ä½œåŒºå’Œæš‚å­˜åŒºä¼šå˜æˆæœªè·Ÿè¸ªã€‚--hardé€‰é¡¹å®Œå…¨é‡ç½®åˆ°æŒ‡å®šæäº¤ã€‚æœªè·Ÿè¸ªçš„é‡ç½®ä¸äº†ã€‚é‡ç½®å†å²å¯ä»¥é€šè¿‡git reflogæŸ¥çœ‹ï¼Œåˆ©ç”¨è¿™ä¸ªå¯ä»¥é‡ç½®å·²ç»é‡ç½®çš„ç‰ˆæœ¬åº“ã€‚\n\u0026lt;commit\u0026gt;å¯ä»¥æ˜¯ï¼š HEADè¡¨ç¤ºæœ€æ–°çš„æäº¤æˆ–è€…è¿™ä¸ªç‰ˆæœ¬åº“ï¼ŒHEAD^ã€HEAD~1ä¸Šä¸Šæ¬¡æäº¤æˆ–è€…ä¸Šä¸ªç‰ˆæœ¬ æˆ–è€…ä½¿ç”¨commit_hashï¼Œæäº¤çš„å“ˆå¸Œå€¼å¯ä»¥ä½¿ç”¨git logæŸ¥çœ‹ï¼Œåªéœ€è¦å‰å‡ ä½å°±è¡Œã€‚ git resetï¼ˆé‡ç½®åˆ°æœ€æ–°çš„æäº¤ï¼‰ç§»é™¤æ‰€æœ‰æš‚å­˜åŒºã€å·¥ä½œåŒºçš„ä¿®æ”¹ï¼Œåˆ°æœªè·Ÿè¸ªã€‚è¿™äº›å‘½ä»¤å…¶å®çœç•¥äº†HEAD\ngit reset --hard é‡ç½®åˆ°æœ€æ–°çš„æäº¤ï¼Œåˆ é™¤å·¥ä½œåŒºå’Œæš‚å­˜åŒº\ngit reset \u0026lt;file\u0026gt;å°†\u0026lt;file\u0026gt;ä»æš‚å­˜åŒºç§»é™¤ï¼Œä½†ä¿æŒâ¼¯ä½œåŒºä¸å˜ã€‚æ­¤æ“ä½œä¸ä¼šä¿®æ”¹â¼¯ä½œåŒºçš„ä»»ä½•â½‚ä»¶ã€‚\n# git restore git restore \u0026lt;file\u0026gt;...æ’¤é”€å¯¹å·¥ä½œåŒºçš„ä¿®æ”¹ï¼Œæ˜¯å¯¹ä»¥è·Ÿè¸ªçš„æ–‡ä»¶å½“æœªæ·»åŠ åˆ°æš‚å­˜åŒºçš„æ–‡ä»¶ã€‚å¤šä¸ªæ–‡ä»¶ç”¨ç©ºæ ¼åˆ†å¼€ã€‚ git checkout -- \u0026lt;file\u0026gt;...åŒç†ï¼Œ--å¯ä»¥çœç•¥ git restore --staged \u0026lt;file\u0026gt;...æ’¤é”€å¯¹æš‚å­˜åŒºçš„ä¿®æ”¹åˆ°æœªè·Ÿè¸ªã€‚é’ˆå¯¹æ·»åŠ åˆ°æš‚å­˜åŒºçš„æ–‡ä»¶ã€‚ git reset HEAD \u0026lt;file\u0026gt;...åŒç†ï¼ŒHEADå¯ä»¥çœç•¥ã€‚ å…·ä½“ç”¨å“ªä¸€ä¸ªï¼Œgitéƒ½ä¼šæœ‰æç¤ºï¼Œä¸ç”¨è®°ã€‚ # git checkout git checkout \u0026lt;branch\u0026gt;åˆ‡æ¢åˆ°æŒ‡å®šçš„åˆ†æ”¯\nå¦‚æœåˆ†æ”¯ä¸ºè¿œç¨‹åˆ†æ”¯ï¼Œåˆ™æ£€å‡ºè¿œç¨‹åˆ†æ”¯ git checkout -b \u0026lt;new-branch\u0026gt;åˆ‡æ¢å¹¶åˆ›å»ºæŒ‡å®šçš„åˆ†æ”¯\ngit checkout \u0026lt;file\u0026gt;æ’¤é”€å·¥ä½œåŒºçš„ä¿®æ”¹\ngit restore \u0026lt;file\u0026gt;åŒç† git checkout \u0026lt;commit\u0026gt;æ ¹æ®æŒ‡å®šçš„æäº¤åˆ›å»ºä¸€ä¸ªåˆ†æ”¯,å¤„äºæ¸¸ç¦»æ€ã€‚ä¸€èˆ¬ä¸ç”¨ã€‚\ngit checkout -b \u0026lt;local_branch_name\u0026gt; origin/\u0026lt;remote_branch_name\u0026gt;åˆ‡æ¢åˆ°è¿œç¨‹åˆ†æ”¯\ngit checkout \u0026lt;branch\u0026gt;å·®ä¸å¤šï¼Œå¯ä»¥ä½¿ç”¨git fetch originè·å–ä»“åº“æ‰€ä»¥ä¿¡æ¯ï¼Œåœ¨æ£€å‡ºåˆ†æ”¯ã€‚ git checkout -åˆ‡æ¢åˆ°å‰ä¸€ä¸ªåˆ†æ”¯ã€‚\n# git remote ç”¨æ¥ç®¡ç†è¿œç¨‹ä»“åº“åˆ—è¡¨ï¼Œoriginä¸ºè¿œç¨‹ä»“åº“çš„é»˜è®¤åˆ«åã€‚è¿™äº›è¿œç«¯ä»“åº“çš„ä¿¡æ¯éƒ½è¢«ä¿å­˜åœ¨./git/config æ–‡ä»¶ä¸­ã€‚\ngit remoteåˆ—å‡ºæ‰€æœ‰å·²é…ç½®çš„è¿œç¨‹ä»“åº“çš„ä¿¡æ¯ã€‚\n-væ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ git remote add \u0026lt;remote_name\u0026gt; \u0026lt;remote_url\u0026gt;æ·»åŠ è¿œç¨‹ä»“åº“\næ·»åŠ â¼€ä¸ªæ–°çš„è¿œç¨‹è¿æ¥ã€‚æ·»åŠ åå¯ä½¿â½¤ \u0026lt;name\u0026gt;ä½œä¸ºæŒ‡å®š\u0026lt;url\u0026gt;è¿œç¨‹è¿æ¥çš„åç§°ã€‚ åªæœ‰é…ç½®äº†è¿™ä¸ªæ‰èƒ½æ¨é€åˆ°è¿œç¨‹ä»“åº“ã€‚ git remote rename \u0026lt;old_name\u0026gt; \u0026lt;new_name\u0026gt;é‡å‘½åè¿œç¨‹ä»“åº“ã€‚ git remote set-url \u0026lt;remote_name\u0026gt; \u0026lt;new_url\u0026gt;ä¿®æ”¹è¿œç¨‹ä»“åº“çš„urlã€‚ git remote remove \u0026lt;remote_name\u0026gt;æˆ–git remote rm \u0026lt;remote_name\u0026gt;åˆ é™¤è¿œç¨‹ä»“åº“ã€‚ git remote show \u0026lt;remote_name\u0026gt;æ˜¾ç¤ºè¿œç¨‹ä»“åº“çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬ URLã€è·Ÿè¸ªçš„åˆ†æ”¯ç­‰ã€‚\nè¡¥å……å¦‚ä½•åˆ›å»ºè¿œç¨‹ä»“åº“\nåˆ›å»ºè¿œç¨‹ä»“åº“å¯ä»¥å…ˆåœ¨githubä¸Šåˆ›å»ºå¥½ï¼Œç„¶ååœ¨æœ¬åœ°pullä¸‹æ¥ï¼Œåœ¨è¿›è¡Œä¿®æ”¹åpushä¸Šå»ã€‚\nå¯ä»¥å»ºä¸€ä¸ªç©ºç™½ä»“åº“ï¼Œåœ¨æœ¬åœ°pushä¸Šå»ï¼Œä½†éœ€è¦è¿›è¡Œç»‘å®šã€‚\n1 2 3 git remote add origin https://github.com/username/null-project.git git branch -M main git push -u origin main # gjit push å°†æœ¬åœ°ä»“åº“æ¨é€åˆ°è¿œç¨‹ä»“åº“\ngit push \u0026lt;remote_repository\u0026gt; \u0026lt;æœ¬åœ°åˆ†æ”¯å\u0026gt;:\u0026lt;è¿œç¨‹åˆ†æ”¯å\u0026gt;æ¨é€æœ¬åœ°åˆ†æ”¯åˆ°æŒ‡å®šçš„è¿œç¨‹åˆ†æ”¯ã€‚å¦‚æœè¿œç¨‹åˆ†æ”¯ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºã€‚:å‰åä¸èƒ½æœ‰ç©ºæ ¼ã€‚\nå½“åˆ†æ”¯åŒåï¼Œå¯ä»¥ç®€å†™æˆgit push \u0026lt;remote_repository\u0026gt; \u0026lt;æœ¬åœ°åˆ†æ”¯å\u0026gt; æœæ— æ³•æäº¤çš„è¯æ‰§è¡Œï¼Œ-fã€--forceé€‰é¡¹å¼ºåˆ¶æ¨é€ï¼Œä¸€èˆ¬ä¸ç”¨ã€‚ git push -u \u0026lt;remote_repository\u0026gt; \u0026lt;æœ¬åœ°åˆ†æ”¯å\u0026gt;è®¾ç½®é»˜è®¤æ¨é€åˆ†æ”¯ã€‚\nä½œç”¨ï¼šè¿™æ ·è®¾ç½®ä»¥åï¼Œæ¨é€åˆ°è¿œç¨‹ä»“åº“å¯ä»¥ç®€å†™æˆgit push git push ä»£æ›¿ git push origin master -uæ˜¯--set-upstreamçš„çŸ­å½¢å¼ã€‚ git push \u0026lt;remote_repository\u0026gt; -d \u0026lt;è¿œç¨‹åˆ†æ”¯å\u0026gt;åˆ é™¤è¿œç¨‹åˆ†æ”¯ ã€‚\n--deleteé•¿é€‰é¡¹ã€‚ git push origin :teståŒç†ï¼Œæ²¡æœ‰å†™æœ¬åœ°åˆ†æ”¯ï¼Œå°±æ˜¯åˆ é™¤è¿œç¨‹åˆ†æ”¯ã€‚ git push \u0026lt;remote\u0026gt; \u0026lt;tagname\u0026gt;æ¨é€æŒ‡å®šæ ‡ç­¾åˆ°æŒ‡å®šè¿œç¨‹ä»“åº“ï¼Œä¸€èˆ¬ä¸º`origin``\n``git push \u0026ndash;tags`æ¨é€æ‰€ç”¨æ ‡ç­¾åˆ°è¿œç¨‹\n# git pull git pull \u0026lt;remote_repository\u0026gt; \u0026lt;è¿œç¨‹åˆ†æ”¯å\u0026gt;:\u0026lt;æœ¬åœ°åˆ†æ”¯å\u0026gt;ä»è¿œç¨‹ä»“åº“æ‹‰å–æœ€æ–°ä»£ç åˆ°æœ¬åœ°ä»“åº“ã€‚ git pullä¼šæ‹‰å–å¹¶åˆå¹¶ï¼Œå‡ºç°å†²çªè¦è§£å†³ä¹‹åæ‰èƒ½åˆå¹¶ã€‚ git fetchè·å–å½“å‰è¿œç¨‹ä»“åº“çš„æœ€æ–°ä¿¡æ¯ï¼Œä¸ä¼šåˆå¹¶ã€‚ é€šå¸¸å¯ä»¥ç®€å†™æˆgit pull,è¿œç¨‹ä»“åº“é»˜è®¤æ˜¯originï¼Œåˆ†æ”¯é»˜è®¤æ˜¯å½“å‰åˆ†æ”¯ã€‚ git pull --rebase\u0026lt;remote\u0026gt; æŠ“å–è¿œç¨‹åˆ†â½€ï¼Œå¹¶ä»¥rebaseæ¨¡å¼å¹¶â¼Šæœ¬åœ°repoâ½½ä¸æ˜¯mergeã€‚ # git fetch git fetch originè·å–è¿œç¨‹ä»“åº“æœ€æ–°çš„æ›´æ”¹ã€‚ä¸ä¼šåˆå¹¶ã€‚é»˜è®¤ä»“åº“æ˜¯originï¼Œåˆ†æ”¯æ˜¯å½“å‰åˆ†æ”¯ï¼Œè¿™é‡Œå¯ä»¥çœç•¥origin git fetch origin \u0026lt;branch\u0026gt;è·å–ç‰¹å®šåˆ†æ”¯çš„æ›´æ”¹. git fetch --allè·å–æ‰€ç”¨ä»“åº“è¿œç¨‹ä»“åº“çš„æœ€æ–°æ›´æ”¹ã€‚ ä¸git pullçš„åŒºåˆ« éƒ½ä¼šè·å–è¿œç¨‹ä»“åº“æœ€æ–°çš„æ›´æ”¹ã€‚ ä½†æ˜¯fetchä¸ä¼šåˆå¹¶ï¼Œè€Œpullä¼šåˆå¹¶ã€‚å¯ä»¥ç†è§£ä¸ºgit pull æ˜¯ git fetch å’Œ git merge çš„ç»„åˆ è·å–æœ€æ–°æ›´æ”¹ä¹‹åå¯ä»¥ï¼š git checkout \u0026lt;branch\u0026gt;æ£€å‡ºæŒ‡å®šåˆ†æ”¯ï¼Œå¦‚æœåŠ originè¦è¿™æ ·git checkout -b \u0026lt;branch\u0026gt; origin/\u0026lt;branch\u0026gt; git merge origin/masteråˆå¹¶è¿œç¨‹ master åˆ†æ”¯çš„æ›´æ”¹åˆ°å½“å‰çš„åˆ†æ”¯ git rebase origin/masterä½¿ç”¨ rebase æ¥æ•´åˆæ›´æ”¹ï¼ˆè¿™å¯èƒ½ä¼šæ”¹å˜æäº¤å†å²ï¼‰ # git stash git stashä¿å­˜å·¥ä½œåŒºã€æš‚å­˜åŒºï¼Œå¯ä»¥åˆ‡æ¢åˆ†æ”¯å»å®Œæˆåˆ«çš„ä»»åŠ¡ã€‚ä¸ä¿å­˜ä¿®æ”¹ï¼Œæœªæäº¤çš„ä¿®æ”¹ä¼šé”™ä¹±åˆ°åˆ«çš„åˆ†æ”¯ã€‚å¹¶ä¸”åªèƒ½ä¿å­˜å·²è¿½è¸ªçš„æ–‡ä»¶ã€‚ git stash listæŸ¥çœ‹ä¿å­˜çš„å·¥ä½œåŒºä»¥åŠæš‚å­˜åŒºã€‚ git stash applyæ¢å¤ä¿å­˜çš„å·¥ä½œåŒºä»¥åŠæš‚å­˜åŒºã€‚ è¿™ä¸ªå‘½ä»¤æ‰§è¡Œä¹‹åä¸ä¼šåˆ é™¤å­˜å‚¨çš„å·¥ä½œåŒºä»¥åŠæš‚å­˜åŒºã€‚ è¦ç”¨git stash dropæ‰èƒ½åˆ é™¤ã€‚ git stash popæ¢å¤å¹¶åˆ é™¤ä¿å­˜çš„å·¥ä½œåŒºä»¥åŠæš‚å­˜åŒºã€‚ é»˜è®¤éƒ½æ˜¯ä¿å­˜ã€æ¢å¤ç¬¬ä¸€ä¸ªstashå³stash@{0}ã€‚è‹¥è¦æŒ‡å®šç¬¬å‡ ä¸ªåœ¨åé¢åŠ stash@{num}ã€‚ å¦‚æ¢å¤ç¬¬äºŒä¸ªstashï¼šgit stash pop stash@{1} æ¯ä¸ªåˆ†æ”¯å…±ç”¨ä¸€ä¸ªstashã€‚ # git tag ä½œç”¨ï¼šç”¨äºæ ‡è®°é¡¹ç›®çš„ç‰ˆæœ¬å‘å¸ƒæˆ–é‡è¦çš„é‡Œç¨‹ç¢‘ã€‚ åˆ†ç±» git tag \u0026lt;tagname\u0026gt; \u0026lt;commit ID\u0026gt;è½»é‡æ ‡ç­¾ git tag vn.n.næ‰“æ ‡ç­¾ï¼Œn.n.nè¡¨ç¤ºå¯¹åº”çš„ç‰ˆæœ¬å·ï¼Œç‰ˆæœ¬å·å‰é¢ä¸€èˆ¬åŠ vï¼Œéµå¾ªä¸€å®šçš„å‘½åè§„èŒƒï¼Œå¦‚v1.0.1ã€‚ é»˜è®¤æ˜¯æ‰“åœ¨æœ€æ–°çš„ä¸€æ¬¡æäº¤ã€‚ åé¢è·Ÿæäº¤çš„å“ˆå¸Œå€¼å¯ä»¥æŒ‡å®šç»™é‚£æ¬¡æäº¤æ‰“æ ‡ç­¾ã€‚å¦‚git tag v0.9.0 f52c633ã€‚ å“ˆå¸Œå€¼å¯ä»¥é€šè¿‡git logæŸ¥çœ‹ git tag -a \u0026lt;tagname\u0026gt; -m \u0026quot;\u0026lt;tag message\u0026gt;\u0026quot; \u0026lt;commit ID\u0026gt;é™„æ³¨æ ‡ç­¾ å¦‚git tag -a v0.1 -m \u0026quot;version 0.1 released\u0026quot; 1094adb æ¨èidçœç•¥é»˜è®¤æœ€æ–°æäº¤ã€‚ æŸ¥çœ‹æ ‡ç­¾ git tagæ˜¾ç¤ºæ‰€æœ‰çš„æœ¬åœ°tagåˆ—è¡¨ï¼ŒæŒ‰ç…§å­—æ¯é¡ºåºæ’åºã€‚å¦‚æœtagæ•°é‡è¾ƒå¤šï¼Œå¯èƒ½ä¼šæ˜¾ç¤ºä¸å…¨ã€‚çœç•¥é€‰é¡¹-lã€--list git show \u0026lt;tagname\u0026gt;æ˜¾ç¤ºæŒ‡å®štagçš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æäº¤çš„ä½œè€…ã€æäº¤æ—¶é—´ã€æäº¤ä¿¡æ¯ç­‰ã€‚ git tag -nï¼šæ˜¾ç¤ºtagåˆ—è¡¨ï¼Œå¹¶åŒæ—¶æ˜¾ç¤ºæ¯ä¸ªtagå¯¹åº”çš„æäº¤ä¿¡æ¯ã€‚ git ls-remote --tags originï¼šæ˜¾ç¤ºè¿œç¨‹ä»“åº“ä¸­çš„æ‰€æœ‰tagä¿¡æ¯ã€‚æ›´æ¨èè¿™ç§ã€‚ æˆ–è€…å…ˆgit fetchè·å–æœ€æ–°çš„æ›´æ”¹ï¼Œç„¶ågit tagæ£€å‡ºæ‰€æœ‰æ ‡ç­¾ã€‚ åˆ é™¤æ ‡ç­¾ git tag -d \u0026lt;tagname\u0026gt;åˆ é™¤æœ¬åœ°æ ‡ç­¾ åˆ é™¤è¿œç¨‹æ ‡ç­¾ï¼šé¦–å…ˆéœ€è¦åœ¨æœ¬åœ°åˆ é™¤æ ‡ç­¾ï¼Œç„¶åæ¨é€åˆ°è¿œç¨‹ä»“åº“ git push origin :refs/tags/\u0026lt;tagname\u0026gt; è¿œç¨‹æ ‡ç­¾æ˜¯refs/tags/v0.0.1è¿™æ ·å­˜åœ¨çš„ï¼Œè·Ÿåˆ é™¤è¿œç¨‹åˆ†æ”¯å·®ä¸å¤šã€‚ æ ‡ç­¾ä¸€æ—¦åˆ›å»ºï¼Œå°±ä¸èƒ½ç›´æ¥ä¿®æ”¹,å¦‚æœéœ€è¦ä¿®æ”¹æ ‡ç­¾ï¼Œé€šå¸¸éœ€è¦åˆ é™¤åŸæ ‡ç­¾ï¼Œå¹¶é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°æ ‡ç­¾ã€‚ æ¨é€æ ‡ç­¾ æ‰“çš„æ ‡ç­¾ä¸ä¼šè‡ªåŠ¨æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼Œéœ€è¦æ‰‹åŠ¨æ¨é€ã€‚ git push \u0026lt;remote\u0026gt; \u0026lt;tagname\u0026gt;æ¨é€æŒ‡å®šæ ‡ç­¾åˆ°æŒ‡å®šè¿œç¨‹ä»“åº“ï¼Œä¸€èˆ¬ä¸ºorigin git push \u0026lt;remote\u0026gt; --tagsæ¨é€æ‰€ç”¨æ ‡ç­¾åˆ°è¿œç¨‹ # gitå¤æ‚å‘½ä»¤ # git log git logä»¥ç¼ºçœæ ¼å¼æ˜¾ç¤ºå…¨éƒ¨commitå†å²ã€‚æ›´å¤šâ¾ƒå®šä¹‰å‚æ•°è¯·å‚è€ƒåç»­éƒ¨åˆ†ã€‚qé€€å‡ºï¼Œç©ºæ ¼ä¸‹ä¸€é¡µï¼ŒhæŸ¥çœ‹å¸®åŠ© git log --statï¼šæ˜¾ç¤ºè¯¦ç»†çš„commitå†å²ã€‚ git log -\u0026lt;limit\u0026gt;é™åˆ¶logçš„æ˜¾ç¤ºæ•°é‡ã€‚ä¾‹å¦‚ï¼šâ€git log -5â€ä»…æ˜¾ç¤ºæœ€æ–°5æ¡commitã€‚ git log --onelineæ¯â¾æ˜¾ç¤ºâ¼€æ¡commitï¼Œç®€åŒ–ä¿¡æ¯ã€‚ä¸--pretty=onelineç­‰æ•ˆ git log --author= \u0026quot;\u0026lt;pattern\u0026gt;\u0026quot;æŒ‰æäº¤è€…åå­—æœç´¢å¹¶æ˜¾ç¤ºcommitã€‚ git log --grep= \u0026quot;\u0026lt;pattern\u0026gt;\u0026quot;æŒ‰æŒ‡å®šå†…å®¹æœç´¢å¹¶æ˜¾ç¤ºcommitã€‚ git log \u0026lt;since\u0026gt;..\u0026lt;until\u0026gt;æ˜¾ç¤ºæŒ‡å®šèŒƒå›´çš„commitã€‚èŒƒå›´å‚æ•°å¯ä»¥æ˜¯commit IDã€åˆ†â½€åç§°ã€HEADæˆ–ä»»æ„ç›¸å¯¹ä½ç½®ã€‚ git log -- \u0026lt;file\u0026gt;ä»…æ˜¾ç¤ºåŒ…å«æŒ‡å®šâ½‚ä»¶ä¿®æ”¹çš„commitã€‚ git log --graphä½¿â½¤\u0026ndash;graphå‚æ•°æ˜¾ç¤ºå›¾å½¢åŒ–çš„branchä¿¡æ¯ã€‚ # git diff git diffâ½è¾ƒâ¼¯ä½œåŒºå’Œæš‚å­˜åŒºçš„ä¿®æ”¹ã€‚ git diff HEADâ½è¾ƒâ¼¯ä½œåŒºå’Œä¸Šâ¼€æ¬¡commitåçš„ä¿®æ”¹ã€‚ HEADæŒ‡å‘å½“å‰åˆ†æ”¯æœ€æ–°çš„commitç‰ˆæœ¬åº“ git diff --cachedâ½è¾ƒæš‚å­˜åŒºå’Œä¸Šâ¼€æ¬¡commitåçš„ä¿®æ”¹ã€‚ git diff --stashedæŸ¥çœ‹æš‚å­˜åŒºä¸æœ€æ–°æäº¤çš„å·®å¼‚ï¼Œä¸ä¸Šé¢ä¸€æ · git diff \u0026lt;commit1\u0026gt; \u0026lt;commit2\u0026gt;æŸ¥çœ‹ä¸¤ä¸ªæäº¤ä¹‹é—´çš„å·®å¼‚ã€‚ git diff \u0026lt;filename\u0026gt;åé¢æŒ‡å®šæ–‡ä»¶ï¼ŒåªæŸ¥çœ‹è¯¥æ–‡ä»¶çš„ä¿®æ”¹æƒ…å†µï¼Œæ²¡æœ‰å‚æ•°æŸ¥è¯¢å…¨éƒ¨ ç”¨git diff HEAD -- readme.txtå‘½ä»¤å¯ä»¥æŸ¥çœ‹ç‰ˆæœ¬åº“å’Œå·¥ä½œåŒºé‡Œé¢æœ€æ–°ç‰ˆæœ¬çš„åŒºåˆ« # git config ä½œç”¨ï¼šé€šè¿‡git configå‘½ä»¤é…ç½®gitçš„é…ç½®æ–‡ä»¶\ngité…ç½®æ–‡ä»¶çº§åˆ«åˆ†ä¸ºï¼š\nä»“åº“çº§åˆ« --local ã€ä¼˜å…ˆçº§æœ€é«˜ã€‘ã€‚æ–‡ä»¶æ‰€åœ¨ä½ç½®ä»“åº“ä¸‹çš„.git/config å½“å‰ç”¨æˆ·çº§åˆ« --globalã€ä¼˜å…ˆçº§æ¬¡ä¹‹ã€‘ä¸€èˆ¬é…ç½®å®ƒã€‚æ–‡ä»¶æ‰€åœ¨ä½ç½®ç”¨æˆ·å®¶ç›®å½•ä¸‹çš„.gitconfig ç³»ç»Ÿæ‰€æœ‰ç”¨æˆ·çº§åˆ« --systemã€ä¼˜å…ˆçº§æœ€ä½ã€‘ã€‚æ–‡ä»¶æ‰€åœ¨ä½ç½®gitå®‰è£…ç›®å½•ä¸‹çš„ ./etc/gitconfig -lã€--listæŸ¥çœ‹é…ç½®ã€‚å¸¸ç”¨\ngit config -læŸ¥çœ‹æ‰€æœ‰çš„é…ç½®ä¿¡æ¯ï¼Œä¾æ¬¡æ˜¯ç³»ç»Ÿçº§åˆ«ã€ç”¨æˆ·çº§åˆ«ã€ä»“åº“çº§åˆ« git config --local -l æŸ¥çœ‹ä»“åº“çº§åˆ«é…ç½®ã€‚å¿…é¡»è¦è¿›å…¥åˆ°å…·ä½“çš„ç›®å½•ä¸‹ã€‚ git config --global -l æŸ¥çœ‹å½“å‰ç”¨æˆ·é…ç½® git config --system -l æŸ¥çœ‹ç³»ç»Ÿæ‰€æœ‰ç”¨æˆ·é…ç½® å¯ä»¥ä¸--show-origin æ˜¾ç¤ºæ–‡ä»¶ä½ç½®ï¼Œ--show-scopeæ˜¾ç¤ºæ–‡ä»¶çº§åˆ«ç»„åˆä½¿ç”¨ -eã€--editæ‰“å¼€ç¼–è¾‘å™¨ç¼–è¾‘æŒ‡å®šçº§åˆ«çš„é…ç½®æ–‡ä»¶ï¼Œæ²¡æœ‰æŒ‡å®šé»˜è®¤ä»“åº“çº§åˆ«ï¼Œä¼šä½¿ç”¨é»˜è®¤ç¼–è¾‘å™¨æ‰“å¼€ç¼–è¾‘ã€‚å®‰è£…çš„æ—¶å€™è®¾ç½®çš„ã€‚\næ·»åŠ é…ç½®ã€ä¿®æ”¹é…ç½®ï¼šç›´æ¥é…ç½®å¯¹åº”çš„é…ç½®å‚æ•°å°±è¡Œã€‚ä¸€èˆ¬é…ç½®ç”¨æˆ·çº§åˆ«å°±è¡Œã€‚çœç•¥äº†--addé€‰é¡¹ã€‚æ²¡æœ‰æŒ‡å®šçº§åˆ«ï¼Œé»˜è®¤ä»“åº“åŸºæœ¬ã€‚å¸¸ç”¨çš„æ·»åŠ é…ç½®å‘½ä»¤:\nç”¨æˆ·é‚®ç®±å’Œç”¨æˆ·åã€‚å®‰è£…gitä¹‹åå¿…è®¾ç½®çš„é…ç½®\ngit config --global user.email \u0026quot;Your mail\u0026quot;\ngit config --global user.name \u0026quot;Your name\u0026quot;\nå¦‚æœæˆ‘ä»¬æ²¡æœ‰é…ç½®ï¼Œåœ¨æäº¤ä»£ç æ—¶ä¼šæœ‰å¦‚ä¸‹é”™è¯¯ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 xxx@DESKTOP-MD21325 MINGW64 /d/test/test (master) $ git commit -m \u0026#34;feature: add readme\u0026#34; Author identity unknown *** Please tell me who you are. Run git config --global user.email \u0026#34;you@example.com\u0026#34; git config --global user.name \u0026#34;Your Name\u0026#34; to set your account\u0026#39;s default identity. Omit --global to set the identity only in this repository. fatal: unable to auto-detect email address (got \u0026#39;xxx@DESKTOP-MD21325.(none)\u0026#39;) è®¾ç½®è‡ªå·±çš„ä»£ç†ã€‚ç½‘é€Ÿæ…¢å¿…è®¾ç½®çš„é…ç½®\ngit config --global http.proxy \u0026quot;http://proxy_ip:port\u0026quot;\ngit config --global https.proxy \u0026quot;https://proxy_ip:port\u0026quot;\n--unsetå–æ¶ˆé…ç½®ï¼Œæ³¨æ„è¦æŒ‡å®šå–æ¶ˆçš„é…ç½®çº§åˆ«ã€‚å¸¸ç”¨å–æ¶ˆé…ç½®å‘½ä»¤ï¼š\nå–æ¶ˆä»£ç†é…ç½®\ngit config --global --unset http.proxy\ngit config --global --unset https.proxy\n--getæŸ¥çœ‹æŒ‡å®šçº§åˆ«ã€æŒ‡å®šé…ç½®é¡¹çš„é…ç½®ï¼Œé»˜è®¤ä»“åº“çº§åˆ«ã€‚å¦‚ï¼š\næŸ¥çœ‹ä»£ç†é…ç½®\ngit config --global --get http.proxy\ngit config --global --get https.proxy\ngit config --global alias.\u0026lt;alias-name\u0026gt; \u0026lt;git-command\u0026gt;é…ç½®â¼€ä¸ªgitå‘½ä»¤çš„å¿«æ·â½…å¼ã€‚ä¾‹å¦‚ï¼šé…ç½®â€alias.glog log \u0026ndash;graph \u0026ndash;onelineâ€ä½¿â€git glogâ€ç›¸å½“äºâ€git log \u0026ndash;graph \u0026ndash;onelineâ€.\ngit config --global core.editor \u0026lt;editor\u0026gt;é…ç½®â½‚æœ¬ç¼–è¾‘å™¨ï¼Œä¾‹å¦‚viï¼Œåœ¨å¿…è¦æ—¶â¾ƒåŠ¨æ‰“å¼€æ­¤â½‚æœ¬ç¼–è¾‘å™¨ã€‚å®‰è£…çš„æ—¶å€™ä¹Ÿå¯ä»¥æŒ‡å®šé»˜è®¤ç¼–è¾‘å™¨ã€‚\n# git submodule git submodule initåˆå§‹åŒ–å­æ¨¡å—ï¼Œå°†å­æ¨¡å—çš„é…ç½®ä¿¡æ¯å­˜å‚¨åœ¨çˆ¶ä»“åº“ä¸­ã€‚\né€šå¸¸æ‰§è¡Œä¹‹åå†æ‰§è¡Œæ›´æ–°å­æ¨¡å—ä½¿ç”¨ï¼Œå¦‚å…‹éš†å¸¦æœ‰å­æ¨¡å—çš„ä»“åº“ï¼Œæ²¡æœ‰åŠ --recursiveï¼Œæ˜¯ä¸ä¼šå…‹éš†å­æ¨¡å—çš„ åˆå§‹åŒ–å­æ¨¡å—ä¹‹åï¼Œæ‰§è¡Œæ›´æ–°å­æ¨¡å—å°±ä¼šæ ¹æ®é…ç½®ä¿¡æ¯ä¸‹è½½å­æ¨¡å— git submodule updateæ ¹æ®çˆ¶ä»“åº“å­æ¨¡å—çš„é…ç½®ä¿¡æ¯æ›´æ–°å­æ¨¡å—ï¼Œå¦‚æœæ²¡æœ‰åˆå§‹åŒ–å­æ¨¡å—å¯ä»¥åŠ å‚æ•°--initï¼Œä¼šä¸‹è½½ä¸çˆ¶é¡¹ç›®ç»‘å®šç‰ˆæœ¬çš„å­æ¨¡å—ï¼Œè‹¥è¦æ›´æ–°åŠ --remote\n--initåˆè¯†åŒ–å­æ¨¡å— --recursiveä¼šé€’å½’ä¸‹è½½å­æ¨¡å—çš„å­æ¨¡å— --remoteæ ¹æ®å­æ¨¡å—è¿œç¨‹ä»“åº“çš„é…ç½®ä¿¡æ¯æ›´æ–°å­æ¨¡å—ï¼Œä¼šä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„å­æ¨¡å— æ³¨æ„æ›´æ–°ä¹‹åè¦æäº¤æ›´æ–°çš„ç‰ˆæœ¬ï¼Œå¦åˆ™å½“åœ¨æ‰§è¡Œæ›´æ–°å‘½ä»¤æ²¡æœ‰åŠ --remoteæ—¶ä¼šé€€å›ä¸çˆ¶ä»“åº“ç»‘å®šçš„ç‰ˆæœ¬ git submodule add \u0026lt;repository\u0026gt; \u0026lt;path\u0026gt;æ·»åŠ å­æ¨¡å—ã€‚å…¶ä¸­ï¼Œ\u0026lt;repository\u0026gt;æ˜¯å­æ¨¡å—çš„è¿œç¨‹ä»“åº“åœ°å€ï¼Œ\u0026lt;path\u0026gt;æ˜¯å­æ¨¡å—åœ¨ä¸»é¡¹ç›®ä¸­çš„è·¯å¾„ã€‚\nå­æ¨¡å—å¯ä»¥å½“æ­£å¸¸ä»“åº“ä½¿ç”¨ã€‚åˆ›å»ºæ—¶\u0026lt;path\u0026gt;è·¯å¾„ä¸èƒ½å­˜åœ¨æ–‡ä»¶ï¼Œæ›´å…‹éš†å·®ä¸å¤šã€‚ # git subtree ä½œç”¨ï¼šå°†ä¸€ä¸ªä»“åº“ä¸­çš„ç›®å½•ä½œä¸ºå¦ä¸€ä¸ªä»“åº“ï¼Œå¯ä»¥æŒ‡å®šåˆ†æ”¯ ç”¨é€”ï¼šæ­å»ºé¡¹ç›®ç½‘ç«™æ—¶ï¼Œå°†é¡¹ç›®ç½‘ç«™èµ„æºæ¨é€åˆ°gh-pagesåˆ†æ”¯ä¸Š git subtree push --prefix=dist origin gh-pageså°†ç›®å½•æ·»åŠ åˆ°gh-pagesåˆ†æ”¯ä¸Šï¼Œdistä¸ºé¡¹ç›®ç½‘ç«™çš„ç›®å½• git subtree push --prefix=\u0026lt;prefix\u0026gt; \u0026lt;repository\u0026gt; \u0026lt;branch\u0026gt;å°†å­ç›®å½•çš„å†…å®¹æ¨é€åˆ°è¿œç¨‹ä»“åº“ã€‚å®ƒä¼šå°†å½“å‰ä»“åº“ä¸­å­ç›®å½•çš„ä¿®æ”¹æ¨é€åˆ°æŒ‡å®šçš„è¿œç¨‹ä»“åº“å’Œåˆ†æ”¯ä¸­ã€‚ æ³¨æ„ï¼šä»¥è¿™ç§æ¨é€çš„æ–¹å¼æ·»åŠ çš„subtreeä¸èƒ½æ‰§è¡Œsubtree pullå‘½ä»¤ï¼Œåªæœ‰é€šè¿‡subtree addæ·»åŠ çš„æ‰èƒ½éƒ½æ‰§è¡Œï¼Œä½†èƒ½å¤Ÿæ‰§è¡Œsubtree pushå‘½ä»¤ git subtree pull --prefix=\u0026lt;prefix\u0026gt; \u0026lt;repository\u0026gt; \u0026lt;branch\u0026gt;è¿™ä¸ªå‘½ä»¤ç”¨äºä»è¿œç¨‹ä»“åº“æ›´æ–°å­ç›®å½•çš„å†…å®¹ã€‚å®ƒä¼šæ‹‰å–è¿œç¨‹ä»“åº“çš„æœ€æ–°ä»£ç ï¼Œå¹¶æ›´æ–°åˆ°å½“å‰ä»“åº“çš„å­ç›®å½•ä¸­ã€‚ git subtree add --prefix=\u0026lt;prefix\u0026gt; \u0026lt;repository\u0026gt; \u0026lt;branch\u0026gt;è¿™ä¸ªå‘½ä»¤ç”¨äºå°†è¿œç¨‹ä»“åº“çš„å†…å®¹ä½œä¸ºå­ç›®å½•æ·»åŠ åˆ°å½“å‰ä»“åº“ä¸­ã€‚\u0026lt;prefix\u0026gt;æ˜¯å­ç›®å½•çš„åç§°ï¼Œ\u0026lt;repository\u0026gt;æ˜¯è¿œç¨‹ä»“åº“çš„åœ°å€ï¼Œ\u0026lt;branch\u0026gt;æ˜¯è¦åˆå¹¶çš„åˆ†æ”¯ã€‚ # git rebase ä½œç”¨ï¼šrebaseç¿»è¯‘æˆå˜åŸºï¼Œé¡¾åæ€ä¹‰ï¼šæ”¹å˜åŸºå‡†ç‚¹ã€‚å¯ä»¥ä½¿æäº¤å†å²æ›´åŠ æ¸…æ™°å’Œçº¿æ€§ã€‚\nåŸå› ï¼šé€šè¿‡åˆå¹¶ä¸¤ä¸ªä¸åŒçš„åˆ†æ”¯ï¼Œæäº¤å†å²ä¼šå¾ˆé”™ä¹±ã€‚è€Œé€šè¿‡å˜åŸºï¼Œä¼šä½¿å¾—æäº¤å†å²æ›´åŠ æ•´æ´å’Œå¯è¯»ã€‚\nå¦‚ä½•å®ç°ï¼šå°±æ˜¯ä¿®æ”¹åˆ›å»ºåˆ†æ”¯çš„èµ·ç‚¹ï¼ˆåŸºå‡†ç‚¹ï¼‰ï¼Œåˆ°æœ€æ–°çš„æäº¤ã€‚èµ·ç‚¹å˜äº†ï¼Œæäº¤å†å²å°±ç®€åŒ–äº†ã€‚\nå‘½ä»¤ï¼š\ngit rebase \u0026lt;base\u0026gt;åŸºäº\u0026lt;base\u0026gt;å¯¹å½“å‰åˆ†â½€è¿›â¾rebaseã€‚\u0026lt;base\u0026gt;å¯ä»¥æ˜¯commitã€åˆ†â½€åç§°ã€tagæˆ–ç›¸å¯¹äºHEADçš„commitã€‚ git rebase -i \u0026lt;base\u0026gt;ä»¥äº¤äº’æ¨¡å¼å¯¹å½“å‰åˆ†â½€åšrebaseã€‚ rebaseçš„è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‡ºç°å†²çªï¼Œè§£å†³å†²çªä¹‹åéœ€è¦ä½¿ç”¨git addå‘½ä»¤å°†è§£å†³å†²çªåçš„æ–‡ä»¶æ ‡è®°ä¸ºå·²è§£å†³ï¼Œç„¶åï¼Œä½¿ç”¨git rebase --continueå‘½ä»¤ç»§ç»­rebaseè¿‡ç¨‹ã€‚Gitä¼šå°è¯•ç»§ç»­åº”ç”¨å‰©ä½™çš„æäº¤ã€‚å¦‚æœå†æ¬¡å‡ºç°å†²çªï¼Œä½ éœ€è¦é‡å¤ä¸Šè¿°è§£å†³å†²çªå’Œç»§ç»­rebaseçš„æ­¥éª¤ã€‚ å¦‚æœåœ¨rebaseè¿‡ç¨‹ä¸­å‡ºç°äº†é—®é¢˜ï¼Œæˆ–è€…ä½ å†³å®šæ”¾å¼ƒrebaseæ“ä½œï¼Œä½ å¯ä»¥ä½¿ç”¨git rebase --abortå‘½ä»¤æ¥æ’¤é”€æ•´ä¸ªrebaseæ“ä½œã€‚ git rebaseçš„æ³¨æ„äº‹é¡¹\né¿å…å¯¹å·²ç»æ¨é€åˆ°è¿œç¨‹ä»“åº“çš„æäº¤æ‰§è¡Œrebaseæ“ä½œï¼šè¿™å¯èƒ½ä¼šå¯¼è‡´æäº¤å†å²çš„ä¸ä¸€è‡´ï¼Œç»™å…¶ä»–åä½œè€…å¸¦æ¥å›°æ‰°ã€‚ ä¿æŒå·¥ä½œç›®å½•å¹²å‡€ï¼šåœ¨æ‰§è¡Œrebaseä¹‹å‰ï¼Œç¡®ä¿ä½ çš„å·¥ä½œç›®å½•ä¸­æ²¡æœ‰æœªæäº¤çš„æ›´æ”¹ã€‚ è°¨æ…ä½¿ç”¨ï¼šç”±äºrebaseä¼šæ”¹å˜æäº¤å†å²ï¼Œå› æ­¤åœ¨ä¸ä»–äººå…±äº«åˆ†æ”¯æ—¶è¦ç‰¹åˆ«å°å¿ƒã€‚é€šå¸¸ï¼Œåœ¨å…¬å…±åˆ†æ”¯ä¸Šåº”è¯¥ä½¿ç”¨mergeè€Œä¸æ˜¯rebaseã€‚ é€šè¿‡æŒæ¡git rebaseçš„ç”¨æ³•å’Œæ³¨æ„äº‹é¡¹ï¼Œä½ å¯ä»¥æ›´æœ‰æ•ˆåœ°ç®¡ç†ä½ çš„Gitä»“åº“ï¼Œä¿æŒä»£ç çš„æ¸…æ™°å’Œæ•´æ´ã€‚\nâ€‹\n# æ‰©å±• # .gitignoreæ–‡ä»¶ Gitæä¾›äº†.gitignoreæ–‡ä»¶ï¼Œç”¨äºæŒ‡å®šå“ªäº›æ–‡ä»¶æˆ–ç›®å½•åº”è¯¥è¢«Gitå¿½ç•¥ï¼Œä¸çº³å…¥ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸­ã€‚.gitignoreæ–‡ä»¶æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå¯ä»¥åŒ…å«ä¸€äº›ç®€å•çš„è§„åˆ™ï¼ŒæŒ‡å®šåº”è¯¥å¿½ç•¥å“ªäº›æ–‡ä»¶æˆ–ç›®å½•ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›.gitignoreæ–‡ä»¶çš„ç¤ºä¾‹è§„åˆ™ï¼š\nå¿½ç•¥æ‰€æœ‰ä»¥.tmpç»“å°¾çš„æ–‡ä»¶ï¼š\n1 *.tmp å¿½ç•¥æ‰€æœ‰çš„logæ–‡ä»¶ï¼š\n1 *.log å¿½ç•¥æ‰€æœ‰çš„.ideaç›®å½•ï¼š\n1 .idea/ å¿½ç•¥æ‰€æœ‰çš„buildç›®å½•åŠå…¶å†…å®¹ï¼š\n1 build/ å¿½ç•¥æ ¹ç›®å½•ä¸‹çš„config.jsonæ–‡ä»¶ï¼Œä½†ä¸å¿½ç•¥å­ç›®å½•ä¸­çš„config.jsonæ–‡ä»¶ï¼š\n1 /config.json å¿½ç•¥æ‰€æœ‰çš„node_modulesç›®å½•åŠå…¶å†…å®¹ï¼š\n1 node_modules/ å¿½ç•¥æ‰€æœ‰çš„DS_Storeæ–‡ä»¶ï¼ˆMac OS Xç³»ç»Ÿä¸­çš„æ–‡ä»¶ï¼‰ï¼š\n1 .DS_Store å¯ä»¥å°†è¿™äº›è§„åˆ™å†™å…¥.gitignoreæ–‡ä»¶ä¸­ï¼Œå¹¶å°†è¯¥æ–‡ä»¶æ·»åŠ åˆ°Gitä»“åº“ä¸­ï¼Œä»¥ä½¿Gitå¿½ç•¥è¿™äº›æ–‡ä»¶æˆ–ç›®å½•ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå³ä½¿æŸäº›æ–‡ä»¶æˆ–ç›®å½•å·²ç»è¢«æ·»åŠ åˆ°Gitä»“åº“ä¸­ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¿®æ”¹.gitignoreæ–‡ä»¶æ¥è®©Gitå¿½ç•¥å®ƒä»¬ï¼Œä½†éœ€è¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ‰èƒ½ä½¿.gitignoreæ–‡ä»¶ç”Ÿæ•ˆï¼š\n1 2 3 4 git rm -r --cached . git add . git commit -m \u0026#34;update .gitignore\u0026#34; git push è¿™äº›å‘½ä»¤ä¼šåˆ é™¤Gitç¼“å­˜ä¸­å·²ç»æ·»åŠ çš„æ–‡ä»¶ï¼Œç„¶åé‡æ–°æ·»åŠ æ–‡ä»¶å¹¶æäº¤æ›´æ”¹ï¼Œä»¥ä½¿.gitignoreæ–‡ä»¶ç”Ÿæ•ˆã€‚\næ€»ç»“ï¼š\nå½“Gitæ‰§è¡Œæäº¤æ“ä½œæ—¶ï¼Œå®ƒä¼šæ£€æŸ¥.gitignoreæ–‡ä»¶ä¸­åˆ—å‡ºçš„æ–‡ä»¶å’Œç›®å½•ï¼Œå¹¶å°†å®ƒä»¬ä»æäº¤ä¸­æ’é™¤ã€‚è¿™æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œå› ä¸ºæœ‰äº›æ–‡ä»¶æˆ–ç›®å½•ä¸åº”è¯¥è¢«çº³å…¥ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸­ï¼Œä¾‹å¦‚ç¼–è¯‘ç”Ÿæˆçš„æ–‡ä»¶ã€æ—¥å¿—æ–‡ä»¶ã€ä¸´æ—¶æ–‡ä»¶ç­‰ã€‚\n.gitignoreæ–‡ä»¶çš„è¯­æ³•æ˜¯åŸºäºæ¨¡å¼åŒ¹é…çš„ï¼Œå…¶ä¸­çš„ç‰¹æ®Šå­—ç¬¦æœ‰ï¼š\n*ï¼šåŒ¹é…ä»»æ„å­—ç¬¦ï¼Œä½†ä¸åŒ…æ‹¬è·¯å¾„åˆ†éš”ç¬¦ï¼ˆ/ï¼‰ã€‚ ?ï¼šåŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦ï¼Œä½†ä¸åŒ…æ‹¬è·¯å¾„åˆ†éš”ç¬¦ï¼ˆ/ï¼‰ã€‚ /ï¼šè·¯å¾„åˆ†éš”ç¬¦ï¼Œç”¨äºæŒ‡å®šç›®å½•ã€‚ !ï¼šç”¨äºå¦å®šæ¨¡å¼ï¼Œå³ä¸å¿½ç•¥æŒ‡å®šçš„æ–‡ä»¶æˆ–ç›®å½•ã€‚ å¯ä»¥åœ¨.gitignoreæ–‡ä»¶ä¸­ä½¿ç”¨é€šé…ç¬¦ã€è·¯å¾„ã€æ³¨é‡Šç­‰è¯­æ³•ï¼Œä»¥æ›´ç²¾ç¡®åœ°æŒ‡å®šéœ€è¦å¿½ç•¥çš„æ–‡ä»¶æˆ–ç›®å½•ã€‚åŒæ—¶ï¼Œå¯ä»¥åœ¨ä»“åº“çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª.gitignoreæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥åœ¨å­ç›®å½•ä¸­åˆ›å»ºç‹¬ç«‹çš„.gitignoreæ–‡ä»¶ã€‚\n# gitè´¦æˆ·è®¤è¯ å½“æˆ‘ä»¬å¯¹è¿œç¨‹ä»“åº“å°±è¡Œä¿®æ”¹æ—¶ï¼Œéœ€è¦å¯¹åº”çš„æƒé™ï¼Œä¸æ˜¯ä»€ä¹ˆäººéƒ½èƒ½å¤Ÿä¿®æ”¹ä»“åº“ã€‚åªæœ‰é€šè¿‡äº†gitè´¦æˆ·è®¤è¯ï¼Œæ‰èƒ½ä¿®æ”¹å¯¹åº”çš„ä»“åº“ã€‚ å¸¸è§gitè´¦æˆ·è®¤è¯çš„æ–¹å¼ï¼š SSHç§˜é’¥è®¤è¯ è¿™æ˜¯Gitä¸­æœ€å¸¸è§çš„è®¤è¯æ–¹å¼ä¹‹ä¸€ã€‚ç”¨æˆ·é¦–å…ˆç”Ÿæˆä¸€å¯¹å…¬é’¥å’Œç§é’¥ï¼Œç„¶åå°†å…¬é’¥æ·»åŠ åˆ°GitæœåŠ¡å™¨ä¸Šçš„ç”¨æˆ·å¸æˆ·ä¸­ã€‚å½“ç”¨æˆ·å°è¯•ä¸GitæœåŠ¡å™¨è¿›è¡Œé€šä¿¡æ—¶ï¼ŒGitå°†ä½¿ç”¨ç§é’¥è¿›è¡Œèº«ä»½éªŒè¯ã€‚è¿™ç§æ–¹å¼ç›¸å¯¹å®‰å…¨ï¼Œå› ä¸ºç§é’¥æ˜¯ä¿å­˜åœ¨ç”¨æˆ·æœ¬åœ°æœºå™¨ä¸Šçš„ï¼Œä¸ä¼šè¢«ä¼ è¾“åˆ°GitæœåŠ¡å™¨ã€‚ ç§˜é’¥ç”Ÿæˆå‘½ä»¤ï¼šbashä¸­è¿è¡Œssh-keygen,ä¸€ç›´å›è½¦å°±è¡Œï¼Œç§˜é’¥ä½ç½®ï¼šä¸»ç›®å½•ä¸‹çš„.sshç›®å½• å…¬é’¥è®¾ç½®ä½ç½®ï¼šgithubè´¦æˆ·Settings-\u0026gt;SSH and GPG keys-\u0026gt;New SSH keyå°†å…¬é’¥å¤åˆ¶ç²˜è´´ä¿å­˜å°±è¡Œã€‚ HTTPSè®¤è¯ åœ¨è¿™ç§æ–¹å¼ä¸­ï¼Œç”¨æˆ·éœ€è¦æä¾›ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œèº«ä»½éªŒè¯ã€‚ç”¨æˆ·éœ€è¦åœ¨GitæœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªç”¨æˆ·å¸æˆ·ï¼Œå¹¶å°†å…¶å…³è”åˆ°æœ¬åœ°çš„Gitä»“åº“ä¸­ã€‚å½“ç”¨æˆ·æ‰§è¡Œéœ€è¦èº«ä»½éªŒè¯çš„æ“ä½œæ—¶ï¼ŒGitä¼šè¦æ±‚è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚è¿™ç§æ–¹å¼ç›¸å¯¹ç®€å•ï¼Œé€‚ç”¨äºä¸ªäººé¡¹ç›®æˆ–å°å‹å›¢é˜Ÿã€‚ è®¾ç½®ä½ç½®ï¼šåœ¨ä½¿ç”¨Gitè¿›è¡Œæ“ä½œæ—¶ï¼Œå¦‚pushæˆ–pullï¼Œç³»ç»Ÿä¼šæç¤ºä½ è¾“å…¥ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œèº«ä»½éªŒè¯ã€‚ è®¿é—®ä»¤ç‰Œï¼ˆPersonal Access Tokenï¼‰è®¤è¯ï¼šä¸å¸¸ç”¨ è®¿é—®ä»¤ç‰Œæä¾›äº†ä¸€ç§æ›´å®‰å…¨ã€æ›´çµæ´»çš„èº«ä»½éªŒè¯æ–¹å¼ï¼Œå› ä¸ºå®ƒå¯ä»¥é™åˆ¶ä»¤ç‰Œçš„ä½¿ç”¨æƒé™ï¼Œå¹¶ä¸”å¯ä»¥éšæ—¶æ’¤é”€æˆ–é‡æ–°ç”Ÿæˆä»¤ç‰Œã€‚ è®¾ç½®ä½ç½®ï¼šgithubè´¦æˆ·Settings-\u0026gt;Developer Settings-\u0026gt;Personal access tokens-\u0026gt;Tokens (classic)-\u0026gt;Generate new tokenï¼Œç„¶åæ ¹æ®è‡ªå·±çš„éœ€æ±‚è®¾ç½®tokençš„æƒé™ã€‚ # ssh-keygen ssh-keygenå‘½ä»¤æ˜¯ä¸€ä¸ªç”¨äºç”Ÿæˆã€ç®¡ç†å’Œè½¬æ¢SSHè®¤è¯å¯†é’¥çš„å·¥å…·ã€‚å®ƒæ”¯æŒRSAå’ŒDSAä¸¤ç§è®¤è¯å¯†é’¥ç±»å‹ï¼Œå¹¶ä¸”æä¾›äº†å¤šç§é€‰é¡¹å’Œå‚æ•°ï¼Œä»¥æ»¡è¶³ä¸åŒçš„éœ€æ±‚ã€‚\nä½¿ç”¨ssh-keygenå‘½ä»¤ï¼Œä½ å¯ä»¥ç”Ÿæˆæ–°çš„å¯†é’¥å¯¹ï¼ŒæŒ‡å®šå¯†é’¥çš„é•¿åº¦ã€ç±»å‹ä»¥åŠä¿å­˜çš„æ–‡ä»¶åã€‚ç”Ÿæˆçš„ç§é’¥å°†ä¿å­˜åœ¨æœ¬åœ°ï¼Œè€Œå…¬é’¥åˆ™ç”¨äºåœ¨SSHæœåŠ¡å™¨ä¸Šè¿›è¡Œèº«ä»½éªŒè¯ã€‚\nä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„ssh-keygenå‘½ä»¤é€‰é¡¹ï¼š\n-tï¼šæŒ‡å®šè¦åˆ›å»ºçš„å¯†é’¥ç±»å‹ï¼Œé»˜è®¤ä¸ºRSAã€‚ -bï¼šæŒ‡å®šå¯†é’¥é•¿åº¦ï¼ˆä»¥ä½ä¸ºå•ä½ï¼‰ã€‚å¯¹äºRSAå¯†é’¥ï¼Œæœ€å°è¦æ±‚æ˜¯768ä½ï¼Œé»˜è®¤æ˜¯2048ä½ã€‚å¯¹äºDSAå¯†é’¥ï¼Œé•¿åº¦å¿…é¡»æ˜¯1024ä½ï¼ˆæ ¹æ®FIPS 1862æ ‡å‡†è§„å®šï¼‰ã€‚ -fï¼šæŒ‡å®šç”¨äºä¿å­˜å¯†é’¥çš„æ–‡ä»¶åã€‚å¦‚æœä¸æŒ‡å®šï¼Œå°†ä½¿ç”¨é»˜è®¤å€¼id_rsaï¼ˆå¯¹äºç§é’¥ï¼‰å’Œid_rsa.pubï¼ˆå¯¹äºå…¬é’¥ï¼‰ã€‚ -Cï¼šæä¾›ä¸€ä¸ªæ–°æ³¨é‡Šï¼Œé€šå¸¸ç”¨äºæ ‡è¯†å¯†é’¥çš„ç”¨é€”æˆ–æ‰€æœ‰è€…ã€‚ -P å’Œ -Nï¼šåˆ†åˆ«ç”¨äºæä¾›æ—§å¯†ç å’Œæ–°å¯†ç ï¼Œä»¥ä¿æŠ¤ç§é’¥æ–‡ä»¶ã€‚å¦‚æœç•™ç©ºï¼Œåˆ™è¡¨ç¤ºä¸éœ€è¦å¯†ç ã€‚ åœ¨ç”Ÿæˆå¯†é’¥å¯¹åï¼Œä½ å¯ä»¥å°†å…¬é’¥å¤åˆ¶åˆ°éœ€è¦è®¿é—®çš„SSHæœåŠ¡å™¨ä¸Šï¼Œé€šå¸¸æ˜¯å°†å…¬é’¥å†…å®¹è¿½åŠ åˆ°æœåŠ¡å™¨çš„~/.ssh/authorized_keysæ–‡ä»¶ä¸­ã€‚è¿™æ ·ï¼Œå½“ä½ ä½¿ç”¨SSHå®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨æ—¶ï¼Œå®¢æˆ·ç«¯å°†ä½¿ç”¨ç§é’¥è¿›è¡Œèº«ä»½éªŒè¯ï¼Œå¦‚æœéªŒè¯æˆåŠŸï¼Œä½ å°†èƒ½å¤Ÿæ— éœ€è¾“å…¥å¯†ç å³å¯ç™»å½•åˆ°æœåŠ¡å™¨ã€‚\nè¯·æ³¨æ„ï¼Œç§é’¥çš„å®‰å…¨æ€§è‡³å…³é‡è¦ã€‚ç§é’¥åº”è¯¥å¦¥å–„ä¿ç®¡ï¼Œå¹¶ä¸”ä¸åº”è¯¥ä¸å…¶ä»–äººå…±äº«ã€‚åŒæ—¶ï¼Œå®šæœŸæ›´æ¢å¯†é’¥å¯¹ä¹Ÿæ˜¯ä¿æŒå®‰å…¨æ€§çš„å¥½ä¹ æƒ¯ã€‚\né™¤äº†ç”Ÿæˆå’Œç®¡ç†å¯†é’¥å¯¹ï¼Œssh-keygenè¿˜æä¾›äº†å…¶ä»–åŠŸèƒ½ï¼Œå¦‚è½¬æ¢å¯†é’¥æ ¼å¼ã€è¯»å–å¯†é’¥æ–‡ä»¶ç­‰ã€‚ä½ å¯ä»¥é€šè¿‡æŸ¥çœ‹ssh-keygençš„å¸®åŠ©æ–‡æ¡£æˆ–æ‰‹å†Œé¡µï¼ˆé€šè¿‡è¿è¡Œman ssh-keygenå‘½ä»¤ï¼‰æ¥è·å–æ›´è¯¦ç»†çš„ä¿¡æ¯å’Œç”¨æ³•ç¤ºä¾‹ã€‚\n","date":"2024-04-22T22:18:17+08:00","permalink":"https://arlettebrook.github.io/p/git%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/","title":"Gitå¸¸ç”¨å‘½ä»¤"},{"content":" # ç®€ä»‹ flagç”¨äºè§£æå‘½ä»¤è¡Œé€‰é¡¹ã€‚æœ‰è¿‡ç±» Unix ç³»ç»Ÿä½¿ç”¨ç»éªŒçš„ç«¥é‹å¯¹å‘½ä»¤è¡Œé€‰é¡¹åº”è¯¥ä¸é™Œç”Ÿã€‚ä¾‹å¦‚å‘½ä»¤ls -alåˆ—å‡ºå½“å‰ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•çš„è¯¦ç»†ä¿¡æ¯ï¼Œå…¶ä¸­-alå°±æ˜¯å‘½ä»¤è¡Œé€‰é¡¹ã€‚\nå‘½ä»¤è¡Œé€‰é¡¹åœ¨å®é™…å¼€å‘ä¸­å¾ˆå¸¸ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨å†™å·¥å…·çš„æ—¶å€™ã€‚\næŒ‡å®šé…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œå¦‚redis-server ./redis.confä»¥å½“å‰ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶redis.confå¯åŠ¨ Redis æœåŠ¡å™¨ï¼› è‡ªå®šä¹‰æŸäº›å‚æ•°ï¼Œå¦‚python -m SimpleHTTPServer 8080å¯åŠ¨ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œç›‘å¬ 8080 ç«¯å£ã€‚å¦‚æœä¸æŒ‡å®šï¼Œåˆ™é»˜è®¤ç›‘å¬ 8000 ç«¯å£ã€‚ # å¿«é€Ÿä½¿ç”¨ å­¦ä¹ ä¸€ä¸ªåº“çš„ç¬¬ä¸€æ­¥å½“ç„¶æ˜¯ä½¿ç”¨å®ƒã€‚æˆ‘ä»¬å…ˆçœ‹çœ‹flagåº“çš„åŸºæœ¬ä½¿ç”¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;flag\u0026#34; ) var ( intflag int boolflag bool stringflag string ) func init() { flag.IntVar(\u0026amp;intflag, \u0026#34;intflag\u0026#34;, 0, \u0026#34;int flag value\u0026#34;) flag.BoolVar(\u0026amp;boolflag, \u0026#34;boolflag\u0026#34;, false, \u0026#34;bool flag value\u0026#34;) flag.StringVar(\u0026amp;stringflag, \u0026#34;stringflag\u0026#34;, \u0026#34;default\u0026#34;, \u0026#34;string flag value\u0026#34;) } func main() { flag.Parse() fmt.Println(\u0026#34;int flag:\u0026#34;, intflag) fmt.Println(\u0026#34;bool flag:\u0026#34;, boolflag) fmt.Println(\u0026#34;string flag:\u0026#34;, stringflag) } å¯ä»¥å…ˆç¼–è¯‘ç¨‹åºï¼Œç„¶åè¿è¡Œï¼ˆæˆ‘ä½¿ç”¨çš„æ˜¯ Win10 + Git Bashï¼‰ï¼š\n1 2 $ go build -o main.exe main.go $ ./main.exe -intflag 12 -boolflag 1 -stringflag test è¾“å‡ºï¼š\n1 2 3 int flag: 12 bool flag: true string flag: test å¦‚æœä¸è®¾ç½®æŸä¸ªé€‰é¡¹ï¼Œç›¸åº”å˜é‡ä¼šå–é»˜è®¤å€¼ï¼š\n1 $ ./main.exe -intflag 12 -boolflag 1 è¾“å‡ºï¼š\n1 2 3 int flag: 12 bool flag: true string flag: default å¯ä»¥çœ‹åˆ°æ²¡æœ‰è®¾ç½®çš„é€‰é¡¹stringflagä¸ºé»˜è®¤å€¼defaultã€‚\nè¿˜å¯ä»¥ç›´æ¥ä½¿ç”¨go runï¼Œè¿™ä¸ªå‘½ä»¤ä¼šå…ˆç¼–è¯‘ç¨‹åºç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œç„¶åæ‰§è¡Œè¯¥æ–‡ä»¶ï¼Œå°†å‘½ä»¤è¡Œä¸­çš„å…¶å®ƒé€‰é¡¹ä¼ ç»™è¿™ä¸ªç¨‹åºã€‚\n1 go run main.go -intflag 12 -boolflag 1 å¯ä»¥ä½¿ç”¨-hæ˜¾ç¤ºé€‰é¡¹å¸®åŠ©ä¿¡æ¯ï¼š\n1 2 3 4 5 6 7 8 $ ./main.exe -h Usage of D:\\code\\golang\\src\\github.com\\darjun\\cmd\\flag\\main.exe: -boolflag bool flag value -intflag int int flag value -stringflag string string flag value (default \u0026#34;default\u0026#34;) æ€»ç»“ä¸€ä¸‹ï¼Œä½¿ç”¨flagåº“çš„ä¸€èˆ¬æ­¥éª¤ï¼š\nå®šä¹‰ä¸€äº›å…¨å±€å˜é‡å­˜å‚¨é€‰é¡¹çš„å€¼ï¼Œå¦‚è¿™é‡Œçš„intflag/boolflag/stringflagï¼› åœ¨initæ–¹æ³•ä¸­ä½¿ç”¨flag.TypeVaræ–¹æ³•å®šä¹‰é€‰é¡¹ï¼Œè¿™é‡Œçš„Typeå¯ä»¥ä¸ºåŸºæœ¬ç±»å‹Int/Uint/Float64/Boolï¼Œè¿˜å¯ä»¥æ˜¯æ—¶é—´é—´éš”time.Durationã€‚å®šä¹‰æ—¶ä¼ å…¥å˜é‡çš„åœ°å€ã€é€‰é¡¹åã€é»˜è®¤å€¼å’Œå¸®åŠ©ä¿¡æ¯ï¼› åœ¨mainæ–¹æ³•ä¸­è°ƒç”¨flag.Parseä»os.Args[1:]ä¸­è§£æé€‰é¡¹ã€‚å› ä¸ºos.Args[0]ä¸ºå¯æ‰§è¡Œç¨‹åºè·¯å¾„ï¼Œä¼šè¢«å‰”é™¤ã€‚ æ³¨æ„ç‚¹ï¼š\nflag.Parseæ–¹æ³•å¿…é¡»åœ¨æ‰€æœ‰é€‰é¡¹éƒ½å®šä¹‰ä¹‹åè°ƒç”¨ï¼Œä¸”flag.Parseè°ƒç”¨ä¹‹åä¸èƒ½å†å®šä¹‰é€‰é¡¹ã€‚å¦‚æœæŒ‰ç…§å‰é¢çš„æ­¥éª¤ï¼ŒåŸºæœ¬ä¸ä¼šå‡ºç°é—®é¢˜ã€‚ å› ä¸ºinitåœ¨æ‰€æœ‰ä»£ç ä¹‹å‰æ‰§è¡Œï¼Œå°†é€‰é¡¹å®šä¹‰éƒ½æ”¾åœ¨initä¸­ï¼Œmainå‡½æ•°ä¸­æ‰§è¡Œflag.Parseæ—¶æ‰€æœ‰é€‰é¡¹éƒ½å·²ç»å®šä¹‰äº†ã€‚\n# é€‰é¡¹æ ¼å¼ flagåº“æ”¯æŒä¸‰ç§å‘½ä»¤è¡Œé€‰é¡¹æ ¼å¼ã€‚\n1 2 3 -flag -flag=x -flag x -å’Œ--éƒ½å¯ä»¥ä½¿ç”¨ï¼Œå®ƒä»¬çš„ä½œç”¨æ˜¯ä¸€æ ·çš„ã€‚æœ‰äº›åº“ä½¿ç”¨-è¡¨ç¤ºçŸ­é€‰é¡¹ï¼Œ--è¡¨ç¤ºé•¿é€‰é¡¹ã€‚ç›¸å¯¹è€Œè¨€ï¼Œflagä½¿ç”¨èµ·æ¥æ›´ç®€å•ã€‚\nç¬¬ä¸€ç§å½¢å¼åªæ”¯æŒå¸ƒå°”ç±»å‹çš„é€‰é¡¹ï¼Œå‡ºç°å³ä¸ºtrueï¼Œä¸å‡ºç°ä¸ºé»˜è®¤å€¼ã€‚ ç¬¬ä¸‰ç§å½¢å¼ä¸æ”¯æŒå¸ƒå°”ç±»å‹çš„é€‰é¡¹ã€‚å› ä¸ºè¿™ç§å½¢å¼çš„å¸ƒå°”é€‰é¡¹åœ¨ç±» Unix ç³»ç»Ÿä¸­å¯èƒ½ä¼šå‡ºç°æ„æƒ³ä¸åˆ°çš„è¡Œä¸ºã€‚çœ‹ä¸‹é¢çš„å‘½ä»¤ï¼š\n1 cmd -x * å…¶ä¸­ï¼Œ*æ˜¯ shell é€šé…ç¬¦ã€‚å¦‚æœæœ‰åå­—ä¸º 0ã€falseçš„æ–‡ä»¶ï¼Œå¸ƒå°”é€‰é¡¹-xå°†ä¼šå–falseã€‚åä¹‹ï¼Œå¸ƒå°”é€‰é¡¹-xå°†ä¼šå–trueã€‚è€Œä¸”è¿™ä¸ªé€‰é¡¹æ¶ˆè€—äº†ä¸€ä¸ªå‚æ•°ã€‚ å¦‚æœè¦æ˜¾ç¤ºè®¾ç½®ä¸€ä¸ªå¸ƒå°”é€‰é¡¹ä¸ºfalseï¼Œåªèƒ½ä½¿ç”¨-flag=falseè¿™ç§å½¢å¼ã€‚\né‡åˆ°ç¬¬ä¸€ä¸ªéé€‰é¡¹å‚æ•°ï¼ˆå³ä¸æ˜¯ä»¥-å’Œ--å¼€å¤´çš„ï¼‰æˆ–ç»ˆæ­¢ç¬¦--ï¼Œè§£æåœæ­¢ã€‚è¿è¡Œä¸‹é¢ç¨‹åºï¼š\n1 $ ./main.exe noflag -intflag 12 å°†ä¼šè¾“å‡ºï¼š\n1 2 3 int flag: 0 bool flag: false string flag: default å› ä¸ºè§£æé‡åˆ°noflagå°±åœæ­¢äº†ï¼Œåé¢çš„é€‰é¡¹-intflagæ²¡æœ‰è¢«è§£æåˆ°ã€‚æ‰€ä»¥æ‰€æœ‰é€‰é¡¹éƒ½å–çš„é»˜è®¤å€¼ã€‚\nè¿è¡Œä¸‹é¢çš„ç¨‹åºï¼š\n1 $ ./main.exe -intflag 12 -- -boolflag=true å°†ä¼šè¾“å‡ºï¼š\n1 2 3 int flag: 12 bool flag: false string flag: default é¦–å…ˆè§£æäº†é€‰é¡¹intflagï¼Œè®¾ç½®å…¶å€¼ä¸º 12ã€‚é‡åˆ°--åè§£æç»ˆæ­¢äº†ï¼Œåé¢çš„--boolflag=trueæ²¡æœ‰è¢«è§£æåˆ°ï¼Œæ‰€ä»¥boolflagé€‰é¡¹å–é»˜è®¤å€¼falseã€‚\nè§£æç»ˆæ­¢ä¹‹åå¦‚æœè¿˜æœ‰å‘½ä»¤è¡Œå‚æ•°ï¼Œflagåº“ä¼šå­˜å‚¨ä¸‹æ¥ï¼Œé€šè¿‡flag.Argsæ–¹æ³•è¿”å›è¿™äº›å‚æ•°çš„åˆ‡ç‰‡ã€‚ å¯ä»¥é€šè¿‡flag.NArgæ–¹æ³•è·å–æœªè§£æçš„å‚æ•°æ•°é‡ï¼Œflag.Arg(i)è®¿é—®ä½ç½®iï¼ˆä» 0 å¼€å§‹ï¼‰ä¸Šçš„å‚æ•°ã€‚ é€‰é¡¹ä¸ªæ•°ä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨flag.NFlagæ–¹æ³•è·å–ã€‚\nç¨ç¨ä¿®æ”¹ä¸€ä¸‹ä¸Šé¢çš„ç¨‹åºï¼š\n1 2 3 4 5 6 7 8 9 10 11 func main() { flag.Parse() fmt.Println(flag.Args()) fmt.Println(\u0026#34;Non-Flag Argument Count:\u0026#34;, flag.NArg()) for i := 0; i \u0026lt; flag.NArg(); i++ { fmt.Printf(\u0026#34;Argument %d: %s\\n\u0026#34;, i, flag.Arg(i)) } fmt.Println(\u0026#34;Flag Count:\u0026#34;, flag.NFlag()) } ç¼–è¯‘è¿è¡Œè¯¥ç¨‹åºï¼š\n1 2 $ go build -o main.exe main.go $ ./main.exe -intflag 12 -- -stringflag test è¾“å‡ºï¼š\n1 2 3 4 [-stringflag test] Non-Flag Argument Count: 2 Argument 0: -stringflag Argument 1: test è§£æé‡åˆ°--ç»ˆæ­¢åï¼Œå‰©ä½™å‚æ•°-stringflag testä¿å­˜åœ¨flagä¸­ï¼Œå¯ä»¥é€šè¿‡Args/NArg/Argç­‰æ–¹æ³•è®¿é—®ã€‚\næ•´æ•°é€‰é¡¹å€¼å¯ä»¥æ¥å— 1234ï¼ˆåè¿›åˆ¶ï¼‰ã€0664ï¼ˆå…«è¿›åˆ¶ï¼‰å’Œ 0x1234ï¼ˆåå…­è¿›åˆ¶ï¼‰çš„å½¢å¼ï¼Œå¹¶ä¸”å¯ä»¥æ˜¯è´Ÿæ•°ã€‚å®é™…ä¸Šflagåœ¨å†…éƒ¨ä½¿ç”¨strconv.ParseIntæ–¹æ³•å°†å­—ç¬¦ä¸²è§£ææˆintã€‚ æ‰€ä»¥ç†è®ºä¸Šï¼ŒParseIntæ¥å—çš„æ ¼å¼éƒ½å¯ä»¥ã€‚\nå¸ƒå°”ç±»å‹çš„é€‰é¡¹å€¼å¯ä»¥ä¸ºï¼š\nå–å€¼ä¸ºtrueçš„ï¼š1ã€tã€Tã€trueã€TRUEã€Trueï¼› å–å€¼ä¸ºfalseçš„ï¼š0ã€fã€Fã€falseã€FALSEã€Falseã€‚ # å¦ä¸€ç§å®šä¹‰é€‰é¡¹çš„æ–¹å¼ ä¸Šé¢æˆ‘ä»¬ä»‹ç»äº†ä½¿ç”¨flag.TypeVarå®šä¹‰é€‰é¡¹ï¼Œè¿™ç§æ–¹å¼éœ€è¦æˆ‘ä»¬å…ˆå®šä¹‰å˜é‡ï¼Œç„¶åå˜é‡çš„åœ°å€ã€‚ è¿˜æœ‰ä¸€ç§æ–¹å¼ï¼Œè°ƒç”¨flag.Typeï¼ˆå…¶ä¸­Typeå¯ä»¥ä¸ºInt/Uint/Bool/Float64/String/Durationç­‰ï¼‰ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬åˆ†é…å˜é‡ï¼Œè¿”å›è¯¥å˜é‡çš„åœ°å€ã€‚ç”¨æ³•ä¸å‰ä¸€ç§æ–¹å¼ç±»ä¼¼ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;flag\u0026#34; ) var ( intflag *int boolflag *bool stringflag *string ) func init() { intflag = flag.Int(\u0026#34;intflag\u0026#34;, 0, \u0026#34;int flag value\u0026#34;) boolflag = flag.Bool(\u0026#34;boolflag\u0026#34;, false, \u0026#34;bool flag value\u0026#34;) stringflag = flag.String(\u0026#34;stringflag\u0026#34;, \u0026#34;default\u0026#34;, \u0026#34;string flag value\u0026#34;) } func main() { flag.Parse() fmt.Println(\u0026#34;int flag:\u0026#34;, *intflag) fmt.Println(\u0026#34;bool flag:\u0026#34;, *boolflag) fmt.Println(\u0026#34;string flag:\u0026#34;, *stringflag) } ç¼–è¯‘å¹¶è¿è¡Œç¨‹åºï¼š\n1 2 $ go build -o main.exe main.go $ ./main.exe -intflag 12 å°†è¾“å‡ºï¼š\n1 2 3 int flag: 12 bool flag: false string flag: default é™¤äº†ä½¿ç”¨æ—¶éœ€è¦è§£å¼•ç”¨ï¼Œå…¶å®ƒä¸å‰ä¸€ç§æ–¹å¼åŸºæœ¬ç›¸åŒã€‚\n# é«˜çº§ç”¨æ³• # å®šä¹‰çŸ­é€‰é¡¹ flagåº“å¹¶æ²¡æœ‰æ˜¾ç¤ºæ”¯æŒçŸ­é€‰é¡¹ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ç»™æŸä¸ªç›¸åŒçš„å˜é‡è®¾ç½®ä¸åŒçš„é€‰é¡¹æ¥å®ç°ã€‚å³ä¸¤ä¸ªé€‰é¡¹å…±äº«åŒä¸€ä¸ªå˜é‡ã€‚ ç”±äºåˆå§‹åŒ–é¡ºåºä¸ç¡®å®šï¼Œå¿…é¡»ä¿è¯å®ƒä»¬æ‹¥æœ‰ç›¸åŒçš„é»˜è®¤å€¼ã€‚å¦åˆ™ä¸ä¼ è¯¥é€‰é¡¹æ—¶ï¼Œè¡Œä¸ºæ˜¯ä¸ç¡®å®šçš„ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;flag\u0026#34; ) var logLevel string func init() { const ( defaultLogLevel = \u0026#34;DEBUG\u0026#34; usage = \u0026#34;set log level value\u0026#34; ) flag.StringVar(\u0026amp;logLevel, \u0026#34;log_type\u0026#34;, defaultLogLevel, usage) flag.StringVar(\u0026amp;logLevel, \u0026#34;l\u0026#34;, defaultLogLevel, usage + \u0026#34;(shorthand)\u0026#34;) } func main() { flag.Parse() fmt.Println(\u0026#34;log level:\u0026#34;, logLevel) } ç¼–è¯‘ã€è¿è¡Œç¨‹åºï¼š\n1 2 3 $ go build -o main.exe main.go $ ./main.exe -log_type WARNING $ ./main.exe -l WARNING ä½¿ç”¨é•¿ã€çŸ­é€‰é¡¹å‡è¾“å‡ºï¼š\n1 log level: WARNING ä¸ä¼ å…¥è¯¥é€‰é¡¹ï¼Œè¾“å‡ºé»˜è®¤å€¼ï¼š\n1 2 $ ./main.exe log level: DEBUG # è§£ææ—¶é—´é—´éš” é™¤äº†èƒ½ä½¿ç”¨åŸºæœ¬ç±»å‹ä½œä¸ºé€‰é¡¹ï¼Œflagåº“è¿˜æ”¯æŒtime.Durationç±»å‹ï¼Œå³æ—¶é—´é—´éš”ã€‚æ—¶é—´é—´éš”æ”¯æŒçš„æ ¼å¼éå¸¸ä¹‹å¤šï¼Œä¾‹å¦‚\u0026quot;300ms\u0026quot;ã€\u0026quot;-1.5h\u0026quot;ã€â€œ2h45m\u0026quot;ç­‰ç­‰ç­‰ç­‰ã€‚ æ—¶é—´å•ä½å¯ä»¥æ˜¯ ns/us/ms/s/m/h/day ç­‰ã€‚å®é™…ä¸Šflagå†…éƒ¨ä¼šè°ƒç”¨time.ParseDurationã€‚å…·ä½“æ”¯æŒçš„æ ¼å¼å¯ä»¥å‚è§timeï¼ˆéœ€fqï¼‰åº“çš„æ–‡æ¡£ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 package main import ( \u0026#34;flag\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;time\u0026#34; ) var ( period time.Duration ) func init() { flag.DurationVar(\u0026amp;period, \u0026#34;period\u0026#34;, 1*time.Second, \u0026#34;sleep period\u0026#34;) } func main() { flag.Parse() fmt.Printf(\u0026#34;Sleeping for %v...\u0026#34;, period) time.Sleep(period) fmt.Println() } æ ¹æ®ä¼ å…¥çš„å‘½ä»¤è¡Œé€‰é¡¹periodï¼Œç¨‹åºç¡çœ ç›¸åº”çš„æ—¶é—´ï¼Œé»˜è®¤ 1 ç§’ã€‚ç¼–è¯‘ã€è¿è¡Œç¨‹åºï¼š\n1 2 3 4 5 6 $ go build -o main.exe main.go $ ./main.exe Sleeping for 1s... $ ./main.exe -period 1m30s Sleeping for 1m30s... # è‡ªå®šä¹‰é€‰é¡¹ é™¤äº†ä½¿ç”¨flagåº“æä¾›çš„é€‰é¡¹ç±»å‹ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰é€‰é¡¹ç±»å‹ã€‚æˆ‘ä»¬åˆ†æä¸€ä¸‹æ ‡å‡†åº“ä¸­æä¾›çš„æ¡ˆä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 package main import ( \u0026#34;errors\u0026#34; \u0026#34;flag\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;strings\u0026#34; \u0026#34;time\u0026#34; ) type interval []time.Duration func (i *interval) String() string { return fmt.Sprint(*i) } func (i *interval) Set(value string) error { if len(*i) \u0026gt; 0 { return errors.New(\u0026#34;interval flag already set\u0026#34;) } for _, dt := range strings.Split(value, \u0026#34;,\u0026#34;) { duration, err := time.ParseDuration(dt) if err != nil { return err } *i = append(*i, duration) } return nil } var ( intervalFlag interval ) func init() { flag.Var(\u0026amp;intervalFlag, \u0026#34;deltaT\u0026#34;, \u0026#34;comma-seperated list of intervals to use between events\u0026#34;) } func main() { flag.Parse() fmt.Println(intervalFlag) } é¦–å…ˆå®šä¹‰ä¸€ä¸ªæ–°ç±»å‹ï¼Œè¿™é‡Œå®šä¹‰ç±»å‹intervalã€‚\næ–°ç±»å‹å¿…é¡»å®ç°flag.Valueæ¥å£ï¼š\n1 2 3 4 5 // src/flag/flag.go type Value interface { String() string Set(string) error } å…¶ä¸­Stringæ–¹æ³•æ ¼å¼åŒ–è¯¥ç±»å‹çš„å€¼ï¼Œflag.Parseæ–¹æ³•åœ¨æ‰§è¡Œæ—¶é‡åˆ°è‡ªå®šä¹‰ç±»å‹çš„é€‰é¡¹ä¼šå°†é€‰é¡¹å€¼ä½œä¸ºå‚æ•°è°ƒç”¨è¯¥ç±»å‹å˜é‡çš„Setæ–¹æ³•ã€‚ è¿™é‡Œå°†ä»¥,åˆ†éš”çš„æ—¶é—´é—´éš”è§£æå‡ºæ¥å­˜å…¥ä¸€ä¸ªåˆ‡ç‰‡ä¸­ã€‚\nè‡ªå®šä¹‰ç±»å‹é€‰é¡¹çš„å®šä¹‰å¿…é¡»ä½¿ç”¨flag.Varæ–¹æ³•ã€‚\nç¼–è¯‘ã€æ‰§è¡Œç¨‹åºï¼š\n1 2 3 4 5 $ go build -o main.exe main.go $ ./main.exe -deltaT 30s [30s] $ ./main.exe -deltaT 30s,1m,1m30s [30s 1m0s 1m30s] å¦‚æœæŒ‡å®šçš„é€‰é¡¹å€¼éæ³•ï¼ŒSetæ–¹æ³•è¿”å›ä¸€ä¸ªerrorç±»å‹çš„å€¼ï¼ŒParseæ‰§è¡Œç»ˆæ­¢ï¼Œæ‰“å°é”™è¯¯å’Œä½¿ç”¨å¸®åŠ©ã€‚\n1 2 3 4 5 $ ./main.exe -deltaT 30x invalid value \u0026#34;30x\u0026#34; for flag -deltaT: time: unknown unit x in duration 30x Usage of D:\\code\\golang\\src\\github.com\\darjun\\go-daily-lib\\flag\\self-defined\\main.exe: -deltaT value comma-seperated list of intervals to use between events # è§£æç¨‹åºä¸­çš„å­—ç¬¦ä¸² æœ‰æ—¶å€™é€‰é¡¹å¹¶ä¸æ˜¯é€šè¿‡å‘½ä»¤è¡Œä¼ é€’çš„ã€‚ä¾‹å¦‚ï¼Œä»é…ç½®è¡¨ä¸­è¯»å–æˆ–ç¨‹åºç”Ÿæˆçš„ã€‚è¿™æ—¶å€™å¯ä»¥ä½¿ç”¨flag.FlagSetç»“æ„çš„ç›¸å…³æ–¹æ³•æ¥è§£æè¿™äº›é€‰é¡¹ã€‚\nå®é™…ä¸Šï¼Œæˆ‘ä»¬å‰é¢è°ƒç”¨çš„flagåº“çš„æ–¹æ³•ï¼Œéƒ½ä¼šé—´æ¥è°ƒç”¨FlagSetç»“æ„çš„æ–¹æ³•ã€‚flagåº“ä¸­å®šä¹‰äº†ä¸€ä¸ªFlagSetç±»å‹çš„å…¨å±€å˜é‡CommandLineä¸“é—¨ç”¨äºè§£æå‘½ä»¤è¡Œé€‰é¡¹ã€‚ å‰é¢è°ƒç”¨çš„flagåº“çš„æ–¹æ³•åªæ˜¯ä¸ºäº†æä¾›ä¾¿åˆ©ï¼Œå®ƒä»¬å†…éƒ¨éƒ½æ˜¯è°ƒç”¨çš„CommandLineçš„ç›¸åº”æ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 // src/flag/flag.go var CommandLine = NewFlagSet(os.Args[0], ExitOnError) func Parse() { CommandLine.Parse(os.Args[1:]) } func IntVar(p *int, name string, value int, usage string) { CommandLine.Var(newIntValue(value, p), name, usage) } func Int(name string, value int, usage string) *int { return CommandLine.Int(name, value, usage) } func NFlag() int { return len(CommandLine.actual) } func Arg(i int) string { return CommandLine.Arg(i) } func NArg() int { return len(CommandLine.args) } åŒæ ·çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±åˆ›å»ºFlagSetç±»å‹å˜é‡æ¥è§£æé€‰é¡¹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 package main import ( \u0026#34;flag\u0026#34; \u0026#34;fmt\u0026#34; ) func main() { args := []string{\u0026#34;-intflag\u0026#34;, \u0026#34;12\u0026#34;, \u0026#34;-stringflag\u0026#34;, \u0026#34;test\u0026#34;} var intflag int var boolflag bool var stringflag string fs := flag.NewFlagSet(\u0026#34;MyFlagSet\u0026#34;, flag.ContinueOnError) fs.IntVar(\u0026amp;intflag, \u0026#34;intflag\u0026#34;, 0, \u0026#34;int flag value\u0026#34;) fs.BoolVar(\u0026amp;boolflag, \u0026#34;boolflag\u0026#34;, false, \u0026#34;bool flag value\u0026#34;) fs.StringVar(\u0026amp;stringflag, \u0026#34;stringflag\u0026#34;, \u0026#34;default\u0026#34;, \u0026#34;string flag value\u0026#34;) fs.Parse(args) fmt.Println(\u0026#34;int flag:\u0026#34;, intflag) fmt.Println(\u0026#34;bool flag:\u0026#34;, boolflag) fmt.Println(\u0026#34;string flag:\u0026#34;, stringflag) } NewFlagSetæ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç¨‹åºåç§°ï¼Œè¾“å‡ºå¸®åŠ©æˆ–å‡ºé”™æ—¶ä¼šæ˜¾ç¤ºè¯¥ä¿¡æ¯ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯è§£æå‡ºé”™æ—¶å¦‚ä½•å¤„ç†ï¼Œæœ‰å‡ ä¸ªé€‰é¡¹ï¼š\nContinueOnErrorï¼šå‘ç”Ÿé”™è¯¯åç»§ç»­è§£æï¼ŒCommandLineå°±æ˜¯ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ï¼› ExitOnErrorï¼šå‡ºé”™æ—¶è°ƒç”¨os.Exit(2)é€€å‡ºç¨‹åºï¼› PanicOnErrorï¼šå‡ºé”™æ—¶äº§ç”Ÿ panicã€‚ éšä¾¿çœ‹ä¸€çœ¼flagåº“ä¸­çš„ç›¸å…³ä»£ç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 // src/flag/flag.go func (f *FlagSet) Parse(arguments []string) error { f.parsed = true f.args = arguments for { seen, err := f.parseOne() if seen { continue } if err == nil { break } switch f.errorHandling { case ContinueOnError: return err case ExitOnError: os.Exit(2) case PanicOnError: panic(err) } } return nil } ä¸ç›´æ¥ä½¿ç”¨flagåº“çš„æ–¹æ³•æœ‰ä¸€ç‚¹ä¸åŒï¼ŒFlagSetè°ƒç”¨Parseæ–¹æ³•æ—¶éœ€è¦æ˜¾ç¤ºä¼ å…¥å­—ç¬¦ä¸²åˆ‡ç‰‡ä½œä¸ºå‚æ•°ã€‚å› ä¸ºflag.Parseåœ¨å†…éƒ¨è°ƒç”¨äº†CommandLine.Parse(os.Args[1:])ã€‚ ç¤ºä¾‹ä»£ç éƒ½æ”¾åœ¨GitHubä¸Šäº†ã€‚\n# å‚è€ƒ flagåº“æ–‡æ¡£ Go æ¯æ—¥ä¸€åº“ä¹‹ flag æ·±å…¥æ¢ç©¶ Go flag æ ‡å‡†åº“é™„æºç åˆ†æ ","date":"2024-04-22T18:02:17+08:00","permalink":"https://arlettebrook.github.io/p/go-flag%E5%BA%93%E4%BB%8B%E7%BB%8D/","title":"Go flagåº“ä»‹ç»"},{"content":" # é™æ€ç½‘é¡µç”Ÿæˆå™¨ æ— è®ºæ‚¨éœ€è¦æ­å»ºä¸ªäººåšå®¢è¿˜æ˜¯ä¸ºæ‚¨çš„é¡¹ç›®åˆ›å»ºæ–‡æ¡£ï¼Œé™æ€ç½‘é¡µç”Ÿæˆå™¨ï¼ˆstatic site generatorï¼‰éƒ½æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚æ— éœ€æœåŠ¡å™¨ã€æ•°æ®åº“ï¼Œåªè¦ä½ ç†Ÿæ‚‰ Markdownï¼Œå–œæ¬¢GitHubï¼Œä½¿ç”¨ç”Ÿæˆå™¨åˆ›å»ºé™æ€ HTML æ–‡ä»¶ï¼Œç„¶åæ¨é€åˆ° GitHub Pages ç­‰å…è´¹æœåŠ¡å³å¯ã€‚\n# å¸¸è§çš„é™æ€ç½‘é¡µç”Ÿæˆå™¨ Hugoæ˜¯ç”±Goè¯­è¨€å®ç°çš„é™æ€ç½‘ç«™ç”Ÿæˆå™¨ã€‚ç®€å•ã€æ˜“ç”¨ã€é«˜æ•ˆã€æ˜“æ‰©å±•ã€å¿«é€Ÿéƒ¨ç½²ã€‚ jekyll æ˜¯ä¸€ä¸ªé™æ€ç½‘é¡µã€åšå®¢ç”Ÿæˆå™¨ vuepressæ˜¯åŸºäº Vue çš„é™æ€ç½‘é¡µç”Ÿæˆå™¨ Hexo æ˜¯ä¸€ä¸ªç”±Nodejsé©±åŠ¨çš„å¿«é€Ÿã€ç®€æ´ä¸”é«˜æ•ˆçš„åšå®¢æ¡†æ¶ã€‚Hexo ä½¿ç”¨ Markdownï¼ˆæˆ–å…¶ä»–æ¸²æŸ“å¼•æ“ï¼‰è§£ææ–‡ç« ï¼Œåœ¨å‡ ç§’å†…ï¼Œå³å¯åˆ©ç”¨é“ä¸½çš„ä¸»é¢˜ç”Ÿæˆé™æ€ç½‘é¡µã€‚ å‚è€ƒï¼šé™æ€ç½‘é¡µç”Ÿæˆå™¨\n# å¿«é€Ÿä½¿ç”¨Hugoæ­å»ºä¸ªäººåšå®¢ç«™ç‚¹ # å®‰è£…Hugo æ ¹æ®è‡ªå·±çš„æ“ä½œç³»ç»Ÿï¼Œä¸‹è½½å·²ç»æ„å»ºå¥½çš„HugoäºŒè¿›åˆ¶æ–‡ä»¶å®˜æ–¹åœ°å€\nå®˜æ–¹æ¨èä¸‹è½½æ‰©å±•ç‰ˆï¼Œæ”¯æŒçš„åŠŸèƒ½æ›´å¤š è§£å‹ä¹‹åï¼Œå°†hugoå¯æ‰§è¡Œæ–‡ä»¶åŠ å…¥åˆ°PATHç¯å¢ƒå˜é‡ä¸­ï¼Œå³å¯ä½¿ç”¨\n1 2 3 hugo version # æŸ¥çœ‹ç‰ˆæœ¬ï¼Œæ‰©å±•ç‰ˆå«è¿™ä¸ªextendedæ ‡ç­¾ hugo -h # æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ hugo subcommand -h # è·å–å­å‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯ # ä½¿ç”¨Hugo hugoéœ€è¦é…åˆgitä¸€èµ·ä½¿ç”¨ï¼Œå¹¶ä¸”å®˜æ–¹æ¨èä½¿ç”¨bashä½œä¸ºç»ˆç«¯\nåˆ›å»ºé¡¹ç›®å¹¶å®‰è£…ä¸»é¢˜hugo-theme-stack\n1 2 3 4 5 hugo new site quickstart # åˆ›å»ºç›®å½•ç»“æ„ cd quickstart git init git submodule add https://github.com/CaiJimmy/hugo-theme-stack/ themes/hugo-theme-stack # å®‰è£…ä¸»é¢˜ æ·»åŠ å†…å®¹å¹¶ä½¿ç”¨å®‰è£…ä¸»é¢˜çš„é»˜è®¤é…ç½®\nä½¿ç”¨å®‰è£…ä¸»é¢˜çš„å®ä¾‹è¿›è¡Œå¿«é€Ÿæ·»åŠ å†…å®¹ åªéœ€è¦è¿›å…¥ä¸»é¢˜æ–‡ä»¶ä¸­çš„exampleSiteä¸­çš„contentæ‹·è´åˆ°quickstartæ ¹ç›®å½•ä¸­ åŒç†ï¼Œåœ¨ä¸»é¢˜æ–‡ä»¶ä¸­çš„exampleSiteä¸­çš„hugo.yamlæ‹·è´åˆ°quickstartæ ¹ç›®å½•ä¸­ï¼Œé‡å‘½åä¸º,å¹¶åˆ é™¤hugo.toml æœ€åè¿è¡Œ\n1 2 hugo server # æœ¬åœ°å¯åŠ¨ä¸€ä¸ªhttpæœåŠ¡å™¨ï¼Œä¾¿äºå¼€å‘å’Œæµ‹è¯•ç«™ç‚¹ï¼Œé»˜è®¤çƒ­æ›´æ–° hugo server --navigateToChanged # è‡ªåŠ¨é‡å®šå‘ï¼šç¼–è¾‘å†…å®¹æ—¶ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨é‡å®šå‘åˆ°ä¸Šæ¬¡ä¿®æ”¹çš„é¡µé¢ ä¼šä½¿ç”¨åˆ°çš„å‘½ä»¤\n1 2 3 4 5 6 7 8 9 10 11 hugo new content post/fist-post.md # ä¼šåœ¨contentç›®å½•ä¸‹åˆ›å»ºpost/fist-post.mdæ–‡ä»¶ # æ‰§è¡Œå®Œåï¼Œä¼šåœ¨content/postç›®å½•è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªMarkDownæ ¼å¼çš„first.mdæ–‡ä»¶ï¼š +++ date = \u0026#34;2015-01-08T08:36:54-07:00\u0026#34; draft = true title = \u0026#34;Fist Post\u0026#34; +++ # draft é»˜è®¤ä¸ºtrueï¼Œæ„å»ºç½‘ç«™æ—¶ä¸ä¼šæ„å»ºè¯¥æ–‡æ¡£ # è¦æ„å»ºè‰ç¨¿æ–‡æ¡£å¯ä»¥ç”¨-Dæˆ–--buildDraftsé€‰é¡¹å¯åŠ¨æœåŠ¡ hugo server -D # title é»˜è®¤ä¸ºæ–‡ä»¶åé¦–å­—æ¯å¤§å†™ æ„å»ºå‘½ä»¤\nè¿›å…¥é¡¹ç›®ç›®å½•ï¼Œè¿è¡Œ\n1 hugo hugoå‘½ä»¤ä¼šæ„å»ºç”Ÿæˆé™æ€æ–‡ä»¶ï¼Œä¼šå°†æ–‡ä»¶å‘å¸ƒé¡¹ç›®çš„publicç›®å½•ä¸‹\nè¦å°†ç«™ç‚¹å‘å¸ƒåˆ°å…¶ä»–ç›®å½•ï¼Œè¯·ä½¿ç”¨è¯¥æ ‡å¿—--destinationæˆ–åœ¨ç«™ç‚¹é…ç½®ä¸­è®¾ç½®publishDir\næ³¨æ„ï¼šæ¯æ¬¡æ„å»ºä¸ä¼šæ¸…ç©ºpublicç›®å½•ï¼Œåªä¼šè¦†ç›–æ—§å†…å®¹ã€‚\nè¿™æ ·åšæ˜¯ä¸ºäº†é˜²æ­¢ï¼Œæ„å»ºä¹‹ååœ¨publicæ·»åŠ çš„æ–‡ä»¶è¢«åˆ é™¤\nè‰ç¨¿ã€æœªæ¥å’Œè¿‡æœŸå†…å®¹\nHugo å…è®¸åœ¨å†…å®¹çš„å‰é¢è®¾ç½®draftã€dateã€publishDateå’ŒexpiryDateã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒHugo åœ¨ä»¥ä¸‹æƒ…å†µä¸‹ä¸ä¼šå‘å¸ƒå†…å®¹ï¼š\nå…¶draftå€¼ä¸ºtrue\næ˜¯dateåœ¨æœªæ¥\næ˜¯publishDateåœ¨æœªæ¥\nå·²ç»expiryDateè¿‡å»äº†\nä¸‹é¢çš„è¡Œä¸ºå¯ä»¥å–æ¶ˆ\n1 2 3 hugo --buildDrafts # or -D hugo --buildExpired # or -E hugo --buildFuture # or -F æ³¨æ„ï¼šå½“è¿™æ ·æ„å»ºä¹‹åï¼Œéœ€è¦æ‰‹åŠ¨åˆ é™¤ä¸æœŸæœ›æ„å»ºçš„æ–‡ä»¶ï¼Œåœ¨æ¨é€ç«™ç‚¹\nå¦åˆ™å½“æ¨é€åˆ°è¿œç¨‹ä¼šå‡ºç°æ„å¤–çš„å†…å®¹\næ‰€ä»¥å»ºè®®è¿è¡Œä¸Šé¢çš„å‘½ä»¤ä¹‹åï¼Œå‰æpublicä¸­æ²¡æœ‰æ‰‹åŠ¨æ·»åŠ çš„æ–‡ä»¶ï¼Œåœ¨æ„å»ºä¹‹å‰æ‰‹åŠ¨æ¸…ç©ºpublicç›®å½•ï¼Œé˜²æ­¢å‡ºç°è‰ç¨¿ã€è¿‡æœŸå’Œæœªæ¥çš„å†…å®¹\næœ€åå°†publicä¸­çš„æ‰€ä»¥æ–‡ä»¶æ¨é€åˆ°é™æ€ç½‘ç«™æ‰˜ç®¡å¹³å°å³å¯\nä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªåŠ¨æ„å»ºå’Œéƒ¨ç½² æ›´å¤šå†…å®¹å‚è€ƒï¼š\nä½¿ç”¨hugoæ­å»ºä¸ªäººåšå®¢ç«™ç‚¹ ï¼ˆ1ï¼‰å¸¦ç€Stackä¸»é¢˜å…¥å‘Hugo ï¼ˆ2ï¼‰éƒ¨ç½²ä½ çš„Hugoåšå®¢ ï¼ˆ3ï¼‰Stackä¸»é¢˜çš„è‡ªå®šä¹‰ è‡ªå®šä¹‰ä¸»é¢˜æ·»åŠ äº†assets/scssã€layouts/_default/ã€layouts/index.html,ä¸ç”¨äº†åˆ äº†å°±è¡Œ # ç›®å½•ç»“æ„ archetypesç›®å½•åŒ…å«æ–°å†…å®¹çš„æ¨¡æ¿\nç›®å½•ä¸‹çš„default.mdç”±æ ‡è®°ï¼ˆmarkdownï¼‰å’Œå†…å®¹æ ¼å¼\nå†…å®¹æ ¼å¼ï¼š\u0026mdash;yaml\u0026mdash;ã€+++toml+++ã€{json}\n1 2 3 4 5 --- # +++/{ date: \u0026#39;{{ .Date }}\u0026#39; # yaml draft: true title: \u0026#39;{{ replace .File.ContentBaseName `-` ` ` | title }}\u0026#39; --- # +++/{ å½“è¿è¡Œhugo new content post/my-first-post.mdå‘½ä»¤æ—¶ä¼šæ ¹æ®default.mdåˆ›å»ºå†…å®¹æ–‡ä»¶\n1 2 3 4 5 --- date: \u0026#34;2023-08-24T11:49:46-07:00\u0026#34; draft: true title: My First Post --- å¯ä»¥åˆ›å»ºæ–°å†…å®¹çš„æ¨¡ç‰ˆ\n1 2 3 archetypes/ â”œâ”€â”€ default.md â””â”€â”€ post.md è‹¥è¿è¡Œhugo new content post/my-first-post.mdæŸ¥æ‰¾æ¨¡ç‰ˆçš„é¡ºåº archetypes/post.md archetypes/default.md themes/my-theme/archetypes/post.md themes/my-theme/archetypes/default.md å¦‚æœè¿™äº›éƒ½ä¸å­˜åœ¨ï¼ŒHugo å°†ä½¿ç”¨å†…ç½®çš„é»˜è®¤åŸå‹ assetsç›®å½•åŒ…å«é€šå¸¸é€šè¿‡èµ„äº§ç®¡é“ä¼ é€’çš„å…¨å±€èµ„æºï¼ŒåŒ…æ‹¬å›¾åƒã€CSSã€Sassã€JavaScript å’Œ TypeScript ç­‰èµ„æºã€‚\nconfigç›®å½•åŒ…å«ç«™ç‚¹é…ç½®ï¼Œå¯èƒ½åˆ†ä¸ºå¤šä¸ªå­ç›®å½•å’Œæ–‡ä»¶ã€‚å¯¹äºå…·æœ‰æœ€å°‘é…ç½®çš„é¡¹ç›®æˆ–ä¸éœ€è¦åœ¨ä¸åŒç¯å¢ƒä¸­è¡¨ç°ä¸åŒçš„é¡¹ç›®ï¼Œhugo.tomlåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­å‘½åçš„å•ä¸ªé…ç½®æ–‡ä»¶å°±è¶³å¤Ÿäº†\ncontentç›®å½•åŒ…å«æ„æˆç«™ç‚¹å†…å®¹çš„æ ‡è®°æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯ Markdownï¼‰å’Œé¡µé¢èµ„æºã€‚\nå¯¹åº”stackä¸»é¢˜ï¼š postå­˜æ”¾å‘å¸ƒçš„æ–‡ç« æ ¼å¼md pageå­˜æ”¾å¯¼èˆªåŒºåŸŸçš„mdæ ¼å¼é…ç½® ä¸åŒçš„è¯­è¨€ç»“å°¾ç”¨.en.mdç­‰è¡¨ç¤º æ ¹æ®æ¨¡ç‰ˆè¿›è¡Œä¿®æ”¹å³å¯ï¼Œæ ¹æ®è‡ªå·±çš„éœ€æ±‚ï¼Œæ²¡æœ‰çš„éœ€è¦è‡ªå·±è¡¥å……å’Œä¿®æ”¹æ–‡ä»¶å†…å®¹ categorieså­˜æ”¾ç±»åˆ«çš„mdæ ¼å¼é…ç½® dataç›®å½•åŒ…å«å¢å¼ºå†…å®¹ã€é…ç½®ã€æœ¬åœ°åŒ–å’Œå¯¼èˆªçš„æ•°æ®æ–‡ä»¶ï¼ˆJSONã€TOMLã€YAML æˆ– XMLï¼‰ã€‚\ni18nç›®å½•åŒ…å«å¤šè¯­è¨€ç«™ç‚¹çš„ç¿»è¯‘è¡¨ã€‚\ncontentç›®å½•åŒ…å«å°†å†…å®¹ã€æ•°æ®å’Œèµ„æºè½¬æ¢ä¸ºå®Œæ•´ç½‘ç«™çš„æ¨¡æ¿ã€‚\npublicç›®å½•åŒ…å«è¿è¡Œhugoæˆ–hugo serverå‘½ä»¤æ—¶ç”Ÿæˆçš„å·²å‘å¸ƒç½‘ç«™ã€‚ Hugo æ ¹æ®éœ€è¦é‡æ–°åˆ›å»ºè¯¥ç›®å½•åŠå…¶å†…å®¹\nresourcesç›®å½•åŒ…å« Hugo èµ„äº§ç®¡é“çš„ç¼“å­˜è¾“å‡ºï¼Œè¿™äº›è¾“å‡ºæ˜¯åœ¨è¿è¡Œhugoæˆ–hugo serverå‘½ä»¤æ—¶ç”Ÿæˆçš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤ç¼“å­˜ç›®å½•åŒ…æ‹¬ CSS å’Œå›¾åƒã€‚ Hugo æ ¹æ®éœ€è¦é‡æ–°åˆ›å»ºè¯¥ç›®å½•åŠå…¶å†…å®¹ã€‚\nstaticç›®å½•åŒ…å«åœ¨æ‚¨æ„å»ºç«™ç‚¹æ—¶å°†å¤åˆ¶åˆ°å…¬å…±ç›®å½•çš„æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼šfavicon.icoã€robots.txtå’Œ éªŒè¯ç«™ç‚¹æ‰€æœ‰æƒçš„æ–‡ä»¶.ä¸assetså·®ä¸å¤š\nthemesç›®å½•åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªä¸»é¢˜ï¼Œæ¯ä¸ªä¸»é¢˜éƒ½ä½äºå…¶è‡ªå·±çš„å­ç›®å½•ä¸­ã€‚\nè”åˆæ–‡ä»¶ç³»ç»Ÿï¼š\nè¿™æ ·ç†è§£ï¼šå®‰è£…çš„ä¸»é¢˜é‡Œé¢åŒæ ·æœ‰è‡ªå·±ç«™ç‚¹çš„ç›®å½•ç»“æ„ï¼Œhugoæ„å»ºæ—¶ä¼šå°†ä¸»é¢˜é‡Œé¢çš„æ–‡ä»¶æŒ‚è½½åˆ°ç«™ç‚¹ï¼Œä¼˜å…ˆçº§æ˜¯ç«™ç‚¹çš„é«˜ # é…ç½®æ–‡ä»¶ hugoæ”¯æŒä¸‰ç§é…ç½®æ–‡ä»¶hugo.tomalã€hugo.yamlã€hugo.jsonï¼Œå–œæ¬¢ç”¨é‚£ä¸ªå°±ç”¨é‚£ä¸ªã€‚\næ¯ç§æ–‡ä»¶æ ¼å¼çš„è§„èŒƒï¼šTOMLã€YAMLå’ŒJSONã€‚\né…ç½®æ–‡ä»¶å¯ä»¥æœ‰å¤šä¸ªï¼Œå¯ä»¥æ”¾åˆ°configç›®å½•ä¸‹ï¼Œé»˜è®¤éƒ½æ˜¯ä½¿ç”¨hugoå¼€å¤´çš„æ–‡ä»¶\næŒ‡å®šé…ç½®æ–‡ä»¶æ„å»º\n1 2 hugo server --config other.toml hugo --config a.toml,b.yaml,c.json # å¯ä»¥æŒ‡å®šå¤šä¸ªï¼Œå·¦è¾¹çš„ä¼˜å…ˆçº§é«˜ æ›´å¤šå†…å®¹é…ç½®å‚è€ƒ\né¢å¤–çš„ä¸€äº›å…³äºé…ç½®æ–‡ä»¶çš„æ€»ç»“\né»˜è®¤è¯­è¨€ä¿®æ”¹ä¸ºzh-cnï¼Œæ„å‘³ç€index.mdè¡¨ç¤ºä¸­æ–‡ï¼Œindex.zh-cn.mdä¹Ÿè¡¨ç¤ºä¸­æ–‡ï¼Œæ­¤æ—¶çš„è‹±æ–‡è¦ç”¨index.en.mdè¡¨ç¤º æ›´å¤šå†…å®¹å‚è€ƒï¼š\nHugoå®˜æ–¹æ–‡æ¡£ Hugoä¸­æ–‡æ–‡æ¡£ Hugo theme # æ–‡ç« è¯„è®º ä½¿ç”¨Walineï¼Œå…¶æ•™ç¨‹å¾ˆå®Œæ•´ã€‚\næ ¹æ®Walineæ•™ç¨‹ä»å¤´å®Œæˆåˆ°ä½¿ç”¨Verceléƒ¨ç½²å®Œæˆã€‚\næœ€ååœ¨config.yamlä¸­çš„walineçš„serverURLç»™ä¸Šä½ çš„VercelæœåŠ¡å™¨åœ°å€ã€‚\nä»¥åŠå¼€å¯è¯„è®ºï¼Œæœ€åwalineè¿˜å¯ä»¥é…ç½®è¯„è®ºé€šçŸ¥æ¸ é“ã€‚\nå°†cloudflareè§£æçš„åŸŸåç»‘å®šåˆ°vercelæ–‡æ¡£ æ¦‚æ‹¬ï¼šæ·»åŠ ä¸€æ¡CNAMEè®°å½•å€¼ä¸ºcname.vercel-dns.comï¼Œå¼€å¯ä»£ç†ï¼Œå°†SSL/TLSä¿®æ”¹ä¸ºå®Œå…¨ å°†cloudflareè§£æçš„åŸŸåç»‘å®šåˆ°github-pagesæ–‡æ¡£ æ¦‚æ‹¬ï¼šæ·»åŠ ä¸€æ¡å­åŸŸï¼Œç±»å‹CNAMEè®°å½•å€¼ä¸ºusername.github.ioï¼Œå¼€å¯ä»£ç†ï¼Œå°†SSL/TLSä¿®æ”¹ä¸ºå®Œå…¨,usernameä¸ºä½ çš„ç”¨æˆ·å æ›´å¤šå†…å®¹è¯·æŸ¥é˜…æ–‡æ¡£ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 comments: enabled: true provider: waline waline: serverURL: url lang: zh-cn pageview: true copyright: false emoji: - https://unpkg.com/@waline/emojis@1.0.1/weibo requiredMeta: - name - email locale: admin: ğŸ‘»Hi! placeholder: ğŸ‰ç•™ä¸‹ä½ çš„è„šå°... # æœç´¢å¼•æ“ä¼˜åŒ–ï¼ˆSEOï¼‰ æœ¬ç½‘ç«™ä½¿ç”¨Hugoæ­å»ºï¼Œè€Œä¸”ä½¿ç”¨çš„stackä¸»é¢˜æ”¯æŒè‡ªåŠ¨ç”ŸæˆåŸºäºOpen Graphåè®®ï¼ˆOGåè®®ï¼‰çš„æ ‡ç­¾ï¼Œæ­¤å¤„è®°å½•ä¸€ä¸‹å¦‚ä½•åœ¨Hugoæ­å»ºçš„ç½‘ç«™ä¸­åšæœç´¢å¼•æ“ä¼˜åŒ–ï¼ˆSEOï¼‰ã€‚\nç›®çš„ï¼šæå‡ç½‘ç«™åœ¨æœç´¢å¼•æ“ä¸­çš„æ’å\nOpen Graphï¼ˆå¼€æ”¾å›¾è°±ï¼‰åè®®ï¼Œç®€ç§°OGåè®®ï¼Œæ˜¯Facebookåœ¨2010å¹´å…¬å¸ƒçš„ä¸€é¡¹åè®®ï¼Œç”¨æ¥æ ‡è®°ç½‘é¡µå†…å®¹ã€‚ç®€å•æ¥è®²ï¼ŒOGåè®®å°±æ˜¯åµŒåœ¨ç½‘é¡µå¤´éƒ¨çš„ä¸€äº›æ ‡ç­¾ï¼Œè¿™äº›æ ‡ç­¾æ ‡è®°äº†ç½‘é¡µçš„æ ‡é¢˜ã€æè¿°ç­‰ç‰¹å¾ï¼Œä½¿å¾—ç½‘é¡µæˆä¸ºä¸€ä¸ªâ€œå¯Œåª’ä½“å¯¹è±¡â€ï¼Œå¯ä»¥è¢«å…¶ä»–ç¤¾äº¤ç½‘ç«™å¼•ç”¨ã€‚\nå¾ˆå¤šæœç´¢å¼•æ“éƒ½æ”¯æŒOGåè®®ï¼Œåœ¨ç½‘é¡µä¸­ä½¿ç”¨OGåè®®çš„æ ‡ç­¾ï¼Œå°±æ›´æœ‰åˆ©äºæå‡æˆ‘ä»¬çš„ç½‘é¡µåœ¨æœç´¢å¼•æ“ä¸­çš„æ’åã€‚\nOGåè®®çš„æ ‡ç­¾åœ¨ç½‘é¡µä¸­é€šå¸¸è¡¨ç¤ºä¸ºç±»ä¼¼ä¸‹é¢æ‰€ç¤ºçš„æ ¼å¼ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 \u0026lt;meta property=\u0026#34;og:title\u0026#34; content=\u0026#34;The Rock\u0026#34; /\u0026gt; \u0026lt;meta property=\u0026#34;og:type\u0026#34; content=\u0026#34;video.movie\u0026#34; /\u0026gt; \u0026lt;meta property=\u0026#34;og:url\u0026#34; content=\u0026#34;https://www.imdb.com/title/tt0117500/\u0026#34; /\u0026gt; \u0026lt;meta property=\u0026#34;og:image\u0026#34; content=\u0026#34;https://ia.media-imdb.com/images/rock.jpg\u0026#34; /\u0026gt; \u0026lt;meta property=\u0026#39;og:url\u0026#39; content=\u0026#39;https://arlettebrook.github.io/search/\u0026#39;\u0026gt; \u0026lt;meta property=\u0026#39;og:site_name\u0026#39; content=\u0026#39;Arlettebrook\u0026amp;#39;s blog\u0026#39;\u0026gt; \u0026lt;meta property=\u0026#39;og:type\u0026#39; content=\u0026#39;article\u0026#39;\u0026gt;\u0026lt;meta property=\u0026#39;article:section\u0026#39; content=\u0026#39;P age\u0026#39; /\u0026gt; -\u0026lt;meta name=\u0026#34;twitter:title\u0026#34; content=\u0026#34;æœç´¢\u0026#34;\u0026gt; +\u0026lt;meta name=\u0026#34;twitter:site\u0026#34; content=\u0026#34;@arlettebrook\u0026#34;\u0026gt; + \u0026lt;meta name=\u0026#34;twitter:creator\u0026#34; content=\u0026#34;@arlettebrook\u0026#34;\u0026gt;\u0026lt;meta name=\u0026#34;twitter:title\u0026#34; co ntent=\u0026#34;æœç´¢\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;twitter:description\u0026#34; content=\u0026#34;\u0026#34;\u0026gt;\u0026lt;link rel=\u0026#34;alternate\u0026#34; type=\u0026#34;application/js on\u0026#34; href=\u0026#34;https://arlettebrook.github.io/search/index.json\u0026#34;\u0026gt; \u0026lt;link rel=\u0026#34;shortcut icon\u0026#34; href=\u0026#34;/img/favicon.ico\u0026#34; /\u0026gt; stackä¸»é¢˜æä¾›äº†å¯¹OGåè®®çš„æ”¯æŒï¼Œåªéœ€è¦åœ¨ç½‘ç«™æ ¹ç›®å½•ä¸‹çš„config/_default/params.en.yamlå’Œconfig/_default/params.zh-cn.yamlé…ç½®æ–‡ä»¶ä¸­å¼€å¯å³å¯ï¼š\n1 2 3 4 5 6 7 opengraph: twitter: # Your Twitter username site: JinliCyou # Available values: summary, summary_large_image card: summary_large_image è¿™æ ·ï¼ŒHugoåœ¨ç”Ÿæˆå’Œéƒ¨ç½²ç½‘ç«™æ—¶å°±ä¼šåœ¨ç½‘é¡µHTMLæ–‡ä»¶ä¸­è‡ªåŠ¨åµŒå…¥OGæ ‡ç­¾ã€‚\nå‚è€ƒï¼šä¸ªäººç½‘ç«™çš„å»ºç«‹è¿‡ç¨‹ï¼ˆå››ï¼‰ï¼šç½‘ç«™çš„æœç´¢å¼•æ“ä¼˜åŒ–ï¼ˆSEOï¼‰\n# é¢å¤–çš„ä¸€äº›çŸ¥è¯† gh-pages æ˜¯GitHub æ‰€æä¾›çš„ä¸€ä¸ªæœåŠ¡ï¼Œç®€å•æ¥è®²å°±æ˜¯å¯ä»¥è®©ä½ ä¸ç”¨èŠ±é’±ä¹Ÿå¯ä»¥éƒ¨ç½²ä¸€ä¸ªé™æ€ç½‘é¡µä½œä¸ºå±•ç¤ºç”¨ï¼Œå› æ­¤å¯¹äºå‰ç«¯å·¥ç¨‹å¸ˆæ¥è®²å°±éå¸¸æ–¹ä¾¿è€Œä¸”å¾ˆå®ç”¨ï¼Œä½†æ˜¯éƒ¨ç½²æ–¹å¼æœ‰å¾ˆå¤šã€‚\ngh-pagesæ˜¯github-pagesçš„ç¼©å†™ï¼Œå¯ä»¥ç”¨äºä¸ªäººåšå®¢å’Œé¡¹ç›®ä»‹ç»çš„ç½‘ç«™æœåŠ¡ã€‚\ngh-pagesä¹Ÿæ˜¯githubç‰¹æ®Šçš„åˆ†æ”¯ï¼Œç”¨æ¥å­˜æ”¾ç½‘ç«™ç›¸å…³çš„ä¸€äº›èµ„æºï¼Œé€šå¸¸ç½‘ç«™åœ°å€ä¸ºusername.github.io/ä»“åº“å\né¡¹ç›®åä¸username.github.ioä¸€æ ·çš„è¯ï¼Œå¯ä»¥çœç•¥ä»“åº“åï¼Œè·Ÿgithubä¸ªäººèµ„æ–™é¡µé¢ä¸€æ ·ï¼Œæ‰€ä»¥è¿™ä¸ªä»“åº“æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ä»“åº“ï¼Œé»˜è®¤ä¼šè‡ªåŠ¨å¼€å¯gh-pagesæœåŠ¡ã€‚åˆ«çš„éœ€è¦æ‰‹åŠ¨ã€‚\nè™½ç„¶gh-pages æ˜¯å±äºå…è´¹çš„æœåŠ¡ï¼ŒåŸºæœ¬ä¸Šåªè¦ä½ æŒæœ‰GitHub å¸å·å°±å¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯å®ƒåŸºæœ¬ä¸Šæœ‰å‡ ä¸ªé‡ç‚¹å¯ä»¥ç¨å¾®æ³¨æ„ä¸€ä¸‹ï¼š\nåªèƒ½æ”¾ç½®çº¯é™æ€ç½‘é¡µï¼Œä¹Ÿå°±æ˜¯è¯´æ²¡æœ‰åç«¯çš„ç½‘é¡µï¼Œä¾‹å¦‚PHPã€Node.jsã€Python ç­‰ç­‰ï¼Œåªèƒ½æ˜¯çº¯HTMLã€CSSã€JavaScript ç­‰ç­‰ï¼Œå› ä¸ºå®ƒå¹¶æ²¡æœ‰è¿ç®—èƒ½åŠ›ã€‚ gh-pages æ˜¯ä»¥å‚¨å­˜åº“ä¸ºå•ä½ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªå‚¨å­˜åº“éƒ½å¯ä»¥æœ‰ä¸€ä¸ªgh-pages åˆ†æ”¯ï¼Œä½†æ˜¯æ¯ä¸ªå‚¨å­˜åº“åªèƒ½æœ‰ä¸€ä¸ªgh-pages åˆ†æ”¯ï¼Œå› æ­¤å¦‚æœä½ æƒ³è¦éƒ¨ç½²å¤šä¸ªç½‘é¡µï¼Œé‚£ä¹ˆä½ å°±éœ€è¦å»ºç«‹å¤šä¸ªå‚¨å­˜åº“ã€‚ gh-pages çš„å®¹é‡æ˜¯æœ‰é™åˆ¶çš„ï¼Œæ¯ä¸ªå‚¨å­˜åº“çš„å®¹é‡æ˜¯1GBï¼Œå¦‚æœä½ çš„ç½‘é¡µè¶…è¿‡è¿™ä¸ªå®¹é‡ï¼Œé‚£ä¹ˆå°±æ— æ³•éƒ¨ç½²ã€‚ gh-pages çš„æµé‡ä¸ºæ¯æœˆ100GB gh-pages æ¯å°æ—¶åªèƒ½éƒ¨ç½²10 æ¬¡ï¼Œå¦‚æœæ˜¯ä½¿ç”¨è‡ªå·±å†™çš„GitHub Actions å°±æ²¡æœ‰è¿™ä¸ªé™åˆ¶ï¼ˆæ¯•ç«Ÿè¦èŠ±é’±ï¼‰ã€‚ å…è´¹çš„ssh å‡­è¯ é¢„è®¾çš„ç½‘åŸŸæ˜¯https://\u0026lt;username\u0026gt;.github.io/\u0026lt;repository\u0026gt;ï¼Œå¦‚æœä½ æƒ³è¦ä½¿ç”¨è‡ªå·±çš„ç½‘åŸŸï¼Œé‚£ä¹ˆä½ å°±éœ€è¦èŠ±é’±è´­ä¹°ç½‘åŸŸï¼Œå¹¶ä¸”è®¾å®šDNS æœ€åè¦ç¨å¾®æ³¨æ„ä¸€ä¸‹gh-pages è™½ç„¶æ˜¯å…è´¹æä¾›çš„é™æ€ç½‘é¡µæ‰˜ç®¡æœåŠ¡ï¼Œä½†æ˜¯å®ƒå¹¶ä¸èƒ½æ‹¿æ¥ä½œä¸ºå•†ä¸šç”¨é€”æˆ–æ˜¯è¿æ³•ç”¨é€”ï¼Œå¦åˆ™ä½ çš„å¸å·å¯èƒ½ä¼šè¢«å°é”\nç®€å•è¯´ä¸€ä¸‹å¦‚ä½•æŸ¥çœ‹ä¸€ä¸ªä»“åº“æ˜¯å¦å¯ç”¨gh-pagesï¼šè¿›å…¥é¡¹ç›®settings-pagesæŸ¥çœ‹å³å¯ï¼Œæœ‰ç»¿è‰²é’©å°±å¯åŠ¨æˆåŠŸï¼Œæ²¡æœ‰éœ€è¦æŒ‡å®šåˆ†æ”¯å’Œæ ¹ç›®å½•ï¼Œä¿å­˜ï¼Œç¨ç­‰ä¸€ä¼šå°±è¡Œã€‚\n# ç”¨gh-pagesåˆ†æ”¯å±•ç¤ºè‡ªå·±çš„é¡¹ç›® æˆ‘ä»¬åªéœ€è¦å°†ç½‘é¡µèµ„æºä¸Šä¼ è‡³gh-pagesåˆ†æ”¯å³å¯\næ­å»ºé¡¹ç›®ç½‘ç«™ï¼šå°†é¡¹ç›®ç½‘ç«™èµ„æºæ¨é€åˆ°gh-pagesåˆ†æ”¯ä¸Š,é™æ€èµ„æºå¿…é¡»æäº¤äº†æ‰ä¼šæˆåŠŸ\n1 git subtree push --prefix=dist origin gh-pages # distä¸ºé¡¹ç›®ç½‘ç«™çš„ç›®å½• æ‹‰å–æŒ‡å®šåˆ†æ”¯\n1 2 3 4 5 6 7 8 git fetch origin # è·å–originä»“åº“çš„ä¿¡æ¯ git checkout -b aaa origin/aaa # åˆ›å»ºå¹¶æ£€å‡ºåˆ†æ”¯ # git cloneä¹‹åä¹Ÿä¹Ÿå¯ä»¥æ£€å‡ºåˆ†æ”¯ git checkout gh-page # å¤±è´¥ç”¨ä¸Šé¢åŠæ³• # åœ¨git clone çš„æ—¶å€™å¯ä»¥æŒ‡å®šåˆ†æ”¯-bé€‰é¡¹ git clone -b url å¦‚æœè¦é¡¹ç›®ä¸­ä¸å«è‡ªå·±ç½‘ç«™çš„æºç ï¼Œå¯ä»¥å¿½ç•¥publicç›®å½•ï¼Œå°†publicç›®å½•åˆ›å»ºä¸ºä¸€ä¸ªç§æœ‰ä»“åº“çš„å­ç›®å½•ï¼Œç„¶åå°†å­ç›®å½•ä½œä¸ºï¼Œé¡¹ç›®çš„gh-pagesåˆ†æ”¯ã€‚\n# é€šè¿‡GitHub Actionsè‡ªåŠ¨éƒ¨ç½²gh-pages ç®€å•ä»‹ç»ä¸€ä¸‹GitHub Actions:\nGitHub Actionsæ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–å·¥å…·ã€‚ å¯ä»¥å®ç°è‡ªåŠ¨åŒ–æ„å»ºã€æµ‹è¯•ã€å’Œéƒ¨ç½²é¡¹ç›®ã€‚ å®šä¹‰è‡ªåŠ¨åŒ–è¿‡ç¨‹æ˜¯é€šè¿‡ç¼–å†™workflowsï¼ˆå·¥ä½œæµï¼‰å®ç°çš„ï¼Œæ ¼å¼æ˜¯yamlã€‚ æ¨é€éƒ¨ç½²çš„github-pageséœ€è¦gitè´¦æˆ·è®¤è¯ï¼Œæ–¹å¼æ˜¯SSHç§˜é’¥è®¤è¯ã€‚\næ‰€ä»¥éœ€è¦è®¾ç½®sshç§˜é’¥ã€‚\nç”Ÿæˆç§˜é’¥ï¼šåœ¨bashä¸­è¿è¡Œssh-keygen,ç§˜é’¥ç±»å‹é»˜è®¤ä¸ºrsaã€‚å¯ä»¥ç»™è¿™ä¸ªç§˜é’¥è®¾ç½®å¤‡æ³¨åŠ -Cé€‰é¡¹ï¼Œå‚æ•°ä¸€èˆ¬ä¸ºæ‹¥æœ‰è€…é‚®ç®±ï¼Œä¸€ç›´å›è½¦å°±è¡Œã€‚ç§˜é’¥ä¿å­˜ä½ç½®ï¼šé»˜è®¤ç”¨æˆ·ä¸»ç›®å½•ä¸‹çš„.sshã€‚å…¬é’¥å°±æ˜¯id_rsa.pub\nå»ºè®®å°†ç”Ÿæˆçš„è¿™ä¸ªç§˜é’¥å¯¹ä¸æœ¬æœºè®¤è¯çš„sshç§˜é’¥å¯¹åˆ†å¼€ï¼Œä¿å­˜åˆ°å¦å¤–çš„ä¸€ä¸ªåœ°æ–¹ã€‚å›è½¦çš„æ—¶å€™ä¿®æ”¹ä½ç½®å°±è¡Œã€‚ è®¾ç½®å…¬é’¥ï¼š\ngithubè´¦æˆ·Settings-\u0026gt;SSH and GPG keys-\u0026gt;New SSH keyå°†å…¬é’¥å¤åˆ¶ç²˜è´´ä¿å­˜å°±è¡Œã€‚è¿™ç§æ–¹å¼ï¼Œåªæœ‰æœ‰ç§é’¥ï¼Œå°±èƒ½æ“ä½œæ‰€æœ‰ä»“åº“ï¼Œä¸æ¨èä½¿ç”¨ã€‚ (è‡ªåŠ¨æ„å»ºä¹‹å)é€‰æ‹©è¦æ¨é€çš„ä»“åº“Settings-\u0026gt;Deploy keys-\u0026gt;Add deploy keyå°†å…¬é’¥å¤åˆ¶ç²˜è´´ä¿å­˜å°±è¡Œã€‚titleéšæ„ã€‚æ³¨æ„å‹¾é€‰Allow write accessã€‚åªé’ˆå¯¹è¯¥ä»“åº“æœ‰æƒé™ã€‚æ¨èä½¿ç”¨ã€‚ è®¾ç½®ç§é’¥ï¼š\nè¿›å…¥Actionsæ‰€åœ¨çš„ä»“åº“Settings-\u0026gt;Secrets and variables-\u0026gt;Actions-\u0026gt;New repository secretã€‚ç§˜é’¥åç§°ä¸ºACTIONS_DEPLOY_KEYï¼Œå€¼ä¸ºç§é’¥id_rsaçš„æ–‡ä»¶å†…å®¹ã€‚æœ€åä¿å­˜å°±è¡Œã€‚ æ·»åŠ workflowsé…ç½®æ–‡ä»¶\nåœ¨æ„å»ºä»“åº“çš„æ ¹ç›®å½•ä¸‹åˆ›å»º.github/workflowsç›®å½•ï¼Œç„¶ååˆ›å»ºauto-deploy-gh-pages.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 name: Deploy github pages on: push: branches: - main # main æ›´æ–°è§¦å‘ # Allows you to run this workflow manually from the Actions tab workflow_dispatch: jobs: auto-deploy-github-pages: runs-on: ubuntu-latest steps: - name: Checkout code uses: actions/checkout@v4 with: submodules: true # clone submodules fetch-depth: 0 # å…‹éš†æ‰€æœ‰å†å²ä¿¡æ¯ - name: Setup Hugo uses: peaceiris/actions-hugo@v3 with: hugo-version: \u0026#34;0.125.4\u0026#34; # Hugo ç‰ˆæœ¬ extended: true # hugoæ’ä»¶ç‰ˆ Stackä¸»é¢˜ å¿…é¡»å¯ç”¨ - name: Cache resources # ç¼“å­˜ resource æ–‡ä»¶åŠ å¿«ç”Ÿæˆé€Ÿåº¦ uses: actions/cache@v4 with: path: resources # æ£€æŸ¥ç…§ç‰‡æ–‡ä»¶å˜åŒ– key: ${{ runner.os }}-hugocache-${{ hashFiles(\u0026#39;content/**/*\u0026#39;) }} restore-keys: ${{ runner.os }}-hugocache- - name: Build # ç”Ÿæˆç½‘é¡µ åˆ é™¤æ— ç”¨ resource æ–‡ä»¶ å‰Šå‡ç©ºè¡Œ run: hugo --minify --gc - name: Deploy # éƒ¨ç½²åˆ° GitHub Page uses: peaceiris/actions-gh-pages@v3 with: # å¦‚æœåœ¨åŒä¸€ä¸ªä»“åº“ä¸‹ä½¿ç”¨è¯·ä½¿ç”¨ github_token å¹¶æ³¨é‡Š deploy_key # github_token: ${{ secrets.GITHUB_TOKEN }} deploy_key: ${{ secrets.ACTIONS_DEPLOY_KEY }} # å¦‚æœåœ¨åŒä¸€ä¸ªä»“åº“è¯·æ³¨é‡Š external_repository: arlettebrook/arlettebrook.github.io # ä½ çš„ GitHub page ä»“åº“ example/example.github.io publish_branch: main # é»˜è®¤gh-pages # cname: blog.trojan123.top # è‡ªå®šä¹‰åŸŸå publish_dir: ./public user_name: \u0026#34;github-actions[bot]\u0026#34; user_email: \u0026#34;github-actions[bot]@users.noreply.github.com\u0026#34; # full_commit_message: ${{ github.event.head_commit.message }} # ä¸å¸¦æäº¤å“ˆå¸Œ # full_commit_message: Deploy from ${{ github.repository }}@${{ github.sha }} ğŸš€ commit_message: ${{ github.event.head_commit.message }}ğŸš€ # å¸¦æäº¤å“ˆå¸Œ # full_commit_message: Deploy from ${{ github.repository }}@${{ github.sha }}ğŸš€ ${{ github.event.head_commit.message }} æ³¨æ„ä½ è¦å°†external_repositoryé¡¹é‡Œçš„arlettebrook/arlettebrook.github.ioæ”¹ä¸ºä½ è¦æ¨é€çš„ä»“åº“ã€‚cnameä¸ºä½ ç»‘å®šçš„è‡ªå®šä¹‰åŸŸåã€‚\nå¿½ç•¥ä¸å¿…è¦çš„æ–‡ä»¶\nåœ¨æ„å»ºé¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º.gitignoreæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n1 2 3 4 public resources assets/jsconfig.json .hugo_build.lock æœ€åå°†æ„å»ºé¡¹ç›®æ¨é€åˆ°è¿œç¨‹å°±è¡Œï¼Œè¿™æ ·æ¯æ¬¡æ¨é€æ„å»ºé¡¹ç›®çš„mainåˆ†æ”¯åˆ°è¿œç¨‹ï¼Œå°±ä¼šè‡ªåŠ¨æ„å»ºå¹¶æ¨é€åˆ°æŒ‡å®šä»“åº“ã€‚\næŸ¥çœ‹æ˜¯å¦æ„å»ºæˆåŠŸï¼šè¿›å…¥æ„å»ºé¡¹ç›®çš„Actionsé€‰é¡¹é‡Œé¢å³å¯æŸ¥çœ‹ã€‚\nå‚è€ƒï¼šï¼ˆ2ï¼‰éƒ¨ç½²ä½ çš„Hugoåšå®¢\n","date":"2024-04-22T16:12:26+08:00","image":"https://arlettebrook.github.io/p/%E5%9F%BA%E4%BA%8Ehugo%E5%92%8Cgh-pages%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E9%9D%99%E6%80%81%E7%BD%91%E7%AB%99/hugo_hu45a5e3ad5e058da6a00650ed8fd40bea_15530_120x120_fill_q75_box_smart1.jpg","permalink":"https://arlettebrook.github.io/p/%E5%9F%BA%E4%BA%8Ehugo%E5%92%8Cgh-pages%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E9%9D%99%E6%80%81%E7%BD%91%E7%AB%99/","title":"åŸºäºHugoå’Œgh-pageså¿«é€Ÿæ­å»ºé™æ€ç½‘ç«™"}]