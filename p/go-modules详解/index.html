<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Go modules详细介绍。"><title>Go modules详解</title>
<link rel=canonical href=https://arlettebrook.github.io/p/go-modules%E8%AF%A6%E8%A7%A3/><link rel=stylesheet href=/scss/style.min.59d76563977ef6a76d0c7df16aa86c7ac37ed8942ba1442046cb6cf3b07439d7.css><meta property='og:title' content="Go modules详解"><meta property='og:description' content="Go modules详细介绍。"><meta property='og:url' content='https://arlettebrook.github.io/p/go-modules%E8%AF%A6%E8%A7%A3/'><meta property='og:site_name' content="Arlettebrook's blog"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Go Modules'><meta property='article:published_time' content='2024-04-28T10:57:17+08:00'><meta property='article:modified_time' content='2024-05-15T10:57:17+08:00'><meta name=twitter:site content="@arlettebrook"><meta name=twitter:creator content="@arlettebrook"><meta name=twitter:title content="Go modules详解"><meta name=twitter:description content="Go modules详细介绍。"><link rel="shortcut icon" href=/img/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-9MKLLVPEER"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-9MKLLVPEER")}</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><div id=article-toolbar style=position:sticky;top:5px;z-index:1000><a href=/ class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg>
<span>返回</span></a></div><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#概述>概述</a><ol><li><a href=#什么是-go-modules>什么是 Go Modules</a></li></ol></li><li><a href=#go-path介绍>GO PATH介绍</a><ol><li><a href=#gopath模式的弊端>GOPATH模式的弊端</a></li></ol></li><li><a href=#go-module-语义化版本规范>Go Module 语义化版本规范</a><ol><li><a href=#语义化版本规范>语义化版本规范</a></li><li><a href=#使用语义化版本规范可能遇到的问题>使用语义化版本规范可能遇到的问题</a></li><li><a href=#如何验证语义化版本规范正确性>如何验证语义化版本规范正确性</a></li><li><a href=#go-modules版本设计>Go Modules版本设计</a><ol><li><a href=#依赖地狱>依赖地狱</a></li><li><a href=#语义导入版本>语义导入版本</a></li></ol></li></ol></li><li><a href=#go-modules基本使用>Go Modules基本使用</a><ol><li><a href=#go-modules相关命令>go modules相关命令</a></li><li><a href=#go-modules参数配置>go modules参数配置</a></li><li><a href=#go-modules模块文件>go modules模块文件</a></li><li><a href=#go-modules模块下载>go modules模块下载</a><ol><li><a href=#go-modules全局缓存>go modules全局缓存</a></li></ol></li><li><a href=#go-modules模块导入>go modules模块导入</a></li></ol></li><li><a href=#gopkgin介绍>gopkg.in介绍</a></li><li><a href=#总结>总结</a></li><li><a href=#参考>参考</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/go/ style=background-color:#f97300;color:#fff>Go
</a><a href=/categories/%E6%8A%80%E6%9C%AF/ style=background-color:#c73659;color:#fff>技术</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/go-modules%E8%AF%A6%E8%A7%A3/>Go modules详解</a></h2><h3 class=article-subtitle>Go modules详细介绍。</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Apr 28, 2024</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 18 分钟</time></div></footer></div></header><section class=article-content><hr><h2 id=概述><a href=#%e6%a6%82%e8%bf%b0 class=header-anchor>#</a>
概述</h2><p>大多数语言都有“依赖”、“包”等概念，<code>Go</code>语言的依赖处理经历了几次变革。</p><p>最早的时候，<code>Go</code>所依赖的所有的第三方库都放在<code>GOPATH</code>这个目录下面。从<code>v1.5</code>开始引入<code>vendor</code>模式，如果项目目录下有<code>vendor</code>目录，那么<code>go</code>工具链会优先使用<code>vendor</code>内的包进行编译、测试等。</p><p>从<code>v1.11</code>开始，引入了<code>Go Modules</code> 作为依赖解决方案，到<code>v1.14</code>宣布<code>Go Modules</code>已经可以用于生产环境，到<code>v1.16</code>版本开始<code>Go Module</code>默认开启。</p><h3 id=什么是-go-modules><a href=#%e4%bb%80%e4%b9%88%e6%98%af-go-modules class=header-anchor>#</a>
什么是 Go Modules</h3><p>Go modules 是 Go 语言的依赖解决方案，发布于 Go1.11，成长于 Go1.12，丰富于 Go1.13，正式于 Go1.14 推荐在生产上使用。</p><p>Go Modules使得Go语言开发者能够更方便地管理代码包及其版本，并能够与现有的版本控制工具（如Git、SVN等）集成使用。</p><p>在传统的GOPATH模式中，所有Go代码都必须位于一个全局的GOPATH路径之下，这使得在不同项目中使用不同版本的依赖包变得非常困难。然而，在Go Modules模式下，每个项目都可以独立管理自己的依赖关系，具有更好的兼容性。当使用Go Modules模式后，项目中会自动创建go.mod文件，其中记录了项目所依赖的模块及其版本信息。<strong>go.mod是Go语言项目中的模块文件</strong>，用于管理项目的依赖关系和版本信息。</p><p>Go Modules也支持语义化版本控制，这意味着开发者可以指定依赖包的版本范围，而不是仅仅依赖最新的版本。这种灵活性有助于确保项目的稳定性和可维护性。</p><p>Go moudles 目前集成在 Go 的工具链中，只要安装了 Go，自然而然也就可以使用 Go moudles 了，而 Go modules 的出现也解决了在 Go1.11 前的几个常见争议问题：</p><ul><li>Go 语言长久以来的依赖管理问题。</li><li>“淘汰”现有的 <code>GOPATH</code> 的使用模式。</li><li>统一社区中的其它的依赖管理工具（提供迁移功能）。</li></ul><p>优势</p><ul><li>首先，研发者能够在任何目录下工作，而不仅仅是在GOPATH指定的目录。</li><li>可以安装依赖包的指定版本，而不是只能从master分支安装最新的版本。</li><li>可以导入同一个依赖包的多个版本。当我们老项目使用老版本，新项目使用新版本时会非常有用。</li><li>要有一个能够罗列当前项目所依赖包的列表。这个的好处是当我们发布项目时不用同时发布所依赖的包。Go能够根据该文件自动下载对应的包。</li></ul><hr><h2 id=go-path介绍><a href=#go-path%e4%bb%8b%e7%bb%8d class=header-anchor>#</a>
GO PATH介绍</h2><p>安装好go开发环境之后，可以运行<code>go env</code>查看go运行时的环境变量。要修改这些环境变量，可以通过配置环境变量来覆盖默认值(覆盖了就不能通过命令设置)，如临时设置<code>export GO111MODULE=on</code>。或者通过命令<code>go env -w key=value</code>，如<code>go env -w GO111MODULE=on</code>。通过命令修改的环境变量保存在<code>GOENV</code>这个环境变量指向的文件。</p><p>有两个比较重要的环境变量：</p><ul><li><strong>GOROOT</strong>：Golang 安装目录的路径，包含编译器程序和系统包，也可以放置三方包（不推荐）。新版本已经不需要配置这个环境变量了，安装了go会自动推断出该变量的值。如果安装之后环境变量中没有<code>$GORROOT/bin</code>,需要手动添加，这样才能直接在命令行中运行go编译程序。</li><li><strong>GOPATH</strong>：该工作目录，放置编译后二进制和 import 包时的搜索路径，一般有三个目录: bin、pkg、src。并且该环境变量必须手动设置。<ul><li>bin：用来存放编译后的可执行文件。引入Go modules之后用于存放<code>get install</code>安装的可执行文件。</li><li>pkg：存储预编译的目标文件，以加快程序的后续编译速度。引入Go modules之后用于存放第三方包。</li><li>src：存储所有.go文件或源代码。在编写 Go 应用程序，程序包和库时，一般会以<code>$GOPATH/src/github.com/foo/bar</code>的路径进行存放。引入Go modules之后用一般不用，go项目可以放在任意目录中，不在是<code>$GOPATH/src</code></li></ul></li></ul><p>因此在使用 GOPATH 模式下，我们需要将应用代码存放在固定的<code>$GOPATH/src</code>目录下，并且如果执行go get来拉取外部依赖会自动下载并安装到<code>$GOPATH</code>目录下。</p><h3 id=gopath模式的弊端><a href=#gopath%e6%a8%a1%e5%bc%8f%e7%9a%84%e5%bc%8a%e7%ab%af class=header-anchor>#</a>
GOPATH模式的弊端</h3><p>在 GOPATH 的 <code>$GOPATH/src</code> 下进行 <code>.go</code> 文件或源代码的存储，我们可以称其为 GOPATH 的模式，这个模式拥有一些弊端。</p><ul><li>A. <strong>无版本控制概念</strong>. 在执行go get的时候，你无法传达任何的版本信息的期望，也就是说你也无法知道自己当前更新的是哪一个版本，也无法通过指定来拉取自己所期望的具体版本。</li><li>B.<strong>无法同步一致第三方版本号</strong>. 在运行 Go 应用程序的时候，你无法保证其它人与你所期望依赖的第三方库是相同的版本，也就是说在项目依赖库的管理上，你无法保证所有人的依赖版本都一致。</li><li>C.<strong>无法指定当前项目引用的第三方版本号</strong>. 你没办法处理 v1、v2、v3 等等不同版本的引用问题，因为 GOPATH 模式下的导入路径都是一样的，都是github.com/foo/bar。</li></ul><p>Go 语言官方从 Go1.11 起开始推进 Go modules（前身vgo，知道即可，不需要深入了解），Go1.13 起不再推荐使用 GOPATH 的使用模式，Go modules 也渐趋稳定，因此新项目也没有必要继续使用GOPATH模式。</p><hr><h2 id=go-module-语义化版本规范><a href=#go-module-%e8%af%ad%e4%b9%89%e5%8c%96%e7%89%88%e6%9c%ac%e8%a7%84%e8%8c%83 class=header-anchor>#</a>
Go Module 语义化版本规范</h2><p>Go Module 的设计采用了语义化版本规范，语义化版本规范非常流行且具有指导意义，本文就来聊聊语义化版本规范的设计和在 Go 中的应用。</p><h3 id=语义化版本规范><a href=#%e8%af%ad%e4%b9%89%e5%8c%96%e7%89%88%e6%9c%ac%e8%a7%84%e8%8c%83 class=header-anchor>#</a>
语义化版本规范</h3><p>语义化版本规范（SemVer）是由 Gravatars 创办者兼 GitHub 共同创办者 Tom Preston-Werner 所建立，旨在解决 <a class=link href=https://hwikizh.cyou/wiki/Dependency_hell target=_blank rel=noopener><code>依赖地狱</code></a> 问题。</p><p>它清楚明了的规定了版本格式、版本号递增规：</p><p><strong>版本格式</strong>：采用 X.Y.Z 的格式，X 是主版本号、Y 是次版本号、而 Z 为修订号（即：主版本号.次版本号.修订号），其中 X、Y 和 Z 为非负的整数，且禁止在数字前方补零。</p><p><strong>版本号递增规则：</strong></p><p>主版本号：当做了不兼容的 API 修改。</p><p>次版本号：当做了向下兼容的功能性新增及修改。</p><p>修订号：当做了向下兼容的问题修正。</p><p>另外，<code>先行版本号</code> 及 <code>版本编译信息</code> 可以加到 <code>主版本号.次版本号.修订号</code> 的后面，作为延伸。</p><p>完整版本格式如下：</p><p><img src=/p/go-modules%E8%AF%A6%E8%A7%A3/index.assets/image-20240428181429712.png width=594 height=393 srcset="/p/go-modules%E8%AF%A6%E8%A7%A3/index.assets/image-20240428181429712_hu4e93c4fe90e112c1b95a6a33697eab15_28580_480x0_resize_box_3.png 480w, /p/go-modules%E8%AF%A6%E8%A7%A3/index.assets/image-20240428181429712_hu4e93c4fe90e112c1b95a6a33697eab15_28580_1024x0_resize_box_3.png 1024w" loading=lazy alt=版本格式 class=gallery-image data-flex-grow=151 data-flex-basis=362px></p><p>先行版本号可以有多个，如第一个为UTC时间，第二个为提交的哈希值：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>v4</span><span class=mf>.0.1</span><span class=o>-</span><span class=mf>0.20210109023952</span><span class=o>-</span><span class=mf>943e75</span><span class=nx>fe5223</span><span class=o>+</span><span class=nx>incompatible</span>
</span></span><span class=line><span class=cl><span class=nx>v0</span><span class=mf>.0.0</span><span class=o>-</span><span class=mi>20240416160154</span><span class=o>-</span><span class=nx>fe59bbe5cc7f</span>
</span></span></code></pre></td></tr></table></div></div><p>其中版本号核心部分 X.Y.Z 是必须的，使用 <code>.</code> 连接，先行版本号和版本编译信息是可选的，先行版本号通过 <code>-</code> 与核心部分连接，版本编译信息通过 <code>+</code> 与核心部分或先行版本号连接。</p><p>合法的几种版本号格式如下：</p><ol><li>主版本号.次版本号.修订号</li><li>主版本号.次版本号.修订号-先行版本号</li><li>主版本号.次版本号.修订号+版本编译信息</li><li>主版本号.次版本号.修订号-先行版本号+版本编译信息</li></ol><p>主版本号必须在有任何不兼容的修改被加入公共 API 时递增。每当主版本号递增时，次版本号和修订号必须归零。</p><p>次版本号必须在有向下兼容的新功能出现或有改进时递增，或在任何公共 API 的功能被标记为弃用时也必须递增。每当次版本号递增时，修订号必须归零。</p><p>修订号必须在只做了向下兼容的修正时才递增。这里的修正指的是针对不正确结果而进行的内部修改。</p><p>存在先行版本号，意味着当前版本不够稳定，且可能存在兼容性问题。先行版本号是一连串以 <code>.</code> 分隔的标识符，由 ASCII 字母数字和连接号 <code>[0-9A-Za-z-]</code> 组成，禁止出现空白符，数字类型则禁止在前方补零。合法示例：1.0.0-alpha、1.0.0-alpha.1、1.0.0-0.3.7、1.0.0-x.7.z.92。</p><p>版本编译信息标志符规格与先行版本号基本相同，略有差异的是数字类型前方允许补零。合法示例：1.0.0-alpha+001、1.0.0+20130313144700、1.0.0-beta+exp.sha.5114f85。</p><p>除了上面几点说明，还需要额外关注以下几点：</p><ol><li>标记版本号的软件发行后，禁止改变该版本软件的内容。任何修改都必须以新版本发行。</li><li>主版本号为零（0.y.z）的软件处于开发初始阶段，一切都可能随时被改变。这样的公共 API 不应该被视为稳定版。</li><li>1.0.0 的版本号用于界定公共 API 的形成。这一版本之后所有的版本号更新都基于公共 API 及其修改内容。</li><li>社区中还存在一个不成文的规定，对于次版本号，偶数为稳定版本，奇数为开发版本。当然不是所有项目都这样设计。</li></ol><h3 id=使用语义化版本规范可能遇到的问题><a href=#%e4%bd%bf%e7%94%a8%e8%af%ad%e4%b9%89%e5%8c%96%e7%89%88%e6%9c%ac%e8%a7%84%e8%8c%83%e5%8f%af%e8%83%bd%e9%81%87%e5%88%b0%e7%9a%84%e9%97%ae%e9%a2%98 class=header-anchor>#</a>
使用语义化版本规范可能遇到的问题</h3><p>在使用语义化版本规范过程中，可能人为或程序编写错误导致出现如下几种可预见的问题：</p><ol><li><p>万一不小心把一个不兼容的改版当成了次版本号发行了该怎么办？</p><p>一旦发现自己破坏了语义化版本控制的规范，就要修正这个问题，并发行一个新的次版本号来更正这个问题并且恢复向下兼容。即使是这种情况，也不能去修改已发行的版本。可以的话，将有问题的版本号记录到文档中，告诉使用者问题所在，让他们能够意识到这是有问题的版本。</p><p>注意：不到万不得已，不要也不能去修改已发行的版本。</p></li><li><p>如果我变更了公共 API 但无意中未遵循版本号的改动怎么办呢？（意即在修订等级的发布中，误将重大且不兼容的改变加到代码之中）</p><p>自行做最佳的判断。如果你有庞大的使用者群在依照公共 API 的意图而变更行为后会大受影响，那么最好做一次主版本的发布，即使严格来说这个修复仅是修订等级的发布。记住，语义化的版本控制就是透过版本号的改变来传达意义。若这些改变对你的使用者是重要的，那就透过版本号来向他们说明。</p></li><li><p><code>v1.2.3</code> 是一个语义化版本号吗？</p><p><code>v1.2.3</code> 并不是的一个语义化的版本号。但是，在语义化版本号之前增加前缀 <code>v</code> 是用来表示版本号的常用做法。在版本控制系统中，将 <code>version</code> 缩写为 <code>v</code> 是很常见的。比如：<code>git tag v1.2.3 -m "Release version 1.2.3"</code> 中，<code>v1.2.3</code> 表示标签名称，而 <code>1.2.3</code> 是语义化版本号。go modules的模块版本也是在前面加<code>v</code></p></li></ol><h3 id=如何验证语义化版本规范正确性><a href=#%e5%a6%82%e4%bd%95%e9%aa%8c%e8%af%81%e8%af%ad%e4%b9%89%e5%8c%96%e7%89%88%e6%9c%ac%e8%a7%84%e8%8c%83%e6%ad%a3%e7%a1%ae%e6%80%a7 class=header-anchor>#</a>
如何验证语义化版本规范正确性</h3><p>官方提供了两个正则可以检查语义化版本号的正确性。</p><ol><li><p>支持按组名称提取匹配结果</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=p>^(</span><span class=err>?</span><span class=nx>P</span><span class=p>&lt;</span><span class=nx>major</span><span class=p>&gt;</span><span class=mi>0</span><span class=p>|[</span><span class=mi>1</span><span class=o>-</span><span class=mi>9</span><span class=p>]</span><span class=err>\</span><span class=nx>d</span><span class=o>*</span><span class=p>)</span><span class=err>\</span><span class=p>.(</span><span class=err>?</span><span class=nx>P</span><span class=p>&lt;</span><span class=nx>minor</span><span class=p>&gt;</span><span class=mi>0</span><span class=p>|[</span><span class=mi>1</span><span class=o>-</span><span class=mi>9</span><span class=p>]</span><span class=err>\</span><span class=nx>d</span><span class=o>*</span><span class=p>)</span><span class=err>\</span><span class=p>.(</span><span class=err>?</span><span class=nx>P</span><span class=p>&lt;</span><span class=nx>patch</span><span class=p>&gt;</span><span class=mi>0</span><span class=p>|[</span><span class=mi>1</span><span class=o>-</span><span class=mi>9</span><span class=p>]</span><span class=err>\</span><span class=nx>d</span><span class=o>*</span><span class=p>)(</span><span class=err>?</span><span class=p>:</span><span class=o>-</span><span class=p>(</span><span class=err>?</span><span class=nx>P</span><span class=p>&lt;</span><span class=nx>prerelease</span><span class=p>&gt;(</span><span class=err>?</span><span class=p>:</span><span class=mi>0</span><span class=p>|[</span><span class=mi>1</span><span class=o>-</span><span class=mi>9</span><span class=p>]</span><span class=err>\</span><span class=nx>d</span><span class=o>*</span><span class=p>|</span><span class=err>\</span><span class=nx>d</span><span class=o>*</span><span class=p>[</span><span class=nx>a</span><span class=o>-</span><span class=nx>zA</span><span class=o>-</span><span class=nx>Z</span><span class=o>-</span><span class=p>][</span><span class=mi>0</span><span class=o>-</span><span class=mi>9</span><span class=nx>a</span><span class=o>-</span><span class=nx>zA</span><span class=o>-</span><span class=nx>Z</span><span class=o>-</span><span class=p>]</span><span class=o>*</span><span class=p>)(</span><span class=err>?</span><span class=p>:</span><span class=err>\</span><span class=p>.(</span><span class=err>?</span><span class=p>:</span><span class=mi>0</span><span class=p>|[</span><span class=mi>1</span><span class=o>-</span><span class=mi>9</span><span class=p>]</span><span class=err>\</span><span class=nx>d</span><span class=o>*</span><span class=p>|</span><span class=err>\</span><span class=nx>d</span><span class=o>*</span><span class=p>[</span><span class=nx>a</span><span class=o>-</span><span class=nx>zA</span><span class=o>-</span><span class=nx>Z</span><span class=o>-</span><span class=p>][</span><span class=mi>0</span><span class=o>-</span><span class=mi>9</span><span class=nx>a</span><span class=o>-</span><span class=nx>zA</span><span class=o>-</span><span class=nx>Z</span><span class=o>-</span><span class=p>]</span><span class=o>*</span><span class=p>))</span><span class=o>*</span><span class=p>))</span><span class=err>?</span><span class=p>(</span><span class=err>?</span><span class=p>:</span><span class=err>\</span><span class=o>+</span><span class=p>(</span><span class=err>?</span><span class=nx>P</span><span class=p>&lt;</span><span class=nx>buildmetadata</span><span class=p>&gt;[</span><span class=mi>0</span><span class=o>-</span><span class=mi>9</span><span class=nx>a</span><span class=o>-</span><span class=nx>zA</span><span class=o>-</span><span class=nx>Z</span><span class=o>-</span><span class=p>]</span><span class=o>+</span><span class=p>(</span><span class=err>?</span><span class=p>:</span><span class=err>\</span><span class=p>.[</span><span class=mi>0</span><span class=o>-</span><span class=mi>9</span><span class=nx>a</span><span class=o>-</span><span class=nx>zA</span><span class=o>-</span><span class=nx>Z</span><span class=o>-</span><span class=p>]</span><span class=o>+</span><span class=p>)</span><span class=o>*</span><span class=p>))</span><span class=err>?$</span>
</span></span></code></pre></td></tr></table></div></div><p>Go 语言示例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;encoding/json&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;regexp&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>version</span> <span class=o>:=</span> <span class=s>&#34;0.1.2-alpha+001&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>pattern</span> <span class=o>:=</span> <span class=nx>regexp</span><span class=p>.</span><span class=nf>MustCompile</span><span class=p>(</span><span class=s>`^(?P&lt;major&gt;0|[1-9]\d*)\.(?P&lt;minor&gt;0|[1-9]\d*)\.(?P&lt;patch&gt;0|[1-9]\d*)(?:-(?P&lt;prerelease&gt;(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+(?P&lt;buildmetadata&gt;[0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>r</span> <span class=o>:=</span> <span class=nx>pattern</span><span class=p>.</span><span class=nf>FindStringSubmatch</span><span class=p>(</span><span class=nx>version</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>m</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>string</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>i</span><span class=p>,</span> <span class=nx>name</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>pattern</span><span class=p>.</span><span class=nf>SubexpNames</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>i</span> <span class=o>==</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>m</span><span class=p>[</span><span class=s>&#34;version&#34;</span><span class=p>]</span> <span class=p>=</span> <span class=nx>r</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>m</span><span class=p>[</span><span class=nx>name</span><span class=p>]</span> <span class=p>=</span> <span class=nx>r</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>result</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nx>json</span><span class=p>.</span><span class=nf>MarshalIndent</span><span class=p>(</span><span class=nx>m</span><span class=p>,</span> <span class=s>&#34;&#34;</span><span class=p>,</span> <span class=s>&#34;  &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%s\n&#34;</span><span class=p>,</span> <span class=nx>result</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>{
</span></span></span><span class=line><span class=cl><span class=cm>  &#34;buildmetadata&#34;: &#34;001&#34;,
</span></span></span><span class=line><span class=cl><span class=cm>  &#34;major&#34;: &#34;0&#34;,
</span></span></span><span class=line><span class=cl><span class=cm>  &#34;minor&#34;: &#34;1&#34;,
</span></span></span><span class=line><span class=cl><span class=cm>  &#34;patch&#34;: &#34;2&#34;,
</span></span></span><span class=line><span class=cl><span class=cm>  &#34;prerelease&#34;: &#34;alpha&#34;,
</span></span></span><span class=line><span class=cl><span class=cm>  &#34;version&#34;: &#34;0.1.2-alpha+001&#34;
</span></span></span><span class=line><span class=cl><span class=cm>}
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>支持按编号提取匹配结果</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=p>^(</span><span class=mi>0</span><span class=p>|[</span><span class=mi>1</span><span class=o>-</span><span class=mi>9</span><span class=p>]</span><span class=err>\</span><span class=nx>d</span><span class=o>*</span><span class=p>)</span><span class=err>\</span><span class=p>.(</span><span class=mi>0</span><span class=p>|[</span><span class=mi>1</span><span class=o>-</span><span class=mi>9</span><span class=p>]</span><span class=err>\</span><span class=nx>d</span><span class=o>*</span><span class=p>)</span><span class=err>\</span><span class=p>.(</span><span class=mi>0</span><span class=p>|[</span><span class=mi>1</span><span class=o>-</span><span class=mi>9</span><span class=p>]</span><span class=err>\</span><span class=nx>d</span><span class=o>*</span><span class=p>)(</span><span class=err>?</span><span class=p>:</span><span class=o>-</span><span class=p>((</span><span class=err>?</span><span class=p>:</span><span class=mi>0</span><span class=p>|[</span><span class=mi>1</span><span class=o>-</span><span class=mi>9</span><span class=p>]</span><span class=err>\</span><span class=nx>d</span><span class=o>*</span><span class=p>|</span><span class=err>\</span><span class=nx>d</span><span class=o>*</span><span class=p>[</span><span class=nx>a</span><span class=o>-</span><span class=nx>zA</span><span class=o>-</span><span class=nx>Z</span><span class=o>-</span><span class=p>][</span><span class=mi>0</span><span class=o>-</span><span class=mi>9</span><span class=nx>a</span><span class=o>-</span><span class=nx>zA</span><span class=o>-</span><span class=nx>Z</span><span class=o>-</span><span class=p>]</span><span class=o>*</span><span class=p>)(</span><span class=err>?</span><span class=p>:</span><span class=err>\</span><span class=p>.(</span><span class=err>?</span><span class=p>:</span><span class=mi>0</span><span class=p>|[</span><span class=mi>1</span><span class=o>-</span><span class=mi>9</span><span class=p>]</span><span class=err>\</span><span class=nx>d</span><span class=o>*</span><span class=p>|</span><span class=err>\</span><span class=nx>d</span><span class=o>*</span><span class=p>[</span><span class=nx>a</span><span class=o>-</span><span class=nx>zA</span><span class=o>-</span><span class=nx>Z</span><span class=o>-</span><span class=p>][</span><span class=mi>0</span><span class=o>-</span><span class=mi>9</span><span class=nx>a</span><span class=o>-</span><span class=nx>zA</span><span class=o>-</span><span class=nx>Z</span><span class=o>-</span><span class=p>]</span><span class=o>*</span><span class=p>))</span><span class=o>*</span><span class=p>))</span><span class=err>?</span><span class=p>(</span><span class=err>?</span><span class=p>:</span><span class=err>\</span><span class=o>+</span><span class=p>([</span><span class=mi>0</span><span class=o>-</span><span class=mi>9</span><span class=nx>a</span><span class=o>-</span><span class=nx>zA</span><span class=o>-</span><span class=nx>Z</span><span class=o>-</span><span class=p>]</span><span class=o>+</span><span class=p>(</span><span class=err>?</span><span class=p>:</span><span class=err>\</span><span class=p>.[</span><span class=mi>0</span><span class=o>-</span><span class=mi>9</span><span class=nx>a</span><span class=o>-</span><span class=nx>zA</span><span class=o>-</span><span class=nx>Z</span><span class=o>-</span><span class=p>]</span><span class=o>+</span><span class=p>)</span><span class=o>*</span><span class=p>))</span><span class=err>?$</span>
</span></span></code></pre></td></tr></table></div></div><p>Go 语言示例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;regexp&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>version</span> <span class=o>:=</span> <span class=s>&#34;0.1.2-alpha+001&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>pattern</span> <span class=o>:=</span> <span class=nx>regexp</span><span class=p>.</span><span class=nf>MustCompile</span><span class=p>(</span><span class=s>`^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>r</span> <span class=o>:=</span> <span class=nx>pattern</span><span class=p>.</span><span class=nf>FindStringSubmatch</span><span class=p>(</span><span class=nx>version</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>i</span><span class=p>,</span> <span class=nx>s</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>r</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%d -&gt; %s\n&#34;</span><span class=p>,</span> <span class=nx>i</span><span class=p>,</span> <span class=nx>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>0 -&gt; 0.1.2-alpha+001
</span></span></span><span class=line><span class=cl><span class=cm>1 -&gt; 0
</span></span></span><span class=line><span class=cl><span class=cm>2 -&gt; 1
</span></span></span><span class=line><span class=cl><span class=cm>3 -&gt; 2
</span></span></span><span class=line><span class=cl><span class=cm>4 -&gt; alpha
</span></span></span><span class=line><span class=cl><span class=cm>5 -&gt; 001
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=go-modules版本设计><a href=#go-modules%e7%89%88%e6%9c%ac%e8%ae%be%e8%ae%a1 class=header-anchor>#</a>
Go Modules版本设计</h3><h4 id=依赖地狱><a href=#%e4%be%9d%e8%b5%96%e5%9c%b0%e7%8b%b1 class=header-anchor>#</a>
依赖地狱</h4><p>我们先来看下早期 Go 依赖包存在的依赖地狱问题：</p><p><img src=/p/go-modules%E8%AF%A6%E8%A7%A3/index.assets/image-20240428182831893.png width=1097 height=513 srcset="/p/go-modules%E8%AF%A6%E8%A7%A3/index.assets/image-20240428182831893_hu10246893e1c443d1187588789017c05f_64039_480x0_resize_box_3.png 480w, /p/go-modules%E8%AF%A6%E8%A7%A3/index.assets/image-20240428182831893_hu10246893e1c443d1187588789017c05f_64039_1024x0_resize_box_3.png 1024w" loading=lazy alt=依赖地狱 class=gallery-image data-flex-grow=213 data-flex-basis=513px></p><p>首先存在两个包 <code>pkg1</code> 和 <code>pkg2</code>，分别依赖 <code>pkg3</code> 的 <code>v1.0.0</code> 版本和 <code>v2.0.0</code> 版本，现在我们开发一个 <code>app</code> 包，它依赖 <code>pkg1</code> 和 <code>pkg2</code>，那么此时由于 <code>app</code> 包只允许包含一个 <code>pkg3</code> 依赖，所以 Go 构建工具无法抉择应该使用哪个版本的 <code>pkg3</code>。这就是所谓的依赖地狱问题。</p><h4 id=语义导入版本><a href=#%e8%af%ad%e4%b9%89%e5%af%bc%e5%85%a5%e7%89%88%e6%9c%ac class=header-anchor>#</a>
语义导入版本</h4><p>为了解决依赖地狱问题，Go 在 1.11 版本时引入和 Go Modules：</p><p><img src=/p/go-modules%E8%AF%A6%E8%A7%A3/index.assets/image-20240428183011710.png width=1096 height=499 srcset="/p/go-modules%E8%AF%A6%E8%A7%A3/index.assets/image-20240428183011710_hu26cf2410430fcf457ac5158230a0c061_64758_480x0_resize_box_3.png 480w, /p/go-modules%E8%AF%A6%E8%A7%A3/index.assets/image-20240428183011710_hu26cf2410430fcf457ac5158230a0c061_64758_1024x0_resize_box_3.png 1024w" loading=lazy alt="Go Modules" class=gallery-image data-flex-grow=219 data-flex-basis=527px></p><p>Go Module 解决问题的方式是，把 <code>pkg3</code> 的 <code>v1.0.0</code> 版本和 <code>v2.0.0</code> 版本当作两个不同的包，这样也就允许了 <code>app</code> 包能够同时包含多个不同版本的 <code>pkg3</code>。</p><p>在使用时，需要在包的导入路径上加上包的主版本号。这里以 <a class=link href=https://github.com/go-micro/go-micro target=_blank rel=noopener><code>go-micro</code></a> 包使用为例，展示下 Go Module 语义导入版本的用法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;go-micro.dev/v4&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// create a new service
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>service</span> <span class=o>:=</span> <span class=nx>micro</span><span class=p>.</span><span class=nf>NewService</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>micro</span><span class=p>.</span><span class=nf>Name</span><span class=p>(</span><span class=s>&#34;helloworld&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// initialise flags
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>service</span><span class=p>.</span><span class=nf>Init</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// start the service
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>service</span><span class=p>.</span><span class=nf>Run</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>可以看到导入路径为 <code>"go-micro.dev/v4"</code>，其中 <code>v4</code> 就代表了需要引入 <code>go-micro</code> 的 <code>v4.y.z</code> 版本。</p><hr><h2 id=go-modules基本使用><a href=#go-modules%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8 class=header-anchor>#</a>
Go Modules基本使用</h2><h3 id=go-modules相关命令><a href=#go-modules%e7%9b%b8%e5%85%b3%e5%91%bd%e4%bb%a4 class=header-anchor>#</a>
go modules相关命令</h3><p>在 Go modules 中，我们能够使用如下命令进行操作：</p><div class=table-wrapper><table><thead><tr><th>命令</th><th>介绍</th></tr></thead><tbody><tr><td><code>go mod init &lt;project></code></td><td>初始化项目依赖，生成go.mod模块文件</td></tr><tr><td><code>go mod download</code></td><td>根据go.mod文件下载依赖</td></tr><tr><td><code>go mod tidy</code></td><td>比对项目文件中引入的依赖与go.mod进行比对,整理模块文件，去除没有用到的依赖</td></tr><tr><td><code>go mod graph</code></td><td>输出依赖关系图、查看现有的依赖结构</td></tr><tr><td><code>go mod edit</code></td><td>编辑go.mod文件</td></tr><tr><td><code>go mod vendor</code></td><td>将项目的所有依赖导出至vendor目录</td></tr><tr><td><code>go mod verify</code></td><td>检验一个依赖包是否被篡改过</td></tr><tr><td><code>go mod why</code></td><td>解释为什么需要某个依赖</td></tr></tbody></table></div><h3 id=go-modules参数配置><a href=#go-modules%e5%8f%82%e6%95%b0%e9%85%8d%e7%bd%ae class=header-anchor>#</a>
go modules参数配置</h3><ul><li><p><strong>GO111MODULE</strong></p><p>Go语言提供了 GO111MODULE 这个环境变量来作为 Go modules 的开关，其允许设置以下参数：</p><div class=table-wrapper><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>auto</td><td>只要项目包含了 go.mod 文件的话启用 Go modules，目前在 Go1.11 至 Go1.14 中仍然是默认值。</td></tr><tr><td>on</td><td>启用 Go modules，推荐设置，将会是Go1.16版本之后的默认值。</td></tr><tr><td>off</td><td>禁用 Go modules，不推荐设置。</td></tr></tbody></table></div><p>你可能会留意到 GO111MODULE 这个名字比较“奇特”，实际上在 Go 语言中经常会有这类阶段性的变量， GO111MODULE 这个命名代表着Go语言在 1.11 版本添加的。后续版本中可能会去掉。</p></li><li><p><strong>GOPROXY</strong></p><p>这个环境变量主要是用于设置 Go 模块代理（Go module proxy），其作用是用于使 Go 在后续拉取模块版本时能够脱离传统的 VCS（版本控制系统，如github，就是源地址下载） 方式，直接通过镜像站点来<strong>快速拉取</strong>。值为<code>off</code>表示禁止模块代理。</p><p>设置<code>GOPROXY</code>可以<strong>加速模块下载</strong>，<strong>确保构建确定性</strong>（提供稳定的构建版本），<strong>提高安全性</strong>，<strong>确保模块始终可用</strong>。</p><p>GOPROXY 的默认值是：<code>https://proxy.golang.org,direct</code>，由于某些原因国内无法正常访问该地址，所以我们通常需要配置一个可访问的地址。目前国内社区使用比较多的有两个 <a class=link href=https://goproxy.cn target=_blank rel=noopener>https://goproxy.cn</a>和 <a class=link href=https://goproxy.io target=_blank rel=noopener>https://goproxy.io</a>，当然如果你的公司有提供GOPROXY地址那么就直接使用。并且修改的代理，通过<code>go get</code>命令下载自己的公共模块，也会同步到 <a class=link href=https://pkg.go.dev/ target=_blank rel=noopener>https://pkg.go.dev/</a>。</p><p>设置GOPAROXY的命令如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>go env -w <span class=nv>GOPROXY</span><span class=o>=</span>https://goproxy.cn,direct
</span></span></code></pre></td></tr></table></div></div><p>GOPROXY 允许设置多个代理地址，多个地址之间需使用英文逗号 “,” 分隔。最后的 “direct” 是一个特殊指示符，用于指示 Go 回源到源地址去抓取（比如 GitHub 等）。当配置有多个代理地址时，如果第一个代理地址返回 404 或 410 错误时，Go 会自动尝试下一个代理地址，当遇见 “direct” 时触发回源，也就是<strong>回到源地址</strong>去抓取。就是代理失败之后用传统方式（源地址下载模块）。</p></li><li><p><strong>GOPRIVATE</strong></p><ul><li><p>GONOPROXY/GONOSUMDB/GOPRIVATE</p><p>这三个环境变量都是用在当前项目依赖了私有模块，例如像是你公司的私有 git 仓库，又或是 github 中的私有库，都是属于私有模块，都是要进行设置的，否则会拉取失败。</p><p>更细致来讲，就是依赖了由 GOPROXY 指定的 Go 模块代理或由 GOSUMDB 指定 Go checksum database 都无法访问到的模块时的场景。</p><p>而一般建议直接设置 GOPRIVATE，它的值将作为 GONOPROXY 和 GONOSUMDB 的默认值，所以建议的最佳姿势是直接使用 GOPRIVATE。</p></li></ul><p>设置了GOPROXY 之后，go 命令就会从配置的代理地址拉取和校验依赖包。当我们在项目中引入了非公开的包（公司内部git仓库或 github 私有仓库等），此时便无法正常从代理拉取到这些非公开的依赖包，这个时候就需要配置 GOPRIVATE 环境变量。GOPRIVATE用来告诉 go 命令哪些仓库属于私有仓库，不必通过代理服务器拉取和校验。</p><p>GOPRIVATE 的值也可以设置多个，多个地址之间使用英文逗号 “,” 分隔。我们通常会把自己公司内部的代码仓库设置到 GOPRIVATE 中，例如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ go env -w <span class=nv>GOPRIVATE</span><span class=o>=</span><span class=s2>&#34;git.example.com,github.com/arlettebrook/demo&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>设置后，前缀为 git.xxx.com 和 github.com/arlettebrook/demo的模块都会被认为是私有模块。</p><p>如果不想每次都重新设置，我们也可以利用通配符，例如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ go env -w <span class=nv>GOPRIVATE</span><span class=o>=</span><span class=s2>&#34;*.example.com&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>这样子设置的话，所有模块路径为 example.com 的子域名（例如：git.example.com）都将不经过 Go module proxy 和 Go checksum database，需要注意的是不包括 example.com 本身。</p><p>此外，如果公司内部自建了 GOPROXY 服务，那么我们可以通过设置 <code>GONOPROXY=none</code>，允许通内部代理拉取私有仓库的包。</p></li></ul><h3 id=go-modules模块文件><a href=#go-modules%e6%a8%a1%e5%9d%97%e6%96%87%e4%bb%b6 class=header-anchor>#</a>
go modules模块文件</h3><ul><li><p>初识化项目</p><p>在项目的根目录下运行<code>go mod init &lt;project></code>，如<code>go mod init github.com/arlettebrook/demo</code>，<code>demo</code>是项目名，<code>github.com/arlettebrook/demo</code>是模块导入路径，当导入的时候，如果本地没有，会去该路径下载。</p></li><li><p><strong>go.mod 文件</strong></p><p>在初始化项目时，会生成一个 go.mod 文件，是启用了 Go modules 项目所必须的最重要的标识，同时也是 GO111MODULE 值为 auto 时的识别标识，它描述了当前项目（也就是当前模块）的元信息，每一行都以一个动词开头。</p><p><strong>示例文件</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>module</span> <span class=nx>github</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>arlettebrook</span><span class=o>/</span><span class=nx>demo</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>go</span> <span class=mf>1.22.1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>require</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>example</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>apple</span> <span class=nx>v0</span><span class=mf>.1.2</span>
</span></span><span class=line><span class=cl>    <span class=nx>example</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>banana</span> <span class=nx>v1</span><span class=mf>.2.3</span>
</span></span><span class=line><span class=cl>    <span class=nx>example</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>banana</span><span class=o>/</span><span class=nx>v2</span> <span class=nx>v2</span><span class=mf>.3.4</span>
</span></span><span class=line><span class=cl>    <span class=nx>example</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>pear</span> <span class=c1>// indirect
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>example</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>strawberry</span> <span class=c1>// incompatible
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>exclude</span> <span class=nx>example</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>banana</span> <span class=nx>v1</span><span class=mf>.2.4</span>
</span></span><span class=line><span class=cl><span class=nx>replace</span> <span class=nx>example</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>apple</span> <span class=nx>v0</span><span class=mf>.1.2</span> <span class=p>=&gt;</span> <span class=nx>example</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>fried</span> <span class=nx>v0</span><span class=mf>.1.0</span> 
</span></span><span class=line><span class=cl><span class=nx>replace</span> <span class=nx>example</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>banana</span> <span class=p>=&gt;</span> <span class=nx>example</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>fish</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>说明</strong></p><ul><li><strong>module</strong>：用于定义当前项目的模块路径。</li><li><strong>go</strong>：用于标识当前模块的 Go 语言版本，值为初始化模块时的版本，目前来看还只是个标识作用。</li><li><strong>require</strong>：用于设置一个特定的模块版本。</li><li><strong>exclude</strong>：用于从使用中排除一个特定的模块版本。</li><li><strong>replace</strong>：用于将一个模块版本替换为另外一个模块版本。</li></ul><p>另外你会发现 <code>example.com/pear</code> 的后面会有一个 indirect 标识，indirect 标识表示该模块为间接依赖，也就是在当前应用程序中的 import 语句中，并没有发现这个模块的明确引用，有可能是你先手动 go get 拉取下来的，也有可能是你所依赖的模块所依赖的，情况有好几种。incompatible：不兼容的</p></li><li><p><strong>go.sum 文件</strong></p><p>在第一次拉取模块依赖后，会发现多出了一个 go.sum 文件，其详细罗列了当前项目直接或间接依赖的所有模块版本，并写明了那些模块版本的 SHA-256 哈希值以备 Go 在今后的操作中保证项目所依赖的那些模块版本不会被篡改。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>github</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>spf13</span><span class=o>/</span><span class=nx>cobra</span> <span class=nx>v1</span><span class=mf>.8.0</span> <span class=nx>h1</span><span class=p>:</span><span class=mi>7</span><span class=nx>aJaZx1B85qltLMc546zn58BxxfZdR</span><span class=o>/</span><span class=nx>W22ej9CFoEf0</span><span class=p>=</span>
</span></span><span class=line><span class=cl><span class=nx>github</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>spf13</span><span class=o>/</span><span class=nx>cobra</span> <span class=nx>v1</span><span class=mf>.8.0</span><span class=o>/</span><span class=k>go</span><span class=p>.</span><span class=nx>mod</span> <span class=nx>h1</span><span class=p>:</span><span class=nx>WXLWApfZ71AjXPya3WOlMsY9yMs7YeiHhFVlvLyhcho</span><span class=p>=</span>
</span></span><span class=line><span class=cl><span class=nx>github</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>spf13</span><span class=o>/</span><span class=nx>pflag</span> <span class=nx>v1</span><span class=mf>.0.5</span> <span class=nx>h1</span><span class=p>:</span><span class=nx>iy</span><span class=o>+</span><span class=nx>VFUOCP1a</span><span class=o>+</span><span class=mi>8</span><span class=nx>yFto</span><span class=o>/</span><span class=nx>drg2CJ5u0yRoB7fZw3DKv</span><span class=o>/</span><span class=nx>JXA</span><span class=p>=</span>
</span></span><span class=line><span class=cl><span class=nx>github</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>spf13</span><span class=o>/</span><span class=nx>pflag</span> <span class=nx>v1</span><span class=mf>.0.5</span><span class=o>/</span><span class=k>go</span><span class=p>.</span><span class=nx>mod</span> <span class=nx>h1</span><span class=p>:</span><span class=nx>McXfInJRrz4CZXVZOBLb0bTZqETkiAhM9Iw0y3An2Bg</span><span class=p>=</span>
</span></span></code></pre></td></tr></table></div></div><p>可以看到一个模块路径可能有如下两种：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>github</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>spf13</span><span class=o>/</span><span class=nx>cobra</span> <span class=nx>v1</span><span class=mf>.8.0</span> <span class=nx>h1</span><span class=p>:</span><span class=mi>7</span><span class=nx>aJaZx1B85qltLMc546zn58BxxfZdR</span><span class=o>/</span><span class=nx>W22ej9CFoEf0</span><span class=p>=</span>
</span></span><span class=line><span class=cl><span class=nx>github</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>spf13</span><span class=o>/</span><span class=nx>cobra</span> <span class=nx>v1</span><span class=mf>.8.0</span><span class=o>/</span><span class=k>go</span><span class=p>.</span><span class=nx>mod</span> <span class=nx>h1</span><span class=p>:</span><span class=nx>WXLWApfZ71AjXPya3WOlMsY9yMs7YeiHhFVlvLyhcho</span><span class=p>=</span>
</span></span></code></pre></td></tr></table></div></div><p>h1 hash 是 Go modules 将目标模块版本的 zip 文件开包后，针对所有包内文件依次进行 hash，然后再把它们的 hash 结果按照固定格式和算法组成总的 hash 值。</p><p>而 h1 hash 和 go.mod hash 两者，要不就是同时存在，要不就是只存在 go.mod hash。那什么情况下会不存在 h1 hash 呢，就是当 Go 认为肯定用不到某个模块版本的时候就会省略它的 h1 hash，就会出现不存在 h1 hash，只存在 go.mod hash 的情况。</p><p><code>go.mod</code>和<code>go.sum</code>都应该被提交到git仓库中去。当别人使用你的项目时，mod保证依赖版本一直，sum保证依赖不被篡改。</p></li></ul><h3 id=go-modules模块下载><a href=#go-modules%e6%a8%a1%e5%9d%97%e4%b8%8b%e8%bd%bd class=header-anchor>#</a>
go modules模块下载</h3><ul><li><p>我们下载、添加模块使用<code>go get -u &lt;module path></code>。</p></li><li><p>默认下载、添加最新版本，首先会检查本地（pkg：全局模块缓存）是否存在，没有，在去下载。</p></li><li><p>在项目中下载会自动添加到<code>go.mod</code>文件中。</p></li><li><p><code>-u</code>选项会更新模块的依赖包到最新版本，推荐加上。</p></li><li><p>还可以指定下载版本</p><div class=table-wrapper><table><thead><tr><th>命令</th><th>作用</th></tr></thead><tbody><tr><td>go get golang.org/x/text@latest</td><td>拉取最新的版本，若存在tag，则优先使用。可以省略。</td></tr><tr><td>go get golang.org/x/text@master</td><td>拉取 master 分支的最新 commit。@branch</td></tr><tr><td>go get <a class=link href=mailto:golang.org/x/text@v0.3.2>golang.org/x/text@v0.3.2</a></td><td>拉取 tag 为 v0.3.2 的 commit。@version，version必须满足语义化版本规范且前面加v。</td></tr><tr><td>go get golang.org/x/text@342b2e</td><td>拉取 hash 为 342b231 的 commit，最终会被转换为 v0.3.2。@commit</td></tr><tr><td>go get golang.org/x/text/v2</td><td>下载主版本号为2的最新版</td></tr></tbody></table></div></li><li><p>最新版本的选择</p><p>分两种情况</p><ol><li>最新版本有发布tags：就以发布的版本，version一般为<code>标签名</code>，如<code>v2.1.2</code></li><li>最新版本没有发布tags:就以提交的最新版本，version一般为<code>已发布标签-最新提交日期-最新提交哈希+版本编译信息</code>，版本编译信息一般没有。如<code>v2.1.2-20240416160154-fe59bbe5cc7f</code>，如果一次tags也没有发布，版本号则为v0.0.0，如<code>v0.0.0-20240416160154-fe59bbe5cc7f</code></li><li>子模块同理</li></ol></li></ul><h4 id=go-modules全局缓存><a href=#go-modules%e5%85%a8%e5%b1%80%e7%bc%93%e5%ad%98 class=header-anchor>#</a>
go modules全局缓存</h4><p>Go module 会把下载到本地的依赖包会以类似下面的形式保存在 <code>$GOPATH/pkg/mod</code>目录下，每个依赖包都会带有版本号进行区分，这样就允许在本地存在同一个包的多个不同版本。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>mod</span>
</span></span><span class=line><span class=cl><span class=err>├──</span> <span class=nx>cache</span>
</span></span><span class=line><span class=cl><span class=err>├──</span> <span class=nx>github</span><span class=p>.</span><span class=nx>com</span>
</span></span><span class=line><span class=cl><span class=err>├──</span> <span class=nx>golang</span><span class=p>.</span><span class=nx>org</span>
</span></span><span class=line><span class=cl><span class=err>├──</span> <span class=nx>google</span><span class=p>.</span><span class=nx>golang</span><span class=p>.</span><span class=nx>org</span>
</span></span><span class=line><span class=cl><span class=err>├──</span> <span class=nx>gopkg</span><span class=p>.</span><span class=nx>in</span>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span></code></pre></td></tr></table></div></div><p>如果想清除所有本地已缓存的依赖包数据，可以执行 <code>go clean -modcache</code> 命令。</p><h3 id=go-modules模块导入><a href=#go-modules%e6%a8%a1%e5%9d%97%e5%af%bc%e5%85%a5 class=header-anchor>#</a>
go modules模块导入</h3><ul><li><p>go模块导入用<code>import "模块路径"</code></p></li><li><p>当导入多个模块的时候用</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>  
</span></span><span class=line><span class=cl>    <span class=s>&#34;fmt&#34;</span>  
</span></span><span class=line><span class=cl>    <span class=s>&#34;os&#34;</span>  
</span></span><span class=line><span class=cl>    <span class=s>&#34;path/filepath&#34;</span>  
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>别名导入用<code>import 别名 "模块路径"</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=nx>f</span> <span class=s>&#34;fmt&#34;</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>点导入用<code>import . "模块路径"</code></p><p>点导入是一种特殊的导入方式，它将包中的所有公共标识符（函数、变量、类型等）提升到当前文件的命名空间中，这样在代码中就可以直接使用这些标识符，而不需要加上包名前缀。但是，这种方式可能会导致命名冲突和代码可读性下降，因此一般不建议使用。</p></li><li><p>空导入用<code>import _ "模块路径"</code></p><p>空导入通常用于初始化包中的变量或者执行包中的初始化函数，而不直接使用该包中的其他标识符。</p></li><li><p>注意事项</p><ul><li><p>当模块的主版本号为0或1的时候省略了主版本标识。</p></li><li><p>当主版本号为2及以上时，不能省略主版本标识。否则会出现冲突。</p></li><li><p>主版本标识只能为<code>/v主版本号</code>，不能用<code>@version</code>，一般使用主版本的最新版，这与语义化版本规范有关。</p></li><li><p>如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;github.com/jordan-wright/email&#34;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;github.com/jordan-wright/email/v4&#34;</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>为什么忽略 v0 和 v1 的主版本号</p><p>还是与语义化版本规范有关，v0属于开发初始阶段，其公共api不被视为稳定版，当版本到达v1，其公共api基本确定，在此之后如果不出现不兼容api的修改，是不会修改主版本号的。后续的次版本、修订号会向下兼容。这是官方所鼓励的。当api做了不兼容的修改，主版本号就会修改。<strong>为了不出现冲突就会加上主版本标识</strong>。</p></li></ul></li></ul><hr><h2 id=gopkgin介绍><a href=#gopkgin%e4%bb%8b%e7%bb%8d class=header-anchor>#</a>
gopkg.in介绍</h2><ul><li><p><code>gopkg.in</code>是旧go包管理工具中的一个，并不是官方包管理工具。作用是下载时重定向到相应github仓库。优点是： URL 更干净、更短、导入路径稳定、易于使用、支持版本控制。</p></li><li><p>浏览器打开链接，会提供对应包的godoc在线链接以及github仓库链接。</p></li><li><p><code>gopkg.in/ini.v1</code>对应github仓库为<code>githu.com/go-ini/ini</code>，当没有指定用户名时，用户名默认为<code>go-包名</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>gopkg</span><span class=p>.</span><span class=nx>in</span><span class=o>/</span><span class=nx>pkg</span><span class=p>.</span><span class=nx>v3</span>      <span class=err>→</span> <span class=nx>github</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=k>go</span><span class=o>-</span><span class=nx>pkg</span><span class=o>/</span><span class=nf>pkg</span> <span class=p>(</span><span class=nx>branch</span><span class=o>/</span><span class=nx>tag</span> <span class=nx>v3</span><span class=p>,</span> <span class=nx>v3</span><span class=p>.</span><span class=nx>N</span><span class=p>,</span> <span class=nx>or</span> <span class=nx>v3</span><span class=p>.</span><span class=nx>N</span><span class=p>.</span><span class=nx>M</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>gopkg</span><span class=p>.</span><span class=nx>in</span><span class=o>/</span><span class=nx>user</span><span class=o>/</span><span class=nx>pkg</span><span class=p>.</span><span class=nx>v3</span> <span class=err>→</span> <span class=nx>github</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>user</span><span class=o>/</span><span class=nf>pkg</span>   <span class=p>(</span><span class=nx>branch</span><span class=o>/</span><span class=nx>tag</span> <span class=nx>v3</span><span class=p>,</span> <span class=nx>v3</span><span class=p>.</span><span class=nx>N</span><span class=p>,</span> <span class=nx>or</span> <span class=nx>v3</span><span class=p>.</span><span class=nx>N</span><span class=p>.</span><span class=nx>M</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>版本控制用<code>.vNumber</code>表示.。</p></li><li><p>与<code>go modules</code>的区别：</p><ul><li>v1<code>gopkg.in</code>必须指定。<code>go mod</code>不用。</li><li><code>gopkg.in</code>分隔符是<code>.</code>（<code>go mod</code>是<code>/</code>）。</li><li>v0为开发版、不稳定版，不指定默认为开发版，<code>go mod</code>不指定默认为v0或v1。</li><li><code>gopkg.in</code>主版本为1就要指定主版本标识。<code>go mod</code>主版本为2才需要指定。</li></ul></li><li><p>如何让<code>gopkg.in</code>收录自己的模块：</p><ul><li>与<code>go mod</code>一样，当我们使用<code>go get</code>下载已经存在的版本仓库时，会自动同步到在线的<a class=link href=https://pkg.go.dev/ target=_blank rel=noopener>godoc</a>中。</li><li>建议仓库名与用户名关系是<code>pkg</code>与<code>go-pkg</code>，推荐<code>gopkg.in</code>。当然也可以直接使用github仓库路径。</li><li>其他情况可以使用<code>go mod</code>。并通过像 <code>proxy.golang.org</code> 这样的代理服务器来分发你的模块。</li></ul></li><li><p><code>gopkg.in</code>版本控制同样遵循[语义化版本控制](#Go Module 语义化版本规范)。</p></li></ul><hr><h2 id=总结><a href=#%e6%80%bb%e7%bb%93 class=header-anchor>#</a>
总结</h2><p>至此我们大致介绍了 Go modules 的前世今生、语义化版本规范以及基本使用。</p><p>Go modules 的成长和发展经历了一定的过程，如果你是刚接触的读者，直接基于 Go modules 的项目开始即可，如果既有老项目，那么是时候考虑切换过来了，Go1.14起已经准备就绪，并推荐你使用。</p><hr><h2 id=参考><a href=#%e5%8f%82%e8%80%83 class=header-anchor>#</a>
参考</h2><blockquote><ol><li><a class=link href=https://semver.org/lang/zh-CN/ target=_blank rel=noopener>https://semver.org/lang/zh-CN/</a></li><li><a class=link href=https://jianghushinian.cn/2023/01/01/Go-Module-%E8%AF%AD%E4%B9%89%E5%8C%96%E7%89%88%E6%9C%AC%E8%A7%84%E8%8C%83/ target=_blank rel=noopener>Go Module 语义化版本规范</a></li><li><a class=link href=https://blog.csdn.net/u011069013/article/details/110114319 target=_blank rel=noopener>Go Modules详解</a></li><li><a class=link href=https://juejin.cn/post/7149869713688887326 target=_blank rel=noopener>Go module详细介绍</a></li></ol></blockquote></section><footer class=article-footer><section class=article-tags><a href=/tags/go-modules/>Go Modules</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section><section class=article-lastmod><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>最后更新于 May 15, 2024 10:57 +0800</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/go-code-guide-introduction/><div class=article-details><h2 class=article-title>Go Code Guide Introduction</h2></div></a></article><article><a href=/p/go-ini-introduction/><div class=article-details><h2 class=article-title>Go-ini Introduction</h2></div></a></article><article><a href=/p/carbon-introduction/><div class=article-details><h2 class=article-title>Carbon Introduction</h2></div></a></article><article><a href=/p/godotenv-introduction/><div class=article-details><h2 class=article-title>Godotenv Introduction</h2></div></a></article><article><a href=/p/cast-introduction/><div class=article-details><h2 class=article-title>Cast Introduction</h2></div></a></article></div></div></aside><script src=//unpkg.com/@waline/client@v2/dist/waline.js></script><link href=//unpkg.com/@waline/client@v2/dist/waline.css rel=stylesheet><div id=waline class=waline-container></div><style>.waline-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding);--waline-font-size:var(--article-font-size)}.waline-container .wl-count{color:var(--card-text-color-main)}</style><script>Waline.init({copyright:!1,dark:'html[data-scheme="dark"]',el:"#waline",emoji:["https://unpkg.com/@waline/emojis@1.0.1/weibo"],lang:"zh-cn",locale:{admin:"👻Hi!",placeholder:"🎉留下你的脚印..."},pageview:!0,requiredMeta:["name","email"],serverURL:"https://waline.trojan123.top/"})</script><footer class=site-footer><section class=copyright>Copyright &copy;
2020 -
2024 <b><a href=https://github.com/arlettebrook target=_blank rel=noopener>@Arlettebrook</a></b></section><section class=powerby>博客内容遵循<b><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/legalcode.zh-hans target=_blank rel=noopener> 知识共享 署名-非商业性-相同方式共享4.0国际协议</a></b><br>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.25.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>